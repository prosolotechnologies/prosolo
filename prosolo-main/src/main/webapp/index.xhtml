<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:comp="http://java.sun.com/jsf/composite/components"
	template="templates/masterLayout2.xhtml"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:dlg="http://java.sun.com/jsf/composite/components/dialogs"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:util="http://www.prosolo.com/util"
	xmlns:courses="http://java.sun.com/jsf/composite/components/courses"
	xmlns:post="http://java.sun.com/jsf/composite/components/post"
	xmlns:people="http://java.sun.com/jsf/composite/components/people" >

	<ui:define name="windowTitle">
		ProSolo - Home
	</ui:define>

	<ui:define name="metadata">
		
	</ui:define>

    <ui:define name="resourceTitle">
    	<h1>Home</h1>
    </ui:define>
    
	<ui:define name="content">
	<h:outputScript library="javascript" name="prosolo.newpost.js" target="head" />
	
    <div class="whiteBar"></div>
    
    <div class="container">
    <p:growl id="growlMain" showDetail="true" globalOnly="true"></p:growl>
        <div class="row">
            <div class="col-md-6 wallTimeline">
                <div class="timelineHead">
                    <h2>What's happening</h2>
                    <div class="dropdown showDrop item">
                        <span>Show:</span>
                        <h:link id="linkStatusWallFilter" 
                        	pt:data-toggle="dropdown" pt:aria-haspopup="true" pt:aria-expanded="true">
                            #{activityWallBean.filter.label}
                            <span class="arrowDown">arrowDown</span>
                        </h:link>
                        <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenu1">
                        	<ui:repeat var="filter" value="#{activityWallBean.filters}">
                        		<li>
                        			<p:commandLink 
	                        			process="@this"
	                        			value="#{filter.label}"
			                        	action="#{activityWallBean.changeFilter(filter)}"
			                        	update=":linkStatusWallFilter :growlMain :statusWall">
			                        </p:commandLink>
                        		</li>
                        	</ui:repeat>
                        </ul>
                    </div>
                </div>

				
          		<post:newPost id="newPost"
          			learningContext="name:status_wall"
          			toUpdate=":statusWall"
          		/>
				
				<h:panelGroup id="statusWall">
					<ui:repeat var="sa" value="#{activityWallBean.socialActivities}">
						<post:wallPost id="wallPost"
							socialActivity="#{sa}"
							growlToUpdate=":growlMain"
							toUpdate=":statusWall"
							toUpdateShareModal=":formSharePost:panelSharePostModal"
							shareModalId="sharePostModal"
							jsFunctionToPrepareShareModal="initializeNewPostPluginForShare"
							learningContext="name:status_wall|context:/name:social_activity|id:#{sa.id}/"
						/>
					</ui:repeat>
				</h:panelGroup>
				
				<h:panelGroup id="panelLoadMore">
					<p:commandLink rendered="#{activityWallBean.moreToLoad}"
						value="Load more..."
						styleClass="btn btn-sm btn-green-stroke btnFullWidth"
						action="#{activityWallBean.loadMoreActivities()}"
						update=":panelLoadMore :statusWall">
					</p:commandLink>
				</h:panelGroup>
				

            </div>
            <div class="col-md-6">
                <div class="sidebarBlock">
                	<ui:fragment rendered="#{not empty credentialsInProgressBean.credentials}">
	                    <div class="inProgressHead">
	                        <h2>In Progress</h2>
	                        <h:link
							value="View All" outcome="/achievements/inprogress" />
	                    </div>
	                    <courses:recentNCredentialsInProgress 
	                    	learningContext="name:status_wall"
	                    />
	                </ui:fragment>
                </div>
                <div class="sidebarBlock">
                    <people:whoToFollow
                    	learningContext="name:status_wall"
                    />
                </div>
            </div>
        </div>
    </div>         

	<h:form id="formSharePost">
	   <!-- MODAL share post -->
       <div class="modal fade sharePostModal" id="sharePostModal" tabindex="-1" role="dialog" aria-labelledby="sharePostMod">
           <div class="modal-dialog" role="document">
               <h:panelGroup layout="block" id="panelSharePostModal" styleClass="modal-content">
               	 <ui:fragment rendered="#{not empty activityWallBean.socialActivityForShare}">
                   <div class="modal-header alignLeft">
                       <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&#215;</span></button>
                       <h2 class="modal-title" id="sharePostMod">Share Post</h2>
                   </div>
                   <div class="modal-body alignLeft">
                       <div class="textAreaWrapper">
                           <div class="contentEditable postShareEditableDivSelector" contenteditable="true" placeholder="Write something..." strip-br="true"></div>
                           <h:inputTextarea id="textAreaPostShareText" styleClass="postTextHidden" value="#{activityWallBean.postShareText}" style="display: none;"></h:inputTextarea>
                           <h:panelGroup id="panelUserSuggestion">
							   <h:panelGroup rendered="#{not empty userSearchBean.query and not empty userSearchBean.users}">
								 <ul class="dropdown-menu searchResultsDrop postShareUserSuggestRegionSelector" style="display:block;">
								 	<ui:repeat var="user" value="#{userSearchBean.users}">
								 		<li>
								 			 <a href="javascript:void(0);"
								 			 	data-id="#{util:encodeId(user.id)}"
								 			 	data-name="#{user.fullName}"
								 			 	onclick="newPostShare.selectSuggestedUser(this);">
						                   		<utilcomp:userAvatar
													avatar="#{user.avatarUrl}"
													fullName="#{user.fullName}"	
													width="32"
													height="32"
											    />  
											    <h3>#{user.fullName}</h3> 
			                  			 	 </a>
					                    </li>
								 	</ui:repeat>
				                 </ul>
				               </h:panelGroup>
		             	    </h:panelGroup>
		             	    <p:remoteCommand 
								name="searchUsersMentionedInPostShare" 
								update="panelUserSuggestion"
								process="userSuggestInput inputHiddenContext inputHiddenPage"
								action="#{userSearchBean.searchUsers()}"/>
					
							 <h:inputText id="userSuggestInput" style="display:none;"
									styleClass="postShareUserSuggestInputSelector"
									value="#{userSearchBean.query}" />
							 <h:inputText style="display:none;"
							 	id="inputHiddenContext"
							 	styleClass="inputHiddenContextSelector"
							 	value="#{userSearchBean.context}">
							 </h:inputText>
							 <h:inputText style="display:none;"
							 	id="inputHiddenPage"
							 	styleClass="inputHiddenPageSelector"
							 	value="#{userSearchBean.page}">
							 </h:inputText>
	                       </div>
                       <post:sharedPostPreview
                       		socialActivity="#{activityWallBean.socialActivityForShare}"
                       		sharedSocialActivityId="0"
                       />
                   </div>
                   <div class="modal-footer alignLeft">
                   	   <p:commandLink 
                   	   	 	styleClass="btn btn-green"
                   	   	 	process="textAreaPostShareText"
                   	   	 	action="#{activityWallBean.sharePost()}"
                   	   	 	update=":growlMain :statusWall"
                   	   	 	oncomplete="$('#sharePostModal').modal('hide');">
                   	   	 	<f:param name="page" value="#{facesContext.viewRoot.viewId}"/>
                 			<f:param name="learningContext" value="name:status_wall"/>
                 			<f:param name="service" value="name:post_share_dialog"/>
                   	   	 	Share
                   	   </p:commandLink>
                       <a href="#" class="btn btn-default" data-dismiss="modal">Cancel</a>
                   </div>
                  </ui:fragment>
               </h:panelGroup>
           </div>
       </div>
       <!-- MODAL share post end -->
	</h:form>
	<script>
		var newPostShare;
		function initializeNewPostPluginForShare() {
			$('#sharePostModal').newpost({
				editableDivSelector: '.textAreaWrapper .postShareEditableDivSelector',
				textAreaSelector: '.textAreaWrapper .postTextHidden',
				postOptionsSelector: '',
				postButtonEnabledSelector: '',
				postButtonDisabledSelector: '',
				newPostContainerSelector: '',
				uploadFileModalSelector: '',
				urlFieldSelector: '',
				addUrlButtonSelector: '',
				linkLoaderContainerSelector: '',
				userSuggestionRegionSelector: '.postShareUserSuggestRegionSelector',
				userSearchInputSelector: '.postShareUserSuggestInputSelector',
				userSearchAction: searchUsersMentionedInPostShare,
				allowUrlPreview : false,
				showHidePostOptions : false
			});
			newPostShare = $('#sharePostModal').data('newpost');
		}
	</script>
	
    </ui:define>
</ui:composition>