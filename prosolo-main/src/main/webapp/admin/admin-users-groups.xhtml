<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	template="templates/masterLayout2.xhtml"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:util="http://www.prosolo.com/util"
	xmlns:courses="http://java.sun.com/jsf/composite/components/courses"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util">

<ui:define name="windowTitle">
	Users
</ui:define>

<ui:define name="metadata">
	<f:metadata>
		<f:viewAction action="#{userGroupsBean.init()}" />
	</f:metadata>
</ui:define>

<ui:define name="navLinks">
	<ul class="nav nav-tabs headerSubmenu">
        <li role="presentation"><h:link outcome="/admin/users">Users</h:link></li>
        <li role="presentation" class="active"><a href="javascript:void(0);">Groups</a></li>
    </ul>
</ui:define>

<ui:define name="content">
	<script src="#{request.contextPath}/resources/javascript2/search.js"></script>
	<p:growl id="growlMain" showDetail="true" globalOnly="true"></p:growl>

    <div class="whiteBar">
        <div class="container">
            <div class="whiteBarContent">
                <div class="whiteBarLeft">
                    <p:commandLink 
                    	styleClass="btn btn-green btn-sm item" 
                    	pt:data-toggle="modal" 
                    	action="#{userGroupsBean.prepareGroupForAdding()}"
                    	update=":newGroupForm:panelNewGroup"
                    	oncomplete="$('#newGroupModal').modal('show');">
                    	New Group
                    </p:commandLink>
                    
                    <div class="searchBox">
                        <h:form>
                    		<p:remoteCommand 
								name="execSearchGroups" 
								process="inputGroupSearch"
								update=":panelGroups :pagination"
								action="#{userGroupsBean.resetAndSearch()}" />
														
							<h:inputText id="inputGroupSearch"
								type="search"
								placeholder="Filter by Keywords"
								value="#{userGroupsBean.searchTerm}"
								onclick="$(this).select();"
								onkeyup="searchListener(execSearchGroups);"/> 
                    	</h:form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <h:panelGroup layout="block" id="panelGroups" styleClass="col-md-12">
                <ul class="whiteBox peopleList">
                	<ui:repeat value="#{userGroupsBean.groups}" var="group">
	                    <li>
	                        <div class="peopleListLeft">
	                            <h2>#{group.name}</h2>
	                        </div>
	                        <div class="peopleListRight">
	                            <div class="studentsNum">
	                                Users: <span>#{group.userCount}</span>
	                            </div>
	                            <div class="userEditOpt">
	                                 <p:commandLink  
				                    	pt:data-toggle="modal" 
				                    	action="#{userGroupsBean.prepareGroupForEdit(group)}"
				                    	update=":newGroupForm:panelNewGroup"
				                    	oncomplete="$('#newGroupModal').modal('show');">
				                    	Edit Name
				                    </p:commandLink>
	
	                                <p:commandLink 
				                    	pt:data-toggle="modal" 
				                    	action="#{userGroupsBean.prepareGroupUsers(group.id)}"
				                    	update=":formManageUsers:panelManageUsers"
				                    	oncomplete="$('#addStudentsModal').modal('show');">
				                    	Manage Users
				                    </p:commandLink>
	
	                                <p:commandLink 
	                                	styleClass="linkRed" 
	                                	pt:data-toggle="modal" 
	                                	action="#{userGroupsBean.prepareGroupForEdit(group)}"
	                                	update=":formDeleteGroup:panelDeleteGroup"
	                                	oncomplete="$('#deleteGroup').modal('show');">
	                                	Delete
	                                </p:commandLink>
	                            </div>
	                        </div>
	                    </li>
                   	</ui:repeat>
                </ul>
            </h:panelGroup>
        </div>
        
        <utilcomp:pagination
	       	id="pagination" 
	       	bean="#{userGroupsBean}"
	       	links="#{userGroupsBean.paginationLinks}"
	       	toUpdate=":panelGroups"
		/>
    </div>
    
    <h:form id="newGroupForm">
    	<div class="modal fade newGroupModal" id="newGroupModal" tabindex="-1" role="dialog" aria-labelledby="nGroupModal">
            <div class="modal-dialog">
                <h:panelGroup layout="block" id="panelNewGroup" styleClass="modal-content">
                	<ui:fragment rendered="#{not empty userGroupsBean.groupForEdit}">
	                    <div class="modal-header alignLeft">
	                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&#215;</span></button>
	                        <h2 class="modal-title">#{userGroupsBean.groupForEdit.id > 0 ? 'Edit Group Name' : 'New Group'}</h2>
	                    </div>
	                    <div class="modal-body alignLeft">
	                        <h:inputText placeholder="Group Name" value="#{userGroupsBean.groupForEdit.name}"></h:inputText>
	                    </div>
	                    <div class="modal-footer alignLeft">
	                        <p:commandLink 
	                        	styleClass="btn btn-green"
	                        	action="#{userGroupsBean.saveGroup()}"
	                        	update=":panelGroups :growlMain :pagination"
	                        	oncomplete="$('#newGroupModal').modal('hide');">
	                        	<f:param name="page" value="#{facesContext.viewRoot.viewId}"></f:param>
								<f:param name="learningContext" value="name:edit_dialog#{userGroupsBean.groupForEdit.id > 0 ? '|id:'.concat(userGroupsBean.groupForEdit.id) : ''}"></f:param>
	                        	#{userGroupsBean.groupForEdit.id > 0 ? 'Done' : 'Create'}
	                        </p:commandLink>
	                        <a href="#" class="btn btn-default" data-dismiss="modal">Cancel</a>
	                    </div>
	                </ui:fragment>
                </h:panelGroup>
            </div>
        </div>
    </h:form>
    
    <h:form id="formManageUsers">
    	<div class="modal fade addStudentsModal" id="addStudentsModal" tabindex="-1" role="dialog" aria-labelledby="addStudentModal">
           <div class="modal-dialog">
               <h:panelGroup layout="block" id="panelManageUsers" styleClass="modal-content">
                   <ui:fragment rendered="#{groupUsersBean.users != null}">
	                   <div class="modal-header alignLeft">
	                       <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&#215;</span></button>
	                       <h2 class="modal-title">Manage Users</h2>
	                   </div>
	                   <div class="searchInstructors">
                    		<p:remoteCommand 
								name="execSearchGroupUsers" 
								process="inputGroupUsersSearch"
								update=":formManageUsers:panelManageUsers"
								action="#{groupUsersBean.resetAndSearch()}" />
														
							<h:inputText id="inputGroupUsersSearch"
								type="search"
								placeholder="Filter Users"
								value="#{groupUsersBean.searchTerm}"
								onclick="$(this).select();"
								onkeyup="searchListener(execSearchGroupUsers);"/> 
	                   </div>
	                   <h:panelGroup id="panelUsers">
		                   <ul class="list">
		                       <ui:repeat var="user" value="#{groupUsersBean.users}" varStatus="status">
			                       	<li>
			                           <div class="instructorInfo">
			                               <div class="checkbox checkLine">
			                                   <h:selectBooleanCheckbox id="selectBooleanUser"
				                                    value="#{user.selected}">
				                                    <p:ajax 
				                                    	event="change" 
				                                    	process="@this" 
				                                    	listener="#{groupUsersBean.userGroupAssignChecked(status.index)}">
				                                    </p:ajax>
				                               </h:selectBooleanCheckbox>
		                              	  	   <h:outputLabel for="selectBooleanUser" />
			                               </div>
			                               <utilcomp:userAvatar
												avatar="#{user.user.avatarUrl}"
												fullName="#{user.user.fullName}" 
												width="48"
												height="48"/>
			                               <div class="infoWrap">
			                                   <h3>#{user.user.fullName}</h3>
			                                   <span>#{user.user.position}</span>
			                               </div>
			                           </div>
			                        </li>
		                       </ui:repeat>
		                   </ul>
		               </h:panelGroup>
	                   <utilcomp:pagination
					       	id="pagination" 
					       	bean="#{groupUsersBean}"
					       	links="#{groupUsersBean.paginationLinks}"
					       	toUpdate=":formManageUsers:panelUsers"
						/>
	                   <div class="modal-footer alignLeft">
	                       <p:commandLink 
	                       		styleClass="btn btn-green"
	                       		action="#{groupUsersBean.updateGroupUsers()}"
	                       		update=""
	                       		oncomplete="$('#addStudentsModal').modal('hide');">
	                       		Done
	                       	</p:commandLink>
	                   </div>
                   </ui:fragment>
               </h:panelGroup>
           </div>
       </div>
    </h:form>
    
    <h:form id="formDeleteGroup">
    	<div class="modal fade" id="deleteGroup" tabindex="-1" role="dialog" aria-labelledby="delGroup">
            <div class="modal-dialog" role="document">
                 <h:panelGroup layout="block" id="panelDeleteGroup" styleClass="modal-content">
                 	<ui:fragment rendered="#{not empty userGroupsBean.groupForEdit}">
	                     <div class="modal-header">
	                         <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&#215;</span></button>
	                         <h2 class="modal-title" id="delGroup">Delete group?</h2>
	                     </div>
	                     <div class="modal-body">
	                         <p>
	                             Are you sure you want to delete group "#{userGroupsBean.groupForEdit.name}"?
	                         </p>
	                     </div>
	                     <div class="modal-footer">
	                         <p:commandLink 
	                         	styleClass="btn btn-red"
	                         	action="#{userGroupsBean.deleteGroup()}"
	                         	update=":panelGroups :pagination :growlMain"
	                         	oncomplete="$('#deleteGroup').modal('hide');">
	                         	<f:param name="page" value="#{facesContext.viewRoot.viewId}"></f:param>
								<f:param name="learningContext" value="name:delete_dialog|id:#{userGroupsBean.groupForEdit.id}"></f:param>
	                         	Delete
	                         </p:commandLink>
	                         <a href="#" class="btn btn-default" data-dismiss="modal">Cancel</a>
	                     </div>
                    </ui:fragment>
                 </h:panelGroup>
            </div>
         </div>
    </h:form>

 </ui:define>
</ui:composition>
