<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	template="templates/masterLayout1.xhtml"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:dlg="http://java.sun.com/jsf/composite/components/admin/dialogs">

<ui:define name="windowTitle">
	Administration: Analytics Settings
</ui:define>

<ui:define name="metadata">
	<f:metadata>
		<f:viewAction action="#{analyticsSettingsBean.init()}" />
	</f:metadata>
</ui:define>

<ui:define name="content">

	<section class="heading">
		<header>
			<i class="fa fa-tasks headIcon"></i>
			<div class="headerTitle">
				<h1>Analytics Settings</h1>
				<p>Here you can setup symptoms and interventions used for student observations.</p>
			</div>
		</header>
	</section>

	<section class="container-fluid mainArea analyticsSettings">
		<div class="row">
			<div class="panel panel-default">
				<div class="panel-heading">
       				<h3 class="panel-title">Symptoms</h3>
				</div>
				
				<div class="panel-body">
					<div class="row">
						<div class="col-md-12">

							<h:form id="newSymptomForm">
								<p:growl id="symptomGrowl" showDetail="true" globalOnly="true" sticky="true" />
								
								<table>
									<tr>
										<td class="col1">
											<h:outputLabel for="newSymptomDesc">Name:</h:outputLabel>
										</td>
										<td>
											<h:inputText id="newSymptomDesc"
												value="#{analyticsSettingsBean.newSymptom.description}"
												required="true" requiredMessage="Name is required"
												validator="#{analyticsSettingsBean.validateNewSymptomName}" />
										</td>
										<td>
											<p:commandLink styleClass="blue button size25"
												process="newSymptomDesc"
												actionListener="#{analyticsSettingsBean.saveSymptom()}"
												value="Save" update="@form :symptomForm">
											</p:commandLink>
										</td>
									</tr>
								</table>
							</h:form>
				
							<br/>
							<br/>
							
							<h:form id="symptomForm">
								<table class="table table-bordered table-striped">
									<thead>
										<tr>
											<th style="width: 500px;">Name</th>
											<th>Edit</th>
											<th>Delete</th>
										</tr>
									</thead>
									<tbody>
										<ui:repeat var="symptom" value="#{analyticsSettingsBean.symptoms}" varStatus="symptomStatus">
											<tr>
												<td class="nameField">
													<h:panelGroup id="symptomData">
														<h:outputText styleClass="name" value="#{symptom.description}" />
														
														<div class="editableName" style="display: none;">
															<div class="editable-input" style="position: relative;">
																<h:inputText id="symptomNameInputText"
																	styleClass="form-control input-lg"
																	value="#{symptom.description}" />
																<span class="editable-clear-x"></span>
															</div>
															<div class="editable-buttons">
																<p:commandLink styleClass="btn btn-primary btn-sm editable-submit"
																	action="#{analyticsSettingsBean.updateSymptom()}"
																	process="symptomNameInputText"
																	update="symptomData :newSymptomForm:symptomGrowl">
																	<i class="glyphicon glyphicon-ok"></i>
																</p:commandLink>
																
																<button type="button"
																	class="btn btn-default btn-sm editable-cancel"
																	onclick="$(this).parent().parent().hide();$(this).parent().parent().parent().find('.name').show();">
																	<i class="glyphicon glyphicon-remove"></i>
																</button>
															</div>
														</div>
													</h:panelGroup>
												</td>
												<td>
													<p:commandLink styleClass="btn btn-default" onclick=
														"$(this).parent().parent().parent().find('.editableName').hide();$(this).parent().parent().parent().find('.name').show();$(this).parent().parent().find('.editableName').show();$(this).parent().parent().find('.name').hide();"
														action="#{analyticsSettingsBean.prepareSymptomEdit(symptom)}">
														<i class="fa fa-edit"></i>
														Edit
													</p:commandLink>
												</td>
												<td>
													<p:commandLink styleClass="btn btn-default remove"
														process="@this"
														rendered="#{!analyticsSettingsBean.isSymptomUsed(symptom.id)}"
														onclick="$('#deleteSymptomDialog').dialog('open');"
														action="#{analyticsSettingsBean.prepareSymptomEdit(symptom)}"
														update=":delSymptomDlg:deleteSymptomDialogForm">
														<i class="fa fa-times"></i>
														Delete
													 </p:commandLink>
							
													<p:commandLink value="Delete"
														styleClass="button disabled gray size25 hasTooltip"
														rendered="#{analyticsSettingsBean.isSymptomUsed(symptom.id)}" />
												</td>
											</tr>
										</ui:repeat>
									</tbody>
								</table>
							</h:form>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>

	<section class="container-fluid mainArea settings">
		<div class="row">
			<div class="panel panel-default">
				<div class="panel-heading">
       				<h3 class="panel-title">Suggestions</h3>
				</div>
				
				<div class="panel-body">
					<div class="row">
						<div class="col-md-12">
							<h:form id="newSuggestionForm">
								<p:growl id="suggestionGrowl" showDetail="true" globalOnly="true" />
								
								<table>
									<tr>
										<td class="col1">
											<h:outputLabel for="newSuggestionDesc">Name:</h:outputLabel>
										</td>
										<td>
											<h:inputText id="newSuggestionDesc"
												value="#{analyticsSettingsBean.newSuggestion.description}"
												required="true" requiredMessage="Name is required"
												validator="#{analyticsSettingsBean.validateNewSuggestionName}" />
										</td>
										<td>
											<p:commandLink styleClass="blue button size25"
												process="newSuggestionDesc"
												actionListener="#{analyticsSettingsBean.saveSuggestion}"
												value="Save" update="@form :suggestionForm">
											</p:commandLink>
										</td>
									</tr>
				
									<tr>
										<td></td>
										<td>
											<h:message for="newSuggestionDesc" style="color: red"></h:message>
										</td>
										<td></td>
									</tr>
								</table>
							</h:form>
				
							<br>
							</br>
				
							<h:form id="suggestionForm">
								<table class="table table-bordered table-striped">
									<thead>
										<tr>
											<th style="width: 500px;">Name</th>
											<th>Edit</th>
											<th>Delete</th>
										</tr>
									</thead>
									<tbody>
										<ui:repeat var="suggestion" value="#{analyticsSettingsBean.suggestions}" varStatus="suggestionStatus">
											<tr>
												<td class="nameField">
													<h:panelGroup id="suggestionData">
														<h:outputText styleClass="name" value="#{suggestion.description}" />
														
														<div class="editableName" style="display: none;">
															<div class="editable-input" style="position: relative;">
																<h:inputText id="symptomNameInputText"
																	styleClass="form-control input-lg"
																	value="#{suggestion.description}" />
																<span class="editable-clear-x"></span>
															</div>
															<div class="editable-buttons">
																<p:commandLink styleClass="btn btn-primary btn-sm editable-submit"
																	action="#{analyticsSettingsBean.updateSuggestion()}"
																	process="symptomNameInputText"
																	update="suggestionData :newSuggestionForm:suggestionGrowl">
																	<i class="glyphicon glyphicon-ok"></i>
																</p:commandLink>
																
																<button type="button"
																	class="btn btn-default btn-sm editable-cancel"
																	onclick="$(this).parent().parent().hide();$(this).parent().parent().parent().find('.name').show();">
																	<i class="glyphicon glyphicon-remove"></i>
																</button>
															</div>
														</div>
													</h:panelGroup>
												</td>
												<td>
													<p:commandLink styleClass="btn btn-default" onclick=
														"$(this).parent().parent().parent().find('.editableName').hide();$(this).parent().parent().parent().find('.name').show();$(this).parent().parent().find('.editableName').show();$(this).parent().parent().find('.name').hide();"
														action="#{analyticsSettingsBean.prepareSuggestionEdit(suggestion)}">
														<i class="fa fa-edit"></i>
														Edit
													</p:commandLink>
												</td>
												<td>
													<p:commandLink styleClass="btn btn-default remove"
														process="@this"
														rendered="#{!analyticsSettingsBean.isSuggestionUsed(suggestion.id)}"
														onclick="$('#deleteSuggestionDialog').dialog('open');"
														action="#{analyticsSettingsBean.prepareSuggestionEdit(suggestion)}"
														update=":delSuggestionDlg:deleteSuggestionDialogForm">
														<i class="fa fa-times"></i>
														Delete
													 </p:commandLink>
							
				
													<p:commandLink value="Delete"
														styleClass="button disabled gray size25 hasTooltip"
														rendered="#{analyticsSettingsBean.isSuggestionUsed(suggestion.id)}" />
												</td>
											</tr>
										</ui:repeat>
									</tbody>
								</table>
							</h:form>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
	
	<dlg:deleteSymptomOrSuggestion id="delSymptomDlg"
		name="#{analyticsSettingsBean.symptomForEdit.description}"
		context="Symptom" 
		update=":symptomForm :newSymptomForm:symptomGrowl"
		action="#{analyticsSettingsBean.deleteSymptom}" />

	<dlg:deleteSymptomOrSuggestion id="delSuggestionDlg"
		name="#{analyticsSettingsBean.suggestionForEdit.description}"
		context="Suggestion" 
		update=":suggestionForm :newSymptomForm:symptomGrowl"
		action="#{analyticsSettingsBean.deleteSuggestion}" />
	
</ui:define>
</ui:composition>