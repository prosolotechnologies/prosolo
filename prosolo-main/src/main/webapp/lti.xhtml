<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:comp="http://java.sun.com/jsf/composite/components"
	template="templates/masterLayout2.xhtml"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:dlg="http://java.sun.com/jsf/composite/components/dialogs">

<f:view transient="true" contentType="text/html">
<h:head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="#{request.contextPath}/favicon.ico" type="image/x-icon" />
    <title>External tool | ProSolo</title>
    <link href="#{request.contextPath}/resources/css2/bootstrap.min.css" rel="stylesheet" />
    <link href="#{request.contextPath}/resources/css2/awesome-bootstrap-checkbox.css" rel="stylesheet" />
    <link href="#{request.contextPath}/resources/css2/style.css" rel="stylesheet" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
</h:head>

<f:metadata>
	<f:viewParam name="launchUrl" value="#{ltiBean.launchUrl}" />
	<f:viewParam name="sharedSecret" value="#{ltiBean.sharedSecret}" />
	<f:viewParam name="consumerKey" value="#{ltiBean.consumerKey}" />
	<f:viewParam name="activityId" value="#{ltiBean.activityId}" />
	<f:viewParam name="targetActivityId" value="#{ltiBean.targetActivityId}" />
</f:metadata>
	
<h:body>
	<h:outputScript library="javascript" name="oauth.js" target="head" />
	<h:outputScript library="javascript" name="sha1.js" target="head" />
	<h:outputScript library="javascript" name="prosolo.lti.js" target="head" />
	
			
	<form action="#{ltiBean.launchUrl}" name="ltiLaunchForm" target="basicLtiLaunchFrame" 
		onsubmit="form.removeChild(document.getElementById('javax.faces.ViewState'))" method="post" 
		enctype="application/x-www-form-urlencoded">
			<input type="hidden" name="context_id" value="3" />
			<input type="hidden" name="context_label" value="lesson_label" />
			<input type="hidden" name="context_title" value="lesson_title" />
			<input type="hidden" name="lti_message_type" value="basic-lti-launch-request" />
			<input type="hidden" name="lti_version" value="LTI-1p0" />
			<input type="hidden" name="resource_link_id" value="#{ltiBean.activityId}" />           
			<input type="hidden" name="user_id" value="#{loggeduser.userId}" />
			<input type="hidden" name="lis_outcome_service_url" value="#{applicationbean.domain}api/lti/replaceresult" />
			<input type="hidden" name="lis_person_name_full" value="#{loggeduser.name} #{loggeduser.lastName}" />
			<input type="hidden" name="lis_person_name_family" value="#{loggeduser.lastName}" />
			<input type="hidden" name="lis_person_name_given" value="#{loggeduser.name}" />
			<input type="hidden" name="lis_person_contact_email_primary" value="#{loggeduser.email}" />
			<input type="hidden" name="tool_consumer_instance_url" value="#{applicationbean.domain}" />
			<input type="hidden" name="lis_result_sourcedid"  value="#{loggeduser.userId}::#{ltiBean.activityId}::#{ltiBean.targetActivityId}" />
			<input type="hidden" name="oauth_version" value="1.0" />
			<input type="hidden" name="oauth_consumer_key" value="#{ltiBean.consumerKey}" />
			<input type="hidden" name="oauth_callback" value="about:blank" />
			<input type="hidden" name="oauth_signature" value="blahs" />
			<input type="hidden" name="oauth_nonce" value="0" />
			<input type="hidden" name="oauth_timestamp" value="0" />
			<input type="hidden" name="oauth_signature_method" value="HMAC-SHA1" />            
			<input type="hidden" name="ltiLaunchForm" value="" />
			<input type="button" hidden="true" onclick="doOnLoad('#{ltiBean.sharedSecret}','#{ltiBean.launchUrl}',this.form)" 
				id="submitLTILaunchFormButton" name="submit_form_button" class="hidden" value="Launch external tool" />
	</form>
	
	<script>
	$(function() {
		$('#submitLTILaunchFormButton').click();
	});
	</script>

	<iframe name="basicLtiLaunchFrame"  id="basicLtiLaunchFrame" src=""
		width="100%" height="900" scrolling="auto" frameborder="1" allowTransparency="true">
		<p>frames_required</p>
	</iframe>

</h:body>
</f:view>
</html>
	
