<ui:component
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:p="http://primefaces.org/ui"
	xmlns:comp="http://java.sun.com/jsf/composite/components"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util"
	xmlns:util="http://www.prosolo.com/util"
	xmlns:courses="http://java.sun.com/jsf/composite/components/courses"
	xmlns:dialogs="http://java.sun.com/jsf/composite/components/dialogs"
	xmlns:compDialogs="http://java.sun.com/jsf/composite/components/dialogs/competences">

	<composite:interface>
		<composite:attribute name="role" type="java.lang.String" default="USER"/>
		<composite:attribute name="toUpdate" default=""></composite:attribute>
		<composite:attribute name="learningContext" default=""/>
		<composite:attribute name="service" default="" />
		<composite:attribute name="actAdded" type="java.lang.Boolean" default="false" />
	</composite:interface>
	
	<composite:implementation>
		<h:outputStylesheet name="bootstrap-datetimepicker.css" library="css2"/>
		<link rel="stylesheet" type="text/css" media="all" href="#{request.contextPath}/resources/css2/bootstrap-tagsinput.css" />
		<script src="#{request.contextPath}/resources/javascript2/bootstrap-tagsinput.min.js"></script>
		<script src="#{request.contextPath}/resources/javascript2/moment.min.js"></script>
		<script src="#{request.contextPath}/resources/javascript2/bootstrap-datetimepicker.min.js"></script>
		<script src="#{request.contextPath}/resources/javascript2/createCompetence.js"></script>
		<script src="#{request.contextPath}/resources/javascript2/tinymce/tinymce.min.js"></script>
	    <script src="#{request.contextPath}/resources/javascript2/prosolo.tinymce.js"></script>
		
	    <div class="whiteBar">
	
	    </div>
	    
	    <div class="container">
	    	<ui:fragment rendered="#{not empty param['credId']}">
	    		<ol class="breadcrumb">
		            <li>
		            	<h:link value="Credentials" outcome="credentialLibrary"/>
		            </li>
		            <li>
		            	<h:link 
		            		value="#{competenceEditBean.credTitle}"
		            		outcome="create-credential">
		            		<f:param name="id" value="#{param['credId']}"></f:param>
		            	</h:link>
		            </li>
		            <ui:fragment rendered="#{!competenceEditBean.isCreateUseCase()}">
		            	<li class="active">#{competenceEditBean.competenceData.title}</li>
		            </ui:fragment>
		            <ui:fragment rendered="#{competenceEditBean.isCreateUseCase()}">
		            	<li class="active">New Competence</li>
		            </ui:fragment>
		        </ol>
	    	</ui:fragment>
	        <ui:fragment rendered="#{empty param['credId']}">
	    		<ol class="breadcrumb">	 
	    			<li>
		            	<a href="javascript:void(0);">Competences</a>
		            </li> 
	    			<ui:fragment rendered="#{!competenceEditBean.isCreateUseCase()}">
		            	<li class="active">#{competenceEditBean.competenceData.title}</li>
		            </ui:fragment>
		            <ui:fragment rendered="#{competenceEditBean.isCreateUseCase()}">
		            	<li class="active">New Competence</li>
		            </ui:fragment>
		        </ol>
	    	</ui:fragment>
	    </div>
	    
	    <div id="#{cc.clientId}">
		    <script>
				containerId = '#{cc.clientId}';
			</script>
			
			<h:form id="formMain">
				<p:growl id="growlMain" showDetail="true" globalOnly="true"></p:growl>
				<h:inputHidden id="hiddenType" value="#{competenceEditBean.competenceData.typeString}" />
			    
			    <div class="container">
			        <div class="row">
			            <div class="col-md-8">
			            	<h:panelGroup layout="block" rendered="#{competenceEditBean.limitedEdit}" styleClass="alert alert-warning" role="alert">
			            		Competence is published... Only limited edits are allowed.
			            	</h:panelGroup>
			                <div class="whiteBox">
			                    <ul class="nav nav-tabs pageSubmenu" role="tablist">
			                        <li role="presentation" class="#{!cc.attrs.actAdded ? 'active' : ''}"><a href="#info" aria-controls="info" role="tab" data-toggle="tab">Competence Info</a></li>
			                        <li role="presentation" class="#{cc.attrs.actAdded ? 'active' : ''}"><a href="#activities" aria-controls="activities" role="tab" data-toggle="tab">Activities</a></li>
			                    </ul>
			                </div>
			                <div class="tab-content">
			                    <div role="tabpanel" class="tab-pane fade #{!cc.attrs.actAdded ? 'active in' : ''}" id="info">
			                        <div class="whiteBox">
			                            <h2>Competence Info</h2>
			                            <div class="formWrapper">
			                                <div class="formLine">
			                                    <label>Parent credential(s)</label>
			                                    <div class="formLineRight">
			                                        <ul class="addedItems">
			                                        	<ui:repeat var="cred" value="#{competenceEditBean.competenceData.credentialsWithIncludedCompetence}">
			                                        		<li>
			                                        			<h:link value="#{cred.title}"
			                                        				outcome="credential.xhtml">
			                                        				<f:param name="id" value="#{util:encodeId(cred.id)}" />
			                                        			</h:link>
				                                            </li>
			                                        	</ui:repeat>                                     
			                                        </ul>
			                                    </div>
			                                </div>
			                                <div class="formLine">
			                                    <label>Title</label>
			                                    <div class="formLineRight">
			                                    	<h:inputText 
			                                    		id="inputTitle"
			                                    		styleClass="pasteable"
			                                    		value="#{competenceEditBean.competenceData.title}"
			                                    		required="true"
														requiredMessage="Title is required"
													/>
													<h:panelGroup 
							                        	layout="block" 
							                        	rendered="#{not empty facesContext.getMessageList(cc.clientId.concat(':formMain:inputTitle'))}" 
							                        	styleClass="alert alert-danger" 
							                        	pt:role="alert">
							                            <h:message for="inputTitle"></h:message>
							                        </h:panelGroup>
			                                    </div>
			                                </div>
			                                <div class="formLine">
			                                    <label>About competence</label>
			                                    <div class="formLineRight">
			                                        <h:inputTextarea
			                                        	id="description"
			                                        	styleClass="pasteable"
			                                        	value="#{competenceEditBean.competenceData.description}" />
			                                        	
			                                        <script>
			                                    		initTinyMCE('#createCompetence\\:formMain\\:description');
			                                    	</script>
			                                    </div>
			                                </div>
			                                <div class="formLine">
			                                    <label>Keywords</label>
			                                    <div class="formLineRight">
			                                    	<h:inputText styleClass="tagsInputCompTag"
			                                    		id="inputKeywords"
					                                	value="#{competenceEditBean.competenceData.tagsString}"
					                                	pt:placeholder="Type and press 'Enter'"
					                                	pt:data-role="tagsinput">
				                                	</h:inputText>
			                                    </div>
			                                </div>
			                                <script>$('.tagsInputCompTag').tagsinput();</script>
			                                <div class="formLine">
			                                    <label>Other</label>
			                                    <div class="formLineRight">                           
			                                        <div class="checkbox checkLine">
														<h:selectBooleanCheckbox disabled="#{competenceEditBean.limitedEdit}"
															id="selectAllowStudentsToAddActivities"
															value="#{competenceEditBean.competenceData.studentAllowedToAddActivities}">
														</h:selectBooleanCheckbox>
														
														<h:outputLabel for="selectAllowStudentsToAddActivities">
															Allow students to add activities
														</h:outputLabel>
													</div>
			                                    </div>
			                                </div>
			                            </div>
			                        </div>
			                    </div>
			                    <div role="tabpanel" class="tab-pane fade #{cc.attrs.actAdded ? 'active in' : ''}" id="activities">
			                    <div class="whiteBox activitiesList">
			                    	<courses:activityList
			                    		id="activityList"
			                    		activities="#{competenceEditBean.competenceData.activities}"
			                    		bean="#{competenceEditBean}"
			                    		isEdit="true"
			                    		showMarkedIfCompleted="false"
			                    		encodedCompetenceId="#{param['id']}"
			                    		encodedCredentialId="#{param['credId']}"
			                    		toUpdate=""
			                    		mainForm=":#{cc.clientId}:formMain"/>
			                    		
			                    </div>
			                    </div>
			                </div>
			            </div>
			            <div class="col-md-4">
							<h:panelGroup layout="block" rendered="#{!competenceEditBean.createUseCase}" styleClass="whiteBox publishBox visibilityBox">
			                    <h2>Visibility</h2>
			                    <div class="clear"></div>
			                    <p:commandLink 
			                    	styleClass="btn btn-green-stroke" 
			                    	pt:data-toggle="modal" 
			                    	action="#{competenceEditBean.initVisibilityManageData()}"
			                    	update=":#{cc.clientId}:resourceVisibilityModal:formManageVisibility:panelManageVisibility"
			                    	oncomplete="$('#manageVisibility').modal('show');">
			                    	Manage Visibility
			                    </p:commandLink>
			                </h:panelGroup>			            
			            	<div id="noteDraft" class="alert alert-warning alert-dismissible" role="alert" style="#{competenceEditBean.competenceData.published ? 'display:none' : ''}">
			                    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button>
			                   	Competency is now <strong>Draft</strong>. In order for changes to be available to others, change status to <strong>Published</strong>.
			                </div>
			                
			                <div id="noteDraft" class="alert alert-warning alert-dismissible" role="alert" style="#{competenceEditBean.competenceData.canUnpublish ? 'display:none' : ''}">
			                    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button>
			                    You are not allowed to unpublish a competency as it is a part of one or more active credential deliveries. Only when all deliveries of a credential with this competency have ended, a competency can be unpublished.
			                </div>
			                
			            	<courses:rightSideBar
			            		id="compSideBar"
			            		publishValues="#{competenceEditBean.compStatusArray}" 
			            		publishValue="#{competenceEditBean.competenceData.status}"
			            		saveAction="#{competenceEditBean.save}"
			            		onclickSave="copyTextFromTinyMCEToTextarea('#createCompetence\\:formMain\\:description');"
			            		toUpdate=":#{cc.clientId}:formMain #{cc.attrs.toUpdate} :#{cc.clientId}:archiveDialog :#{cc.clientId}:restoreDialog :#{cc.clientId}:duplicateDialog" 
			            		resource="COMPETENCE"
			            		role="#{cc.attrs.role}"
			            		resourceLowerCase="competence"
								childResourcePlural="activities"
								statusChangeDisabled="#{not competenceEditBean.competenceData.canUnpublish}"
								archiveModal="#archiveModal"
								duplicateModal="#duplicateComp"
								restoreModal="#restoreModal"
								archived="#{competenceEditBean.competenceData.archived}"
								resourceId="#{competenceEditBean.competenceData.competenceId}"/>
			            </div>
			        </div>
	
		    	</div>
		    	
		    	<script>  
		        	var type = null;
		        	if('#{cc.attrs.role}' === "USER") {
		        		type = "user_created";
		        	} else {
		        		type = "university_created";
		        	}
					document.getElementById('#{cc.clientId}:formMain:hiddenType').value = type;
		        </script>
		    </h:form>
	    
		    <h:form id="formRemoveActivityModal">
		    	<div class="modal fade" id="modalRemoveActivity" tabindex="-1" role="dialog" aria-labelledby="removeActivity">
		            <div class="modal-dialog" role="document">
		                <div class="modal-content">
		                    <div class="modal-header">
		                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&#215;</span></button>
		                        <h2 class="modal-title" id="removeActivity1">Remove Activity?</h2>
		                    </div>
		                    <div class="modal-body">
		                        <p>Are you sure you want to remove this activity from competence?<br></br><br></br></p>
		                    </div>
		                    <div class="modal-footer">
		                    	<p:commandLink
		                    		value="Remove"
		                    		styleClass="btn btn-red"
		                    		process="@this"
		                    		action="#{competenceEditBean.removeActivity()}"
		                    		update=":#{cc.clientId}:formMain:activityList"
		                    		oncomplete="$('#modalRemoveActivity').modal('hide');">
		                    	</p:commandLink>
		                        <a href="#" class="btn btn-default" data-dismiss="modal">Cancel</a>
		                    </div>
		                </div>
		            </div>
		        </div>
		    </h:form>
				
			<dialogs:resourceVisibility
				id="resourceVisibilityModal"
				bean="#{competenceVisibilityBean}"
				resource="Competence"
				toUpdate=":#{cc.clientId}:formMain:growlMain"
				learningContext="#{cc.attrs.learningContext}"
			/>
			
			<dialogs:archiveResource
	    		id="archiveDialog"
				archiveActionMethodName="archive"  	
				archiveAction="#{competenceEditBean.archive}"
				toUpdate=":#{cc.clientId}:formMain #{cc.attrs.toUpdate}"
				title="Competency" 
				resourceType="competency"
				resourceTypePlural="competencies"
				learningContext="name:competence|id:#{competenceEditBean.competenceData.competenceId}"/>
				
			<dialogs:restoreResource
	    		id="restoreDialog"
				restoreActionMethodName="restore"  	
				restoreAction="#{competenceEditBean.restore}"
				toUpdate=":#{cc.clientId}:formMain #{cc.attrs.toUpdate}"
				title="Competency" 
				resourceType="competency"
				resourceTypePlural="competencies"
				learningContext="name:competence|id:#{competenceEditBean.competenceData.competenceId}"/>
				
	 		<compDialogs:duplicateCompetence   
	 			id="duplicateDialog"   
	 			competence="#{competenceEditBean.competenceData}"
				duplicateActionMethodName="duplicate"  	
				duplicateAction="#{competenceEditBean.duplicate}"
				toUpdate=":#{cc.clientId}:formMain #{cc.attrs.toUpdate}"
				learningContext=""/>
			
		</div>
	</composite:implementation>
</ui:component>