<ui:component
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:p="http://primefaces.org/ui"
	xmlns:comp="http://java.sun.com/jsf/composite/components"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util"
	xmlns:util="http://www.prosolo.com/util"
	xmlns:courses="http://java.sun.com/jsf/composite/components/courses">

	<composite:interface>
		<composite:attribute name="role" type="java.lang.String" default="USER"/>
		<composite:attribute name="toUpdate" default=""></composite:attribute>
		<composite:attribute name="learningContext" default=""/>
		<composite:attribute name="service" default="" />
		<composite:attribute name="actAdded" type="java.lang.Boolean" default="false" />
	</composite:interface>
	
	<composite:implementation>
		<script src="https://use.typekit.net/zvv0dgl.js"></script>
    <script>try{Typekit.load({ async: true });}catch(e){}</script>
	<script src="#{request.contextPath}/resources/javascript2/bootstrap-tagsinput.min.js"></script>
	<script src="#{request.contextPath}/resources/javascript2/createCompetence.js"></script>
   
    <div class="whiteBar">

    </div>
    <div id="#{cc.clientId}">
    <script>
		containerId = '#{cc.clientId}';
	</script>
	<h:form id="formMain">
	<p:growl id="growlMain" showDetail="true" globalOnly="true"></p:growl>
	<h:inputHidden id="hiddenType" value="#{competenceEditBean.competenceData.typeString}" />
    <div class="container">
        <div class="row">
            <div class="col-md-8">
                <div class="whiteBox">
                    <ul class="nav nav-tabs pageSubmenu" role="tablist">
                        <li role="presentation" class="#{!cc.attrs.actAdded ? 'active' : ''}"><a href="#info" aria-controls="info" role="tab" data-toggle="tab">Competence Info</a></li>
                        <li role="presentation" class="#{cc.attrs.actAdded ? 'active' : ''}"><a href="#activities" aria-controls="activities" role="tab" data-toggle="tab">Activities</a></li>
                    </ul>
                </div>
                <div class="tab-content">
                    <div role="tabpanel" class="tab-pane fade #{!cc.attrs.actAdded ? 'active in' : ''}" id="info">
                        <div class="whiteBox">
                            <h2>Competence Info</h2>
                            <div class="formWrapper">
                                <div class="formLine">
                                    <label>Parent credential(s)</label>
                                    <div class="formLineRight">
                                        <ul class="addedItems">
                                        	<ui:repeat var="cred" value="#{competenceEditBean.competenceData.credentialsWithIncludedCompetence}">
                                        		<li>
                                        			<h:link value="#{cred.title}"
                                        				outcome="credential.xhtml">
                                        				<f:param name="id" value="#{util:encodeId(cred.id)}" />
                                        			</h:link>
	                                                <a href="#" class="removeX" data-toggle="tooltip" title="Remove">remove</a>
	                                            </li>
                                        	</ui:repeat>                                     
                                        </ul>
                                        <input type="text" placeholder="Assign to credential..."></input>
                                    </div>
                                </div>
                                <div class="formLine">
                                    <label>Title</label>
                                    <div class="formLineRight">
                                    	<h:inputText 
                                    		id="inputTitle"
                                    		styleClass="pasteable"
                                    		value="#{competenceEditBean.competenceData.title}"
                                    		onkeyup="updateStatusToDraft();"
                                    		required="true"
											requiredMessage="Title is required"
										/>
										<h:panelGroup 
				                        	layout="block" 
				                        	rendered="#{not empty facesContext.getMessageList(cc.clientId.concat(':formMain:inputTitle'))}" 
				                        	styleClass="alert alert-danger" 
				                        	pt:role="alert">
				                            <h:message for="inputTitle"></h:message>
				                        </h:panelGroup>
                                    </div>
                                </div>
                                <div class="formLine">
                                    <label>About competence</label>
                                    <div class="formLineRight">
                                        <h:inputTextarea 
                                        	styleClass="pasteable"
                                        	value="#{competenceEditBean.competenceData.description}"
                                        	onkeyup="updateStatusToDraft();"></h:inputTextarea>
                                    </div>
                                </div>
                                <div class="formLine">
                                    <label>Keywords</label>
                                    <div class="formLineRight">
                                    	<h:inputText styleClass="tagsInputCompTag"
                                    		id="inputKeywords"
		                                	value="#{competenceEditBean.competenceData.tagsString}"
		                                	pt:placeholder="Type and press 'Enter'"
		                                	pt:data-role="tagsinput">
	                                	</h:inputText>
                                    </div>
                                </div>
                                <script>$('.tagsInputCompTag').tagsinput();</script>
                            </div>
                        </div>
                    </div>
                    <div role="tabpanel" class="tab-pane fade #{cc.attrs.actAdded ? 'active in' : ''}" id="activities">
                    <div class="whiteBox activitiesList">
                    	<courses:activityList
                    		id="activityList"
                    		activities="#{competenceEditBean.competenceData.activities}"
                    		bean="#{competenceEditBean}"
                    		isEdit="true"
                    		showMarkedIfCompleted="false"
                    		isPreview="false"
                    		encodedCompetenceId="#{param['id']}"
                    		toUpdate=":#{cc.clientId}:formMain:compSideBar"
                    		mainForm=":#{cc.clientId}:formMain"/>
                    		
                    </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
            	<courses:rightSideBar
            		id="compSideBar"
            		chooseOptionText="Allow students to add activities"
            		chooseOptionValue="#{competenceEditBean.competenceData.studentAllowedToAddActivities}"
            		publishValues="#{competenceEditBean.compStatusArray}" 
            		publishValue="#{competenceEditBean.competenceData.status}"
            		saveAction="#{competenceEditBean.save}"
            		toUpdate=":#{cc.clientId}:formMain #{cc.attrs.toUpdate}" 
            		previewAction="#{competenceEditBean.preview}"
            		linkPreviewClass="hiddenLinkPreview"/>
            		
            	<h:link
					style="display: none;"
					styleClass="hiddenLinkPreview"
					target="_blank"
					outcome="competence">
					<f:param name="compId" value="#{competenceEditBean.id}"></f:param>
					<f:param name="mode" value="preview"></f:param>
				</h:link>
            </div>
        </div>

    </div>
    	<script>  
        	var type = null;
        	if('#{cc.attrs.role}' === "USER") {
        		type = "user_created";
        	} else {
        		type = "university_created";
        	}
			document.getElementById('#{cc.clientId}:formMain:hiddenType').value = type;
        </script>
    </h:form>
    
    <h:form id="formRemoveActivityModal">
    	<div class="modal fade" id="modalRemoveActivity" tabindex="-1" role="dialog" aria-labelledby="removeActivity">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&#215;</span></button>
                        <h2 class="modal-title" id="removeActivity1">Remove Activity?</h2>
                    </div>
                    <div class="modal-body">
                        <p>Are you sure you want to remove this activity from competence?<br></br><br></br></p>
                    </div>
                    <div class="modal-footer">
                    	<p:commandLink
                    		value="Remove"
                    		styleClass="btn btn-red"
                    		process="@this"
                    		action="#{competenceEditBean.removeActivity()}"
                    		update=":#{cc.clientId}:formMain:activityList :#{cc.clientId}:formMain:compSideBar"
                    		oncomplete="$('#modalRemoveActivity').modal('hide');">
                    	</p:commandLink>
                        <a href="#" class="btn btn-default" data-dismiss="modal">Cancel</a>
                    </div>
                </div>
            </div>
        </div>
    </h:form>
    
     <courses:deleteModalDialog  
     	deleteActionMethodName="delete"      	
		deleteAction="#{competenceEditBean.delete}"
		toUpdate=":#{cc.clientId}:formMain #{cc.attrs.toUpdate}" 
		modalDeleteTitle="Competence"
		modalDeleteText="competence"/>
		
		</div>
	</composite:implementation>
</ui:component>