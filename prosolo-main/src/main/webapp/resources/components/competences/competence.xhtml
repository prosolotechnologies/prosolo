<ui:component
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:p="http://primefaces.org/ui"
	xmlns:comp="http://java.sun.com/jsf/composite/components"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util"
	xmlns:util="http://www.prosolo.com/util"
	xmlns:courses="http://java.sun.com/jsf/composite/components/courses"
	xmlns:post="http://java.sun.com/jsf/composite/components/post">

	<composite:interface>
		<composite:attribute name="bean" required="true"/>
		<composite:attribute name="role" type="java.lang.String" default="USER"/>
		<composite:attribute name="learningContext" default=""/>
		<composite:attribute name="service" default="" />
	</composite:interface>
	
	<composite:implementation>
		<ui:param name="isPreview" value="#{cc.attrs.bean.isPreview()}" />
     	<ui:param name="canEdit" value="#{cc.attrs.role == 'MANAGER' and cc.attrs.bean.competenceData.type == 'UNIVERSITY_CREATED' 
     		and request.isUserInRole('MANAGE.CONTENT.EDIT') || cc.attrs.role != 'MANAGER' and cc.attrs.bean.competenceData.type == 'USER_CREATED' and cc.attrs.bean.isCurrentUserCreator()}"></ui:param>
     	
     	<c:choose>
		    <c:when test="#{cc.attrs.bean.competenceData.enrolled}">
		         <c:set var="learningContext" value="name:credential|id:#{cc.attrs.bean.decodedCredId}|context:/name:competence|id:#{cc.attrs.bean.decodedCompId}|context:/name:target_competence|id:#{cc.attrs.bean.competenceData.targetCompId}//"/>
		    </c:when>
		    <c:otherwise>
		    	 <c:choose>
		    	 	 <c:when test="#{cc.attrs.bean.decodedCredId ne 0}">
			         	   <c:set var="learningContext" value="name:credential|id:#{cc.attrs.bean.decodedCredId}|context:/name:competence|id:#{cc.attrs.bean.decodedCompId}/"/>
			         </c:when>
			         <c:otherwise>
			         	   <c:set var="learningContext" value="name:competence|id:#{cc.attrs.bean.decodedCompId}"/>
		         	 </c:otherwise>
		    	 </c:choose>
		    </c:otherwise>
		</c:choose>
     	<p:growl id="growlMain" showDetail="true" globalOnly="true"></p:growl>
     	<div id="#{cc.clientId}">
		    <div class="whiteBar">
		        <div class="container">
		            <div class="whiteBarContent">
		                <div class="whiteBarLeft">
		                	<ui:fragment rendered="#{cc.attrs.bean.competenceData.enrolled and 
		                		cc.attrs.bean.competenceData.progress lt 100 and !isPreview}">
		                		<h:link rendered="#{cc.attrs.bean.competenceNextToLearn or !cc.attrs.bean.mandatoryOrder}"
		                			value="#{cc.attrs.bean.competenceData.progress != 0 ? 'Resume' : 'Start'}"
		                			styleClass="btn btn-green btn-sm"
		                			outcome="activity"
		                			onclick="sendLogPageNavigation('/activity.xhtml', 
										'#{facesContext.viewRoot.viewId}', 
										'#{util:addSubContext(cc.attrs.learningContext, &#34;name:COMPETENCE|id:&#34;.concat(util:decodeId(param[&#34;compId&#34;])).concat(&#34;|context:/name:resume_learning/&#34;))}', 
										'#{cc.attrs.service}');">
		                			<f:param name="actId" value="#{util:encodeId(cc.attrs.bean.competenceData.nextActivityToLearnId)}"></f:param>
					            	<f:param name="compId" value="#{param['compId']}"></f:param>
					            	<f:param name="credId" value="#{param['credId']}" disable="#{empty param['credId']}"></f:param>
		                		</h:link>
		                		<ui:fragment rendered="#{!(cc.attrs.bean.competenceNextToLearn or !cc.attrs.bean.mandatoryOrder)}">
			                		<a href="javascript:void(0);" 
			                			class="btn btn-green btn-sm" 
			                			disabled="disabled" 
			                			data-toggle="tooltip" 
			                			title="In order to start this competence, previous tasks need to be completed.">
			                			#{cc.attrs.bean.competenceData.progress != 0 ? 'Resume' : 'Start'}
			                		</a>
		                		</ui:fragment>
		                	
			                    <div class="progressBar">
			                        <span>#{cc.attrs.bean.competenceData.progress}%</span>
			                        <div class="progress">
			                            <div class="progress-bar" role="progressbar" aria-valuenow="#{cc.attrs.bean.competenceData.progress}" aria-valuemin="0" aria-valuemax="100" style="width: #{cc.attrs.bean.competenceData.progress}%;">
			                            </div>
			                        </div>
			                    </div>
		                	</ui:fragment>
		                	
		                	<ui:fragment rendered="#{cc.attrs.bean.competenceData.enrolled and 
		                		cc.attrs.bean.competenceData.progress == 100}">
		                		<div class="tagCompleted">Completed</div>
		                	</ui:fragment>
		                    
		                </div>
		                <div class="whiteBarRight">
		                    <div class="duration item">#{cc.attrs.bean.competenceData.durationString}</div>
		                    <h:link 
		                    	rendered="#{canEdit and !isPreview}"
		                    	value="Edit Competence"
		                    	styleClass="btn btn-green-stroke btn-sm item"
		                    	outcome="create-competence">
		                    	<f:param name="id" value="#{param['compId']}"></f:param>
		                    	<f:param name="credId" value="#{param['credId']}" disable="#{empty param['credId']}"></f:param>
		                    </h:link>
		                </div>
		            </div>
		        </div>
		    </div>
		
		    <div class="container">
		    	<ui:fragment rendered="#{cc.attrs.bean.competenceData.credentialId != 0}">
		    		<ol class="breadcrumb">
			            <li>
			            	<h:link value="Credentials" outcome="credentialLibrary"/>
			            </li>
			            <li>
			            	<h:link 
			            		value="#{cc.attrs.bean.competenceData.credentialTitle}"
			            		outcome="credential"
			            		onclick="sendLogPageNavigation('/credential.xhtml', 
										'#{facesContext.viewRoot.viewId}', 
										'#{util:addSubContext(learningContext, &#34;name:breadcrumbs|context:/name:CREDENTIAL|id:&#34;.concat(cc.attrs.bean.decodedCredId).concat(&#34;/&#34;))}', 
										'#{cc.attrs.service}');">
			            		<f:param name="id" value="#{util:encodeId(cc.attrs.bean.competenceData.credentialId)}"></f:param>
			            	</h:link>
			            </li>
			            <li class="active">#{cc.attrs.bean.competenceData.title}</li>
			        </ol>
		    	</ui:fragment>
		        <ui:fragment rendered="#{cc.attrs.bean.competenceData.credentialId == 0}">
		    		<ol class="breadcrumb">	
		    			<li>
			            	<a href="javascript:void(0);">Competences</a>
			            </li>          
			            <li class="active">#{cc.attrs.bean.competenceData.title}</li>
			        </ol>
		    	</ui:fragment>
		    </div>
		
		    <div class="container">
		        <div class="row">
		            <div class="col-md-8">
		                <h2>About Competence</h2>
		                <p>#{cc.attrs.bean.competenceData.description}</p>
		                <div class="whiteBox activitiesList">
			                <courses:activityList
			                    		activities="#{cc.attrs.bean.competenceData.activities}"
			                    		encodedCredentialId="#{param['credId']}"
			                    		encodedCompetenceId="#{param['compId']}"
			                    		bean="#{cc.attrs.bean}"
			                    		isEdit="false"
			                    		showMarkedIfCompleted="true"
			                    		isPreview="#{isPreview}"
			                />
		               </div>
		               <post:comments 
		               		id="comments"
		               		comments="#{cc.attrs.bean.commentsData}"
		               		commentsContainerDivId="commentsContainerDiv"
		               		growlToUpdate=":#{cc.clientId}:growlMain"
		               		learningContext="#{learningContext}"
		               />
		            </div>
		            <div class="col-md-4">
						<div class="sidebarBlock">
			                <h2>Keywords</h2>
			                <ul class="tags">
			                	<ui:repeat var="tag" value="#{cc.attrs.bean.competenceData.tags}">
			                		<li><a href="javascript:void(0)">#{tag.title}</a></li>
			                	</ui:repeat>               
			                </ul>
		                </div>
		                
		                <div class="sidebarBlock">
			                <h2>Created by</h2>
			                <div class="user32">
			                    <a href="#">
									<utilcomp:userAvatar
										avatar="#{cc.attrs.bean.competenceData.creator.avatar}"
										fullName="#{cc.attrs.bean.competenceData.creator.name}" />
			                    </a>
			                    <h3><a href="#">#{cc.attrs.bean.competenceData.creator.name}</a></h3>
			                </div>
		                </div>
		            </div>
		        </div>
			
		    </div>
		    <ui:fragment rendered="#{not empty param['comment']}">
		    	<script>
			    	scrollTo('comment_' + #{util:decodeId(param['comment'])});
			    </script>
		    </ui:fragment>
		</div>
	</composite:implementation>
</ui:component>