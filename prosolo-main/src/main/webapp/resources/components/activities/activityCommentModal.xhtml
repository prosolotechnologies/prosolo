<ui:component xmlns="http://www.w3.org/1999/xhtml"
			  xmlns:h="http://java.sun.com/jsf/html"
			  xmlns:f="http://java.sun.com/jsf/core"
			  xmlns:ui="http://java.sun.com/jsf/facelets"
			  xmlns:p="http://primefaces.org/ui"
			  template="templates/masterLayout2.xhtml"
			  xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util"
			  xmlns:composite="http://java.sun.com/jsf/composite"
			  xmlns:util="http://www.prosolo.com/util">

	<composite:interface>
		<composite:attribute name="toUpdate" default=""/>
	</composite:interface>


	<composite:implementation>
		<h:outputStylesheet library="css2" name="bootstrap-slider.css" />
		<script
				src="#{request.contextPath}/resources/javascript2/bootstrap-slider.min.js"></script>

		<script>

            //comment form hide/show
            function displaySubmitButtonPrivateConvModal(inputElem) {
                if ($(inputElem).val().length == 0) {
                    $(inputElem).parent().find('a.btn-green').addClass('hidden');
                } else {
                    $(inputElem).parent().find('a.btn-green').removeClass('hidden');
                }
            }
		</script>

		<h:form id="formPrivateConversation">
			<div class="modal fade assessmentCommentsModal"
				 id="assessmentCommentsModal1" tabindex="-1" role="dialog"
				 aria-labelledby="assessmentCommentsModal">
				<div class="modal-dialog modal-lg">
					<h:panelGroup id="panelModalPrivateConversation" layout="block"
								  styleClass="modal-content">
						<ui:fragment rendered="#{not empty activityAssessmentBean.activityAssessmentData}">
							<div class="modal-header alignLeft">
								<button type="button" class="close" data-dismiss="modal"
										aria-label="Close">
									<span aria-hidden="true">&#215;</span>
								</button>
								<h2 class="modal-title">Comments</h2>
							</div>
							<div class="discussion">
								<div class="comments">
									<ui:fragment
											rendered="#{not empty activityAssessmentBean.activityAssessmentData.activityDiscussionMessageData}">
										<ul class="media-list">
											<ui:repeat var="activityMessageData"
													   value="#{activityAssessmentBean.activityAssessmentData.activityDiscussionMessageData}">
												<li class="media">
													<div class="media-left">
														<utilcomp:userAvatar
																avatar="#{activityMessageData.senderAvatarUrl}"
																fullName="#{activityMessageData.senderFullName}" />
													</div>

													<div class="media-body">
														<ui:fragment
																rendered="#{activityAssessmentBean.isCurrentUserMessageSender(activityMessageData)}">
															<div class="commentMain">
																<span class="commentTime"> Edited:
																	#{activityMessageData.dateUpdatedFormat} </span>

																<h3 class="media-heading">
																	#{activityMessageData.senderFullName}
																	<ui:fragment
																			rendered="#{activityMessageData.senderInsructor}">
																		<span>INSTRUCTOR</span>
																	</ui:fragment>
																</h3>

																<p class="commentText">#{activityMessageData.content}</p>
																<div class="editComment hidden">
																	<p:inputTextarea name="name"
																					 styleClass="contentEditableComment"
																					 style="width:100%;" rows="1"
																					 value="#{activityMessageData.content}"
																					 onkeyup="displaySubmitButtonPrivateConvModal(this)"></p:inputTextarea>
																	<p:commandLink styleClass="btn btn-sm btn-green"
																				   oncomplete="hideEditPrivateConversationComment(this);"
																				   update=":#{cc.clientId}:formPrivateConversation:panelModalPrivateConversation"
																				   actionListener="#{activityAssessmentBean.editComment(activityMessageData.content, activityMessageData.encodedMessageId)}"
																				   type="button" name="button">
																		Submit
																	</p:commandLink>

																	<a href="javascript:void(0)"
																	   class="btn btn-sm btn-green-stroke"
																	   onclick="hideEditPrivateConversationComment(this)">Cancel</a>
																</div>

																<div class="commentOptions">
																	<a href="javascript:void(0)" class="edit"
																	   onclick="showEditComment(this)"> <span
																			class="icon"></span>Edit
																	</a>
																</div>
															</div>
														</ui:fragment>

														<ui:fragment
																rendered="#{not activityAssessmentBean.isCurrentUserMessageSender(activityMessageData)}">
															<div class="commentMain">
																<span class="commentTime"> Edited:
																	#{activityMessageData.dateCreatedFormat} </span>
																<h3 class="media-heading">
																	#{activityMessageData.senderFullName}
																	<ui:fragment
																			rendered="#{activityMessageData.senderInsructor}">
																		<span>INSTRUCTOR</span>
																	</ui:fragment>
																</h3>
																<p>#{activityMessageData.content}</p>
															</div>

															<div class="media replyInput hidden">
																<div class="media-left">
																	<utilcomp:userAvatar
																			avatar="#{activityMessageData.senderAvatarUrl}"
																			fullName="#{activityMessageData.senderFullName}" />
																</div>

																<div class="media-body replyComment">
																	<div class="commentForm">
																		<textarea placeholder="Add Comment..."
																				  onkeyup="displaySubmitButtonPrivateConvModal(this)"></textarea>
																		<button type="button"
																				class="btn btn-sm btn-green hidden" name="button">
																			Submit</button>
																	</div>
																</div>
															</div>
														</ui:fragment>
													</div>
												</li>
											</ui:repeat>
										</ul>
									</ui:fragment>
								</div>
								<div class="addComment">
									<utilcomp:userAvatar avatar="#{loggeduser.avatar}"
														 fullName="#{loggeduser.fullName}" />

									<div class="commentForm">
										<p:inputTextarea styleClass="contentEditableComment"
														 style="width:100%;" rows="1"
														 value="#{activityAssessmentBean.newCommentValue}"
														 placeholder="Add Comment..."
														 onkeyup="displaySubmitButtonPrivateConvModal(this)" />

										<p:commandLink
												action="#{activityAssessmentBean.addCommentToActivityDiscussion()}"
												type="button" styleClass="btn btn-sm btn-green hidden"
												name="button"
												update=":#{cc.clientId}:formPrivateConversation:panelModalPrivateConversation #{cc.attrs.toUpdate}">
											Submit
											<f:param name="page" value="#{facesContext.viewRoot.viewId}" />
											<f:param name="learningContext" value="#{learningContext}" />
											<f:param name="service"
													 value="name:result_private_conversation_dialog|id:#{util:decodeId(activityAssessmentBean.activityAssessmentData.encodedDiscussionId)}" />
										</p:commandLink>

									</div>
								</div>
								<div class="clear"></div>
							</div>
						</ui:fragment>
					</h:panelGroup>
				</div>
			</div>
		</h:form>
	</composite:implementation>

</ui:component>