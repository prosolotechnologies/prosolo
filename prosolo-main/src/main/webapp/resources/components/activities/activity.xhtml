<ui:component
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:p="http://primefaces.org/ui"
	xmlns:comp="http://java.sun.com/jsf/composite/components"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util"
	xmlns:util="http://www.prosolo.com/util"
	xmlns:courses="http://java.sun.com/jsf/composite/components/courses"
	xmlns:post="http://java.sun.com/jsf/composite/components/post"
	xmlns:activities="http://java.sun.com/jsf/composite/components/activities">

	<composite:interface>
		<composite:attribute name="bean" required="true"/>
		<composite:attribute name="role" type="java.lang.String" default="USER"/>
		<composite:attribute name="learningContext" default=""/>
		<composite:attribute name="service" default="" />
	</composite:interface>
	
	<composite:implementation>
	    <script src="#{request.contextPath}/resources/javascript2/mediaelement/mediaelement-fix.min.js"></script>
	    <script src="#{request.contextPath}/resources/javascript2/videojs.js"></script>
		<link rel="stylesheet" type="text/css" media="all"
			href="#{request.contextPath}/resources/javascript2/mediaelement/mediaelementplayer.min.css" />
			
		<script src="#{request.contextPath}/resources/javascript2/tinymce/tinymce.min.js"></script>
		<script>
		tinymce.init({
			theme: "modern",
		    skin: 'light',
		    height : "200",
			selector:'#activity .writeResult textarea',
			font_formats: 'prosolo_semibold,Helvetica=Helvetica Neue,helvetica,sans-serif',
	    	plugins: 'link media code image',
			menubar:false,
		    statusbar: false,
		    toolbar: 'undo redo | bold italic | alignleft aligncenter alignright alignfull | bullist numlist |  outdent indent | link image media  | code'
		});
		</script>
		<style>
			.mce-panel {
				margin-bottom: 20px;
			}
		</style>
		
		<ui:param name="isPreview" value="#{cc.attrs.bean.isPreview()}" />
     	<ui:param name="canEdit" value="#{cc.attrs.role == 'MANAGER' and cc.attrs.bean.competenceData.activityToShowWithDetails.type == 'UNIVERSITY_CREATED' 
     		and request.isUserInRole('MANAGE.CONTENT.EDIT') || cc.attrs.role != 'MANAGER' and cc.attrs.bean.competenceData.activityToShowWithDetails.type == 'USER_CREATED' and cc.attrs.bean.isCurrentUserCreator()}"></ui:param>
     	
     	<c:choose>
			<c:when test="#{cc.attrs.bean.competenceData.activityToShowWithDetails.enrolled}">
				<c:set var="learningContext" value="name:credential|id:#{cc.attrs.bean.decodedCredId}|context:/name:competence|id:#{cc.attrs.bean.decodedCompId}|context:/name:activity|id:#{cc.attrs.bean.competenceData.activityToShowWithDetails.activityId}|context:/name:target_activity|id:#{cc.attrs.bean.competenceData.activityToShowWithDetails.targetActivityId}///"/>
		    </c:when>
			<c:otherwise>
				<c:choose>
					<c:when test="#{cc.attrs.bean.decodedCredId ne 0}">
						<c:set var="learningContext" value="name:credential|id:#{cc.attrs.bean.decodedCredId}|context:/name:competence|id:#{cc.attrs.bean.decodedCompId}|context:/name:activity|id:#{cc.attrs.bean.competenceData.activityToShowWithDetails.activityId}//"/>
					</c:when>
					<c:otherwise>
						<c:set var="learningContext" value="name:competence|id:#{cc.attrs.bean.decodedCompId}|context:/name:activity|id:#{cc.attrs.bean.competenceData.activityToShowWithDetails.activityId}//"/>
					</c:otherwise>
				</c:choose>
			</c:otherwise>
		</c:choose>
		
		<p:growl id="growlMain" showDetail="true" globalOnly="true" />
		
		<div id="#{cc.clientId}">
	    	<div class="whiteBar">
				<div class="container">
					<activities:activityHeaderOptions
						id="header"
						bean="#{cc.attrs.bean}"
						activity="#{cc.attrs.bean.competenceData.activityToShowWithDetails}"
						learningContext="#{learningContext}"
						service="#{cc.attrs.service}"
						canEdit="#{canEdit}"
						isPreview="#{isPreview}"
						toUpdateOnActivityComplete=":#{cc.clientId}:panelCompProgress :#{cc.clientId}:growlMain"
					/>
				</div>
			</div>
	
		    <div class="container">
		    	<ui:fragment rendered="#{cc.attrs.bean.competenceData.credentialId != 0}">
		    		<ol class="breadcrumb">
			            <li>
			            	<h:link value="Credentials" outcome="/credentialLibrary"/>
			            </li>
			            <li>
			            	<h:link 
			            		value="#{cc.attrs.bean.competenceData.credentialTitle}"
			            		outcome="credential"
			            		onclick="sendLogPageNavigation('/credential.xhtml', 
										'#{facesContext.viewRoot.viewId}', 
										'#{util:addSubContext(learningContext, &#34;name:breadcrumbs|context:/name:CREDENTIAL|id:&#34;.concat(cc.attrs.bean.decodedCredId).concat(&#34;/&#34;))}', 
										'#{cc.attrs.service}');">
			            		<f:param name="id" value="#{param['credId']}"></f:param>
			            	</h:link>
			            </li>
			            <li>
			            	<h:link 
			            		value="#{cc.attrs.bean.competenceData.title}"
			            		outcome="competence"
			            		onclick="sendLogPageNavigation('/competence.xhtml', 
										'#{facesContext.viewRoot.viewId}', 
										'#{util:addSubContext(learningContext, &#34;name:breadcrumbs|context:/name:COMPETENCE|id:&#34;.concat(cc.attrs.bean.decodedCompId).concat(&#34;/&#34;))}', 
										'#{cc.attrs.service}');">
			            		<f:param name="compId" value="#{param['compId']}"></f:param>
			            		<f:param name="credId" value="#{param['credId']}"></f:param>
			            	</h:link>
			            </li>
			            <li class="active">#{cc.attrs.bean.competenceData.activityToShowWithDetails.title}</li>
			        </ol>
		    	</ui:fragment>
		        <ui:fragment rendered="#{cc.attrs.bean.competenceData.credentialId == 0}">
		    		<ol class="breadcrumb">	 
		    			<li>
			            	<a href="javascript:void(0);">Competences</a>
			            </li> 
		    			<li>
			            	<h:link 
			            		value="#{cc.attrs.bean.competenceData.title}"
			            		outcome="competence">
			            		<f:param name="compId" value="#{param['compId']}"></f:param>  
			            	</h:link>
			            </li>         
			            <li class="active">#{cc.attrs.bean.competenceData.activityToShowWithDetails.title}</li>
			        </ol>
		    	</ui:fragment>
		    </div>
	
		    <div class="container">
		        <div class="row">
		            <div class="col-md-8">
		            	<courses:activityDetails 
		            		id="activityDetails"
		            		credentialId="#{cc.attrs.bean.decodedCredId}"
		            		competenceId="#{cc.attrs.bean.decodedCompId}"
		            		activity="#{cc.attrs.bean.competenceData.activityToShowWithDetails}"
		            		bean="#{cc.attrs.bean}"
		            		isPreview="#{isPreview}"
		            		learningContext="#{learningContext}"
		            		role="#{cc.attrs.role}"
		            	/>
		                
		                <post:comments 
		               		id="comments"
		               		comments="#{cc.attrs.bean.commentsData}"
		               		commentsContainerDivId="commentsContainerDiv"
		               		growlToUpdate=":#{cc.clientId}:growlMain"
		               		learningContext="#{learningContext}"
		               />
		            </div>
		            
		            <h:panelGroup layout="block" id="panelCompProgress" styleClass="col-md-4">
						<div class="sidebarBlock">
							<activities:activityCompProgress
								bean="#{cc.attrs.bean}"
								learningContext="#{learningContext}"
								service="#{cc.attrs.service}"
							/>
						</div>
					</h:panelGroup>
				</div>
		    </div>
		    
			<ui:fragment rendered="#{not empty param['comment']}">
				<script>
					scrollTo('comment_' + #{util:decodeId(param['comment'])});
				</script>
			</ui:fragment>
		</div>
	</composite:implementation>
</ui:component>