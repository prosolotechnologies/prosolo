<ui:component
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:p="http://primefaces.org/ui"
	xmlns:prosoloUtils="http://www.prosolo.com/util"
	xmlns:pt="http://java.sun.com/jsf/passthrough">

	<!-- mode: image , imageName, name -->

	<composite:interface>
		<composite:attribute name="user" type="org.prosolo.domainmodel.user.User" />
		<composite:attribute name="userData" type="org.prosolo.web.activitywall.data.UserData" />
		<composite:attribute name="mode" required="true" /> 
		<composite:attribute name="idPrefix" default="" />
		<composite:attribute name="divClass" default="" />
		<composite:attribute name="overlayClass" default="null" />
		<composite:attribute name="imageSize" default="22" />
		<composite:attribute name="nameStyleClass" default="" />
		<composite:attribute name="context"/>
		<composite:attribute name="toRender" default="true" />
		<composite:attribute name="disableLink" default="false" />
		<composite:attribute name="tooltipPosition" default="bottom"/>
	</composite:interface>
	
	<composite:implementation>
		<h:panelGroup rendered="#{cc.attrs.toRender and cc.attrs.user == null and cc.attrs.userId == 0}" class="noContentMessage">
			Not defined
		</h:panelGroup>
		 
		<h:panelGroup layout="block" rendered="#{cc.attrs.toRender and cc.attrs.user != null or cc.attrs.userData != null}">
			<span id="userDetails#{cc.attrs.user != null ? cc.attrs.user.id : cc.attrs.userData.id}-#{cc.attrs.idPrefix}" class="userLink #{cc.attrs.divClass}">
				<h:panelGroup layout="block" rendered="#{(cc.attrs.mode == 'image' or cc.attrs.mode == 'imageName')}">
					
					<h:outputLink rendered="#{(cc.attrs.user != null and cc.attrs.user.profileUrl != null) or
							(cc.attrs.userData != null and cc.attrs.userData.profileUrl != null)}"
						value="#{cc.attrs.user != null ? cc.attrs.user.profileUrl : cc.attrs.userData.profileUrl}" 
						disabled="#{cc.attrs.disableLink}"
						class="relative #{cc.attrs.mode == 'image' ? 'userDetailsLink' : ''}"
						onclick="sendLogPageNavigation('#{cc.attrs.user != null ? cc.attrs.user.profileUrl : cc.attrs.userData.profileUrl}','#{cc.attrs.context}');"
						style="display: inline-block;"
						target="_blank"
						pt:context="#{cc.attrs.context}">
						<h:panelGroup rendered="#{cc.attrs.overlayClass != null}" class="overlay #{cc.attrs.overlayClass}" />
						
						<h:graphicImage rendered="#{cc.attrs.user != null}"
							styleClass="imageRound image#{cc.attrs.imageSize} #{cc.attrs.imageClass}"
							value="#{colleguesBean.avatarUrl(cc.attrs.user, 60)}" 
							width="#{cc.attrs.imageSize}"
							height="#{cc.attrs.imageSize}" 
							alt="#{cc.attrs.user.name} #{cc.attrs.user.lastname}" />
							
						<h:graphicImage rendered="#{cc.attrs.userData != null}"
							styleClass="imageRound image#{cc.attrs.imageSize} #{cc.attrs.imageClass}"
							value="#{cc.attrs.userData.avatarUrl != null ? cc.attrs.userData.avatarUrl : colleguesBean.avatarUrlByUserId(cc.attrs.userId, 60)}" 
							width="#{cc.attrs.imageSize}"
							height="#{cc.attrs.imageSize}" 
							alt="#{cc.attrs.userData.name}" />
					</h:outputLink>
					
					<h:link class="relative #{cc.attrs.mode == 'image' ? 'userDetailsLink' : ''}"
						outcome="/publicprofile"
						disabled="#{cc.attrs.disableLink}"
						onclick="sendLogPageNavigation('publicprofile.xhtml?user=#{cc.attrs.user != null ? cc.attrs.user.id : cc.attrs.userData.id}','#{cc.attrs.context}');"
						pt:context="#{cc.attrs.context}"
						rendered="#{(cc.attrs.user != null and cc.attrs.user.profileUrl == null) 
								or (cc.attrs.userData != null and cc.attrs.userData.profileUrl == null)}">
								
						<f:param name="user" value="#{cc.attrs.user != null ? cc.attrs.user.id : cc.attrs.userData.id}" />
						
						<h:panelGroup rendered="#{cc.attrs.overlayClass != null}" class="overlay #{cc.attrs.overlayClass}" />
						
						<h:graphicImage rendered="#{cc.attrs.user != null}"
							styleClass="imageRound image#{cc.attrs.imageSize} #{cc.attrs.imageClass}"
							value="#{colleguesBean.avatarUrl(cc.attrs.user, 60)}" width="#{cc.attrs.imageSize}"
							height="#{cc.attrs.imageSize}" 
							alt="#{cc.attrs.user.name} #{cc.attrs.user.lastname}" />
							
						<h:graphicImage rendered="#{cc.attrs.userData != null}"
							styleClass="imageRound image#{cc.attrs.imageSize} #{cc.attrs.imageClass}"
							value="#{cc.attrs.userData.avatarUrl != null ? cc.attrs.userData.avatarUrl : colleguesBean.avatarUrlByUserId(cc.attrs.userId, 60)}" 
							width="#{cc.attrs.imageSize}"
							height="#{cc.attrs.imageSize}" 
							alt="#{cc.attrs.userData.name}" />
					</h:link>
				</h:panelGroup>
				
				<h:panelGroup rendered="#{cc.attrs.mode == 'imageName'}">
					&#160;
				</h:panelGroup>
	
				<h:panelGroup layout="block" rendered="#{cc.attrs.mode == 'name' or cc.attrs.mode == 'imageName'}">
					<h:outputLink rendered="#{(cc.attrs.user != null and cc.attrs.user.profileUrl != null) or
							(cc.attrs.userData != null and cc.attrs.userData.profileUrl != null)}"
						class="userDetailsLink #{cc.attrs.nameStyleClass}"
						onclick="sendLogPageNavigation( '#{cc.attrs.user != null ? cc.attrs.user.profileUrl : cc.attrs.userData.profileUrl}','#{cc.attrs.context}');"
						value="#{cc.attrs.user != null ? cc.attrs.user.profileUrl : cc.attrs.userData.profileUrl}" 
						target="_blank"
						pt:context="#{cc.attrs.context}">
						<h:outputText value="#{cc.attrs.user != null ? cc.attrs.user.name.concat(' ').concat(cc.attrs.user.lastname) : cc.attrs.userData.name}"/>
					</h:outputLink>
					
					<h:link rendered="#{(cc.attrs.user != null and cc.attrs.user.profileUrl == null) 
								or (cc.attrs.userData != null and cc.attrs.userData.profileUrl == null)}"
						class="userDetailsLink #{cc.attrs.nameStyleClass}"
						onclick="sendLogPageNavigation('publicprofile.xhtml?user=#{cc.attrs.user != null ? cc.attrs.user.id : cc.attrs.userData.id}','#{cc.attrs.context}');"
						value="#{cc.attrs.user != null ? cc.attrs.user.name.concat(' ').concat(cc.attrs.user.lastname) : cc.attrs.userData.name}" 
						outcome="/publicprofile"
						pt:context="#{cc.attrs.context}">
						<f:param name="user" value="#{cc.attrs.user != null ? cc.attrs.user.id : cc.attrs.userData.id}" /> 
					</h:link>
				</h:panelGroup>
				
				<p:commandLink rendered="#{cc.attrs.user != null}" 
					styleClass="userDetailsRefresh" value="refresh" style="display: none;"
					action="#{userDetailsBean.initializeUserDetails(cc.attrs.user)}" 
					process="@this"
					oncomplete="userDetailsControl#{cc.attrs.user.id}P#{cc.attrs.idPrefix}.show();"
					update=":#{p:component('userDetailsTooltip')}" />
	
				<p:commandLink rendered="#{cc.attrs.userData != null}" 
					styleClass="userDetailsRefresh" value="refresh" style="display: none;"
					action="#{userDetailsBean.initializeUserDetailsByUserData(cc.attrs.userData)}"
					process="@this"
					oncomplete="userDetailsControl#{cc.attrs.userData.id}P#{cc.attrs.idPrefix}.show();"
					update=":#{p:component('userDetailsTooltip')}" />
					
				<script>
					$('#userDetails#{cc.attrs.user != null ? cc.attrs.user.id : cc.attrs.userData.id}-#{cc.attrs.idPrefix} .userDetailsRefresh').on('click', function(e) {
						e.stopPropagation();
					});
				</script>
			</span>
		</h:panelGroup>
		
		<script>
			if(#{cc.attrs.toRender and (cc.attrs.user != null or cc.attrs.userData != null)}) {
				var userDetailsControl#{cc.attrs.user != null ? cc.attrs.user.id : cc.attrs.userData.id}P#{cc.attrs.idPrefix} = 
					prosolo.bigTooltipControl.create(
						'#userDetails#{cc.attrs.user != null ? cc.attrs.user.id : cc.attrs.userData.id}-#{cc.attrs.idPrefix}', 
						'.userDetailsLink',
						'.userDetailsRefresh',
						'.userDetailsTooltip',
						'#{cc.attrs.tooltipPosition}',
						'#{request.contextPath}/resources/images/style/ajax-loader-black.gif',
						'#{cc.attrs.user != null ? cc.attrs.user.id : cc.attrs.userData.id}');
			}
		</script>
	</composite:implementation>
</ui:component>