<ui:component
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:util="http://www.prosolo.com/util"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util"
	xmlns:post="http://java.sun.com/jsf/composite/components/post"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:c="http://java.sun.com/jsp/jstl/core">

	<composite:interface>
	    <composite:attribute name="socialActivity" required="true" 
	    	type="org.prosolo.services.activityWall.impl.data.SocialActivityData1"/>
	    <composite:attribute name="growlToUpdate" default=""/>
		<composite:attribute name="learningContext" default=""/>
		<composite:attribute name="service" default="" />
		<composite:attribute name="toUpdate" default=""/>
		<composite:attribute name="toUpdateShareModal" default="" />
		<composite:attribute name="shareModalId" required="true" />
		<composite:attribute name="jsFunctionToPrepareShareModal" default=""/>
	</composite:interface> 
	
	<composite:implementation>
		<article class="whiteBox wallPost">
           <div class="wallPostHead">
               <div class="user32">
                   <h:link outcome="/profile">
                   		<utilcomp:userAvatar
							avatar="#{cc.attrs.socialActivity.actor.avatarUrl}"
							fullName="#{cc.attrs.socialActivity.actor.fullName}"	
							width="32"
							height="32"
					    />    
					    <f:param name="id" value="#{util:encodeId(cc.attrs.socialActivity.actor.id)}"></f:param>
                   </h:link>
                   <h3>
                   		<h:link outcome="/profile">
                   			#{cc.attrs.socialActivity.actor.fullName}
                   			<f:param name="id" value="#{util:encodeId(cc.attrs.socialActivity.actor.id)}"></f:param>
                   		</h:link>
                   		<span>
                   			#{cc.attrs.socialActivity.predicate}
                   			<ui:fragment rendered="#{not empty cc.attrs.socialActivity.object}">
                   				<ui:fragment rendered="#{not empty cc.attrs.socialActivity.object.creator.fullName}">
                   					<h:link outcome="/profile">
				                   		#{cc.attrs.socialActivity.object.creator.fullName}'s
									    <f:param name="id" value="#{util:encodeId(cc.attrs.socialActivity.object.creator.id)}"></f:param>
				                   </h:link>
                   				</ui:fragment>
                   				#{cc.attrs.socialActivity.object.shortType}
                   				#{cc.attrs.socialActivity.object.title}
                   			</ui:fragment>
                   			#{cc.attrs.socialActivity.relationToTarget}
                   			<ui:fragment rendered="#{not empty cc.attrs.socialActivity.target}">
                   				#{cc.attrs.socialActivity.target.shortType}
                   				<ui:fragment rendered="#{not empty cc.attrs.socialActivity.target.creator.fullName}">
                   					#{cc.attrs.socialActivity.target.creator.fullName}'s
                   				</ui:fragment>
                   				#{cc.attrs.socialActivity.target.title}
                   			</ui:fragment>
                   		</span>
                   </h3>
               </div>
               <div class="wallPostHeadRight">
                   <a href="wall-post-view.html" class="timestamp">      	
                   		#{cc.attrs.socialActivity.datePretty}
                   </a>
                   <h:panelGroup id="panelSocialActivityOptions" styleClass="dropdown optDrop">
                       <a data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                           <span class="arrowDown">arrowDown</span>
                       </a>
                       <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenu1">
                           <li>
                           		<p:commandLink
                           			value="Hide post"
                           			action="#{wallactions.hideActivity(cc.attrs.socialActivity)}"
                           			update="#{cc.attrs.growlToUpdate} #{cc.attrs.toUpdate}">
                           		</p:commandLink>
                           </li>
                           <ui:fragment rendered="#{activityWallBean.isCurrentUserCreator(cc.attrs.socialActivity)}">
	                           <li>
	                           	    <p:commandLink
	                           			value="Delete post"
	                           			action="#{wallactions.deleteActivity(cc.attrs.socialActivity)}"
	                           			update="#{cc.attrs.growlToUpdate} #{cc.attrs.toUpdate}">
	                       				<f:param name="learningContext" value="#{cc.attrs.learningContext}"></f:param>
	      								<f:param name="page" value="#{facesContext.viewRoot.viewId}"></f:param>
	                           		</p:commandLink>
	                           </li>
	                           <li>
	                           		<p:commandLink rendered="#{!cc.attrs.socialActivity.commentsDisabled}"
	                           			value="Disable comments"
	                           			action="#{wallactions.disableComments(cc.attrs.socialActivity)}"
	                           			update="#{cc.attrs.growlToUpdate} panelToggleComments comments panelSocialActivityOptions">
	                       				<f:param name="learningContext" value="#{cc.attrs.learningContext}"></f:param>
	      								<f:param name="page" value="#{facesContext.viewRoot.viewId}"></f:param>
	                           		</p:commandLink>
	                           		<p:commandLink rendered="#{cc.attrs.socialActivity.commentsDisabled}"
	                           			value="Enable comments"
	                           			action="#{wallactions.enableComments(cc.attrs.socialActivity)}"
	                           			update="#{cc.attrs.growlToUpdate} panelToggleComments comments panelSocialActivityOptions">
	                       				<f:param name="learningContext" value="#{cc.attrs.learningContext}"></f:param>
	      								<f:param name="page" value="#{facesContext.viewRoot.viewId}"></f:param>
	                           		</p:commandLink>
	                           </li>
	                       </ui:fragment>
                       </ul>
                   </h:panelGroup>
               </div>
           </div>
           <div class="wallPostBody">
               <p id="wallPostTextSelector#{cc.attrs.socialActivity.id}" class="wallPostContent">
               		<h:outputText escape="false" value="#{cc.attrs.socialActivity.text}"></h:outputText>
               </p>
               <post:attachmentPreview id="link"
               		uniqueId="#{cc.attrs.socialActivity.id}"
					attachmentPreview="#{cc.attrs.socialActivity.attachmentPreview}"
					viewUseCase="true"
					learningContext="#{cc.attrs.learningContext}"
			   />
           </div>
           <ui:fragment rendered="#{cc.attrs.socialActivity.type eq 'Post_Reshare'}">
           	   <post:sharedPostPreview
               		socialActivity="#{cc.attrs.socialActivity.originalSocialActivity}"
               		sharedSocialActivityId="#{cc.attrs.socialActivity.id}"
               />
           </ui:fragment>
           <div class="wallPostFooter">
           	   <p:commandLink
					styleClass="like #{cc.attrs.socialActivity.liked ? 'liked' : ''}"
					action="#{activityWallBean.likeAction(cc.attrs.socialActivity)}"
					update="@this">
					<svg class="icon" width="12px" height="12px" viewBox="0 0 12 12" version="1.1">
						<g id="triangle" stroke="none" stroke-width="1" fill="#D5D8DA" fill-rule="evenodd">
							<polygon id="Triangle-5" points="6 1 12 11 0 11 "></polygon>
						</g>
					</svg>
					#{cc.attrs.socialActivity.likeCount == 0 ? 'Like' : cc.attrs.socialActivity.likeCount}
					<f:param name="page" value="#{facesContext.viewRoot.viewId}"/>
					<f:param name="learningContext" value="#{cc.attrs.learningContext}"/>
			   </p:commandLink>
           
               <h:panelGroup id="panelToggleComments">
	               <p:commandLink rendered="#{!cc.attrs.socialActivity.comments.initialized and !cc.attrs.socialActivity.commentsDisabled}"
	               		styleClass="commentsNumber" 
	               		pt:role="button" 
	               		pt:data-toggle="collapse" 
	               		href="#commentsContainerDiv#{cc.attrs.socialActivity.id}" 
	               		pt:aria-expanded="false" 
	               		pt:aria-controls="#commentsContainerDiv#{cc.attrs.socialActivity.id}"
	               		action="#{activityWallBean.initializeCommentsIfNotInitialized(cc.attrs.socialActivity)}"
	               		update="comments panelToggleComments"
	               		oncomplete="$('#commentsContainerDiv#{cc.attrs.socialActivity.id}').collapse();">
	               		<span class="icon"></span>#{cc.attrs.socialActivity.comments.numberOfComments} #{cc.attrs.socialActivity.comments.numberOfComments eq 1 ? 'comment' : 'comments'}
	               	</p:commandLink>
	               	<ui:fragment rendered="#{cc.attrs.socialActivity.comments.initialized and !cc.attrs.socialActivity.commentsDisabled}">
	               		<h:panelGroup id="panelCommentsNumber" styleClass="panelCommentsNumber#{cc.attrs.socialActivity.id}">
		               			<a class="commentsNumber" role="button" data-toggle="collapse" href="#commentsContainerDiv#{cc.attrs.socialActivity.id}" aria-expanded="false" aria-controls="collapseComments1">
		               				<span class="icon"></span>
		               					#{cc.attrs.socialActivity.comments.numberOfComments} #{cc.attrs.socialActivity.comments.numberOfComments eq 1 ? 'comment' : 'comments'}
		               		    </a>
	               		</h:panelGroup>  
	           		</ui:fragment>
	            </h:panelGroup>
	            <ui:fragment rendered="#{cc.attrs.socialActivity.type eq 'Post'}">
		            <p:commandLink 
		            	styleClass="sharePost" 
		            	pt:data-toggle="modal" 
		            	data-target="#sharePostModal"
		            	action="#{activityWallBean.setSocialActivityForShare(cc.attrs.socialActivity)}"
		            	update="#{cc.attrs.toUpdateShareModal}"
		            	oncomplete="$('##{cc.attrs.shareModalId}').modal('show'); #{cc.attrs.jsFunctionToPrepareShareModal}();">
		            	<span class="icon"></span>Share
		            </p:commandLink>
		        </ui:fragment>
           </div>
           
           <post:comments
           		id="comments"
           		comments="#{cc.attrs.socialActivity.comments}"
           		uniqueId="#{cc.attrs.socialActivity.id}"
           		commentsContainerDivId="commentsContainerDiv#{cc.attrs.socialActivity.id}"
           		showSortOptions="false"
           		isCollapsible="true"
           		growlToUpdate="#{cc.attrs.growlToUpdate}"
           		learningContext="#{learningContext}"
           		toUpdateOnSaveTopLevelComment="@(.panelCommentsNumber#{cc.attrs.socialActivity.id})"
           		toUpdateOnCommentSave=""
           />
       </article>
       <script>
	  		$(function(){
	  			replaceInlineUserLink('#wallPostTextSelector#{cc.attrs.socialActivity.id}');
	  		});
	   </script>   
	</composite:implementation>
</ui:component>