<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:link="http://java.sun.com/jsf/composite/components/resourceLinks"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util"
	xmlns:util="http://www.prosolo.com/util">

	<utilcomp:messagesBundle var="msg" />
	
	<h:outputScript library="javascript" name="prosolo.search.js" target="head" />

	<!-- search start -->
	<li class="dropdown search">
		<a href="#" class="dropdown-toggle faded" data-toggle="dropdown" role="button" 
			aria-haspopup="true" aria-expanded="false">
			<i class="fa fa-search fa-lg"></i>
		</a>
		
		<!-- search panel start -->
		<div class="dropdown-menu searchPanel">
			<div class="col-md-2">
				<div class="sFor">Search for:</div>
			</div>
			
			<div class="col-md-9">
				<h:form id="globalsearchform" class="navbar-form navbar-left" role="search">
				
					<p:growl id="globalSearchFormGrowl" showDetail="true" />
				
					<p:remoteCommand name="globalSearchAction"
						update=":topSearchResults"
						action="#{globalSearchBean.executeSearch}" />
						
					<script>
						var globalSearch;
					
						$(function() {
							$('.userActions .search').prosolosearch({
								resultContainer : '.userActions .search .searchResults',
								loaderContainer : '.userActions .search .searchResults .container',
								searchInput : '.userActions .search .form-control',
								watermark: 'Search',
								searchAction: globalSearchAction,
								hideSearchResultsOnOutsideClick: false
							});
							globalSearch = $('.userActions .search').data('prosolo.search');
						});
					</script>
				
					<div class="form-group">
						<h:inputText size="20" 
				 			id="globalInputString"
				 			value="#{globalSearchBean.query}"
				 			onclick="return false;"
							styleClass="form-control"
							placeholder="Search..."
						/>
					</div>
					<script>
						$('.search .dropdown').on('click', function(e){
							e.stopPropagation();
						});
					</script>
				</h:form>
			</div>
			
			<div class="col-md-1">
				<a href="javascript:;" class="closeSearch">
					<i class="fa fa-close fa-lg"></i>
				</a>
			</div>
			
			<div class="searchResults">
				<h:panelGroup id="topSearchResults" class="container">
					<div class="row">
						<div class="col-md-4">
							<div class="resBox">
								<h2>
									#{msg['search.global.courses.title']} (#{searchCoursesBean.size})
									
									<h:link class="pull-right seeAllLinkSearch" value="See all" outcome="/manage/courses">
										<f:param name="query" value="" />
									</h:link>
								</h2>
								
								<ul>
									<ui:repeat value="#{searchCoursesBean.courses}"	var="foundCourse" varStatus="iterator" id="foundCoursesList">
										<li>
											<div class="col-md-2">
												<span class="ico-sm ico-credential"></span>
											</div>
											
											<div class="col-md-10 resRight">
												<h3>
													<h:link value="#{foundCourse.title}" outcome="/manage/course">
														<f:param name="id" value="#{util:encodeId(foundCourse.id)}" />
													</h:link>
												</h3>
												<span> 
													Created by:
													<link:user
														mode="name"
														userData="#{foundCourse.maker}"
														idPrefix="globalSearchCourse#{iterator.index}" 
														context="topsearch.credentials.#{foundCourse.id}.details"/>
													 - 
													<p:commandLink
										    			rendered="#{not empty foundCourse.memberIds}"
														value="#{foundCourse.memberIds.size()} members"
														action="#{peopleListDialog.initializePeopleWithIds(foundCourse.memberIds)}"
														onclick="$('#peopleListDialog').dialog('open');"
														update=":peopleListForm"
													/>
													<h:outputText rendered="#{empty foundCourse.memberIds}"	value="0 members" />
												</span>
												<br />
												
												<h:link value="Details" outcome="/manage/course">
													<f:param name="id" value="#{util:encodeId(foundCourse.id)}" />
												</h:link>
											</div>
										</li>
									</ui:repeat>
								</ul>
							</div>
						</div>
						
						<div class="col-md-4">
							<div class="resBox">
								<h2>
									#{msg['label.competence.plural']} (#{searchCompetencesBean.compsSize})
									<h:link class="pull-right seeAllLinkSearch" outcome="/manage/competences" value="See all">
										<f:param name="query" value="" />
									</h:link>
								</h2>
								
								<ul>
									<ui:repeat value="#{searchCompetencesBean.competences}"	var="foundCompetence" varStatus="iterator" id="foundCompetencesList">
										<li>
											<div class="col-md-2">
												<span class="ico-sm ico-competence"></span>
											</div>
											<div class="col-md-10 resRight">
												<h3>
													<h:link value="#{foundCompetence.title}" outcome="/manage/competence">
														<f:param name="id" value="#{util:encodeId(foundCompetence.id)}" />
													</h:link>
												</h3>
					
												<span> 
													Created by: 
													<link:user
														mode="name"
														userData="#{foundCompetence.maker}"
														idPrefix="globalSearchComp#{iterator.index}"
														context="topsearch.competences.#{foundCompetence.id}.maker" />
												</span>
												<br /> 
												
												
												<h:link value="Details" outcome="/manage/competence">
													<f:param name="id" value="#{util:encodeId(foundCompetence.id)}" />
												</h:link>
												
											</div>
										</li>
									</ui:repeat>
								</ul>
							</div>
						</div>
						
						
					</div>
					
					<script>
					$(function() {
						$('.userActions .search .searchResults .seeAllLinkSearch').each(function(i, obj) {
							var seeAll1 = $(obj);
							seeAll1.attr('href', setQueryParamOfUri(seeAll1.attr('href'), 'query', $('#globalsearchform .form-control').val()));
						});
					});
					</script>
				</h:panelGroup>
			</div>
		</div> <!-- search panel end --></li>
	<!-- search end -->
</ui:composition>
