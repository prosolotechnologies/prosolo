<ui:component
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util">
	
	<composite:interface>
		<composite:attribute name="edit" default="true"/>
		<composite:attribute name="user" required="true"/>
		<composite:attribute name="context" />
	</composite:interface>
	
	<composite:implementation>
	
		<h:outputScript library="javascript" name="prosolo.tags.js" target="head"/>
	
		<h:form id="userInterestsBlock">
			<h3>
				Interests
			</h3>
			<div class="clear"></div>
			
			<h:panelGroup layout="block" id="interestsContainer" styleClass="interestsContainer">
			
				<div class="actions">
					<c:if test="#{cc.attrs.edit}">
						<a href="#" class="button gray size20 linkEdit" 
							onclick="toggleEditMode('.userInterestsRead','.userInterestsEdit');toggleEditMode('.linkEdit','.linkSave, .linkCancel');sendServiceUse('MOUSE_CLICK', {context: '#{cc.attrs.context}.interests', link: 'edit'});return false;">
							Edit
						</a>
					</c:if>
						
					<a class="button gray size20 linkCancel hidden" 
						onclick="toggleEditMode('.userInterestsRead','.userInterestsEdit');toggleEditMode('.linkEdit','.linkSave, .linkCancel');sendServiceUse('MOUSE_CLICK', {context: '#{cc.attrs.context}.interests', link: 'cancel'});">
						Cancel
					</a>
					<p:commandLink styleClass="button green size20 linkSave hidden" 
						id="btnSaveGoal" value="Save"
						action="#{userinterests.updateUserInterests(cc.attrs.context)}"
						onclick="toggleEditMode('.userInterestsRead','.userInterestsEdit');toggleEditMode('.linkEdit','.linkSave, .linkCancel');" 
						update="interestsContainer userInterestsGrowl"/>
				</div>

				<h:panelGroup layout="block" id="userInterestsRead" styleClass="userInterestsRead">
					<h:outputText rendered="#{empty userinterests.interestsData.interestsText}"
						class="noContentMessage" value="No interests specified" />
						
					<h:inputText rendered="#{not empty userinterests.interestsData.interestsText}" 
						class="interestsReadBox" value="#{userinterests.interestsData.interestsText}" />
					
					<script>
						$('.userInterestsEdit .interestsEditBox').tags({editMode : true});
						$('.userInterestsRead .interestsReadBox').tags({
							editMode : false,
							tag: 'a',
							onClick: function(elem, hashtag) {
								$(elem).attr('href', 'search.xhtml?tab=hashtags&amp;query='+hashtag);
							}
						});
					</script>
				</h:panelGroup>
				
				<c:if test="#{cc.attrs.edit}">
					<h:panelGroup layout="block" id="userInterestsEdit" class="hidden userInterestsEdit">
						<h:inputText class="interestsEditBox" value="#{userinterests.interestsData.interestsTextEdit}" />
						
						<span class="noContentMessage block">HINT: Separate interests with comma (,)</span>
					</h:panelGroup>
				</c:if>
			</h:panelGroup>
			
			<utilcomp:lazyLoad 
				parentClass="userInterests"
				specificClassIdentifier="interests"
				updateOnComplete=":userInterests:userInterestsBlock:interestsContainer"
				loaderContainer=".interestsContainer"
				initializeAction="#{userinterests.init(cc.attrs.user)}"
				oncomplete="registerLazyLoadCompleted();"
				async="true"
			/>

			<p:growl id="userInterestsGrowl" showDetail="true" />
		</h:form>
	</composite:implementation>
</ui:component>