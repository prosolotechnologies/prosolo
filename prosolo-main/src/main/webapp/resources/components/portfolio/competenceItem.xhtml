<ui:component
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util"
	xmlns:dlgAnalytics="http://java.sun.com/jsf/composite/components/dialogs/analytics"
	xmlns:icon="http://java.sun.com/jsf/composite/components/resourceLinks/icons"
	xmlns:link="http://java.sun.com/jsf/composite/components/resourceLinks">

	<composite:interface>
		<composite:attribute name="compData" type="org.prosolo.web.portfolio.data.AchievedCompetenceData" required="true" />
		<composite:attribute name="styleClass" />
		<composite:attribute name="idSufix" />
		<composite:attribute name="canBeBrushedUp" default="true" />
		<composite:attribute name="editable" type="java.lang.Boolean" default="false" />
		<composite:attribute name="context" />
	</composite:interface>
	
	<composite:implementation>
		<utilcomp:messagesBundle var="msg" />
	
		<div id="compItem#{cc.attrs.idSufix}" class="compProfileItem profileItem profileItemBlue #{cc.attrs.styleClass}">
			<div class="topContent">
				<h4>
					<link:competence
						toRender="#{cc.attrs.compData.targetCompetenceId > 0}"
						styleClass="firstLine"
						resourceId="#{cc.attrs.compData.targetCompetenceId}"
						type="TargetCompetence"
						title="#{cc.attrs.compData.title}"
						context="#{cc.attrs.context}"
					/>
					<link:competence
						toRender="#{cc.attrs.compData.targetCompetenceId == 0}"
						styleClass="firstLine"
						resourceId="#{cc.attrs.compData.competenceId}"
						type="Competence"
						title="#{cc.attrs.compData.title}"
						context="#{cc.attrs.context}"
					/>
				</h4>
				
				<p>Valid for <strong>1 year</strong></p>
				
				<p:commandLink
					rendered="#{cc.attrs.compData.badgeCount > 0}"
					styleClass="link profLinkBadges"
					onclick="$('#badgeListDialog').dialog('open');"
					action="#{badgelist.initializeForCompletedResourceById(cc.attrs.compData.id, cc.attrs.context)}"
					update=":badgeListForm"
					>
					<span class="icon active"></span>
					<span class="count">#{cc.attrs.compData.badgeCount}</span> badges								
				</p:commandLink>
				<h:panelGroup layout="block"
					rendered="#{cc.attrs.compData.badgeCount == 0}"
					styleClass="link profLinkBadges inactive"
					>
					<span class="icon"></span>
					<span class="count">0</span> badges								
				</h:panelGroup>
				
				<p:commandLink
					styleClass="link profLinkEvals"
					rendered="#{cc.attrs.compData.evaluationCount > 0}"
					onclick="$('#evaluationListDialog').dialog('open');"
					action="#{evaluationlist.initializeTargetCompetenceEvaluations(cc.attrs.compData.targetCompetenceId, true, cc.attrs.context)}"
					update=":#{p:component('evaluationListForm')}"
					>
					<span class="icon active"></span>
					<span class="count">#{cc.attrs.compData.evaluationCount}</span> #{msg['portfolio.evaluatedItem.evaluationsNumber']}
				</p:commandLink>
				<h:panelGroup layout="block"
					rendered="#{cc.attrs.compData.evaluationCount == 0}"
					styleClass="link profLinkEvals inactive"
					>
					<span class="icon"></span>
					<span class="count">0</span> #{msg['portfolio.evaluatedItem.evaluationsNumber']}								
				</h:panelGroup>
				
				<p:commandLink
					styleClass="link profLinkStats"
					onclick='$("#competenceStatisticsDialog").dialog("open");'
					action="#{competenceAnalyticsBean.initializeById(cc.attrs.compData.competenceId, cc.attrs.context)}"
					update=":compAnalytics:competenceStatisticsDialogForm">
					
					<span class="icon"></span>
					Statistics
				</p:commandLink>
				
				<utilcomp:visibility 
					visibility="#{cc.attrs.compData.visibility}"
					toRender="#{cc.attrs.editable}"
					containerDiv="#compItem#{cc.attrs.idSufix}"
					contentType="node"
					changeNodeVisibility="#{portfolioutil.changeNodeVisibility(cc.attrs.compData)}"
					context="#{cc.attrs.context}.comp.#{cc.attrs.compData.competenceId}" />
			</div>
					
			<h:panelGroup layout="block" rendered="#{cc.attrs.editable}" class="bottomEdit">
				<c:if test="#{cc.attrs.canBeBrushedUp}">
					<p:commandLink value="Brush up"
						onclick="$('#addToGoalDialog').dialog('open');"
						action="#{addToGoalDialog.initializeGoalsByCompetenceId(cc.attrs.compData.competenceId, cc.attrs.context)}"
						update=":addToGoal:addToGoalForm"
					/>
				</c:if>
				
				<c:if test="#{!adminSettings.settings.individualCompetencesCanNotBeEvaluated}">
					<p:commandLink value="#{msg['portfolio.evaluatedItem.button.askForEvaluation.title']}"
						rendered="#{cc.attrs.compData.competence == null}"
						onclick="$('#askForEvaluationDialog').dialog('open');"
						action="#{askForEvaluation.setResourceById(cc.attrs.compData.targetCompetenceId, cc.attrs.context)}"
						update=":askForEvaluationDialogForm"
					/>
				
					<p:commandLink value="#{msg['portfolio.evaluatedItem.button.askForEvaluation.title']}" 
						rendered="#{cc.attrs.compData.competence != null}"
						onclick="$( '#askForEvaluationDialog' ).dialog('open');"
						action="#{askForEvaluation.setResource(cc.attrs.compData.competence, cc.attrs.context)}"
						update=":askForEvaluationDialogForm"
					/>
				</c:if>
			</h:panelGroup>
		</div>
	</composite:implementation>
</ui:component>