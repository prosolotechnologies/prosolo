<ui:component
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:func="http://org.prosolo/functions"
	xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:dlg="http://java.sun.com/jsf/composite/components/dialogs"
	xmlns:comp="http://java.sun.com/jsf/composite/components"
	xmlns:link="http://java.sun.com/jsf/composite/components/resourceLinks"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util">
 
	<composite:interface>
		<composite:attribute name="toRender" default="true" />
	</composite:interface>
	
	<composite:implementation>
		<utilcomp:messagesBundle var="msg" />

		<h:outputStylesheet library="css" name="jquery.switchButton.css"  />
		
		<h:outputScript library="javascript" name="jquery.switchButton.js" target="head" />
		<h:outputScript library="javascript" name="prosolo.switchButton.js" target="head" />
		<h:outputScript library="javascript" name="jquery.autosize.min.js" target="head" />
	
		<div id="submitEvaluation" class="container submitEvaluation">
		
			<div class="content wide">
			
			    <h:form rendered="#{cc.attrs.toRender}" id="submitEvaluationForm">
			    	<div class="info">
						<div class="title">
							<h2>
								#{msg['evaluation.competence.title']} 
								<h:panelGroup rendered="#{newevaluation.formData.draft}"> - Draft</h:panelGroup>
							</h2>
							
							<h:panelGroup layout="block" 
								rendered="#{!newevaluation.formData.draft}"
								class="normal">
									<strong>Submitted:&#160;</strong>#{newevaluation.formData.dateSubmitted}
							</h:panelGroup>
						</div>
						
						<table>
							<tr>
								<td>#{msg['evaluation.goal.info.label.title']}: </td>
								<td colspan="3">
									<link:competence
										resourceId="#{newevaluation.formData.primeEvaluatedResource.id}"
										type="TargetCompetence"
										title="#{newevaluation.formData.primeEvaluatedResource.title}"
										styleClass="bold"
										context="competenceEvaluation" />
								</td>
							</tr>
							<tr>
								<td>#{msg['evaluation.goal.info.label.requested']}:</td>
								<td colspan="3">
									#{newevaluation.formData.dateRequested}
								</td>
							</tr>
						</table>
							
						<p>
			    			#{msg['evaluation.competence.info.evaluationRequest.part1.user']} 
			    			
			    			<span class="title"><link:user value="userDetails" user="#{newevaluation.formData.requester}" mode="name" context="competenceEvaluation.name"/></span>
			    			#{msg['evaluation.competence.info.evaluationRequest.part2.requestingEvaluation']} 
				    		
				    		<span class="title">
			    			<link:competence
								resourceId="#{newevaluation.formData.primeEvaluatedResource.id}"
								type="TargetCompetence"
								title="#{newevaluation.formData.primeEvaluatedResource.title}"
								styleClass="bold"
								context="competenceEvaluation" /></span>.<br/>

			    			#{msg['evaluation.competence.info.detailedExplanation']} 
							<br/> 
							
							<!-- 
							For activating hints for writing the evaluation, please click here.
							 -->
						</p>
			    	</div>
			    	
			    	<div class="separator clear"></div>
			    	
					<div class="message">
						<h3>#{msg['evaluation.competence.message.sectionTitle']}
				    		
				    		<span class="switchButton">
					    		<h:selectBooleanCheckbox value="#{newevaluation.formData.primeEvaluatedResource.accepted}"
					    			class="approveBtn" />
					    			
								<script>
									$('#submitEvaluation .message .approveBtn').switchButton({
					    				width: 40,
					    				height: 15,
					    				button_width: 20,
			    						on_label: 'Approved', 
			    						off_label: 'Rejected',
			    						disabled: #{!newevaluation.formData.draft},
			    					});
									$('#submitEvaluation .message textarea.evaluationMessage').autosize(); 
								</script>
				    		</span>
				    	</h3>
					
				    	<h:panelGroup layout="block" rendered="#{newevaluation.formData.draft}">
							<h:inputTextarea class="evaluationMessage left" 
								value="#{newevaluation.formData.primeEvaluatedResource.comment}"
								placeholder="#{msg['textarea.message']}" />
								
							<script>
								$(function() {
									$('#submitEvaluation .message textarea.evaluationMessage').autosize(); 
								});
							</script>
						</h:panelGroup>
						
						<h:panelGroup layout="block"
							rendered="#{!newevaluation.formData.draft}"
							class="text left evaluationMessage">
							#{newevaluation.formData.primeEvaluatedResource.comment}
						</h:panelGroup>
						
						<div class="rightBox">
							<h:panelGroup layout="block" id="badgesContainer" class="badgesDialog right">
								Badges:
								<c:if test="#{newevaluation.formData.draft and not empty newevaluation.formData.primeEvaluatedResource.badges}">
									<h:panelGrid columns="3">
										<ui:repeat value="#{newevaluation.formData.primeEvaluatedResource.badges}" var="badge">
											<div class="badgeWrapper">
												<p:commandLink rendered="#{newevaluation.formData.draft}"
													styleClass="badge badge#{badge.capitalizedName}50 #{badge.selected ? 'selected' : ''}" 
						    						action="#{newevaluation.toggleBadge(newevaluation.formData.primeEvaluatedResource, badge)}"
						    						update=":#{cc.clientId}:submitEvaluationForm:badgesContainer" />
											
					   							<div class="clear"></div>
											</div>
							    		</ui:repeat>
									</h:panelGrid>
								</c:if>
								
								<c:if test="#{!newevaluation.formData.draft}">
									<c:if test="#{not empty newevaluation.formData.primeEvaluatedResource.selectedBadges}">
										<h:panelGrid columns="3">
											<ui:repeat value="#{newevaluation.formData.primeEvaluatedResource.selectedBadges}" var="badge">
												<div class="badgeWrapper">
													<h:panelGroup rendered="#{!newevaluation.formData.draft and badge.selected}"
														class="badge badge#{badge.capitalizedName}50 selected">
													</h:panelGroup>
						   							
						   							<div class="clear"></div>
												</div>
								    		</ui:repeat>
										</h:panelGrid>
									</c:if>
								
									<c:if test="#{empty newevaluation.formData.primeEvaluatedResource.selectedBadges}">
										<br/>
										<span class="noContentMessage">
											No selected badges.
										</span>
									</c:if>
								</c:if>
							</h:panelGroup>
			    		</div>
					</div>
						
					<div class="clear separator"></div>
					
				    <h:panelGroup layout="block" styleClass="actions">
					    <p:commandLink
							value="Save draft"
					    	rendered="#{newevaluation.formData.draft}"
							styleClass="button blue right size30"
							action="#{newevaluation.saveDraft}"
							update="submitEvaluationFormGrowl"
						/>										
					    <p:commandLink
							value="Submit"
					    	rendered="#{newevaluation.formData.draft}"
							styleClass="button green size30 marginRight10"
							onclick="$('#submitEvaluationDialog').dialog('open');"
						/>								
						<h:link value="#{newevaluation.formData.draft ? 'Cancel' : 'Back'}" 
							styleClass="button gray size30" 
							outcome="/communications" />
				    </h:panelGroup>
						
					<div class="activitiesUsed" id="activitiesUsed">
				   		<h3>Activity plan used</h3>
				   		
				   		<h:panelGroup rendered="#{not empty newevaluation.formData.usedActivities}"
				   			class="options right marginBottom10">
				   			Options: 
							<label class="marginLeft10">
								<h:selectBooleanCheckbox class="details" value="#{newevaluation.showActivityDetails}" />
								Show details
							</label>
						</h:panelGroup>
				    
				    	<comp:planused id="evaluationCompetence" 
				    		value="planused"
				    		mode="MANAGER"
							parentid="activitiesUsed"
							activities="#{newevaluation.formData.usedActivities}"
							cantdisplaymessage="No activities have been associated with this competence." />
							
						<script>
							$('#submitEvaluation .actBlock .title').on('click', function() {
								var details = $(this).next('.box');
								
								if (details.css('display') == 'none') {
									details.slideDown();
								} else {
									details.slideUp();
								}
							});
							
							$('#submitEvaluation .activitiesUsed .details').on('click', function() {
							    if ($(this).is(':checked')) {
							    	$('#submitEvaluation .actBlock .box').slideDown();
							    } else {
							    	$('#submitEvaluation .actBlock .box').slideUp();
							    }
							});
						</script>
				    </div>
						
					<script>
						$(function() {
							roundImages();
						});
					</script>
					
					<p:growl id="submitEvaluationFormGrowl" showDetail="true" />
				</h:form>
				
				<dlg:appendedActivities id="appActivities" />
				<div class="clear"></div>
			</div><!-- .content -->
		
			<div class="clear"></div>
		</div><!-- .container end -->
	</composite:implementation>
</ui:component>