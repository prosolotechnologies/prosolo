<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:link="http://java.sun.com/jsf/composite/components/resourceLinks"
	xmlns:action="http://java.sun.com/jsf/composite/components/actions"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util"
	xmlns:pt="http://java.sun.com/jsf/passthrough">

	<utilcomp:messagesBundle var="msg" />

	<div class="searchSystem">
		<a href="#" class="arrow btnSearchClass" onclick="$('.searchSystem .searchPanel .form-control').focus();return false;">
			<i class="fa fa-search fa-lg"></i>
		</a>
		
		<div class="dropdown searchPanel hidden" style="display: hidden;">
			<div class="col-md-2">
				<div class="sFor">Search for:</div>
			</div>
			<div class="col-md-9">
				<h:form id="globalsearchform" class="globalsearchform indexTripStep12" position="s">
					
					<p:growl id="globalSearchFormGrowl" showDetail="true" />
					
					<p:remoteCommand name="globalSearchAction"
						update=":topSearchResults"
						action="#{globalSearchBean.executeSearch}" />
					
					<script>
						var globalSearch;
					
						$(function() {
							$('.mainMenuButtons .searchSystem').prosolosearch({
								resultContainer : '.mainMenuButtons .searchSystem .searchResults',
								loaderContainer : '.mainMenuButtons .searchSystem .searchResults .container',
								searchInput : '.mainMenuButtons .searchSystem .form-control',
								watermark: 'Search',
								searchAction: globalSearchAction,
								hideSearchResultsOnOutsideClick: false
							});
							globalSearch = $('.mainMenuButtons .searchSystem').data('prosolo.search');
						});
					</script>
					
					<div class="form-group">
						<h:inputText size="20" 
				 			id="globalInputString"
				 			value="#{globalSearchBean.query}"
				 			onclick="return false;"
							styleClass="form-control"
							placeholder="Search..."
						/>
					</div>
					<script>
						$('.searchSystem .dropdown').on('click', function(e){
							e.stopPropagation();
						});
					</script>
				</h:form>
			</div>
			
			<div class="col-md-1">
				<a class="closeSearch" href="#" onclick="$('.searchSystem .dropdown').addClass('hidden');$('.searchSystem .closeSearch').removeClass('pressed');return false;">
					<i class="fa fa-close fa-lg"></i>
				</a>
			</div>
			
			<div class="searchResults hidden">
				<h:panelGroup layout="block" id="topSearchResults" class="container">
					<div class="row">
						<div class="col-md-4 resultCategory">
							<div class="resBox">
								<h2>
									#{msg['search.global.courses.title']} (#{searchCoursesBean.size})
									<h:link class="pull-right seeAllLink" value="See all" outcome="/courseBrowse">
										<f:param name="query" value="" />
									</h:link>
								</h2>
								
								<ul>
									<ui:repeat value="#{searchCoursesBean.courses}"	var="foundCourse" varStatus="iterator" id="foundCoursesList">
										<li>
											<div class="col-md-2">
												<span class="courseIcon30"></span>
											</div>
											
											<div class="col-md-10 resRight">
												<h3>
													<h:link value="#{foundCourse.title}" outcome="/course">
														<f:param name="id" value="#{foundCourse.id}" />
													</h:link>
												</h3>
												
												<span> 
													Created by:
													<link:user
														mode="name"
														userData="#{foundCourse.maker}"
														idPrefix="globalSearchCourse#{iterator.index}" 
														context="topsearch.credentials.#{foundCourse.id}.details"/>
													 - 
													<p:commandLink
										    			rendered="#{not empty foundCourse.memberIds}"
														value="#{foundCourse.memberIds.size()} members"
														action="#{peopleListDialog.initializePeopleWithIds(foundCourse.memberIds)}"
														onclick="$('#peopleListDialog').dialog('open');"
														update=":peopleListForm"
													/>
													<h:outputText rendered="#{empty foundCourse.memberIds}"	value="0 members" />
												</span>
												<br />
												
												<h:link value="Details" outcome="/course">
													<f:param name="id" value="#{foundCourse.id}" />
												</h:link>
											</div>
										</li>
									</ui:repeat>
								</ul>
							</div>
						</div>
						<div class="col-md-4 resultCategory">
							<div class="resBox">
								<h2>
									Competences (#{searchCompetencesBean.compsSize})
									<h:link class="pull-right seeAllLink" outcome="/search" value="See all">
										<f:param name="tab" value="competences" />
										<f:param name="query" value="" />
									</h:link>
								</h2>
								<ul>
									<ui:repeat value="#{searchCompetencesBean.competences}"	var="foundCompetence" varStatus="iterator" id="foundCompetencesList">
										<li>
											<div class="col-md-2">
												<span class="competenceIcon30"></span>
											</div>
											<div class="col-md-10 resRight">
												<h3>
													<link:competence resourceId="#{foundCompetence.id}"
														type="Competence"
														title="#{foundCompetence.title}"
														context="topsearch.competences.#{foundCompetence.id}.title" />
												</h3>
												<span> Created by: 
													<link:user
														mode="name"
														userData="#{foundCompetence.maker}"
														idPrefix="globalSearchComp#{iterator.index}"
														context="topsearch.competences.#{foundCompetence.id}.maker" />
												</span>
												
												<br />
												
												<link:competence resourceId="#{foundCompetence.id}"
													type="Competence"
													title="Details"
													context="topsearch.competences.#{foundCompetence.id}.details" />
											</div>
										</li>
									</ui:repeat>
								</ul>
							</div>
						</div>
						<div class="col-md-4 resultCategory">
							<div class="resBox">
								<h2>
									People (#{searchPeopleBean.userSize})
									<h:link class="pull-right seeAllLink" outcome="/search" value="See all">
										<f:param name="tab" value="people" />
										<f:param name="query" value="" />
									</h:link>
								</h2>
								<ul>
									<ui:repeat id="foundUsersList" value="#{searchPeopleBean.users}" var="userData" varStatus="iterator">
										<li>
											<div class="col-md-2">
												<span class="userProfileImage">
													<h:graphicImage styleClass="imageRound image30"
														value="#{userData.avatarUrl}" width="30"
														height="30" alt="#{userData.name}" />
												</span>
											</div>
											<div class="col-md-10 resRight">
												<h3>
													<link:user
														userData="#{userData}"
														divClass="title link" 
														mode="name"
														idPrefix="globalSearchName#{iterator.index}"
														context="globalsearch.name" />
												</h3>
												<action:directMessage receiverData="#{userData}" />
												|
												<h:panelGroup rendered="#{!peopleActionBean.isLoggedUserFollowingCollegueById(userData.id)}">
													<p:commandLink id="followButton" value="Follow"
														action="#{peopleActionBean.followCollegueData(userData, 'globalsearch')}"
														update=":globalsearchform:globalSearchFormGrowl #{(view.viewId == '/index.xhtml') ? ':listFollowingPeopleForm:followingUsersPanel' : ''}"
														oncomplete="roundImages()"
														/>
												</h:panelGroup>
												
												<h:panelGroup rendered="#{peopleActionBean.isLoggedUserFollowingCollegueById(userData.id)}">
													<p:commandLink id="unfollowButton" value="Unfollow"
														action="#{peopleActionBean.unfollowCollegueData(userData, 'globalsearch')}"
														update=":globalsearchform:globalSearchFormGrowl #{(view.viewId=='/index.xhtml') ? ':listFollowingPeopleForm:followingUsersPanel' : ''}"
														oncomplete="roundImages()" />
												</h:panelGroup>
											</div>
										</li>
									</ui:repeat>
								</ul>
							</div>
						</div>
						<div class="clear"></div>
					</div>
					
					<script>
					$(function() {
						var seeAll1 = $('.mainMenuButtons .searchSystem .searchResults .resultCategory .seeAllLink');
						seeAll1.attr('href', setQueryParamOfUri(seeAll1.attr('href'), 'query', $('.globalsearchform .form-control').val()));
					});
					</script>
				</h:panelGroup>

				<div class="clear"></div>
			</div>
		</div>
	</div>
</ui:composition>