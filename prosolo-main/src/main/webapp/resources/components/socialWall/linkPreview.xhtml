<ui:component
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:post="http://java.sun.com/jsf/composite/components/post"
	xmlns:util="http://www.prosolo.com/util"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util">

	<composite:interface>
		<composite:attribute name="attachmentPreview" required="true"/>
		<composite:attribute name="styleClass" default="" />
	</composite:interface>
	
	<composite:implementation>
		<div id="#{cc.clientId}">
		<ui:remove><h:panelGroup rendered="#{cc.attrs.attachmentPreview.invalidLink}">
					Could not load website!
		</h:panelGroup></ui:remove>
		<h:panelGroup rendered="#{cc.attrs.attachmentPreview.initialized}">
		<div class="row">
           	<hr></hr>
           	
            <div class="col-md-3 wide">     
            <div id="imgInfoContainer">
				<h:panelGroup layout="block" id="imageContainer">
					<div id="atcImages"> 
						<h:panelGroup rendered="#{not cc.attrs.attachmentPreview.initialized or empty cc.attrs.attachmentPreview.images}">
           					<img width="100" class="shown" src="#{request.contextPath}/resources/images/noImage.jpg"></img>
           				</h:panelGroup>
           				<div id="foundImages">
           				<h:panelGroup rendered="#{not empty cc.attrs.attachmentPreview.images}">
							<ui:repeat value="#{cc.attrs.attachmentPreview.images}" id="images" var="imageIterator">
								<h:graphicImage value="#{imageIterator}" styleClass="#{imageIterator == cc.attrs.attachmentPreview.image ? 'shown' : 'hidden'}" width="100" />
							</ui:repeat>
						</h:panelGroup>
						</div>
					</div>
					
					<h:panelGroup id="atcTotalImageNav" rendered="#{not empty cc.attrs.attachmentPreview.images}">                           	
						<p:commandLink id="prev"
							action="#{competenceActivitiesBean.getPrevImage()}" 
							oncomplete="showImage('prev')"
							update="atcTotalImagesInfo">
							<i class="fa fa-chevron-circle-left"></i>
						</p:commandLink>
						<p:commandLink id="next"
							action="#{competenceActivitiesBean.getNextImage()}" 
							oncomplete="showImage('next')"
							update="atcTotalImagesInfo">
							<i class="fa fa-chevron-circle-right"></i>
						</p:commandLink>
					</h:panelGroup>
					
					<h:panelGroup layout="block" id="atcTotalImagesInfo" class="atcTotalImagesInfo">
						<h:panelGroup id="cur_image_num"><h:outputText value="#{cc.attrs.attachmentPreview.selectedImageIndex + 1}" /></h:panelGroup> of 
						<span id="atc_total_images"><h:outputText value="#{cc.attrs.attachmentPreview.images.size()}" /></span> images
					</h:panelGroup>
					<script>
				$('#atcImages .shown').fadeIn('slow');
				</script>
				</h:panelGroup>
				
				<script>
				function showImage(direction){
					var lookingFor = $('.shown');
					var indexOfSelected = $(' #foundImages img').index(lookingFor);
					var totalSize = $(' #foundImages img').length;
					
					if (direction == "next") {
						if (indexOfSelected >= totalSize-1) {
							indexOfSelected = 0;
						} else {
							indexOfSelected++;
						}
					} else if (direction == "prev") {
						if (indexOfSelected == 0) {
							indexOfSelected = totalSize-1;
						} else {
							indexOfSelected--;
						}
					}
					$ (' #foundImages img').removeClass('shown').addClass('hidden');
					$ (' #foundImages img:eq('+indexOfSelected+')').removeClass('hidden').addClass('shown');
				}
				</script>
				</div>
              
              </div>
              <div class="col-md-9">
              <div class="form-group holderInput">
                 <h:inputText 
                 		value="#{cc.attrs.attachmentPreview.title}"
                 		styleClass="form-control">
                 </h:inputText>
     			</div>
                 <div class="form-group noMargin">
                    <label for="">Page description</label>
                    <h:inputTextarea 
                      rows="5"
                 		value="#{cc.attrs.attachmentPreview.description}"
                 		styleClass="form-control">
                 	  </h:inputTextarea>
     			   </div>
              </div>                     
	</div>  
	</h:panelGroup>
	</div>
	</composite:implementation>
</ui:component>