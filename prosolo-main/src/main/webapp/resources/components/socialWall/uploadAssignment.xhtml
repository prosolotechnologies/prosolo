<ui:component
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:p="http://primefaces.org/ui"
	xmlns:dlg="http://java.sun.com/jsf/composite/components/dialogs"
	xmlns:link="http://java.sun.com/jsf/composite/components/resourceLinks"
	xmlns:icon="http://java.sun.com/jsf/composite/components/resourceLinks/icons"
	xmlns:util="http://www.prosolo.com/util">

	<!-- mode: USER, MANAGER -->

	<composite:interface>
		<composite:attribute name="activityData" type="org.prosolo.web.activitywall.data.ActivityWallData" />
		<composite:attribute name="styleClass" type="java.lang.String" />
		<composite:attribute name="containerClass" type="java.lang.String" />
		<composite:attribute name="handleFileUploadSelector" type="java.lang.String" />
		<composite:attribute name="updateAfterAssignmentChange" type="java.lang.String" />
		<composite:attribute name="toRender" type="java.lang.Boolean" default="true" />
		<composite:attribute name="linkLength" default="60" />
		<composite:attribute name="mode" default="USER" /> 
		<composite:attribute name="disabled" type="java.lang.Boolean" default="false" />
		<composite:attribute name="uniqueParentSelector" type="java.lang.String"/> 
		<composite:attribute name="context" type="java.lang.String"/> 
	</composite:interface>
	
	<composite:implementation>
	
		<h:outputScript library="javascript" name="jquery.shortenedText.js" target="head"/>
		
		<div class="box">
			<h:panelGroup layout="block" rendered="#{cc.attrs.toRender}" class="uploadAssignment richContent #{cc.attrs.styleClass}">
				<strong>Assignment</strong>
				<div class="clear"></div>
				
				<div class="details">
					<span class="left marginRight10">
						Deadline: #{cc.attrs.activityData.attachmentPreview.duration} #{cc.attrs.activityData.attachmentPreview.duration == 1 ? 'day' : 'days'}
					</span>
					<span class="right visibility">
						#{cc.attrs.activityData.attachmentPreview.visibleToEveryone ? '' : 'Visible to uploader'} 
					</span>
				</div>
				
				<h:panelGroup layout="block">
					<div class="clear separator"></div>
					
					<span class="solutionUpload button blue size20 #{cc.attrs.disabled ? '' : 'hidden'}">Upload solution</span> 
					
					<a href="#" class="solutionUpload button blue size20 
						#{((cc.attrs.activityData.attachmentPreview.uploadedAssignmentLink == null or empty cc.attrs.activityData.attachmentPreview.uploadedAssignmentLink) and
							cc.attrs.mode == 'USER') ? (cc.attrs.disabled ? 'hidden' : '') : 'hidden'}"
						onclick="$('#{cc.attrs.uniqueParentSelector} .assignementUploadControl input.upload').trigger('click');return false;">Upload solution</a>
					
					<h:panelGroup class="assignementUploadControl"
						rendered="#{(cc.attrs.activityData.attachmentPreview.uploadedAssignmentLink == null or 
							empty cc.attrs.activityData.attachmentPreview.uploadedAssignmentLink) and
							cc.attrs.mode == 'USER'}">
						<p:fileUpload
							styleClass="uploadAssignment upload	"
							fileUploadListener="#{compwall.handleAssignmentUpload}"  
				            mode="advanced"  
				            auto="true"
				            update="#{cc.attrs.updateAfterAssignmentChange}">
				            <f:attribute name="targetActivityId" value="#{cc.attrs.activityData.id}" />
				            <f:attribute name="context" value="#{cc.attrs.context}" />
			            </p:fileUpload>
					</h:panelGroup>
	
					<h:panelGroup rendered="#{(cc.attrs.activityData.attachmentPreview.uploadedAssignmentLink == null or 
							empty cc.attrs.activityData.attachmentPreview.uploadedAssignmentLink) and
							cc.attrs.mode == 'MANAGER' and not cc.attrs.disabled}">
						No file uploaded
					</h:panelGroup> 
					
					<h:panelGroup rendered="#{cc.attrs.activityData.attachmentPreview.uploadedAssignmentLink != null and 
								not empty cc.attrs.activityData.attachmentPreview.uploadedAssignmentLink}">
								
						<span class="left marginRight10">Uploaded files:</span>
						<div class="clear"></div>
						<h:outputLink styleClass="assignmentUrl left" target="_blank" 
							onclick="sendLogPageNavigationWithParameters('#{cc.attrs.activityData.attachmentPreview.uploadedAssignmentLink}', {context: '#{cc.attrs.context}.uploadAssignment'});"
							value="#{cc.attrs.activityData.attachmentPreview.uploadedAssignmentLink}">
								- #{cc.attrs.activityData.attachmentPreview.uploadedAssignmentTitle.trim()}
						</h:outputLink>

						<p:commandLink styleClass="closeIcon"
							rendered="#{cc.attrs.mode == 'USER'}"
							action="#{compwall.removeAssignmentFromActivity(cc.attrs.activityData)}"
							update="#{cc.attrs.updateAfterAssignmentChange}"
							process="@this">
							<f:param name="context" value="#{cc.attrs.context}" />
						</p:commandLink>
						
						<script>
							$('#{cc.attrs.containerClass} .assignmentUrl').shortenedText({showChar: #{cc.attrs.linkLength}, mode: 'static'});
						</script>
					</h:panelGroup>
				</h:panelGroup>
			</h:panelGroup>
		</div>
	</composite:implementation>
</ui:component>