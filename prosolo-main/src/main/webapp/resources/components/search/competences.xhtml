<ui:composition
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:dlg="http://java.sun.com/jsf/composite/components/dialogs"
	xmlns:action="http://java.sun.com/jsf/composite/components/actions"
	xmlns:link="http://java.sun.com/jsf/composite/components/resourceLinks"
	xmlns:icon="http://java.sun.com/jsf/composite/components/resourceLinks/icons">
	
	<h:outputScript library="javascript" name="readmore.custom.js" target="head" />
	
	<script>
		document.title = 'Search: Competences';
	</script>
	
	<div id="searchCompetences">
		<h2>Search: Competences</h2>
		
		<h:form id="compSearchForm" class="filteredSearch">
			<div>
				<p:commandLink styleClass="button blue size25 right search" value="Search"
					onclick="addLoaderToSearchContainer(); updateUrlQuery();"
					action="#{searchCompetencesBean.searchAllCompetences()}"
					update=":compSearchForm:resultContainer"/>
				
				<div class="inputContainer">
					<div class="mGlass"></div>
  						<h:inputText size="20" class="searchInput"
				  		onclick="$(this).select();" 
				  		onkeydown="searchListener();" />
				  	<h:inputHidden class="searchInputHidden"
				  		value="#{searchCompetencesBean.query}" 
				  	/>
				</div>
			</div>

			<div class="separator clear"></div>
			
			<h:panelGroup layout="block" class="resultContainer" id="resultContainer" style="display: none;">
				<ui:repeat value="#{searchCompetencesBean.competences}" var="compData" id="compList" varStatus="iterator">
					
					<div class="box">
						<div class="avatar">
							<icon:competence />
						</div>
						
						<div class="textWrapper">
							<span class="title">
								<link:competence
									resource="#{compData.competence}"
									type="Competence"
									title="#{compData.title}" />
							</span>
							<div class="clear"></div>
							
							<h:panelGroup layout="block"
								rendered="#{compData.description != null}"
								class="message">"#{compData.description}"</h:panelGroup>
							<div class="clear"></div>
							<h:panelGroup layout="block" class="user">
								
								Creator:&#160;
								
								<link:user value="userDetailsImage" 
				    				user="#{compData.creator}"
				    				mode="imageName"
				    				imageSize="22"
				    				idPrefix="compSearchCreator#{iterator.index}" 
				    				context="search.competences.#{compData.id}.maker.imageName"/>
							</h:panelGroup>
							
							<div class="clear"></div>
							
							<div class="links">
								<action:addToGoal 
									styleClass="left button"
									competence="#{compData.competence}" />
							</div>
						</div>
						
						<div class="date">Validity: #{compData.validity} months</div>
		            </div>
					
					<div class="separator clear"></div>
					
				</ui:repeat>
				
				<p:commandLink id="loadMore" rendered="#{searchCompetencesBean.moreToLoad}" styleClass="loadMore"
					actionListener="#{searchCompetencesBean.loadMoreCompetences}"
					update=":compSearchForm">
					<h:outputText value="SHOW MORE" />
				</p:commandLink>
				<script type="text/javascript">
				$(function() {
					
					roundImages();
					
					$('form.filteredSearch .loadMore').on('click', function() {
						$(this).html('<img src="#{request.contextPath}/resources/images/style/ajax-loader-black.gif" id="loginloader" style="margin-top: 9px;"/>');
						return false;
					});
					
					var input = $('form.filteredSearch .inputContainer .searchInput');
					input[0].selectionStart = input[0].selectionEnd = input.val().length;
					
					$('.search .resultContainer').fadeIn();
					$('#searchCompetences .box .message').readmore({ maxHeight: 60,	});
				});
				</script>
			</h:panelGroup>
		</h:form>
	</div>
</ui:composition>