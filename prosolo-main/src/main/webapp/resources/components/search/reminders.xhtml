<ui:composition
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util">
	
	<script>
		document.title = 'Search: Reminders';
	</script>
	
	<utilcomp:messagesBundle var="msg" />
	<ui:include src="/resources/components/dialogs/reminderDialog.xhtml" />

	<div id="searchReminders">
		<h2>Search: Reminders</h2>
		
		<h:form id="remindersForm" class="filteredSearch">
			<h:inputHidden value="#{searchRemindersBean.chosenFilterString}" id="hiddenFilter" />
			<div>
				<p:commandLink styleClass="button blue size25 right search" value="Search"
					onclick="addLoaderToSearchContainer(); updateUrlQuery();"
					actionListener="#{searchRemindersBean.searchAllReminders()}"
					update=":remindersForm:resultContainer :remindersForm:filter"/>
				
				<div class="inputContainer">
					<div class="mGlass"></div>
  						<input type="text" size="20" class="searchInput"
				  		onclick="$(this).select();" 
				  		onkeydown="searchListener();" />
				  	<h:inputHidden class="searchInputHidden"
				  		value="#{searchRemindersBean.query}" 
				  	/>
				</div>
				
				<h:panelGroup layout="block" id="filter" class="filter">
					<ul class="aHolder">
						<li>
							<a class="reminderFilterDrop button gray size16">#{searchRemindersBean.chosenFilterString}<span></span></a>
							<div class="dropdown hidden">
								<ul>
									<li class="#{searchRemindersBean.chosenFilter == null ? 'selected' : ''}">
										<a class="cursorPointer" onclick="setFilter('all', true); $('#searchReminders .search').trigger('click');">#{searchRemindersBean.getFilterName('ALL')}</a>
									</li>
									<li class="#{searchRemindersBean.chosenFilter == 'ACTIVE' ? 'selected' : ''}">
										<a class="cursorPointer" onclick="setFilter('active', true); $('#searchReminders .search').trigger('click');">#{searchRemindersBean.getFilterName('ACTIVE')}</a>
									</li>
									<li class="#{searchRemindersBean.chosenFilter == 'CRITICAL' ? 'selected' : ''}">
										<a class="cursorPointer" onclick="setFilter('critical', true); $('#searchReminders .search').trigger('click');">#{searchRemindersBean.getFilterName('CRITICAL')}</a>
									</li>
									<li class="#{searchRemindersBean.chosenFilter == 'COMPLETED' ? 'selected' : ''}">
										<a class="cursorPointer" onclick="setFilter('completed', true); $('#searchReminders .search').trigger('click');">#{searchRemindersBean.getFilterName('COMPLETED')}</a>
									</li>
								</ul>
							</div>
						</li>
					</ul>
					<script type="text/javascript">
						enableDropdown('#searchReminders .reminderFilterDrop');
					</script>
				</h:panelGroup>
			</div>

			<div class="separator clear"></div>
		
			<h:panelGroup layout="block" id="resultContainer" class="resultContainer" style="display: none;">
				<p:growl id="remindersGrowl" showDetail="true" />
				
				<ui:repeat value="#{searchRemindersBean.reminders}" var="reminderData" id="searchRemindersListId">
					<div class="box">
						<div class="textWrapper">
							<div class="message">
								#{reminderData.resourceType}
								
								<p:commandLink id="reminderCommandLinkId"
									styleClass="bold"
									onclick="$('#remainderDetailsFormModalDialog').dialog('open');"
									action="#{reminderBeanDialog.setReminder(reminderData, 'search.reminders')}"
									update=":reminderDetailsFormDialog:remainderDetailsForm"	>
									#{reminderData.title}
								</p:commandLink>
								
								<div class="clear"></div>
									
								<span class="bold">due to: </span>
								<h:outputFormat value="#{reminderData.deadline}">
									<f:convertDateTime pattern="dd.MM.yyyy" />
								</h:outputFormat>
							</div>
						</div>
					
						<div class="date">
							<span class="circle #{reminderData.status.name().toLowerCase()}"></span>
							<h:outputText class="status" value="#{reminderData.status}"/> 
						</div>
					
						<div class="clear"></div>
						
						<div class="links">
							<p:commandLink id="dismissReminderButtonIndex" value="Dismiss"
								styleClass="button gray size20 left"
								action="#{reminderBeanDialog.dismissReminder(reminderData)}" 
								update=":remindersForm:resultContainer" 
							/>
							
							<ui:remove>
							<p:commandLink styleClass="button gray size20 left" value="Edit"/>
							</ui:remove>
						</div>
					</div>
			
	            	<div class="separator clear"></div>
				</ui:repeat>
				
				<p:commandLink id="loadMore" rendered="#{searchRemindersBean.moreToLoad}" styleClass="loadMore"
					actionListener="#{searchRemindersBean.loadMoreGoals}"
					update=":remindersForm">
					<h:outputText value="SHOW MORE" />
				</p:commandLink>
			
				<script>
					$('.search .resultContainer').fadeIn();
				</script>
			</h:panelGroup>
		</h:form>
		
		<script type="text/javascript">
			$(function(){
				var filter = "#{param['filter']}";
				if (filter.length > 0) {
					$(escapeColons('#searchReminders:hiddenFilter')).val("#{param['filter']}");
					setFilter("#{param['filter']}");
				}
			});
		
			function setFilter(filter, updateQuery) {
				$(escapeColons('#remindersForm:hiddenFilter')).val(filter);
				
				if (updateQuery) {
					setQueryParam('filter', $(escapeColons('#remindersForm:hiddenFilter')).val());
				}
			}
		</script>
	</div>
</ui:composition>