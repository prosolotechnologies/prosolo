<ui:composition
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:action="http://java.sun.com/jsf/composite/components/actions">
	<h:form id="friendsFeedForm" class="feed">
 
		<h:link class="button gray size20 marginBottom10" value="Back to Archive">
			<f:param name="tab" value="#{digestBean.selectedMenu}" />
		</h:link>
		<div class="content2 wide">
			<h2 class="left	marginTop10">Digest for #{personalFeedsBean.feedData.date} based on your friends RSS feeds</h2>
			<div class="clear"></div>
			
			<h:panelGroup rendered="#{empty friendsFeedsBean.friendsFeedsMessages}">
				Your friends did not generated any RSS feeds yet.
			</h:panelGroup>
			
			<ui:repeat id="friendsFeedsList"
				value="#{friendsFeedsBean.friendsFeedsMessages}" var="feed"
				varStatus="iterator">
				<h:panelGroup layout="block" class="feedContent box"  rendered="true">

					<h:panelGroup layout="block" styleClass="imgInfoContainer100" rendered="#{feed.image.length() gt 0}">
						<div class="atcImages">
							<h:outputLink target="_blank" value="#{feed.image}">
								<h:graphicImage value="#{feed.image}" alt="#{feed.image}"  
									styleClass="imgInfoContainer100" />
							</h:outputLink>
						</div>
					</h:panelGroup>

					<h:panelGroup layout="block" id="atcInfo" styleClass="textWrapper">
						<h:outputLink styleClass="atcTitle" target="_blank" id="title"
							value="#{feed.link}">
							<h:outputText value="#{feed.title}" />
						</h:outputLink>

						<h:outputLink styleClass="atcUrl" target="_blank" id="link"
							value="#{feed.link}">
							<h:outputText value="#{feed.link}" />
						</h:outputLink>


						<p class="atcDesc">
							<h:outputText value="#{feed.description}" />
						</p>
						
						<span class="date"> #{feedData.date} </span>
						<div class="clear"></div>
						
						<action:post styleClass="marginRight10 left"
							text="#{feedData.feedMessage.title}"
							link="#{feedData.feedMessage.link}"
							context="personalFeed.#{feedData.id}" />
							
						<action:addToGoal styleClass="marginRight10 left"
							linkTitle="#{feedData.feedMessage.title}"
							link="#{feedData.feedMessage.link}"
							context="personalFeed.#{feedData.id}" />

						<action:addToCompetence styleClass="marginRight10 left"
							linkTitle="#{feedData.feedMessage.title}"
							link="#{feedData.feedMessage.link}"
							context="personalFeed.#{feedData.id}" />
						
						<div class="clear separator"></div>
					</h:panelGroup>
				</h:panelGroup>
			</ui:repeat>
			<p:commandLink id="loadMore" rendered="#{friendsFeedsBean.moreToLoad}" styleClass="loadMore"
			onclick="addLoader(this);"
			actionListener="#{friendsFeedsBean.loadMoreFeedMessages}"
			update=":friendsFeedForm">
			<h:outputText value="SHOW MORE" />
		</p:commandLink>
		
		<script>
		function addLoader(elem){
			$(elem).html('<img src="#{request.contextPath}/resources/images/style/ajax-loader-black.gif" id="loginloader" style="margin-top: 9px;"/>');
		}
		$('.feed .textWrapper .atcDesc').shortenedText({showChar: 300});
		</script>
	</div>
	</h:form>
</ui:composition>