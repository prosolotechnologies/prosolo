<ui:composition
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:p="http://primefaces.org/ui">
	
	<h2 class="left">Digest: Course Tweets Archive</h2>
	
 <!-- h:form id="personalFeedsCalendarForm"-->
 	<ui:remove>
		<div>
			<h:commandLink styleClass="button size30 gray right viewButton listViewButton" value="List View" />
			<h:commandLink styleClass="button size30 green right viewButton calendarViewButton" value="Calendar View" />
		</div>
	</ui:remove>
 
	<div class="clear"></div>

	<div class="view calendarView">
		<p:schedule value="#{feedArchiveBean.feedsScheduleData}" rightHeaderTemplate="">			
 			<p:ajax event="eventSelect" listener="#{feedArchiveBean.onFeedSelect}" />		
	 	</p:schedule>
	</div>
	<!-- /h:form-->
	
<div class="view listView hidden">
	<h:form id="listFeedForm">
		<ui:repeat id="personalFeedsList" value="#{feedArchiveBean.feedsData}" var="feedData" varStatus="iterator">
		<c:if test="#{loggeduser != null and loggeduser.loggedIn and !feedData.privateAndSystemFeedsEmpty}">
				<div class="feedContent box">
					<div class="textWrapper">
						<h:link class="atcTitle" value="#{feedData.title}">
							<f:param name="tab" value="#{digestBean.selectedMenu}" />
							<f:param name="id" value="#{feedData.id}" />
						</h:link>
					</div>
					<span class="date">
						#{feedData.date}
					</span>
				</div>
			<div class="separator"></div>
		</c:if>
		<c:if test="#{!loggeduser.loggedIn and !feedData.systemFeedsEmpty}">
				<div class="feedContent box">
					<div class="textWrapper">
						<h:link class="atcTitle" value="#{feedData.title}">
							<f:param name="tab" value="#{digestBean.selectedMenu}" />
							<f:param name="id" value="#{feedData.id}" />
						</h:link>
					</div>
					<span class="date">
						#{feedData.date}
					</span>
				</div>
			<div class="separator"></div>
		</c:if>
		</ui:repeat>
			
			<p:commandLink id="loadMore"
				value="SHOW MORE"
				rendered="#{feedArchiveBean.moreToLoad}" styleClass="loadMore"
				onclick="addLoader(this);"
				actionListener="#{feedArchiveBean.loadMoreFeeds}"
				update=":listFeedForm" />
			
			<p:commandLink styleClass="initialize"
				actionListener="#{feedArchiveBean.loadFeeds()}"
				update=":listFeedForm" />
				
			<script>
			function addLoader(elem){
				$(elem).html('<img src="#{request.contextPath}/resources/images/style/ajax-loader-black.gif" id="loginloader" style="margin-top: 9px;"/>');
			}
			</script>
		</h:form>
	</div>
	
	<script>
		var listLoaded = false;
		
		$(function(){
			$('.viewButton').on('click', function() {
				if ($(this).hasClass('gray')) {
					$('.viewButton').toggleClass('gray').toggleClass('green');
					$('.view').toggleClass('hidden');
					
					if ($(this).hasClass('listViewButton')) {
						if (!listLoaded) {
							$('.listView .initialize').trigger('click');
							listLoaded = true;
						}
					}
				}
			});
		});
	</script>

</ui:composition>