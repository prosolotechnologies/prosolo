<ui:component
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:p="http://primefaces.org/ui"
	xmlns:comp="http://java.sun.com/jsf/composite/components"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util"
	xmlns:util="http://www.prosolo.com/util"
	xmlns:courses="http://java.sun.com/jsf/composite/components/courses">

	<composite:interface>
		<composite:attribute name="role" type="java.lang.String" default="USER"/>
		<composite:attribute name="toUpdate" default=""></composite:attribute>
		<composite:attribute name="learningContext" default=""/>
		<composite:attribute name="service" default="" />
	</composite:interface>
	
	<composite:implementation>
		<link rel="stylesheet" type="text/css" media="all" href="#{request.contextPath}/resources/css2/bootstrap-tagsinput.css" />
		<script src="https://use.typekit.net/zvv0dgl.js"></script>
    	<script>try{Typekit.load({ async: true });}catch(e){}</script>
    	<script src="#{request.contextPath}/resources/javascript2/bootstrap-tagsinput.min.js"></script>
    	<script src="#{request.contextPath}/resources/javascript2/search.js"></script>
    	<script src="#{request.contextPath}/resources/javascript2/createCredential.js"></script>
	   <div class="whiteBar">
	
	   </div>
	   	<div id="#{cc.clientId}">
	   	<script>
			containerId = '#{cc.clientId}';
		</script>
		<h:form id="formMain">
			<p:growl id="growlMain" showDetail="true" globalOnly="true"></p:growl>
			
			<div class="container">
				<div class="row">
					<h:inputHidden id="hiddenType" value="#{credentialEditBean.credentialData.typeString}" />
					<div class="col-md-8">
						<div class="whiteBox">
							<ul class="nav nav-tabs pageSubmenu" role="tablist">
								<li role="presentation" class="active"><a href="#info" aria-controls="info" role="tab" data-toggle="tab">Credential Info</a></li>
								<li role="presentation"><a href="#competences" aria-controls="competences" role="tab" data-toggle="tab">Competences</a></li>
							</ul>
						</div>
						
						<div class="tab-content">
							<div role="tabpanel" class="tab-pane fade in active" id="info">
								<div class="whiteBox">
									<h2>Credential Info</h2>
									
									<div class="formWrapper">
										<div class="formLine">
											<label>Title</label>
											<div class="formLineRight">
												<h:inputText 
													styleClass="pasteable"
													id="inputTitle" 
													value="#{credentialEditBean.credentialData.title}" 
													onkeyup="updateStatusToDraft();"/>
										</div>
										</div>
										
										<div class="formLine">
											<label>About credential</label>
											<div class="formLineRight">                           
												<h:inputTextarea 
													styleClass="pasteable"
													id="inputDescription" 
													value="#{credentialEditBean.credentialData.description}"
													onkeyup="updateStatusToDraft();"></h:inputTextarea>
											</div>
										</div>
										
										<div class="formLine">
											<label>Keywords</label>
											
											<div class="formLineRight">
												<h:inputText id="inputKeywords" styleClass="tagsInputCredTag"
													value="#{credentialEditBean.credentialData.tagsString}"
													pt:placeholder="Type and press 'Enter'"
													pt:data-role="tagsinput" />
											</div>
										</div>
										
										<script>$('.tagsInputCredTag').tagsinput();</script>
										
										<div class="formLine">
											<label>Twitter hashtags</label>
											
											<div class="formLineRight">
												<h:inputText id="inputHashtags" styleClass="tagsInputCredHahstag"
												value="#{credentialEditBean.credentialData.hashtagsString}"
												pt:placeholder="Type and press 'Enter'"
												pt:data-role="tagsinput" />
											</div>
										</div>
										<script>$('.tagsInputCredHahstag').tagsinput();</script>
									</div>
								</div>
							</div>
				            
							<div role="tabpanel" class="tab-pane fade mandatoryFlow" id="competences">
								<courses:compList 
									id="compList"
									bean="#{credentialEditBean}"
									competences="#{credentialEditBean.credentialData.competences}"
									isEdit="true"
									startedLearning="false"
									toUpdate=":#{cc.clientId}:formMain:credSidebar"
									role="#{cc.attrs.role}"/>
			
								<div class="mandatoryArrow"></div>
			                        
								<div class="newCompetenceBox">
									<div class="elementsWrapper">
										<p:commandLink
											styleClass="btn btn-green"
											value="Create New Competence"
											action="#{credentialEditBean.saveAndNavigateToCreateCompetence}" />
											
										<span>or</span>
		
										<div class="elementsRight">
											<p:remoteCommand name="execSearchComps" process="inputCompName"
												update=":#{cc.clientId}:formMain:panelCompSearchResults"
												action="#{credentialEditBean.searchCompetences()}" />
											
											<h:inputText id="inputCompName"
												styleClass="competenceSearchField"
												value="#{credentialEditBean.compSearchTerm}"
												placeholder="Add existing one" 
												onclick="$(this).select();"
												onkeyup="showSearchResults('.searchResultsDrop', '.competenceSearchField');searchIfNeeded('.competenceSearchField', execSearchComps);return false;">
											</h:inputText>
											
											<h:panelGroup id="panelCompSearchResults">
												<ul class="dropdown-menu searchResultsDrop" style="display:block;">
													<ui:repeat var="comp" value="#{credentialEditBean.compSearchResults}">
														<li>
															<p:commandLink
																process="@this"
																action="#{credentialEditBean.addComp(comp)}"
																update=":#{cc.clientId}:formMain:compList :#{cc.clientId}:formMain:panelCompSearchResults :#{cc.clientId}:formMain:credSidebar"
																oncomplete="$('.competenceSearchField').val(''); $('.searchResultsDrop').first().stop(true, true).slideUp(10);">
																<h3>#{comp.title}</h3>
															</p:commandLink>
														</li>
													</ui:repeat>
												</ul>
											</h:panelGroup>
		
											<a href="#">Recommended Competences</a>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					
		            <div class="col-md-4">
		            	<div class="alert alert-warning" role="alert">
		            		Note that all changes to the the <strong>'Credential Info'</strong> tab will affect all students currently learning for this credential.<br></br>Changes made on the <strong>'Competences'</strong> tab will affect only future students.
		            	</div>
		            	<courses:rightSideBar
		            		id="credSidebar"
		            		chooseOptionText="Mandatory flow"
		            		chooseOptionValue="#{credentialEditBean.credentialData.mandatoryFlow}"
		            		publishValues="#{credentialEditBean.courseStatusArray}" 
		            		publishValue="#{credentialEditBean.credentialData.status}"
		            		saveAction="#{credentialEditBean.save}"
		            		toUpdate=":#{cc.clientId}:formMain #{cc.attrs.toUpdate}" 
		            		previewAction="#{credentialEditBean.preview}"
		            		linkPreviewClass="hiddenLinkPreview"/>
		            		
		            	<h:link
							style="display: none;"
							styleClass="hiddenLinkPreview"
							target="_blank"
							outcome="credential">
							<f:param name="id" value="#{credentialEditBean.id}"></f:param>
							<f:param name="mode" value="preview"></f:param>
						</h:link>
		            		
		            </div>
		            
		            <script>  
		            	var type = null;
		            	if('#{cc.attrs.role}' === "USER") {
		            		type = "user_created";
		            	} else {
		            		type = "university_created";
		            	}
						document.getElementById('#{cc.clientId}:formMain:hiddenType').value = type;
		            </script>
		        </div>
		    </div>
		   </h:form>
		   
		   <h:form id="formRemoveComp">
		   	<div class="modal fade" id="modalRemoveComp" tabindex="-1" role="dialog" aria-labelledby="removeCompetence">
		           <div class="modal-dialog" role="document">
		               <div class="modal-content">
		                   <div class="modal-header">
		                       <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&#215;</span></button>
		                       <h2 class="modal-title" id="removeCompetence1">Remove Competence?</h2>
		                   </div>
		                   <div class="modal-body">
		                       <p>Are you sure you want to remove this competence from credential?<br></br><br></br>
		                       <small>Note: Competence will not be deleted entirely. In order to do that, go to competence Edit > Delete.</small></p>
		                   </div>
		                   <div class="modal-footer">
		                   	<p:commandLink
		                   		value="Remove"
		                   		styleClass="btn btn-red"
		                   		process="@this"
		                   		action="#{credentialEditBean.removeComp()}"
		                   		update=":#{cc.clientId}:formMain:compList :#{cc.clientId}:formMain:credSidebar"
		                   		oncomplete="$('#modalRemoveComp').modal('hide');">
		                   	</p:commandLink>
		                       <a href="#" class="btn btn-default" data-dismiss="modal">Cancel</a>
		                   </div>
		               </div>
		           </div>
		       </div>
		   </h:form>
		   
		   <courses:deleteModalDialog      
			   	deleteActionMethodName="delete"  	
				deleteAction="#{credentialEditBean.delete}"
				toUpdate=":#{cc.clientId}:formMain #{cc.attrs.toUpdate}" 
				modalDeleteTitle="Credential"
				modalDeleteText="credential"/>
	   </div>
	</composite:implementation>
</ui:component>