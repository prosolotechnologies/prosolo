<ui:component
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:comp="http://java.sun.com/jsf/composite/components"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util"
	xmlns:link="http://java.sun.com/jsf/composite/components/resourceLinks"
	xmlns:post="http://java.sun.com/jsf/composite/components/post"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:c="http://java.sun.com/jsp/jstl/core">

	<composite:interface>
		<composite:attribute name="publishValues" required="true" />
		<composite:attribute name="publishValue" required="true" />
		<composite:attribute name="saveAction" required="true" method-signature="void save()"/>
		<composite:attribute name="toUpdate" required="true" />
		<composite:attribute name="previewAction" required="true" method-signature="void preview()"/>
		<composite:attribute name="linkPreviewClass" required="true" />
	</composite:interface>
	
	<composite:implementation>
		<div id="#{cc.clientId}" class="whiteBox publishBox">
			<h2>Publish</h2>
			
			<p:commandLink id="linkPreview"
				value="Preview #{cc.attrs.publishValue eq 'DRAFT' ? 'Draft' : ''}"
				styleClass="linkPreview"
				action="#{cc.attrs.previewAction}"
				update="#{cc.attrs.toUpdate}"
				oncomplete="if(args &amp;&amp; !args.validationFailed) {attachListenersForUpdatingStatus(); document.getElementsByClassName('#{cc.attrs.linkPreviewClass}')[0].click();}">
				<f:param name="page" value="#{facesContext.viewRoot.viewId}"></f:param>
				<f:param name="learningContext" value="name:preview"></f:param>
			</p:commandLink>
			
			<div class="clear"></div>
			
			<h:selectOneMenu 
				id="selectStatus" styleClass="selectpicker" 
				value="#{cc.attrs.publishValue}"
				onchange="onStatusChange();">
				<f:selectItems value="#{cc.attrs.publishValues}" var="status"
					itemValue="#{status}" itemLabel="#{status.label}" />
			</h:selectOneMenu>
			
			<script>$('.selectpicker').selectpicker('refresh');</script>
			
			<div class="publishRow">
				<p:commandLink 
					styleClass="btn btn-green" 
					action="#{cc.attrs.saveAction}"
					update="#{cc.attrs.toUpdate}"
					oncomplete="attachListenersForUpdatingStatus();">
					<f:param name="page" value="#{facesContext.viewRoot.viewId}"></f:param>
					Save changes
				</p:commandLink>
				<a href="#" class="linkRed" data-toggle="modal" data-target="#deleteModal">Delete</a>      
			</div>
		</div>
	</composite:implementation>
</ui:component>