<ui:component
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:comp="http://java.sun.com/jsf/composite/components"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util"
	xmlns:link="http://java.sun.com/jsf/composite/components/resourceLinks"
	xmlns:post="http://java.sun.com/jsf/composite/components/post"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:c="http://java.sun.com/jsp/jstl/core">

	<composite:interface>
		<composite:attribute name="publishValues" required="true" />
		<composite:attribute name="publishValue" required="true" />
		<composite:attribute name="scheduledDateValue" />
		<composite:attribute name="scheduledDatePrettyString" default=""/>
		<composite:attribute name="saveAction" required="true" method-signature="void save()"/>
		<composite:attribute name="cancelScheduledUpdateModal" default=""/>
		<composite:attribute name="toUpdate" required="true" />
		<composite:attribute name="resource" required="true" /> <!-- Should be either CREDENTIAL or COMPETENCE -->
		<composite:attribute name="role" required="true" />
		<composite:attribute name="resourceLowerCase" required="true" />
		<composite:attribute name="childResourcePlural" required="true" />
		<composite:attribute name="onclickSave" />
		<composite:attribute name="statusChangeDisabled" default="false"/>
		<composite:attribute name="duplicateModal" required="true"/>
		<composite:attribute name="archiveModal" required="true"/>
		<composite:attribute name="restoreModal" required="true"/>
		<composite:attribute name="archived" required="true"/>
		<composite:attribute name="resourceId" required="true"/>

	</composite:interface>
	
	<composite:implementation>
		<script src="#{request.contextPath}/resources/javascript2/rightSideBar.js"></script>
		<div id="#{cc.clientId}" class="whiteBox publishBox">
			<h2>Publish</h2>
			
			<h:link outcome="/manage/competence" value="Preview" class="linkPreview">
				<f:param name="compId" value="#{util:encodeId(competenceEditBean.competenceData.competenceId)}"></f:param>
			</h:link>
			<div class="clear"></div>
			
			<label>Status:</label>
			
            <ui:fragment>
				<h:selectOneMenu disabled="#{cc.attrs.statusChangeDisabled}"
					id="selectStatus" styleClass="selectpicker" 
					value="#{cc.attrs.publishValue}"
					onchange="onStatusChange();">
					<f:selectItems value="#{cc.attrs.publishValues}" var="status"
						itemValue="#{status}" itemLabel="#{status.label}" />
				</h:selectOneMenu>
				<script>
					setIsDraft(#{competenceEditBean.draft});
					$('.selectpicker').selectpicker('refresh');
			
					$(function(){
						var activityListSize = $('.activityItem').length - 1;
						
						
						$("#btnSaveChanges").click(function(){
							var status = getStatus();
							if(status == "DRAFT"){
								saveChangesBtnClick(status);
							}else if(activityListSize == 0 &amp;&amp; status == "PUBLISHED"){
								$('#activityNotFoundModal').modal('show');
								return false;
							}else if(activityListSize != 0){
								saveChangesBtnClick(status);
							}
						}); 
		    		})
				</script>
				<br />
			</ui:fragment>
			<div class="publishRow">
				<a href="javascript:void(0);" id="btnSaveChanges" class="btn btn-green" 
					>Saves changes</a>
				<p:commandLink style="display: none;"
					styleClass="saveChangesSelector"
					onclick="#{cc.attrs.onclickSave}"
					action="#{cc.attrs.saveAction}"
					update="#{cc.attrs.toUpdate} :#{cc.clientId}"
					oncomplete="">
					<f:param name="page" value="#{facesContext.viewRoot.viewId}" />
					Save changes
				</p:commandLink>
				#{cc.attrs.activities}
				<ui:fragment rendered="#{cc.attrs.resourceId > 0}">
					<a href="#" data-toggle="modal" data-target="#{cc.attrs.duplicateModal}">Duplicate</a>
				</ui:fragment>
				<a id="linkPublishChildResources" href="#" style="display: none;" data-toggle="modal" data-target="#publishModal"></a> 
				<div class="modal fade" id="publishModal" tabindex="-1" role="dialog" aria-labelledby="publishModal">
			        <div class="modal-dialog" role="document">
			            <div class="modal-content">
			                <div class="modal-header">
			                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&#215;</span></button>
			                    <h2 class="modal-title" id="duplicateCredential">Save changes</h2>
			                </div>
			                <div class="modal-body">
			                	<p>
			                		Are you sure you want to publish this competency? Once published, only small edits can be made on this competency.
									Competency will be available for enrollment to all students with proper privileges. But also, competency structure can be seen by all users.
			                	</p>
			                </div>
			                <div class="modal-footer">
			                    <p:commandLink
									styleClass="btn btn-green"
									onclick="#{cc.attrs.onclickSave}"
									action="#{cc.attrs.saveAction}"
									update="#{cc.attrs.toUpdate}"
									oncomplete="hideModal('publishModal');">
									<f:param name="page" value="#{facesContext.viewRoot.viewId}"></f:param>
									<f:param name="service" value="name:publish_resource_dialog"></f:param>
									Publish
								</p:commandLink>
			                    <a href="#" class="btn btn-default" data-dismiss="modal">Cancel</a>
			                </div>
			            </div>
			        </div>
	    		</div>
	    		
	    		<a id="linkActivityNotFound" href="#" style="display: none;" data-toggle="modal" data-target="#activityNotFoundModal"></a>
				<div class="modal fade" id="activityNotFoundModal" tabindex="-1" role="dialog" aria-labelledby="activityNotFoundModal">
			        <div class="modal-dialog" role="document">
			            <div class="modal-content">
			                <div class="modal-header">
			                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&#215;</span></button>
			                    <h2 class="modal-title" id="duplicateCredential">Competency can not be published</h2>
			                </div>
			                <div class="modal-body">
			                	<p>
			                		You can not publish a competency without activities. Please add activities to your competency.
			                	</p>
			                </div>
			                <div class="modal-footer">
			                    <a href="#" class="btn btn-default" data-dismiss="modal">Close</a>
			                </div>
			            </div>
			        </div>
	    		</div>
	    	
	    		<ui:fragment rendered="#{cc.attrs.resourceId > 0 and not cc.attrs.archived}">
					<a href="#" class="linkRed" data-toggle="modal" data-target="#{cc.attrs.archiveModal}">Archive</a> 
				</ui:fragment> 
				<ui:fragment rendered="#{cc.attrs.resourceId > 0 and cc.attrs.archived}">
					<a href="#" data-toggle="modal" data-target="#{cc.attrs.restoreModal}">Restore</a> 
				</ui:fragment>    
			</div>
		</div>
		
	</composite:implementation>
</ui:component>