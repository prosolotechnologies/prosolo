<ui:component xmlns:h="http://java.sun.com/jsf/html"
			  xmlns:f="http://java.sun.com/jsf/core"
			  xmlns:ui="http://java.sun.com/jsf/facelets"
			  xmlns:composite="http://java.sun.com/jsf/composite"
			  xmlns:p="http://primefaces.org/ui"
			  xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
			  xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util"
			  xmlns:util="http://www.prosolo.com/util"
			  xmlns:courses="http://java.sun.com/jsf/composite/components/courses">

	<composite:interface>
		<composite:attribute name="bean" required="true" />
		<composite:attribute name="role" type="java.lang.String"
			default="USER" />
		<composite:attribute name="learningContext" default="" />
		<composite:attribute name="service" default="" />
	</composite:interface>

	<composite:implementation>
		<utilcomp:messagesBundle var="msg" />
		<script src="#{request.contextPath}/resources/javascript2/search.js"></script>
		<script src="https://use.typekit.net/zvv0dgl.js"></script>
		<script>
			try {
				Typekit.load({
					async : true
				});
			} catch (e) {
			}
		</script>
		<script>
			function markAnnouncementReadWithId(announcementId) {
				markAnnouncementRead([ {
					name : 'announcementId',
					value : announcementId
				} ])
			}
		</script>

		<ui:param name="baseContext"
			value="name:credential|id:#{cc.attrs.bean.decodedId}"></ui:param>
		<ui:param name="canEdit"
			value="#{cc.attrs.role == 'MANAGER' and request.isUserInRole('MANAGE.CONTENT.EDIT') and cc.attrs.bean.access.canEdit}"></ui:param>
		<ui:param name="startedLearning"
			value="#{cc.attrs.bean.credentialData.enrolled}"></ui:param>

		<div id="#{cc.clientId}">
			<h:form id="formMain">
				<p:growl id="growlMain" globalOnly="true" showDetail="true" />

				<div class="whiteBar">
					<div class="container">
						<div class="whiteBarContent">
							<div class="whiteBarLeft">
								<p:commandLink
									rendered="#{cc.attrs.bean.credentialData.deliveryStatus eq 'ACTIVE' and cc.attrs.role == 'USER' and !startedLearning and cc.attrs.bean.access.canAccess}"
									styleClass="btn btn-green btn-sm"
									action="#{cc.attrs.bean.enrollInCredential()}"
									update=":#{cc.clientId}:formMain">
			                     	Start
			                     	<f:param name="context" value="#{baseContext}" />
								</p:commandLink>

								<ui:fragment
									rendered="#{startedLearning and cc.attrs.bean.credentialData.progress lt 100}">
									<h:link outcome="/competence" styleClass="btn btn-green btn-sm">
				                     	Resume
										<f:param name="compId"
											value="#{util:encodeId(cc.attrs.bean.credentialData.nextCompetenceToLearnId)}" />
										<f:param name="credId" value="#{param['id']}" />
									</h:link>

									<h:panelGroup layout="block" styleClass="progressBar item">
										<span>#{cc.attrs.bean.credentialData.progress}%</span>
										<div class="progress">
											<div class="progress-bar" role="progressbar"
												aria-valuenow="#{cc.attrs.bean.credentialData.progress}"
												aria-valuemin="0" aria-valuemax="100"
												style="width: #{cc.attrs.bean.credentialData.progress}%">
											</div>
										</div>
									</h:panelGroup>
								</ui:fragment>

								<ui:fragment
									rendered="#{cc.attrs.bean.credentialData.progress == 100}">
									<div class="tagCompleted item">Completed</div>
								</ui:fragment>

								<ui:fragment
									rendered="#{(startedLearning and cc.attrs.bean.credentialData.progress lt 100) or (cc.attrs.bean.credentialData.progress == 100)}">
									<ui:remove>
										<!-- We will reintroduce this functionality later -->
										<ui:fragment
											rendered="#{cc.attrs.bean.userHasAssessmentForCredential()}">
											<h:link outcome="/credential-assessment"
												class="btn btn-green-stroke btn-sm">
												View Assessments
				                    			<f:param name="assessmentId"
													value="#{cc.attrs.bean.getAssessmentIdForUser()}" />
												<f:param name="id" value="#{param['id']}" />
											</h:link>
										</ui:fragment>
									</ui:remove>

									<ui:remove>
										<h:link outcome="/credential-assessment"
											class="btn btn-green-stroke btn-sm item">
											View Assessment
			                    			<f:param name="assessmentId"
												value="#{cc.attrs.bean.getAssessmentIdForUser()}" />
											<f:param name="id" value="#{param['id']}" />
										</h:link>
									</ui:remove>

									<h:link outcome="/assessments"
										class="btn btn-green-stroke btn-sm item">
										View Assessments
									</h:link>

									<a href="#" class="btn btn-green btn-sm item"
										data-toggle="modal" data-target="#askAssessment"> Ask for
										Assessment </a>
									
									<courses:askForAssessmentModal id='askForAssessmentModal'
										bean="#{cc.attrs.bean}" role="#{cc.attrs.role}" toUpdate=":#{cc.clientId}:formMain"/>

								</ui:fragment>
							</div>

							<div class="whiteBarRight">
								<h:panelGroup
									rendered="#{cc.attrs.bean.credentialData.mandatoryFlow}"
									styleClass="mandatoryTag item">Mandatory flow</h:panelGroup>
								<div class="duration item">#{cc.attrs.bean.credentialData.durationString}</div>
								<h:link rendered="#{canEdit}"
									outcome="create-credential"
									styleClass="btn btn-green-stroke btn-sm item">
			                    	Edit #{util:capitalizeWord(msg['label.credential'])}
			                    	<f:param name="id" value="#{param['id']}"></f:param>
								</h:link>
							</div>
						</div>
					</div>
				</div>

				<div class="container">
					<ol class="breadcrumb">
						<li>
							<h:link value="#{util:capitalizeWord(msg['label.credential.plural'])}" outcome="credentialLibrary"/>
						</li>
						<li class="active">#{cc.attrs.bean.credentialData.title}</li>
					</ol>
				</div>

				<div class="container">
					<div class="row">
						<div
							class="col-md-8 #{cc.attrs.bean.credentialData.mandatoryFlow ? 'mandatoryFlow' : ''}">
							<h:panelGroup
								rendered="#{startedLearning and announcementStudentBean.userDidNotReadLastAnnouncement(cc.attrs.bean.id)}"
								layout="block" styleClass="alert alert-info alert-dismissible"
								pt:role="alert">
								<p:remoteCommand name="markAnnouncementRead" update="@none"
									process="@this"
									actionListener="#{announcementStudentBean.markAnnouncementReadFromAjax()}"></p:remoteCommand>
								<button
									onclick="markAnnouncementReadWithId('#{announcementStudentBean.announcementId}')"
									type="button" class="close" data-dismiss="alert"
									aria-label="Close">
									<span aria-hidden="true">Ã—</span>
								</button>
                    			There's a new announcements for this #{msg['label.credential']}.
                    			<h:link outcome="announcement">
                    				Read here
                    				<f:param name="id" value="#{param['id']}"></f:param>
									<f:param name="announcementId"
										value="#{announcementStudentBean.announcementId}"></f:param>
								</h:link>.
                			</h:panelGroup>
							<h2>About #{util:capitalizeWord(msg['label.credential'])}</h2>
							<p>
								<h:outputText escape="false"
									value="#{cc.attrs.bean.credentialData.description}" />
							</p>
							<courses:compList bean="#{cc.attrs.bean}"
								competences="#{cc.attrs.bean.credentialData.competences}"
								credentialId="#{param['id']}" isEdit="false"
								startedLearning="#{startedLearning}"
								readOnly="#{!cc.attrs.bean.access.canAccess and cc.attrs.bean.access.canRead}" 
								learningContext="#{util:addSubContext(cc.attrs.learningContext, baseContext)}"
								growlToUpdate=":#{cc.clientId}:formMain:growlMain"
								role="#{cc.attrs.role}"/>
						</div>

						<div class="col-md-4">
							<h:panelGroup layout="block" styleClass="sidebarBlock"
								rendered="#{cc.attrs.role eq 'USER' and startedLearning}">
			                    There 
			                    
								#{cc.attrs.bean.numberOfUsersLearningCred == 1 ? 'is' : 'are'} 
			                    <h:link outcome="/credential-students">
									<f:param name="id" value="#{param['id']}" />
			                    	#{cc.attrs.bean.numberOfUsersLearningCred} student#{cc.attrs.bean.numberOfUsersLearningCred == 1 ? '' : 's'}
			                    </h:link> 
			                    who #{cc.attrs.bean.numberOfUsersLearningCred == 1 ? 'is' : 'are'} learning this #{msg['label.credential']}.
			                </h:panelGroup>
							<ui:fragment rendered="#{not empty cc.attrs.bean.credentialData.tags}">
								<div class="sidebarBlock #{cc.attrs.role eq 'USER' ? 'sidebarBlockKeywords' : ''}">
										<h2>Keywords</h2>
										<ul class="tags">
											<ui:repeat var="tag"
												value="#{cc.attrs.bean.credentialData.tags}">
												<li>#{tag.title}</li>
											</ui:repeat>
										</ul>
									<ui:fragment
										rendered="#{cc.attrs.role eq 'USER' and startedLearning and cc.attrs.bean.numberOfTags gt 0}">
										<p class="keywordsExplore">
											There #{cc.attrs.bean.numberOfTags gt 1 ? 'are' : 'is'} #{cc.attrs.bean.numberOfTags} keyword#{cc.attrs.bean.numberOfTags gt 1 ? 's' : ''} more that
											describe #{msg['label.competence']} and activities of this #{msg['label.credential']}.
											<h:link value="Click here to filter them."
												outcome="credential-keywords">
												<f:param name="id" value="#{cc.attrs.bean.id}" />
											</h:link>
										</p>
									</ui:fragment>
								</div>
							</ui:fragment>

							<ui:fragment
								rendered="#{not empty cc.attrs.bean.credentialData.hashtags}">
								<div class="sidebarBlock">
									<h2>Twitter hashtags</h2>
									<ul class="tags">
										<ui:repeat var="hashtag"
											value="#{cc.attrs.bean.credentialData.hashtags}">
											<li>#{hashtag.title}</li>
										</ui:repeat>
									</ul>
								</div>
							</ui:fragment>

							<ui:fragment
								rendered="#{not empty cc.attrs.bean.credentialData.instructorFullName}">
								<div class="sidebarBlock">
									<h2>Your instructor</h2>
									<div class="user32">
										<a href="#"> <utilcomp:userAvatar
												avatar="#{cc.attrs.bean.credentialData.instructorAvatarUrl}"
												fullName="#{cc.attrs.bean.credentialData.instructorFullName}" />
										</a>
										<h3>
											<a href="#">#{cc.attrs.bean.credentialData.instructorFullName}</a>
										</h3>
									</div>
								</div>
							</ui:fragment>

							<div class="sidebarBlock">
								<h2>Created by</h2>
								<div class="user32">
									<a href="#"> <utilcomp:userAvatar
											avatar="#{cc.attrs.bean.credentialData.creator.avatar}"
											fullName="#{cc.attrs.bean.credentialData.creator.name}" />
									</a>
									<h3>
										<a href="#">#{cc.attrs.bean.credentialData.creator.name}</a>
									</h3>
								</div>
							</div>
						</div>
					</div>
				</div>
			</h:form>
		</div>
	</composite:implementation>
</ui:component>