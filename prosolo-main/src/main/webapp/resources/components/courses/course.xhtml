<ui:component
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:p="http://primefaces.org/ui"
	xmlns:comp="http://java.sun.com/jsf/composite/components"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util"
	xmlns:compcourses="http://java.sun.com/jsf/composite/components/courses"
	xmlns:dlgportfolio="http://java.sun.com/jsf/composite/components/dialogs/portfolio"
	xmlns:dlg="http://java.sun.com/jsf/composite/components/dialogs"
	xmlns:link="http://java.sun.com/jsf/composite/components/resourceLinks"
	xmlns:dlgAnalytics="http://java.sun.com/jsf/composite/components/dialogs/analytics"
	xmlns:dlgcourse="http://java.sun.com/jsf/composite/components/dialogs/course"
	xmlns:icon="http://java.sun.com/jsf/composite/components/resourceLinks/icons"
	xmlns:util="http://www.prosolo.com/util">

	<composite:interface>
		<composite:attribute name="courseBean" required="true"/>
		<composite:attribute name="pageTitle" type="java.lang.String" />
		<composite:attribute name="role" type="java.lang.String" default="USER"/>
		<composite:attribute name="initiallyHidden" default="false"/>
		<composite:attribute name="creatingNew" default="false"/>
		<composite:attribute name="competences" />
		<composite:attribute name="predefinedCompetences" />
		<composite:attribute name="cancelLinkPath" />
		<composite:attribute name="context" />
		<composite:attribute name="learningContext" default=""/>
		<composite:attribute name="service" default="" />
	</composite:interface>
	
	<composite:implementation>
	
		<h:outputStylesheet library="css" name="jquery.switchButton.css"  />

		<h:outputScript library="javascript" name="prosolo.tags.js" target="head"/>
		<h:outputScript library="javascript" name="jquery.switchButton.js" target="head" />
		<h:outputScript library="javascript" name="prosolo.switchButton.js" target="head" />
		<h:outputScript library="javascript" name="prosolo.autosaveForm.js" target="head" />
		<h:outputScript library="javascript" name="jquery.autosize.min.js" target="head" />
		<h:outputScript library="javascript" name="jquery.shortenedText.js" target="head"/>
		
		<utilcomp:messagesBundle var="msg" />
	
	    <h:form id="newCourseForm" style="#{cc.attrs.initiallyHidden ? 'display:none' : ''}">
			<p:remoteCommand name="autosave"
				action="#{manageCourseBean.autosave()}" 
				update=":#{cc.clientId}:newCourseForm:coursesFormGrowl"
				oncomplete="$(window).autosaveForm('removeAutosaveLoader');"
				async="true" />
			
	    	<script>
				$(function(){
					$(window).autosaveForm({
						elemSelector: '.autosaveEnabled',
						autosaveFunction: autosave,
						loaderPath: '#{request.contextPath}/resources/images/style/ajax-loader-black.gif',
   					});
					
					$('.rightSidebar .publishBtn').switchButton({
	    				width: 40,
	    				height: 15,
	    				button_width: 20,
   						on_label: 'Published', 
   						off_label: 'Not published',
   						on_callback: function(elem) {
   							$(window).autosaveForm('addLoaderNextAndAutosave', elem);
   						},
   						off_callback: function(elem) {
   							$(window).autosaveForm('addLoaderNextAndAutosave', elem);
   						}
   					});
				})
			</script>
	    
			<h2 class="left	heading icon">
				<icon:course styleClass="icon" />
				#{cc.attrs.creatingNew ? msg['composite.course.create.title'] : ''}
				<h:outputText rendered="#{not cc.attrs.creatingNew}" value="#{cc.attrs.courseBean.course.title}" />
			</h2>
			
			<c:if test="#{cc.attrs.role == 'USER'}">
			
				<h:panelGroup layout="block" id="enrollmentContainer">
					<h:panelGroup layout="block" 
						rendered="#{!coursePortfolioBean.activeCourses.contains(cc.attrs.courseBean.course) and 
										!coursePortfolioBean.completedCourses.contains(cc.attrs.courseBean.course)}"
						class="rightSidebar">
						
						<h3>#{msg['composite.course.action.enrollInCourse.title']}</h3>
						
						<p>
							#{msg['composite.course.action.enrollInCourse.info1']}
							<h:link value="Learn tab" 
								class="bold"
								onclick="sendLogPageNavigationWithParameters('learn', { context: '#{cc.attrs.context}', 'courseStatus': 'notActive'});" 
								outcome="/learn">
							</h:link>
							#{msg['composite.course.action.enrollInCourse.info2']}
							<h:link value="Learn space" 
								class="bold"
								onclick="sendLogPageNavigationWithParameters('learn', { context: '#{cc.attrs.context}', 'courseStatus': 'notActive'});" 
								outcome="/learn">
							</h:link>.
						</p>
						<p:commandLink value="#{msg['composite.course.action.enrollInCourse.button.enroll']}"
							rendered="#{cc.attrs.courseBean.course.targetGoalId == 0}"
							styleClass="button green size40 left marginBottom10"
							onclick="addWhiteLoaderWithClass(this, '', true, false, '')"
						 	action="#{courseBean.enrollInCourse()}"
						 	update=":#{cc.clientId}:newCourseForm:coursesFormGrowl 
						 		:#{cc.clientId}:newCourseForm:enrollmentContainer 
						 		:#{cc.clientId}:newCourseForm:addedCompetencesContainer 
						 		:#{cc.clientId}:newCourseForm:actions">
						 	<f:param name="context" value="#{cc.attrs.context}" />
						 	<f:param name="page" value="#{facesContext.viewRoot.viewId}" />
						 	<f:param name="learningContext" value="#{cc.attrs.learningContext}" />
						 </p:commandLink>
				 		
				 		<p:commandLink value="#{msg['composite.course.action.enrollInCourse.button.enroll']}"
							rendered="#{cc.attrs.courseBean.course.targetGoalId > 0}"
							styleClass="button green size40 left marginBottom10"
							onclick='$("#activateCourseFormModalDialog").dialog("open");'
							action="#{activateCourseDialog.initialize(cc.attrs.courseBean.course, cc.attrs.context)}"
							update=":#{cc.clientId}:activateCourse:activateCourseForm">
							<f:param name="learningContext" value="#{cc.attrs.learningContext}" />
						</p:commandLink>
				 		
				 		<h:panelGroup layout="block"
				 			rendered="#{!coursePortfolioBean.futureCourses.contains(cc.attrs.courseBean.course)}"
				 			class="marginBottom10">
				 			
				 			Or you can 
							<p:commandLink value="#{msg['composite.course.action.enrollInCourse.button.addToFutureCourses']}"
								styleClass="bold"
							 	actionListener="#{courseBean.addToFutureCourses()}" 
							 	update=":#{cc.clientId}:newCourseForm:coursesFormGrowl 
							 		:#{cc.clientId}:newCourseForm:enrollmentContainer">
						 		<f:param name="context" value="#{cc.attrs.context}" />
							</p:commandLink>
							and complete it later.
				 		</h:panelGroup>
				 		
				 		<h:panelGroup layout="block"
				 			rendered="#{coursePortfolioBean.futureCourses.contains(cc.attrs.courseBean.course)}"
				 			class="marginBottom10">
				 			
				 			#{msg['composite.course.action.enrollInCourse.inFutureCourses.info']}
				 			
							<p:commandLink value="#{msg['composite.course.action.enrollInCourse.inFutureCourses.button']}"
								styleClass="bold"
							 	actionListener="#{courseBean.removeFromFutureCourses()}" 
							 	update=":#{cc.clientId}:newCourseForm:coursesFormGrowl :#{cc.clientId}:newCourseForm:enrollmentContainer">
							 	<f:param name="context" value="#{cc.attrs.context}" />
							</p:commandLink>.
				 		</h:panelGroup>
					</h:panelGroup>
					
					<h:panelGroup layout="block" 
						rendered="#{coursePortfolioBean.completedCourses.contains(cc.attrs.courseBean.course)}"
						class="rightSidebar">
						<h3>#{msg['composite.course.action.enrollInCourse.completed.title']}</h3>
						
						<p>
							#{msg['composite.course.action.enrollInCourse.completed.info1']}
							<h:link value="Profile tab" 
								class="bold"
								onclick="sendLogPageNavigationWithParameters('profile', { context: '#{cc.attrs.context}', 'courseStatus': 'completed'});" 
								outcome="/profile">
							</h:link>
							#{msg['composite.course.action.enrollInCourse.completed.info2']}
						</p>
						<h:link value="#{msg['composite.course.action.enrollInCourse.completed.button']}" 
							class="button green size40 left marginBottom10"
							onclick="sendLogPageNavigationWithParameters('profile', { context: '#{cc.attrs.context}', 'courseStatus': 'completed'});" 
							outcome="/profile" />
					</h:panelGroup>
					
					
					<h:panelGroup layout="block" 
						rendered="#{coursePortfolioBean.activeCourses.contains(cc.attrs.courseBean.course)}"
						class="rightSidebar">
						
						<h3>#{msg['composite.course.action.enrollInCourse.active.title.courseGoal']}</h3>
						
						<p>
							#{msg['composite.course.action.enrollInCourse.active.info1']}
							<h:link value="Learn tab" 
								class="bold"
								onclick="sendLogPageNavigationWithParameters('learn', { context: '#{cc.attrs.context}', 'courseStatus': 'active', 'targetGoalId' : '#{cc.attrs.courseBean.course.targetGoalId}'});" 
								outcome="/learn">
								<f:param name="id" value="#{util:encodeId(cc.attrs.courseBean.course.targetGoalId)}" />
							</h:link>
							#{msg['composite.course.action.enrollInCourse.active.info2']}
							<h:link value="Learn tab" 
								class="bold"
								onclick="sendLogPageNavigationWithParameters('learn', { context: '#{cc.attrs.context}', 'courseStatus': 'active', 'targetGoalId' : '#{cc.attrs.courseBean.course.targetGoalId}'});" 
								outcome="/learn">
								<f:param name="id" value="#{util:encodeId(cc.attrs.courseBean.course.targetGoalId)}" />
							</h:link>
							#{msg['composite.course.action.enrollInCourse.active.info3']}
						</p>
						
						<h:link value="#{msg['composite.course.action.enrollInCourse.active.button']}" 
							class="button green size40 left marginBottom10"
							onclick="sendLogPageNavigationWithParameters('learn', { context: '#{cc.attrs.context}', 'courseStatus': 'active', 'targetGoalId' : '#{cc.attrs.courseBean.course.targetGoalId}'});" 
							outcome="/learn">
							<f:param name="id" value="#{util:encodeId(cc.attrs.courseBean.course.targetGoalId)}" />
						</h:link>
						
						You can 
						
						<p:commandLink value="#{msg['composite.course.action.enrollInCourse.active.button.withdraw']}"
							styleClass="bold"
							onclick='$("#removeCourseFormModalDialog").dialog("open");'
							action="#{deleteGoalCourseDialog.initialize(cc.attrs.courseBean.course, cc.attrs.context)}"
							update=":#{cc.clientId}:removeCourse:removeCourseForm">
							<f:param name="learningContext" value="#{cc.attrs.learningContext}" />
						</p:commandLink>
						at any point if you decide to.
					</h:panelGroup>
				</h:panelGroup>
			</c:if>
			
			<c:if test="#{cc.attrs.role == 'MANAGER'}">
				<div class="rightSidebar">
					<h:selectBooleanCheckbox 
						value="#{cc.attrs.courseBean.course.published}"
		    			class="publishBtn" />
		    			
		    			<p class="marginTop20">
			    			<h:link outcome="/manage/tools" 
			    			rendered="#{param['id'] != null}"
								class="button size25 blue left"
								value="Manage external tools">
								<f:param  name="credId" value="#{cc.attrs.courseBean.id}" />
							</h:link>
						</p>
				</div>
			</c:if>
			
			<div class="newCourseForm">
				<table class="#{cc.attrs.role == 'MANAGER' ? 'manager' : 'user'}">
					<tr>
						<td class="col1">Title:</td>
						<td>
							<c:if test="#{cc.attrs.role == 'MANAGER'}">
								<h:inputText
									class="title autosaveEnabled"
									value="#{cc.attrs.courseBean.course.title}" 
									placeholder="#{msg['textfield.title']}"/>
							</c:if>
							
							<c:if test="#{cc.attrs.role == 'USER'}">
								<h:outputText class="title" value="#{cc.attrs.courseBean.course.title}" />
							</c:if>
							<h:outputText class="activeStatus" rendered="#{cc.attrs.courseBean.course.active}" value="active" />
						</td>
					</tr>
					<tr>
						<td class="col1 topAlign">Description:</td>
						<td>
							<c:if test="#{cc.attrs.role == 'MANAGER'}">
								<h:inputTextarea
									class="description autosaveEnabled" 
									value="#{cc.attrs.courseBean.course.description}"
									placeholder="#{msg['textarea.description']}" />
							</c:if>
							
							<c:if test="#{cc.attrs.role == 'USER'}">
								<h:outputText class="description" value="#{cc.attrs.courseBean.course.description}" />
							</c:if>
						</td>
					</tr>
					<tr>
						<td class="col1 keywords topAlign">Keywords:</td>
						<td>
							<h:inputText class="tags" value="#{cc.attrs.courseBean.course.tagsString}" />
						</td>
					</tr>
					
					<tr>
						<td class="col1 topAlign">Twitter hashtags:</td>
						<td>
							<h:inputText class="hashtags" value="#{cc.attrs.courseBean.course.hashtagsString}" />
						</td>
					</tr>
					
					<c:if test="#{cc.attrs.role == 'MANAGER'}">
					<tr>
						<td class="col1 topAlign">RSS feeds:</td>
						<td>
						
							<h:link outcome="/manage/courseFeeds" 
								class="button size25 green left"
								value="Manage RSS feed sources">
								<f:param  name="id" value="#{cc.attrs.courseBean.id}" />
							</h:link>
						</td>
					</tr>
					</c:if>
					
					<tr>
						<td class="col1">Creator:</td>
						<td>
							<h:panelGroup rendered="#{cc.attrs.courseBean.course.creatorType == 'MANAGER'}">
								Organizational
							</h:panelGroup>
							<h:panelGroup rendered="#{cc.attrs.courseBean.course.creatorType == 'USER'}">
								<link:user value="userDetails"
									user="#{loggeduser.user}" mode="imageName"
									imageSize="22" idPrefix="compDetails" 
									context="course.imageName"/>
							</h:panelGroup>
						</td>
					</tr>
					<tr>
						<td class="col1">
							<h:panelGroup rendered="#{cc.attrs.role == 'MANAGER'}">
								Students can add new competences:
							</h:panelGroup>
						</td>
						<td>
							<h:selectBooleanCheckbox
								class="studentsCanAddCompetencesCheck autosaveEnabled"
								rendered="#{cc.attrs.role == 'MANAGER'}"
								value="#{cc.attrs.courseBean.course.studentsCanAddNewCompetences}" />
						</td>
					</tr>
				</table>
				<div class="clear"></div>
				
				<h:panelGroup layout="block" id="competenceViewsContainer" class="competenceViewsContainer marginTop10">
					<ul class="sideTabs">
						<li>
							<a class="tabLink standardViewButton"
								onclick="logTabNavigation('list', '#{cc.attrs.context}');" 
								for-tab="standardView">
								List View
							</a>
						</li>
						<li>
							<a class="tabLink ganttViewButton"
								onclick="logTabNavigation('gantt', '#{cc.attrs.context}');"
								for-tab="ganttView">
								Gantt View
							</a>
						</li>
					</ul>
					
				
					<div class="tabContent standardView" tab-id="standardView">
						<h:panelGroup layout="block" rendered="#{cc.attrs.role == 'USER'}">
							<h3 class="left first icon">
								<icon:competence size="30" styleClass="icon" />
								Predefined Competences
								<utilcomp:infotooltip position="PREDEFINED_COURSE_COMPETENCES" context="#{cc.attrs.context}.predefinedCompetences" />
							</h3>
						
							<h:panelGroup layout="block" id="predefinedCompsContainer" class="profileItemContainer">
								<ui:repeat id="courseCompsLoop" value="#{cc.attrs.predefinedCompetences}" var="compData" varStatus="iterator">
									<div class="profileItem profileItemBlue competenceItem #{iterator.index % 3 != 2 ? 'rightMargin' : '' } #{iterator.index ge 3 ? 'topMargin' : '' }">
										<div class="topContent">
											<h4>
												<link:competence 
													resourceId="#{compData.competenceId}"
													title="#{compData.title}"
													type="Competence"
													styleClass="firstLine" 
													context="#{cc.attrs.context}"
													unused="true" />
												
												<compcourses:compStatus 
													competenceId="#{compData.competenceId}"
													styleClass="right"
													toRender="#{cc.attrs.role == 'USER'}" />
											</h4>
											
											<p>
												Valid for 
												<h:panelGroup rendered="#{compData.validity > 0}">
													<strong>#{compData.validity} months</strong>
												</h:panelGroup>
												<h:panelGroup rendered="#{compData.validity == 0}" class="noContentMessage">
													unknown
												</h:panelGroup>
											</p>
											
											<p:commandLink
												styleClass="link profLinkStats"
												onclick='$("#competenceStatisticsDialog").dialog("open");'
												actionListener="#{competenceAnalyticsBean.initializeById(compData.competenceId, cc.attrs.context)}"
												update=":#{cc.clientId}:compAnalytics:competenceStatisticsDialogForm">
												
												<span class="icon"></span>
												Statistics
											</p:commandLink>
										</div>
									</div>
								</ui:repeat>
								
								<h:outputText class="noContentMessage" value="No competences added"
										rendered="#{empty cc.attrs.predefinedCompetences}"/>
							</h:panelGroup>
							
							<div class="clear marginBottom10"></div>
						</h:panelGroup>
						
							
						<h:panelGroup layout="block" id="addedCompetencesContainer">
							<h:panelGroup layout="block"
								id="addedCompetences"
								rendered="#{cc.attrs.role == 'MANAGER' or cc.attrs.courseBean.course.enrolled}">
							
								<h3 class="left icon">
									<icon:competence size="30" styleClass="icon" />
									<h:outputText rendered="#{cc.attrs.courseBean.course.basedOnCourse != null}" value="Added "/>
									Competences
									<utilcomp:infotooltip position="ADDED_COURSE_COMPETENCES" context="#{cc.attrs.context}.competences" />
								</h3>
								
								<div class="clear marginBottom10"></div>
								
								<h:panelGroup rendered="#{cc.attrs.role == 'MANAGER' or 
									(cc.attrs.courseBean.course.studentsCanAddNewCompetences and 
										cc.attrs.courseBean.course.active and 
										adminSettings.settings.userCanCreateCompetence)}">
									<p:commandLink styleClass="button blue size25 left"
										value="Create Competence"
										action="#{cc.attrs.courseBean.resetCompetenceFormData}"
										onclick="$('#newCompFormModalDialog').dialog('open');"
										update=":#{p:component('newCompForm')}"
									/>
									
									<span class="left marginRight10">or search existing: </span>
								</h:panelGroup>
								
								<h:panelGroup rendered="#{cc.attrs.role == 'MANAGER' or cc.attrs.courseBean.course.active}">
									<div class="newObjCompetenceSearchFormContainer left">
										<comp:searchCompetences id="compSearch"
											value="newCourseAddedComps"
											container=".newObjCompetenceSearchFormContainer"
											regionToRenderOnAction=":#{cc.clientId}:newCourseForm:newCourseAddedCompsContainer :#{p:component('ganttContainer')} 
														:#{p:component('prereqCoreqCompetenceForm')} :#{cc.clientId}:newCourseForm:coursesFormGrowl"
											actionLinkName="Add"
											actionBean="#{cc.attrs.courseBean}"
											toExcludeIds="#{cc.attrs.courseBean.course.allCompetenceIds}" />
									</div>
									
									<p:commandLink id="showAllCompetencesButton"
										styleClass="marginLeft10"
										value="Show all" 
										onclick="$('#allCompetencesModalDialog').dialog('open');"
										action="#{searchCompetencesBean.showAllCompetences()}"
										update=":#{cc.clientId}:allComp:allCompetencesFormId"
									/>
								</h:panelGroup>
										 
								<h:panelGroup rendered="#{cc.attrs.role == 'USER' and cc.attrs.courseBean.course.active}">
									<utilcomp:infotooltip styleClass="right marginTop5" position="SUGGESTED_COURSE_COMPETENCES" context="#{cc.attrs.context}.cuggestions" />
									
									<p:commandLink styleClass="button blue size25 right"
										value="Get Suggestions"
										action="#{cc.attrs.courseBean.initializeSuggestedCompetences}"
										onclick="$('#suggestedCompFormModalDialog').dialog('open');"
										update=":#{p:component('suggestedCompForm')}"
									/>
								</h:panelGroup>
								<div class="clear marginBottom20 marginTop20"></div>
			
							
								<h:panelGroup layout="block" 
									id="newCourseAddedCompsContainer" 
									class="newCourseAddedCompsContainer profileItemContainer">
									
									<ui:repeat id="newCourseAddedCompsLoop" value="#{cc.attrs.competences}" var="compData" varStatus="iterator">
										<div class="profileItem profileItemBlue competenceItem #{iterator.index % 3 != 2 ? 'rightMargin' : '' } #{iterator.index ge 3 ? 'topMargin' : '' }">
											<div class="topContent">
												<h4>
													<link:competence 
														resourceId="#{compData.competenceId}"
														type="Competence"
														title="#{compData.title}"
														regionToUpdate=":#{p:component('competenceDetailsForm')}"
														styleClass="firstLine" 
														context="#{cc.attrs.context}" />
													
													<compcourses:compStatus 
														competenceId="#{compData.competenceId}"
														styleClass="right"
														toRender="#{cc.attrs.role == 'USER'}" />
												</h4>
												<p>
													Valid for 
													<h:panelGroup rendered="#{compData.validity > 0}">
														<strong>#{compData.validity} months</strong>
													</h:panelGroup>
													<h:panelGroup rendered="#{compData.validity == 0}" class="noContentMessage">
														unknown
													</h:panelGroup>
												</p>
												
												<p:commandLink
													styleClass="link profLinkStats"
													onclick='$("#competenceStatisticsDialog").dialog("open");'
													actionListener="#{competenceAnalyticsBean.initializeById(compData.competenceId, cc.attrs.context)}"
													update=":#{cc.clientId}:compAnalytics:competenceStatisticsDialogForm">
													
													<span class="icon"></span>
													Statistics
												</p:commandLink>
											</div>
											
											<h:panelGroup layout="block" class="bottomEdit"
												rendered="#{cc.attrs.role == 'MANAGER' or cc.attrs.courseBean.course.active}">
												<p:commandLink value="Remove" 
													action="#{cc.attrs.courseBean.removeCompetence(cc.attrs.courseBean.course, compData.competenceId)}"
													update=":#{p:component('newCourseAddedCompsContainer')} :#{p:component('ganttContainer')} :#{cc.clientId}:newCourseForm:coursesFormGrowl"
												/>
												<h:link 
													rendered="#{cc.attrs.role == 'MANAGER'}"
													value="Edit" 
													outcome="/manage/competence">
													<f:param name="id" value="#{util:encodeId(compData.competenceId)}" />
													<f:param name="cred" value="#{param['id']}" />
													<f:param name="origin" value="/manage/course.xhtml?id=#{cc.attrs.courseBean.course.id}" />
												</h:link>
											</h:panelGroup>
										</div>
									</ui:repeat>
									<script>
									$(function(){
										$('.profileItem.competenceItem h4 .firstLine').shortenedText({showChar: 30, mode: 'static'});
									});
									</script>
									
									<h:outputText class="noContentMessage" 
										value="No competences added"
										rendered="#{empty cc.attrs.competences}"/>
										
									<utilcomp:tooltip target=".hasTooltip[title]" />
								</h:panelGroup>
							</h:panelGroup>
						</h:panelGroup>
					</div>
					
					<div class="ganttView tabContent hidden" tab-id="ganttView">
						<p:commandLink 
							styleClass="prepareData hidden" 
							action="#{cc.attrs.courseBean.serializeCompetencesToJson()}" 
							update=":#{p:component('ganttContainer')}"
							/>
					
						<compcourses:gantt id="courseGantt"
							courseBean="#{cc.attrs.courseBean}"
							prepareAction=".newCourse .tabContent.ganttView .prepareData"
							data="#{cc.attrs.courseBean.competencesJson}"
							changeHolder="#{cc.attrs.courseBean.changeHolder}"
							updateOnRemoveCompetence=":#{p:component('newCourseAddedCompsContainer')}"
							parentSelector=".newCourseForm .ganttView"
							slideWidth="680"
							readOnly="#{!(cc.attrs.role == 'MANAGER' or cc.attrs.courseBean.course.active)}"
							context="#{cc.attrs.context}.gantt" />
					</div>
				</h:panelGroup>
	
				<utilcomp:tooltip target=".hasTooltip[title]" />			
			</div> <!-- End newCourseForm -->
			
			<script type="text/javascript">
				$('.competenceViewsContainer').tabs();
				$('.newCourse .newCourseForm .tags').tags({
					editMode : #{cc.attrs.role == 'MANAGER'},
					afterUpdateCallback: function(elem) {
						$(window).autosaveForm('addLoaderAndAutosave', elem);
					}
				});
				$('.newCourse .newCourseForm .hashtags').tags({
					editMode : #{cc.attrs.role == 'MANAGER'},
					afterUpdateCallback: function(elem) {
						$(window).autosaveForm('addLoaderAndAutosave', elem);
					}
				});

				$(function() {
					$('.newCourse .newCourseForm .description').autosize();
				});
			
				$('.tabLink').on('click', function() {
					if ($(this).hasClass('ganttViewButton')) {
						initializeGantt();
					}
					return false;
				});
			</script>
			
			<h:panelGroup layout="block" id="actions"
				rendered="#{cc.attrs.role == 'MANAGER' or cc.attrs.courseBean.course.active}"
				class="actions main">
			
				<p:commandLink 
					rendered="#{cc.attrs.role == 'MANAGER' or cc.attrs.courseBean.course.enrolled}"
					styleClass="button size30 green left" value="Save" 
					action="#{cc.attrs.courseBean.saveCourse}"/>
					
				<h:link class="button size30 gray left"
					value="#{(cc.attrs.role == 'MANAGER' or cc.attrs.courseBean.course.enrolled) ? 'Cancel' : 'Back'}"
					outcome="#{cc.attrs.cancelLinkPath}" />
				
			</h:panelGroup>
			
			<p:growl id="coursesFormGrowl" showDetail="true" />
		</h:form>
		<div class="clear"></div>
		
		<div id="prerequisitesCorequisitesModalDialog" class="coursePrerequisitesCorequisites" style="display: none;">
			<h:form id="prereqCoreqCompetenceForm">
				<h:panelGroup layout="block"
					rendered="#{not empty cc.attrs.courseBean.suggestedPrerequisites or not empty cc.attrs.courseBean.suggestedCorequisites}">
					
					<h:panelGroup layout="block" class="prerequisites" rendered="#{not empty cc.attrs.courseBean.suggestedPrerequisites}">
						It is not recommended to work on the competence
						<link:competence
							type="Competence"
							resource="#{cc.attrs.courseBean.recentlyAddedObjCompetence.competence}"
							title="#{cc.attrs.courseBean.recentlyAddedObjCompetence.competence.title}"
							regionToUpdate=":#{p:component('competenceDetailsForm')}" 
							context="course"/>
						before completing its prerequisites. Add following prerequisites:
						
						<ul>
							<ui:repeat value="#{cc.attrs.courseBean.suggestedPrerequisites}" var="prerequisite" varStatus="iterator">
								<li>
									<link:competence 
										resource="#{prerequisite}"
										type="Competence"
										title="#{prerequisite.title}"
										regionToUpdate=":#{p:component('competenceDetailsForm')}" 
										context="course"/>
										
									<p:commandLink styleClass="iconRemove" 
										action="#{cc.attrs.courseBean.removeSuggestedPrerequisite(prerequisite)}"
										update=":#{p:component('prereqCoreqCompetenceForm')}"/>
								</li>
							</ui:repeat>
						</ul>
					</h:panelGroup>
					
					<h:panelGroup layout="block" class="corequisites" rendered="#{not empty cc.attrs.courseBean.suggestedCorequisites}">
						
						You might consider adding following competences that are associated with it:
						<ul>
							<ui:repeat value="#{cc.attrs.courseBean.suggestedCorequisites}" var="corequisite" varStatus="iterator">
								<li>
									<link:competence 
										resource="#{corequisite}"
										type="Competence"
										title="#{corequisite.title}"
										regionToUpdate=":#{p:component('competenceDetailsForm')}"
										context="course" />
										
									<p:commandLink styleClass="iconRemove" 
										action="#{cc.attrs.courseBean.removeSuggestedCorequisite(corequisite)}"
										update=":#{p:component('prereqCoreqCompetenceForm')}"/>
								</li>
							</ui:repeat>
						</ul>
					</h:panelGroup>
					
					<p:commandLink value="Save"
						styleClass="button green size30 right"
						onclick="$('#prerequisitesCorequisitesModalDialog').dialog('close');"
						action="#{cc.attrs.courseBean.addSuggestedPrerequisitesCorequisites()}"
						update=":#{p:component('newCourseAddedCompsContainer')} :#{p:component('ganttContainer')}"
						/>
					&#160;
					<p:commandLink value="Cancel"
						styleClass="button gray size30 right"
						update="@form"/>
					
					<script>
						$('#prerequisitesCorequisitesModalDialog').dialog('open');
					</script>
				</h:panelGroup>
				
				<script>
				$(function(){
					$('#prerequisitesCorequisitesModalDialog').dialog({
						title: 'Add prerequisite and corequisite competences',
						autoOpen: false,
						show : 'slide',
						width: 500,
						modal: true,
						resizable: false,
					});
					$('#prerequisitesCorequisitesModalDialog').show();
				});
				</script>
			</h:form>
		</div>
		
		<compcourses:suggestedCompDialog id="course" />
		
		<dlgportfolio:activityList id="newCourse" />
		
		<dlg:newCompetence id="newComp" 
			compData="#{cc.attrs.courseBean.competenceFormData}"
			updateCompetenceAction="#{cc.attrs.courseBean.saveCompetence()}"
			regionToUpdate=":#{p:component('newCourseAddedCompsContainer')} :#{p:component('ganttContainer')} 
							:#{p:component('prereqCoreqCompetenceForm')} :#{cc.clientId}:newCourseForm:coursesFormGrowl"
			mode="#{cc.attrs.mode}"
			context="course" />
		
		<ui:remove>
			<dlg:addToGoal id="courseAddToGoal" value="courseAddToGoal"
				updateAfterAddToGoal=":#{cc.clientId}:newCourseForm:newCourseAddedCompsContainer 
					:#{cc.clientId}:newCourseForm:courseGantt:ganttContainer 
					:#{cc.clientId}:newCourseForm:predefinedCompsContainer" />
		</ui:remove>	
		
		<dlg:allCompetencesDialog id="allComp"
			regionToUpdate=":#{p:component('newCourseAddedCompsContainer')} :#{p:component('ganttContainer')} 
							:#{p:component('prereqCoreqCompetenceForm')} :#{cc.clientId}:newCourseForm:coursesFormGrowl"
			actionLinkName="Add"
			actionBean="#{cc.attrs.courseBean}"
			competencesAlreadyAdded="#{cc.attrs.courseBean.getAllCompetencesIds()}"
		/>
		
		<dlgAnalytics:competence id="compAnalytics" />
		
		<c:if test="#{cc.attrs.role == 'USER'}">
			<dlgcourse:deleteCourse id="removeCourse"
				updateOncomplete=":#{cc.clientId}:newCourseForm:coursesFormGrowl 
					:#{cc.clientId}:newCourseForm:enrollmentContainer 
					:#{cc.clientId}:newCourseForm:addedCompetencesContainer 
					:#{cc.clientId}:newCourseForm:actions"
			/>
			
			<dlgcourse:activateCourse id="activateCourse"
				updateOncomplete=":#{cc.clientId}:newCourseForm:coursesFormGrowl 
			 		:#{cc.clientId}:newCourseForm:enrollmentContainer 
			 		:#{cc.clientId}:newCourseForm:addedCompetencesContainer 
			 		:#{cc.clientId}:newCourseForm:actions"
			/>
		</c:if>
		
	</composite:implementation>
</ui:component>