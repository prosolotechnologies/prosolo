<ui:component
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:link="http://java.sun.com/jsf/composite/components/resourceLinks"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:post="http://java.sun.com/jsf/composite/components/post">

	<composite:interface>
		<composite:attribute name="activity" required="true" />
		<composite:attribute name="bean" required="true" />
		<composite:attribute name="uploadFileModalId" required="true" />
		<composite:attribute name="addLinkModalId" required="true" />
		<composite:attribute name="prepareAddingResLinkMethodName" required="true" />
		<composite:attribute name="prepareAddingResLinkMethod" required="true" method-signature="void #{cc.attrs.prepareAddingResLinkMethodName}()" />
		<composite:attribute name="toUpdate" default="" />
		<composite:attribute name="toUpdateModalUploadFile" default="" />
		<composite:attribute name="toUpdateModalAddLink" default="" />
		<composite:attribute name="mainForm" default="" />
	</composite:interface>
	
	<composite:implementation>
		<script src="#{request.contextPath}/resources/javascript2/tinymce/tinymce.min.js"></script>
		<script>
		tinymce.init({
			theme: "modern",
		    skin: 'light',
			selector:'.fieldsText textarea',
			menubar:false,
		    statusbar: false,
		    toolbar: 'undo redo | bold italic | link image | alignleft aligncenter alignright alignfull | bullist numlist |  outdent indent'
		});
		</script>
	
		<div id="#{cc.clientId}">
		<!-- video activity start -->
	    <h:panelGroup layout="block" rendered="#{cc.attrs.activity.activityType == 'VIDEO'}" styleClass="fieldsVideo">
           <div class="formLine">
               <label>Video URL</label>
               <div class="formLineRight">
               	   <h:inputText 
               	   		id="inputVideoUrl"
               	   		styleClass="pasteable"
               	   		value="#{cc.attrs.activity.link}"
               	   		onkeyup="updateStatusToDraft();"
               	   		validator="youtubeValidator"
               	   		required="true"
						requiredMessage="Video URL is required"/>
				   <h:panelGroup 
                    	layout="block" 
                    	rendered="#{not empty facesContext.getMessageList(cc.clientId.concat(':inputVideoUrl'))}" 
                    	styleClass="alert alert-danger" 
                    	pt:role="alert">
                        <h:message for="inputVideoUrl"></h:message>
                    </h:panelGroup>
               </div>
           </div>
        </h:panelGroup>
        
        <!-- text activity start -->
        <h:panelGroup layout="block" rendered="#{cc.attrs.activity.activityType == 'TEXT'}" styleClass="fieldsText">
          <div class="formLine">
              <label>Text</label>
              <div class="formLineRight">
              	  <h:inputTextarea 
              	  	id="inputTextActText"
              	  	value="#{cc.attrs.activity.text}"
              	  	styleClass="textareaBig pasteable"/>
				   <h:panelGroup 
	                   	layout="block" 
	                   	rendered="#{not empty facesContext.getMessageList(cc.clientId.concat(':inputTextActText'))}" 
	                   	styleClass="alert alert-danger" 
	                   	pt:role="alert">
	                       <h:message for="inputTextActText"></h:message>
	               </h:panelGroup>
              </div>
          </div>
     	</h:panelGroup>
     	
     	 <h:panelGroup layout="block" rendered="#{cc.attrs.activity.activityType == 'SLIDESHARE'}" styleClass="fieldsSlideshare">
	          <div class="formLine">
	              <label>Slideshare URL</label>
	              <div class="formLineRight">
	                   <h:inputText 
	                   		id="inputSlideshareUrl"
	                   		styleClass="pasteable"
	                   		value="#{cc.attrs.activity.link}"
	                   		onkeyup="updateStatusToDraft();"
	                   		validator="slideshareValidator"
	                   		required="true"
	        				requiredMessage="Slideshare URL is required"/>
       				   <h:panelGroup 
                           	layout="block" 
                           	rendered="#{not empty facesContext.getMessageList(cc.clientId.concat(':inputSlideshareUrl'))}" 
                           	styleClass="alert alert-danger" 
                           	pt:role="alert">
                               <h:message for="inputSlideshareUrl"></h:message>
                       </h:panelGroup>
	              </div>
	          </div>
	     </h:panelGroup>
	       
	     <h:panelGroup rendered="#{cc.attrs.activity.activityType != 'EXTERNAL_TOOL'}">
	         <div class="formLine">
	             <label>Upload file</label>
	             <div class="formLineRight">
	             	<h:panelGroup id="panelFiles">
	             	<h:panelGroup id="panelAddedFiles" rendered="#{!cc.attrs.bean.isFileListEmpty()}">	
	                 <ul class="addedItems">
	                 	<ui:repeat var="file" value="#{cc.attrs.activity.files}">
	                 		<ui:fragment rendered="#{file.status != 'REMOVED'}">
	                 			<li>
	                 				<h3>#{file.linkName}</h3>
                                    <p:commandLink 
			                         	styleClass="removeX" 
			                         	pt:data-toggle="tooltip" 
			                         	pt:title="Remove"
			                         	process="@this"
			                         	action="#{cc.attrs.bean.removeFile(file)}"
			                         	update=":#{cc.clientId}:panelFiles #{cc.attrs.toUpdate}">
			                         	remove
			                         </p:commandLink>
                                    <div class="clear">
                                    </div>
			                        <a href="#{file.url}" target="_blank">#{file.fetchedTitle}</a>
			                         
	                     		</li>
	                 		</ui:fragment>
	                 	</ui:repeat>
	                 </ul>
	                 </h:panelGroup>
	                      
	                 <p:commandLink 
	                 	process="@this"
	                 	styleClass="btn btn-green btn-sm" 
	                 	pt:data-toggle="modal"
	                 	action="#{cc.attrs.prepareAddingResLinkMethod}"
	                 	update="#{cc.attrs.toUpdateModalUploadFile}"
	                 	oncomplete="$('##{cc.attrs.uploadFileModalId}').modal('show');">Upload New File
	                 </p:commandLink>
	                
	                 </h:panelGroup>
	             </div>
	         </div>
	         <div class="formLine">
	             <label>Add URL</label>
	             <div class="formLineRight">
	             	<h:panelGroup id="panelLinks">
	             	<h:panelGroup id="panelAddedLinks" rendered="#{!cc.attrs.bean.isLinkListEmpty()}">	
	                 <ul class="addedItems">
	                 	<ui:repeat var="link" value="#{cc.attrs.activity.links}">
	                 		<ui:fragment rendered="#{link.status != 'REMOVED'}">
		                 		<li>
		                 			<h3>#{link.linkName}</h3>
                                    <p:commandLink 
			                         	styleClass="removeX" 
			                         	pt:data-toggle="tooltip" 
			                         	pt:title="Remove"
			                         	process="@this"
			                         	action="#{cc.attrs.bean.removeLink(link)}"
			                         	update=":#{cc.clientId}:panelLinks #{cc.attrs.toUpdate}">
			                         	remove
			                         </p:commandLink>
                                    <div class="clear">
                                    </div>
			                        <a href="#{link.url}" target="_blank">#{link.url}</a>
			                         
		                     	</li>
		                     </ui:fragment>
	                 	</ui:repeat>
	                 </ul>
	                 </h:panelGroup>
	                 </h:panelGroup>
	                 
	                 <p:commandLink 
	                 	process="@this"
	                 	styleClass="btn btn-green btn-sm" 
	                 	pt:data-toggle="modal"
	                 	action="#{cc.attrs.prepareAddingResLinkMethod}"
	                 	update="#{cc.attrs.toUpdateModalAddLink}"
	                 	oncomplete="attachListenerForFetchingPageTitle(); $('##{cc.attrs.addLinkModalId}').modal('show')">Add New URL
	                 </p:commandLink>

	             </div>	          
	         </div>
	         <div class="formLine">
	             <label>Upload result</label>
	             <div class="formLineRight">
	                 <div class="checkbox checkLine">
	                 	 <h:selectBooleanCheckbox 
	                 	 	id="checkUploadResult"
                    		value="#{cc.attrs.activity.uploadAssignment}"
                    		onchange="updateStatusToDraft();">
                    	 </h:selectBooleanCheckbox>
	                     <label for="#{cc.clientId}:checkUploadResult">Show "Upload Result" option</label>
	                 </div>
	             </div>
	         </div>
         </h:panelGroup>
         
         <!-- external tool activity -->
   		 <h:panelGroup layout="block" rendered="#{cc.attrs.activity.activityType == 'EXTERNAL_TOOL'}" styleClass="fieldsExternal">
            <div class="formLine">
                <label>&#160;</label>
                <div class="formLineRight">
                    <p>External activities are added via LTI protocol. Please provide LTI tool details obtained from your LTI provider.</p>
                </div>
            </div>
            <div class="formLine">
                <label>Launch URL</label>
                <div class="formLineRight">
                     <h:inputText 
                     	id="inputLaunchUrl"
                     	styleClass="pasteable"
                     	value="#{cc.attrs.activity.launchUrl}"
                     	onkeyup="updateStatusToDraft();"
                     	validator="urlValidator"
                     	required="true"
        				requiredMessage="Launch URL is required"/>
   				     <h:panelGroup 
                       	layout="block" 
                       	rendered="#{not empty facesContext.getMessageList(cc.clientId.concat(':inputLaunchUrl'))}" 
                       	styleClass="alert alert-danger" 
                       	pt:role="alert">
                           <h:message for="inputLaunchUrl"></h:message>
                     </h:panelGroup>
                </div>
            </div>
            <div class="formLine">
                <label>Shared secred</label>
                <div class="formLineRight">
                     <h:inputText 
                     	id="inputSecret"
                     	styleClass="pasteable"
                     	value="#{cc.attrs.activity.sharedSecret}"
                     	onkeyup="updateStatusToDraft();"
                     	required="true"
        				requiredMessage="Shared secret is required"/>
   				     <h:panelGroup 
                       	layout="block" 
                       	rendered="#{not empty facesContext.getMessageList(cc.clientId.concat(':inputSecret'))}" 
                       	styleClass="alert alert-danger" 
                       	pt:role="alert">
                           <h:message for="inputSecret"></h:message>
                     </h:panelGroup>
                </div>
            </div>
            <div class="formLine">
                <label>Consumer key (optional)</label>
                <div class="formLineRight">
                     <h:inputText 
                     	styleClass="pasteable"
                     	value="#{cc.attrs.activity.consumerKey}"
                     	onkeyup="updateStatusToDraft();"/>
                </div>
            </div>
            <div class="formLine">
                <label>&#160;</label>
                <div class="formLineRight">
                    <div class="checkbox checkLine">
                    	<h:selectBooleanCheckbox id="checkAcceptGrades"
                    		value="#{cc.attrs.activity.acceptGrades}"
                    		onchange="updateStatusToDraft();">
                    	</h:selectBooleanCheckbox>
                        <label for="#{cc.clientId}:checkAcceptGrades">Accept grades</label>
                    </div>
                </div>
            </div>
        </h:panelGroup>
    	</div>
	</composite:implementation>
</ui:component>