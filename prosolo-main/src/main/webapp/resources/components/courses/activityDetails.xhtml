<ui:component
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:comp="http://java.sun.com/jsf/composite/components"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util"
	xmlns:link="http://java.sun.com/jsf/composite/components/resourceLinks"
	xmlns:post="http://java.sun.com/jsf/composite/components/post"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:courses="http://java.sun.com/jsf/composite/components/courses"
	xmlns:socialWall="http://java.sun.com/jsf/composite/components/socialWall"
	xmlns:util="http://www.prosolo.com/util">

	<composite:interface>
		<composite:attribute name="activity" required="true" />
		<composite:attribute name="bean" required="true" />
		<composite:attribute name="isPreview" required="true" type="java.lang.Boolean" />
		<composite:attribute name="learningContext" required="true" />
	</composite:interface>
	
	<composite:implementation>
		<div id="#{cc.clientId}">
			<p:growl id="growlDetails" globalOnly="true" showDetail="true" />
			
            <ui:fragment rendered="#{cc.attrs.activity.activityType == 'VIDEO'}">
				<div class="activityMain">
					<socialWall:youtubevideopreview
						embedId="#{cc.attrs.activity.embedId}"
						width="731"
						height="413"
						context="#{cc.attrs.learningContext}"/>
				</div>
			</ui:fragment>
			
			<ui:fragment rendered="#{cc.attrs.activity.activityType == 'SLIDESHARE'}">
				<iframe src="#{cc.attrs.activity.embedId}"
					width="731" height="413" frameborder="0"
					marginwidth="0" marginheight="0" scrolling="no"
					style="border: 1px solid #CCC; border-width: 1px 1px 0; margin-bottom: 5px">
				</iframe>
			</ui:fragment>
			
			<ui:fragment rendered="#{cc.attrs.activity.activityType == 'EXTERNAL_TOOL'}">
				<h:link 
					style="display:none;"
					value="Load"
					styleClass="linkLoadExternalActivity"
					outcome="/lti" 
					target="extActivityFrame"
					onclick="sendLogPageNavigationWithParameters('/lti', {});">
					<f:param name="launchUrl" value="#{cc.attrs.activity.launchUrl}"/>
					<f:param name="sharedSecret" value="#{cc.attrs.activity.sharedSecret}"/>
					<f:param name="consumerKey" value="#{cc.attrs.activity.consumerKey}"/>
					<f:param name="targetActivityId" value="#{cc.attrs.activity.targetActivityId}"/>
					<f:param name="activityId" value="#{cc.attrs.activity.activityId}"/>
				</h:link>
			
				<iframe name="extActivityFrame"
					width="731" height="413" frameborder="0"
					marginwidth="0" marginheight="0" scrolling="yes"
					style="border: 1px solid #CCC; border-width: 1px 1px 0; margin-bottom: 5px">
				</iframe>
				
				<script>
				$(function(){
					document.getElementsByClassName("linkLoadExternalActivity")[0].click();
				});
				</script>
			</ui:fragment>
           
            <ui:fragment rendered="#{not empty cc.attrs.activity.description}">
            	<p>#{cc.attrs.activity.description}</p>
            </ui:fragment>
            
            <h:panelGroup layout="block" rendered="#{cc.attrs.activity.activityType == 'TEXT'}" styleClass="whiteBox activityTextBox">
				<h:outputText escape="false" value="#{cc.attrs.activity.text}"/>
            </h:panelGroup>
            
            <ui:fragment rendered="#{cc.attrs.activity.activityType != 'EXTERNAL_TOOL'}">
	            <ul class="whiteBox activityLinksBox">
	            	<ui:repeat var="link" value="#{cc.attrs.activity.links}">
	            		<li>
		                    <div class="actBoxLeft">
		                        <h3>#{link.linkName}</h3>
		                        <span>#{link.url}</span>
		                    </div>
		                    <a href="#{link.url}" 
	                    		target="_blank" 
	                    		class="btn btn-green btn-sm"
	                    		onclick="sendLogPageNavigation('#{link.url}', 
	                    				'#{facesContext.viewRoot.viewId}', 
	                    				'#{util:addSubContext(cc.attrs.learningContext, &#34;name:activity_link|id:&#34;.concat(link.id))}', 
	                    				null);">
	                    		Open
		                    </a>
		                </li>
	            	</ui:repeat>    
	            </ul>
	            <ul class="whiteBox activityFilesBox">
	            	<ui:repeat var="file" value="#{cc.attrs.activity.files}">
	            		<li>
		                    <div class="actBoxLeft">
		                        <h3>#{file.linkName}</h3>
		                        <span>#{file.linkName}</span>
		                    </div>
		                    <a href="#{file.url}" 
		                    	target="_blank" 
		                    	class="btn btn-green btn-sm"
		                    	onclick="sendLogPageNavigation('#{file.url}', 
	                    				'#{facesContext.viewRoot.viewId}', 
	                    				'#{util:addSubContext(cc.attrs.learningContext, &#34;name:activity_file|id:&#34;.concat(file.id))}', 
	                    				null);">
		                    	Download
		                    </a>
		                </li>
	            	</ui:repeat>    	             
	            </ul>
	        </ui:fragment>
            <h:panelGroup id="panelUploadAssignment" rendered="#{cc.attrs.activity.enrolled and cc.attrs.activity.uploadAssignment}">
            	<ui:fragment rendered="#{not empty cc.attrs.activity.assignmentLink}">
            		<h2>Your Result</h2>
	                <ul class="whiteBox activityResultBox">
	                    <li>
	                        <div class="actBoxLeft">
	                            <h3>#{cc.attrs.activity.assignmentTitle}</h3>
	                            <a href="#" class="deleteLink linkRed" data-toggle="modal" data-target="#deleteModal">Delete</a>
	                        </div>
	                        <a href="#{cc.attrs.activity.assignmentLink}" target="_blank" class="btn btn-green btn-sm">Download</a>
	                    </li>
	                </ul>
            	</ui:fragment>
            	<ui:fragment rendered="#{empty cc.attrs.activity.assignmentLink}">
            		<h:form id="formUpload" enctype="multipart/form-data">
		            	<utilcomp:fileUpload
		            		uploadFileInfo="Upload Result"
		            		fileUploadListenerMethodName="handleFileUpload"
		            		fileUploadListenerMethod="#{cc.attrs.bean.handleFileUpload}"
		            		toUpdate=":#{cc.clientId}:panelUploadAssignment :#{cc.clientId}:growlDetails"
		            		learningContext="#{cc.attrs.learningContext}"
		            	/> 
	            	</h:form> 
            	</ui:fragment>

            </h:panelGroup>
            <courses:deleteModalDialog
                deleteActionMethodName="deleteAssignment"          	
        		deleteAction="#{activityViewBean.deleteAssignment}"
        		toUpdate=":#{cc.clientId}:panelUploadAssignment :#{cc.clientId}:growlDetails" 
        		modalDeleteTitle="Result"
        		modalDeleteText="the result"
        		learningContext="#{cc.attrs.learningContext}"/>
        </div>
	</composite:implementation>
</ui:component>