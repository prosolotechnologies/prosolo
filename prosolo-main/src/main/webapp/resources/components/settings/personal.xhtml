<ui:component xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util"
	xmlns:util="http://www.prosolo.com/util">

	<composite:interface>
		<composite:attribute name="toUpdate" default="" />
	</composite:interface>

	<composite:implementation>
		<link rel="stylesheet" type="text/css" media="all" href="#{request.contextPath}/resources/css2/icropper.css" />
		<script src="#{request.contextPath}/resources/javascript2/icropper/icropper-min.js"></script>
		<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?v=3.exp&amp;sensor=false&amp;libraries=places&amp;key=AIzaSyCsXx1RPF5Fia-ZGczRCXwEQgn9HwYH50M"></script>
		<script src="#{request.contextPath}/resources/javascript2/settings.profile.location.js"></script>

		<div class="whiteBar"></div>

		<div class="container">

			<div class="row">
				<div class="col-md-8">
					<div class="whiteBox">
						<h2>Personal Info</h2>
						<div class="formWrapper">
							<h:form id="settingsPersonalForm">
								<p:growl id="settingsPersonalGrowl" showDetail="true"></p:growl>
								
								<div class="formLine">
									<label>First name</label>
									<div class="formLineRight">
										<h:inputText id="editName" class="editName"
													 placeholder="Enter your first name"
													 value="#{profileSettings.accountData.name}" />
									</div>
								</div>
								
								<div class="formLine">
									<label>Last name</label>
									<div class="formLineRight">
										<h:inputText id="editLastName" class="editLastName"
													 placeholder="Enter your last name"
													 value="#{profileSettings.accountData.lastName}" />
									</div>
								</div>
								
								<div class="formLine">
									<label>Email</label>
									<div class="formLineRight">
										<h:inputText id="editEmail" class="editEmail" disabled="true"
											value="#{profileSettings.accountData.email}" />
										<small>Email cannot be changed. Email will not be publicly displayed.</small>
									</div>
								</div>
								
								<div class="formLine">
									<label>Position</label>
									<div class="formLineRight">
										<h:inputText id="editPosition" class="editPosition"
													 placeholder="Enter a position"
													 value="#{profileSettings.accountData.position}" />
									</div>
								</div>
								
								<div class="formLine">
									<label>Location</label>
									<h:panelGroup layout="block" id="location" class="location formLineRight">
										<h:inputText id="editLocationName"
											value="#{profileSettings.accountData.locationName}"
											class="searchLocationTextField"
											size="50" />
										<h:inputText value="#{profileSettings.accountData.latitude}" class="latitude" style="display: none;" />
										<h:inputText value="#{profileSettings.accountData.longitude}" class="longitude" style="display: none;" />
										
										<f:view contentType="text/html">
											<div class="map-canvas"></div>
										</f:view>
										
										<script>
											$(function(){
												initializeMap('#{profileSettings.accountData.locationName}', '#{profileSettings.accountData.latitude}', '#{profileSettings.accountData.longitude}');
											});
										</script>
									</h:panelGroup>
								</div>
								
								<div class="formLine">
									<label>&#160;</label>
									<div class="formLineRight">
										<p:commandLink styleClass="btn btn-green" value="Save Changes"
											action="#{profileSettings.saveAccountChanges}"
											update=":#{cc.clientId}:settingsPersonalForm #{cc.attrs.toUpdate}">
											<f:param name="page" value="#{facesContext.viewRoot.viewId}" />
											<f:param name="learningContext" value="#{'name:settings_personal|id:'.concat(loggeduser.userId)}" />
										</p:commandLink>
									</div>
								</div>
							</h:form>
						</div>
					</div>
					
					<div class="whiteBox socialNetworks">
						<h2>Social Profiles</h2>
						
						<div class="formWrapper">
							<h:form id="socialNetworksSettingsForm">
								<p:growl id="settingsSocialNetworksGrowl" showDetail="true"></p:growl>
								
								<h:panelGroup layout="block" id="socialNetworksContainer" class="socialNetworksContainer">
									<div class="formLine">
										<label>LinkedIn profile URL</label>
										<div class="formLineRight">
											<h:inputText value="#{profileSettings.userSocialNetworksData.socialNetworkAccountsData['LINKEDIN'].linkEdit}" />
										</div>
									</div>
									
									<div class="formLine">
										<label>Twitter profile URL</label>
										
										<div class="formLineRight">
											<h:inputText id="twitterProfileUrl" value="#{profileSettings.userSocialNetworksData.socialNetworkAccountsData['TWITTER'].linkEdit}" />
											
											<div class="twitterBtnBox">
												<h:panelGroup id="twitter">
													<h:panelGroup rendered="#{!profileSettings.connectedToTwitter}">
														<p:commandLink styleClass="btn btnTwitterConnect btn-sm"
															action="#{twitterBean.startTweeterOauthAuthProcess}"
															update=":#{cc.clientId}:socialNetworksSettingsForm:twitter settingsSocialNetworksGrowl">
															<span></span>Connect to Twitter
														</p:commandLink>
														
														<small>Connect your Twitter account and republish
															your tweets to your ProSolo followers.</small>
													</h:panelGroup>
													
													<h:panelGroup rendered="#{profileSettings.connectedToTwitter}">
														<p:commandLink styleClass="btn btnTwitterConnect btn-sm"
															action="#{twitterBean.disconnectUserAccount(true)}"
															update=":#{cc.clientId}:socialNetworksSettingsForm:twitter settingsSocialNetworksGrowl">
															<span></span>Disconnect from Twitter
														</p:commandLink>
													</h:panelGroup>
													<script>
														function twitterWarningOnClick() {
															var newLink = $('##{cc.clientId}\\:socialNetworksSettingsForm\\:twitterProfileUrl').val();
															$('##{cc.clientId}\\:formTwitterWarning\\:twitterProfileUrl').val(newLink);
															$('#twitterWarning').modal('show');
														}
														function saveChangesClick() {
															var newLink = $('##{cc.clientId}\\:socialNetworksSettingsForm\\:twitterProfileUrl').val();
															console.log(newLink);
															if(#{!profileSettings.connectedToTwitter} || '#{profileSettings.userSocialNetworksData.socialNetworkAccountsData['TWITTER'].linkEdit}' === newLink) {
																$('##{cc.clientId}\\:socialNetworksSettingsForm\\:saveChangesLink').click();
															} else {
																$('#saveChangesTwitterWarningLink').click();
															}
														}
													</script>
												</h:panelGroup>
											</div>
										</div>
									</div>
									
									<div class="formLine">
										<label>Facebook profile URL</label>
										<div class="formLineRight">
											<h:inputText value="#{profileSettings.userSocialNetworksData.socialNetworkAccountsData['FACEBOOK'].linkEdit}" />
										</div>
									</div>
									
									<div class="formLine">
										<label>Blog URL</label>
										<div class="formLineRight">
											<h:inputText value="#{profileSettings.userSocialNetworksData.socialNetworkAccountsData['BLOG'].linkEdit}" />
										</div>
									</div>
									
									<div class="formLine">
										<label>&#160;</label>
										<div class="formLineRight">
											<a class="btn btn-green" onclick="saveChangesClick();">Save Changes</a>
					
											<p:commandLink id="saveChangesLink" style="display: none;"
												value="Save Changes"
												action="#{profileSettings.saveSocialNetworkChanges}"
												update="settingsSocialNetworksGrowl twitter #{cc.attrs.toUpdate}" />
											<a id="saveChangesTwitterWarningLink" style="display: none;"
												onclick="twitterWarningOnClick();">
												Save Changes
											</a>
										</div>
									</div>
										
								</h:panelGroup>
							</h:form>
						</div>
					</div>
				</div>
				<div class="col-md-4">
					<div class="whiteBox yourPhotoBox">
						<h2>Your Photo</h2>

						<div class="clear"></div>

						<h:form id="settingsAvatarForm">
							<p:growl id="settingsAvatarFormGrowl" showDetail="true" enctype="multipart/form-data" />
							
							<h:panelGroup layout="block" id="avatar" class="avatar">
								<h:panelGroup layout="block" id="displayAvatar" class="#{profileSettings.newAvatar != null ? 'hidden' : ''}">

									<div class="yourPhotoContent">
										<h:graphicImage styleClass="img-circle"
											rendered="#{not empty profileSettings.accountData.avatarUrl}"
											width="100" height="100" alt=""
											value="#{profileSettings.accountData.avatarUrl}" />

										<h:panelGroup
											rendered="#{empty profileSettings.accountData.avatarUrl}"
											class="letterAvatar letterAvatar100 img-circle">
											#{util:initials(profileSettings.accountData.name.concat(" ").concat(profileSettings.accountData.lastName))}
										</h:panelGroup>

										<div class="chooseBtnBox">
											<utilcomp:simpleFileUpload id="avatarFileUpload"
																	   fileUploadListenerMethodName="handleFileUpload"
																	   fileUploadListenerMethod="#{profileSettings.handleFileUpload}"
																	   toUpdate=":#{cc.clientId}:settingsAvatarForm:editAvatar :#{cc.clientId}:settingsAvatarForm:displayAvatar"
																	   uploadButtonStyle="btn btn-green"
																	   fileSizeValidationMessageContainer="#avatarFileUploadValidation"
																	   allowTypes="gif|jpe?g|png"/>

											<small id="avatarFileUploadValidation" class="redText displayBlock"></small>
											<div class="clear"></div>
											<small>GIF, JPG or PNG,<br />Min 400x400 px.</small>
										</div>
									</div>
								</h:panelGroup>

								<h:panelGroup layout="block" id="editAvatar" class="#{profileSettings.newAvatar == null ? 'hidden' : ''}">
									<div class="second">
										<div class="cropperContainer">
											<div id="croppedImage"></div>
										</div>

										<div class="clear"></div>
										
										<div class="cropButtons">
											<p:commandLink styleClass="btn btn-green btn-sm" value="Crop and Save"
												onclick="$('.avatar .hiddenCoordinates').val(ic.getInfo().t+'_'+ic.getInfo().l+'_'+ic.getInfo().w+'_'+ic.getInfo().h);"
												action="#{profileSettings.crop()}"
												process="hiddenCoordinates"
												update=":#{cc.clientId}:settingsAvatarForm:avatar :#{cc.clientId}:settingsAvatarForm:settingsAvatarFormGrowl :userMenuForm" />
	
											<p:commandLink styleClass="btn btn-default btn-sm" value="Cancel"
												action="#{profileSettings.cancelCrop()}"
												update=":#{cc.clientId}:settingsAvatarForm:avatar" />
										</div>

										<h:inputText id="hiddenCoordinates" class="hiddenCoordinates"
											style="display:none;"
											value="#{profileSettings.cropCoordinates}" />

										<script type="text/javascript">
										var ic = new ICropper('croppedImage',{
											minWidth: 100,
											minHeight: 100,
											keepSquare: true,
											image: '#{profileSettings.newAvatar}'
										});
										</script>
									</div>
								</h:panelGroup>
								
								<script>
									$('.avatar').fadeIn();
									roundImages();
								</script>
							</h:panelGroup>
						</h:form>
					</div>
				</div>
			</div>
		</div>
		
		<h:form id="formTwitterWarning">
	    	<div class="modal fade removeInstructorModal" id="twitterWarning" tabindex="-1" role="dialog">
	          <div class="modal-dialog" role="document">
	              <div class="modal-content">
	                  <div class="modal-header">
	                      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&#215;</span></button>
	                      <h2 class="modal-title" id="removeInst1">Change Twitter Profile URL?</h2>
	                  </div>
	                  <div class="modal-body">
	                      <p>Your Twitter account is connected to ProSolo. If you change your Twitter profile URL, you will need to connect the new account to ProSolo. Are you sure you want to continue?</p>
	                  </div>
	                  <div class="modal-footer">
	                  	  <h:inputHidden id="twitterProfileUrl" value="#{profileSettings.userSocialNetworksData.socialNetworkAccountsData['TWITTER'].linkEdit}" />
	                  	  <p:commandLink
	                  	  	value="Save Changes"
	                  	  	styleClass="btn btn-green"
	                  	  	actionListener="#{twitterBean.disconnectUserAccount(false)}"
	                  	  	action="#{profileSettings.saveSocialNetworkChanges}"
							update=":#{cc.clientId}:socialNetworksSettingsForm:settingsSocialNetworksGrowl #{cc.clientId}:socialNetworksSettingsForm:twitter #{cc.attrs.toUpdate}"
	                  	  	oncomplete="$('#twitterWarning').modal('hide');">
	                  	  </p:commandLink>
	                      <p:commandLink 
	                      	styleClass="btn btn-default" 
	                      	process="@this"
	                      	update="#{cc.clientId}:socialNetworksSettingsForm:twitterProfileUrl"
	                      	oncomplete="$('#twitterWarning').modal('hide');">
	                      	Cancel
	                      </p:commandLink>
	                  </div>
	              </div>
	          </div>
	      </div>
	    </h:form>
	</composite:implementation>
</ui:component>