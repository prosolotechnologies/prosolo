<ui:composition
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:p="http://primefaces.org/ui">

	<div class="clear"></div>

	<h:form>
		<p:dataTable var="report"
			value="#{activityReportArchiveBean.getAll()}" paginator="true"
			rows="5" effectSpeed="fast"
			paginatorTemplate="{PreviousPageLink} {CurrentPageReport} {NextPageLink} {RowsPerPageDropdown}"
			rowsPerPageTemplate="10, 20, 56" type="none"
			paginatorPosition="bottom">
			<f:facet name="header">Prosolo Weekly Activity Archives. Found #{activityReportArchiveBean.getSize()} archives.</f:facet>

			<p:column>
				<f:facet name="header">From</f:facet>
				#{report.getFrom()}
			</p:column>
			<p:column>
				<f:facet name="header">To</f:facet>
				#{report.getTo()}
			</p:column>
			<p:column>
				<f:facet name="header">Archive Link</f:facet>
				<h:outputLink value="#{report.getURL()}">Download</h:outputLink>
			</p:column>
		</p:dataTable>
	</h:form>

	<script>
		var listLoaded = false;
		
		$(function(){
			$('.viewButton').on('click', function() {
				if ($(this).hasClass('gray')) {
					$('.viewButton').toggleClass('gray').toggleClass('green');
					$('.view').toggleClass('hidden');
					
					if ($(this).hasClass('listViewButton')) {
						if (!listLoaded) {
							$('.listView .initialize').trigger('click');
							listLoaded = true;
						}
					}
				}
			});
		});
	</script>
	
	<c:if test="#{loggeduser.user.system}">
		<div class="separator"></div>
		<h3 style="margin-bottom: 0px; color: red">Only system user available action. Use this only if you know what you are doing.</h3>
					
		<h:panelGroup layout="block" class="left" id="updateFeedsPanel">
	
			<h:form>
				<div class="row info">
					<div class="second">
						<h:commandLink value="Batch Generate Activity Reports"
							class="button size30 green left">
							<f:ajax event="click"
								listener="#{activityReportTestBean.testBatchGenerateActivityReports()}" />
						</h:commandLink>
					</div>
				</div>
				
				<div class="row info">
					<div class="first bold"></div>
					<div class="loaderContainer"></div>
				</div>
				
				<div class="row info">
					<div class="second"></div>
				</div>
			</h:form>
			
			<script>
			$(function() {
				if (#{feedsBean.initialisedAggregation}) {
					$('.loaderContainer').html('<img class="loader center" src="#{request.contextPath}/resources/images/style/ajax-loader-black.gif"/>').show();
				}
			});
			</script>
		</h:panelGroup>
	</c:if>

</ui:composition>