<ui:component
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:func="http://org.prosolo/functions"
	xmlns:comp="http://java.sun.com/jsf/composite/components"
	xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:link="http://java.sun.com/jsf/composite/components/resourceLinks"
	xmlns:icon="http://java.sun.com/jsf/composite/components/resourceLinks/icons"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util"
	xmlns:course="http://java.sun.com/jsf/composite/components/courses">
	
	<!-- actionBean: this bean must have a method 'void connectCompetence(Competence)' -->
	
	<composite:interface>
		<composite:attribute name="regionToUpdate" />
		<composite:attribute name="actionLinkName" default="Connect" />
		<composite:attribute name="competencesAlreadyAdded" type="java.util.List" />
		<composite:attribute name="actionBean" required="true" />
	</composite:interface>
	
	<composite:implementation > 
		<div id="allCompetencesModalDialog" title="Browse competences" class="allCompetencesModalDialog" style="display: none;">
		
			<h:form id="allCompetencesFormId" prependId="false" class="allCompetencesForm">
			
				<h:panelGroup layout="block" id="allCompetencesResultPanelContent" class="listAllSearchContainer">
					<div class="bold right">#{searchCompetencesBean.pageProgressTitle}</div>
					
					<ui:repeat value="#{searchCompetencesBean.pageCompetences}" var="compData">
						<div class="searchRecord">
							<div class="image">
								<icon:competence />
							</div>
		
							<div class="info">
								<div class="title">#{compData.title}</div>
								
								<course:compStatus 
									competenceId="#{compData.id}"
									styleClass="right"
									updateOnAddToGoal=":#{p:component('addToGoalForm')}" />
		
								<h:panelGroup layout="block" rendered="#{!empty compData.creator}">
									Creator:
									
									<link:user value="userDetailsImage" 
					    				user="#{compData.creator}"
					    				mode="name"
					    				imageSize="22"
					    				divClass="bold"
					    				idPrefix="compSearchCreator#{iterator.index}" 
					    				context="competences.name"/>
								</h:panelGroup>
								
								<div class="membersCount">
									#{competencesSearchBean.getCompetenceUsersNumber(compData.competence)}
								</div>
							
								<div class="actions">
									<link:competence
										resource="#{compData.competence}"
										title="Details"
										type="Competence"
										context="allCompetencesDialog" />
		
									<span class="bullet"></span>
									
									<p:commandLink rendered="#{!cc.attrs.competencesAlreadyAdded.contains(compData.id)}"
										value="#{cc.attrs.actionLinkName}"
										onclick="$('#allCompetencesModalDialog').dialog('close');"
										action="#{cc.attrs.actionBean.connectCompetence(compData.competence)}"
										update="#{cc.attrs.regionToUpdate}"
									/>
									<h:outputText rendered="#{cc.attrs.competencesAlreadyAdded.contains(compData.id)}"
										class="textGray"
										value="Added"
									/>
								</div>
								
							</div>
						</div>
					</ui:repeat>
					
					<div class="clear"></div>
					
					<div class="searchCompetencesNav">
						<p:commandLink value="Next"
							styleClass="nextlink button gray size16 right"
							rendered="#{searchCompetencesBean.hasMoreCompetences()}"
							actionListener="#{searchCompetencesBean.nextPage}"
							update=":#{p:component('allCompetencesFormId')}"
						/>
						
						<p:commandLink value="Prev" 
							styleClass="prevlink button gray size16 left marginRight10"
							rendered="#{searchCompetencesBean.hasPrevCompetences()}"
							actionListener="#{searchCompetencesBean.prevPage}"
							update=":#{p:component('allCompetencesFormId')}"
						/>
					</div>
					
					<utilcomp:tooltip target=".hasTooltip[title]" />
				</h:panelGroup>
			</h:form>
			
			<script>
			$(function() {
				$('#allCompetencesModalDialog').dialog({
					autoOpen: false,
					width: 450,
					show: 'slide',
					resizable: false,
					modal: true,
					open: function(event, ui) { 
						$(this).children(':first')
							.css('text-align', 'center')
							.css('padding-top', '50px')
							.html('<img src="#{request.contextPath}/resources/images/style/ajax-loader-black.gif" style="vertical-align:middle;"/>');
					}
				});
				$('#allCompetencesModalDialog').show();
			});
			</script>
		</div>
	</composite:implementation>
</ui:component>