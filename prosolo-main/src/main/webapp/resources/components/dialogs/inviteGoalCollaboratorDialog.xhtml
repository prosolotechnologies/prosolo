   <ui:composition
   	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:dlg="http://java.sun.com/jsf/composite/components/dialogs"
	xmlns:link="http://java.sun.com/jsf/composite/components/resourceLinks"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util">
	
	<utilcomp:messagesBundle var="msg" />
	
    <div id="inviteGoalCollaboratorDialog" class="userSearchInput inviteGoalCollaboratorDialog" title="Invite Collaborators" style="display: none;">
    	
	    <h:form id="inviteGoalCollaboratorDialogForm">
	    	<p:growl id="inviteGoalCollaboratorDialogGrowl" showDetail="true" />
	    
	    	<p class="text">
		    	#{msg['dialog.inviteGoalCollaborator.info']}
	    	</p>
	    	
	    	<utilcomp:userInputField id="inviteGoalCollaboratorsSearch"
	    		users="#{inviteGoalCollaboratorDialog.collabratorsToInvite}"
	    		toExcludeIds="#{inviteGoalCollaboratorDialog.toExcludeIds}"
	    		keywordHolder="#{inviteGoalCollaboratorDialog.keyword}"
	    		actionBean="#{inviteGoalCollaboratorDialog}"
	    		searchResult="#{inviteGoalCollaboratorDialog.userSearchResults}"
	    		regionToUpdateOnRemove=":inviteGoalCollaboratorDialogForm:actions :inviteGoalCollaboratorDialogForm:recommendedCollaboratorsPanel"
	    		regionToUpdateOnAdd=":inviteGoalCollaboratorDialogForm:actions :inviteGoalCollaboratorDialogForm:recommendedCollaboratorsPanel" />
	    	
			<div class="clear"></div>
			
			<table class="invitedContainer">
				<tr>
					<td class="collaborators">
						Your collaborators:
				
						<ul class="users">
							<ui:repeat value="#{inviteGoalCollaboratorDialog.existingCollaborators}" var="user" varStatus="iterator">
								<li>
						    		<link:user value="collabImage" 
					    				userData="#{user}"
					    				mode="imageName"
					    				imageSize="22"
					    				idPrefix="collaboratorInviteImageName#{iterator.index}"
					    				context="learn.targetGoal.#{learninggoals.selectedGoalData.data.targetGoalId}.inviteCollaborator.collaborators.imageName"/>
								</li>
							</ui:repeat>
						</ul>
						
						<h:panelGroup rendered="#{empty inviteGoalCollaboratorDialog.existingCollaborators}"
							class="noContentMessage">
							#{msg['dialog.inviteGoalCollaborator.noCollaborators']}
						</h:panelGroup>
					</td>
					<td class="waitingForResponse">
						Still waiting for a response from:
				
						<ul class="users">
							<ui:repeat value="#{inviteGoalCollaboratorDialog.invitedUsers}" var="user" varStatus="iterator">
								<li>
									<link:user value="collabImage" 
					    				userData="#{user}"
					    				mode="imageName"
					    				imageSize="22"
				    					idPrefix="invitedCollabInviteImageName#{iterator.index}"
				    					context="learn.targetGoal.#{learninggoals.selectedGoalData.data.targetGoalId}.inviteCollaborator.waitingForResponse.imageName"/>
			    				</li>
							</ui:repeat>
						</ul>
						
						<h:panelGroup rendered="#{empty inviteGoalCollaboratorDialog.invitedUsers}"
							class="noContentMessage">
							#{msg['dialog.inviteGoalCollaborator.noInvitedUsers']}
						</h:panelGroup>
					</td>
				</tr>
			</table>
			<div class="clear marginBottom10"></div>

			<strong>Recommended collaborators: <utilcomp:infotooltip position="RECOMMENDED_COLLEAGUES" context="learn.targetGoal.#{learninggoals.selectedGoalData.data.targetGoalId}.inviteCollaborator" /></strong>
				
			<h:panelGroup layout="block" class="recommendedCollaborators" id="recommendedCollaboratorsPanel">
				<h:panelGroup rendered="#{empty inviteGoalCollaboratorDialog.recommendedCollaboratorsEdit}" styleClass="noContentMessage">
					No recommendations.
				</h:panelGroup>
				
				<ui:repeat value="#{inviteGoalCollaboratorDialog.recommendedCollaboratorsEdit}"
					var="recommendedUser" id="recommendedUsersList"	varStatus="loop">

					<div class="collaborator">
						<link:user value="goalCollaborators" 
		    				userData="#{recommendedUser}"
		    				idPrefix="recommendedCollaborator#{loop.index}image"
		    				mode="image"
		    				imageSize="30"
		    				styleClass="name"
		    				context="learn.targetGoal.#{learninggoals.selectedGoalData.data.targetGoalId}.inviteCollaborator.recommendedCollaborators.image"/>
						
						<div class="info">
							<link:user value="userDetails" 
			    				userData="#{recommendedUser}"
			    				divClass="name"
			    				mode="name"
			    				idPrefix="recommendedCollaborator#{iterator.index}name"
			    				context="learn.targetGoal.#{learninggoals.selectedGoalData.data.targetGoalId}.inviteCollaborator.recommendedCollaborators.name"/>
			    				
							<div class="font11">#{recommendedUser.position}</div>
							
							<div class="action">
								<p:commandLink id="inviteButton" value="Invite"
									onclick="$('#invitationToJoinGoalModalDialog').dialog('open');"
									action="#{inviteGoalCollaboratorDialog.addUser(recommendedUser)}"
									update=":inviteGoalCollaboratorDialogForm:inviteGoalCollaboratorsSearch:searchInputDiv 
											:inviteGoalCollaboratorDialogForm:actions"
								/>
								
								<ui:remove>
								<span class="bullet"></span>
								
								<p:commandLink id="recommendButton" value="Recommend"
									onclick="openGoalRecommendationDialog();"
									action="#{recommendLearningGoalBean.init(recommendedUser)}"
								/>
								</ui:remove>
							</div>
						</div>
					</div>
				</ui:repeat>
				
				<script>
					roundImages();
					$('.recommendedCollaborators').fadeIn();
				</script>
				<utilcomp:tooltip target=".hasTooltip[title]" />
			</h:panelGroup>
			
			<div class="clear"></div>
			
		    <div class="message">
		    	Message:
		    	<br/>
		    	<h:inputTextarea value="#{inviteGoalCollaboratorDialog.message}"
		    		placeholder="#{msg['textarea.message']}" />
		    </div>
		    
			<input type="text" class="id" style="display: none;" value="#{learninggoals.selectedGoalData.data.targetGoalId}" />
		    
		    <h:panelGroup layout="block" id="actions" class="actions">
			    <p:commandLink
					value="Submit"
					rendered="#{not empty inviteGoalCollaboratorDialog.collabratorsToInvite}"
					styleClass="button green size30 right"
					onclick="$('#inviteGoalCollaboratorDialog').dialog('option', 'submit', true);$('#inviteGoalCollaboratorDialog').dialog('option', 'fireCloseHandler', false ).dialog('close');"
					action="#{inviteGoalCollaboratorDialog.sendGoalInvites()}"
					update=":inviteGoalCollaboratorDialogForm" />
					
			    <p:commandLink value="Submit"
					rendered="#{empty inviteGoalCollaboratorDialog.collabratorsToInvite}"
					styleClass="button gray size30 right disabled hasTooltip"
					title="#{msg['dialog.inviteGoalCollaborator.submit.disabled.tooltip']}" />
				
				<a href="#" class="button gray size30 right"
					onclick="$('#inviteGoalCollaboratorDialog').dialog('close');">Cancel</a>
					
				<utilcomp:tooltip target=".hasTooltip[title]" />
		    </h:panelGroup>
		    
		    <p:commandLink styleClass="resetForm" 
		    	style="display: none;" 
		    	action="#{inviteGoalCollaboratorDialog.initEvaluatorsList()}" 
		    	update=":inviteGoalCollaboratorDialogForm" />
	    	
			<script>
			$(function() {
				$('.searchInputDiv').on('click', function(e) {
					$(this).find('input').focus();
				});
			});
			$('#inviteGoalCollaboratorDialog .message textarea').autosize(); 
			$('#inviteGoalCollaboratorDialog .search .searchInputDiv input').autoGrowInput({comfortZone: 10});
			</script>
		</h:form>
		
		<script>
		$(function() {
			$('#inviteGoalCollaboratorDialog').dialog({
				autoOpen: false,
				show: 'slide',
				width: 500,
				modal: true,
				resizable: false,
				open: function(event, ui) { 
					$(this).children(':first')
						.css('text-align', 'center')
						.css('padding-top', '50px')
						.html('<img src="#{request.contextPath}/resources/images/style/ajax-loader-black.gif" style="vertical-align:middle;"/>');
				},
				close: function() {
					var submitted = $(this).dialog('option', 'submit');
					
					if (!submitted) {
						var id = $('#inviteGoalCollaboratorDialog .id').val();
						sendServiceUse('MOUSE_CLICK', {context: 'learn.targetGoal.'+id+'.inviteCollaborator', link: 'cancel', 'targetGoalId' : id});
					}
					
					$(this).dialog('option', 'submit', false);
				}
			});
			$('#inviteGoalCollaboratorDialog').show();
		});
		</script>
	</div>
</ui:composition>