<ui:component
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:comp="http://java.sun.com/jsf/composite/components"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util"
	xmlns:link="http://java.sun.com/jsf/composite/components/resourceLinks">

	<composite:interface>
		<composite:attribute name="dialogTitle" required="false" default="Create new competence"/>
		<composite:attribute name="compData" required="true"/>
		<composite:attribute name="regionToUpdate" required="false" />
		<composite:attribute name="mode" required="false" default="USER" />
		<composite:attribute name="context" />
		<composite:attribute name="updateCompetenceAction"
			method-signature="void saveCompetence()"
			required="true"/>
	</composite:interface>
	
	<composite:implementation>
		<h:outputScript library="javascript" name="prosolo.tags.js" target="head"/>
		
		<utilcomp:messagesBundle var="msg" />
		
	    <div id="newCompFormModalDialog" style="display: none;">
	    
			<h:form id="newCompForm" class="newCompForm">
				<p:growl id="newCompFormGrowl" showDetail="true" />
			
				<table>
					<tr>
						<td>
							<label for="compName">Name:</label>
						</td>
						<td>
							<h:inputText id="compName" class="compName" 
								placeholder="#{msg['textfield.title']}"
								value="#{cc.attrs.compData.title}" />
						</td>
					</tr>
					<tr class="description">
						<td class="label">
							<label for="compDescription">Description:</label>
						</td>
						<td>
							<h:inputTextarea id="compDescription" 
								value="#{cc.attrs.compData.description}"
								placeholder="#{msg['textarea.description']}" />
						</td>
					</tr>
					<tr class="validity">
						<td>
							<label for="validityPeriod">Validity:</label>
						</td>
						<td>
							<h:inputText id="validityPeriod" value="#{cc.attrs.compData.validity}" />&#160;month(s)
						</td>
					</tr>
					<tr class="validity">
						<td>
							<label for="duration">Duration:</label>
						</td>
						<td>
							<h:inputText id="duration" value="#{cc.attrs.compData.duration}" />&#160;day(s)
						</td>
					</tr>
					<tr>
						<td class="col01 keywords">Keywords:</td>
						<td class="col02">
							<h:inputText class="tagsEditMode" value="#{cc.attrs.compData.tagsString}" />
							<span class="noContentMessage block">HINT: keywords must be separated with a comma (,)</span>
						</td>
					</tr>
				</table>
				<div class="clear"></div>
				
				<h:panelGroup rendered="#{cc.attrs.mode == 'MANAGER'}" class="managerOptions">
					<div class="prerequisiteCompsContainer">
						Prerequisite competences: 
						<utilcomp:infotooltip position="PREREQUISITE_COMPETENCES" />
						
						<comp:searchCompetences value="prerequisiteComps"
							id="prerequisiteComps"
							container=".prerequisiteCompsContainer"
							regionToRenderOnAction=":#{p:component('prerequisiteList')}"
							actionBean="#{competenceDialogPrerequisite}"
							excludeAddedCompetences="false" />
							
						<h:panelGroup layout="block" id="prerequisiteList" class="prerequisiteComps">
							<ul>
								<ui:repeat value="#{cc.attrs.compData.prerequisites}" var="prerequisite" varStatus="iterator">
									<li>
										<link:competence 
											resource="#{prerequisite}"
											type="Competence"
											title="#{prerequisite.title}"
											styleClass="title" 
											context="newCompetence"/>
											
										<p:commandLink styleClass="iconRemove" 
											action="#{competenceDialog.removePrerequisite(prerequisite)}"
											update=":#{p:component('prerequisiteList')}"/>
									</li>
								</ui:repeat>
							</ul>
						</h:panelGroup>
					</div>
					<div class="corequisiteCompsContainer">
						Corequisite competences:
						<utilcomp:infotooltip position="COREQUISITE_COMPETENCES" />
						
						<comp:searchCompetences value="corequisiteComps"
							id="corequisiteComps"
							container=".corequisiteCompsContainer"
							regionToRenderOnAction=":#{p:component('corequisiteList')}"
							actionBean="#{competenceDialogCorequisite}"
							excludeAddedCompetences="false" />
							
						<h:panelGroup layout="block" id="corequisiteList" class="corequisiteComps">
							<ul>
								<ui:repeat value="#{cc.attrs.compData.corequisites}" var="corequisite" varStatus="iterator">
									<li>
										<link:competence 
											resource="#{corequisite}"
											type="Competence"
											title="#{corequisite.title}"
											styleClass="title" 
											context="newCompetence"/>
											
										<p:commandLink styleClass="iconRemove"
											action="#{competenceDialog.removeCorequisite(corequisite)}"
											update=":#{p:component('corequisiteList')}"/>
									</li>
								</ui:repeat>
							</ul>
						</h:panelGroup>
					</div>
				</h:panelGroup>
				<div class="clear"></div>
				
				<p:commandLink value="Save"
					id="save"
					styleClass="button green size30 right"
					onclick="$('#newCompFormModalDialog').dialog('close');"
				 	action="#{cc.attrs.updateCompetenceAction}"
					update="#{cc.attrs.regionToUpdate}">
					<f:param name="context" value="#{cc.attrs.context}" />
				</p:commandLink>
				&#160;
				<p:commandLink value="Cancel"
					styleClass="button gray size30 right"
					onclick="$('#newCompFormModalDialog').dialog('close');" />
					
				<p:defaultCommand target=":#{cc.clientId}:newCompForm:save" />
					
				<script>
				$(function() {
					$('.newCompForm tr.description textarea').autosize();
					$('.newCompForm .compName').focus();
					$('.newCompForm .tagsEditMode').tags();
				});
				</script>
				<utilcomp:tooltip target=".hasTooltip[title]" />
			</h:form>
		</div>
		<script>
		$(function() {
			$('#newCompFormModalDialog').dialog({
				title: '#{cc.attrs.dialogTitle}',
				autoOpen: false,
				show : 'slide',
				width: 630,
				modal: true,
				resizable: false,
				open: function(event, ui) { 
					$(this).children(':first')
						.css('text-align', 'center')
						.css('padding-top', '50px')
						.html('<img src="#{request.contextPath}/resources/images/style/ajax-loader-black.gif" style="vertical-align:middle;"/>');
				},
			});
			$('#newCompFormModalDialog').show();
		});
		</script>
	</composite:implementation>
</ui:component>