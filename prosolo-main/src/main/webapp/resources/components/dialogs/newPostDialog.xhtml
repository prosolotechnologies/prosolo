<ui:composition
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:post="http://java.sun.com/jsf/composite/components/post"
	xmlns:socialWall="http://java.sun.com/jsf/composite/components/socialWall"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util"
	xmlns:link="http://java.sun.com/jsf/composite/components/resourceLinks">
	
	<utilcomp:messagesBundle var="msg" />
	
	<h:outputScript library="javascript" name="jquery.shortenedText.js" target="head"/>
	<div id="newPostDialog" title="Post to my Status Wall" class="newPostDialog" style="display: none;">
    
		<h:form id="newPostDialogForm" class="newPostDialogForm">
			<p:growl id="newPostDialogFormGrowl" showDetail="true" />
			
			<h:panelGroup layout="block" class="postInputBox"
				rendered="#{postDialogBean.newPostData != null}">
				
				<h:panelGroup rendered="#{postDialogBean.sharedFrom != null}">
					Sharing post from:
				
					<link:user value="sharedFrom" 
	    				userData="#{postDialogBean.sharedFrom}"
	    				mode="name"
	    				idPrefix="newPostDialog"
	    				context="#{postDialogBean.context}.postDialogBean.sharedFrom" />
    			</h:panelGroup>
				
				<post:newpostNoForm value="statusUpdateDialog" id="statusUpdateDialog" 
					content="#{postDialogBean.newPostData}" 
					createPostAction="#{postDialogBean.createNewPost()}"
					handleFileUpload="#{postDialogBean.handleFileUpload}"
					containerDiv=".newPostDialogForm"
					afterCreatePostCallback="$('#newPostDialog').dialog('close');#{postDialogBean.onComplete};"
					watermark="Write something..."
					regionToRefresh=":newPostDialogForm:newPostDialogFormGrowl :#{p:component('addToGoalForm')}" 
					service="name:POST_DIALOG" />
					
			</h:panelGroup>
				
			<h:panelGroup layout="block" rendered="#{postDialogBean.attachPreview != null}" class="resourcePreviewBox">
				<h:inputTextarea class="textInput" placeholder="Write something..." value="#{postDialogBean.text}" />
				<script>
					$('.newPostDialogForm .resourcePreviewBox .textInput').focus();
				</script>
	
				<div class="postBlock">
					<socialWall:attachmentPreview
						uniqueParentSelector="#newPostDialog"
						attachmentPreview="#{postDialogBean.attachPreview}" />
				</div>
				
				<script>
					var urlLength = #{postDialogBean.attachPreview != null ? 45 : 65};
					$('.postBlock .richContent .atcUrl').shortenedText({showChar: urlLength, mode: 'static'});
					$('.postBlock .richContent .atcDesc').shortenedText({showChar: 250, mode: 'link'});
				</script>
	            
	            <p:commandLink
					value="Post"
					styleClass="button green size30 right"
					onclick="$('#newPostDialog').dialog('close');"
					action="#{postDialogBean.createNewPost}"
					oncomplete="#{postDialogBean.onComplete}"
					update=":newPostDialogForm:newPostDialogFormGrowl :#{p:component('addToGoalForm')}"
				/>
					
				<a class="button gray size30 right" onclick="$('#newPostDialog').dialog('close');">Cancel</a>
			</h:panelGroup>
		</h:form>
	</div>
	
	<script>
	$(function() {
		$('#newPostDialog').dialog({
			autoOpen: false,
			show : 'slide',
			width: 450,
			modal: true,
			resizable: false,
			open: function(event, ui) { 
				$(this).children(':first')
					.css('text-align', 'center')
					.css('padding-top', '50px')
					.html('<img src="#{request.contextPath}/resources/images/style/ajax-loader-black.gif" style="vertical-align:middle;"/>');
			},
		});
		$('#newPostDialog').show();
	});
	</script>
</ui:composition>