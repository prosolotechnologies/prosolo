<ui:component
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:func="http://org.prosolo/functions"
	xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:post="http://java.sun.com/jsf/composite/components/post"
	xmlns:comp="http://java.sun.com/jsf/composite/components"
	xmlns:dlg="http://java.sun.com/jsf/composite/components/dialogs">

	<composite:interface>
		<composite:attribute name="newActivityData" />
		<composite:attribute name="createActivityAction"
			method-signature="void createNewPost()" />
		<composite:attribute name="handleFileUpload"
			method-signature="void handleFileUpload(org.primefaces.event.FileUploadEvent)" />
		<composite:attribute name="activityToRemoveHolder" />
		<composite:attribute name="removeActivityAction"
			method-signature="void removeActivity()" />
	</composite:interface>
	
	<composite:implementation>
	
		<div id="#{cc.attrs.value}ActivityListFormModalDialog" class="activityListForm" title="Activities" style="display: none;">
								
			<h:form id="activityListForm" class="activityListForm">
				<p:growl id="activityListGrowl" showDetail="true" />
	
				<h:panelGroup layout="block" rendered="#{activityListDialog.editable}">
					<div class="marginTop10 marginBottom10">
					
						<p:commandLink styleClass="button blue size25 left"
							value="New Activity"
							onclick="$('#newActivityForActivityListFormModalDialog').dialog('open');"
							update=":exCredit:newActivityForActivityList:newActivityForm"
							oncomplete="newActivityForActivityListcreateNewActivityNewPost.expandPostInput();"
						/>
						
						<span class="searchText">
							or search
						</span>
						
						<comp:searchActivities value="exCredActivityList"
							container=".activityListForm"
							actionLinkName="Add"
							actionBean="#{portfolio}"
							toExcludeIds="#{portfolio.getAllActivitiesIds()}"
							regionToRenderOnAction=":#{p:component('activityListForm')}"
							context="#{activityListDialog.context}"
						/>
					</div>
					<div class="clear marginBottom10"></div>
				
					<ui:remove>
						<post:newpostNoForm value="newCreditActivity"
							content="#{cc.attrs.newActivityData}" 
							createPostAction="#{cc.attrs.createActivityAction}"
							handleFileUpload="#{cc.attrs.handleFileUpload}"
							containerDiv="##{cc.attrs.value}ActivityListFormModalDialog"
							regionToRefresh=":#{p:component('activityListForm')}"
							actionButtonName="Add"
							watermark="Add activity..."
							context="#{activityListDialog.context}" />
					</ui:remove>
				</h:panelGroup>
				
				<h:panelGroup layout="block" rendered="#{!activityListDialog.editable}">
					<comp:planused
						id="exCreditActivities"
						parentid="#{cc.attrs.value}ActivityListFormModalDialog"
						activities="#{activityListDialog.activities}"
						cantdisplaymessage="No activities added."
						width="455"
						context="#{activityListDialog.context}"
					/>
				</h:panelGroup>
				<h:panelGroup layout="block" rendered="#{activityListDialog.editable}">
					<comp:planused
						id="exCreditActivitiesEdit"
						parentid="#{cc.attrs.value}ActivityListFormModalDialog"
						activities="#{activityListDialog.activities}"
						cantdisplaymessage="No activities added."
						removeActivityMethod="#{cc.attrs.removeActivityAction}"
						activityToRemoveHolder="#{cc.attrs.activityToRemoveHolder}"
						width="455"
						context="#{activityListDialog.context}"
					/>
				</h:panelGroup>
				
				<p:commandLink regionToRefresh=":#{p:component('activityListForm')}" actionListener="#{portfolio.resetExCreditAddActivityForm()}" styleClass="reset" style="display:none;" value="reset" />
			</h:form>
		</div>
		<script>
			$(function() {
				$('##{cc.attrs.value}ActivityListFormModalDialog').dialog({
					autoOpen : false,
					show : 'slide',
					width : 500,
					modal : true,
					resizable : false,
				});
				$('##{cc.attrs.value}ActivityListFormModalDialog').show();
			});
		</script>
		
		<c:if test="#{loggeduser != null and loggeduser.loggedIn}">
			<dlg:newActivity id="newActivityForActivityList"
				value="newActivityForActivityList"
				activityData="#{cc.attrs.newActivityData}"
				handleFileUpload="#{cc.attrs.handleFileUpload}"
				regionToUpdate=":#{p:component('activityListForm')}"
				createActivityAction="#{cc.attrs.createActivityAction}" />
		</c:if>
			
	</composite:implementation>
</ui:component>