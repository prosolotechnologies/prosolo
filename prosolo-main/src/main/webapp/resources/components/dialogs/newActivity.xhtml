<ui:component
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:comp="http://java.sun.com/jsf/composite/components"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util"
	xmlns:link="http://java.sun.com/jsf/composite/components/resourceLinks"
	xmlns:post="http://java.sun.com/jsf/composite/components/post">

	<composite:interface>
		<composite:attribute name="dialogTitle" required="false" default="Create new activity" />
		<composite:attribute name="activityData" required="true" />
		<composite:attribute name="regionToUpdate" required="false" />
		<composite:attribute name="createActivityAction"
			method-signature="void saveNewActivity()"
			required="true"/>
		<composite:attribute name="handleFileUpload"
			method-signature="void handleFileUpload(org.primefaces.event.FileUploadEvent)"
		/>
	</composite:interface>
	
	<composite:implementation>
		
		<div id="#{cc.attrs.value}FormModalDialog" style="display: none;">
			<h:form id="newActivityForm" class="newActivityForm">
				<p:growl id="newActivityFormGrowl" showDetail="true" />
				
				<post:newpostNoForm value="#{cc.attrs.value}createNewActivity" 
					id="createNewActivity" 
					handleFileUpload="#{cc.attrs.handleFileUpload}"
					content="#{cc.attrs.activityData}" 
					containerDiv=".newActivityForm"
					watermark="Add activity contents here..."
					hideActions="true"
				/>
					
				<div class="clear"></div>
	
				<div class="marginTop10">
					<p:commandLink value="Save" id="save"
						styleClass="button green size30 right"
						onclick="$('##{cc.attrs.value}FormModalDialog').dialog('close');"
						action="#{cc.attrs.createActivityAction}"
						update="@form newActivityFormGrowl #{cc.attrs.regionToUpdate}" />
					&#160;
					
					<p:commandLink value="Cancel" styleClass="button gray size30 right"
						onclick="$('##{cc.attrs.value}FormModalDialog').dialog('close');" />
				</div>
	
				<p:defaultCommand target=":#{cc.clientId}:newActivityForm:save" />
	
				<script>
				$(function() {
					$('.newActivityForm tr.description textarea').autosize();
					$('.newActivityForm .compName').focus();
					$('.newActivityForm .tagsEditMode').tags();
				});
			 	
			 	$('.newActivityForm .button.uploadFile').on('click', function(e){
			 		e.stopPropagation();
					$('.fileUploadContainer  .browseFile').trigger('click');
				});
			 	</script>
			</h:form>
		</div>
			 
		<script>
		$(function() {
			$('##{cc.attrs.value}FormModalDialog').dialog({
				title: '#{cc.attrs.dialogTitle}',
				autoOpen: false,
				show : 'slide',
				width: 630,
				modal: true,
				resizable: false,
				open: function(event, ui) { 
					$(this).children(':first')
						.css('text-align', 'center')
						.css('padding-top', '50px')
						.html('<img src="#{request.contextPath}/resources/images/style/ajax-loader-black.gif" style="vertical-align:middle;"/>');
				},
			});
			$('##{cc.attrs.value}FormModalDialog').show();
		});
		</script>
	</composite:implementation>
</ui:component>