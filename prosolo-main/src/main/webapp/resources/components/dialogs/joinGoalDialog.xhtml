<ui:composition
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:p="http://primefaces.org/ui"
	xmlns:dlg="http://java.sun.com/jsf/composite/components/dialogs"
	xmlns:link="http://java.sun.com/jsf/composite/components/resourceLinks"
	xmlns:icon="http://java.sun.com/jsf/composite/components/resourceLinks/icons"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util">
	
	<div id="joinGoalFormModalDialog" title="Join Learning Goal" class="deleteCompFormModalDialog joinGoalDialog" style="display: none;">
		<h:form id="joinGoalForm">

			You are invited to join learning goal 
			<link:goal 
				targetGoalId="#{joinGoalDialog.targetGoalToJoinData.id}" 
				title="#{joinGoalDialog.targetGoalToJoinData.title}" 
				context="joinGoalDialog"/> to work with the following collaborators:
				
			<div class="break"></div>
			
			<div class="recommendedCollaborators marginBottom20 inlineBlock marginTop10">
				<ui:repeat value="#{joinGoalDialog.collaborators}" var="collabData" id="collaboratorList" varStatus="iterator">

					<div class="collaborator">
						<link:user value="goalCollaborators" 
		    				userData="#{collabData}"
		    				idPrefix="joinGoalCollaborator#{iterator.index}image"
		    				mode="image"
		    				imageSize="30"
		    				styleClass="name"
		    				context="joinGoalDialog.collaborators.image"/>
						
						<div class="info">
							<link:user value="userDetails" 
			    				userData="#{collabData}"
			    				divClass="name"
			    				mode="name"
			    				idPrefix="joinGoalCollaborator#{iterator.index}name"
			    				context="joinGoalDialog.collaborators.name"/>
			    				
							<div class="font11">#{collabData.position}</div>
						</div>
					</div>
				</ui:repeat>
				
				<script>
					roundImages();
				</script>
			</div>

			<h:panelGroup rendered="#{joinGoalDialog.goalStatus == 'NO_GOAL_COURSE_CONNECTED'}">
				<p>
				This learning goal is connected to a credential. By accepting this invitation to join a goal, you will be enrolled into the credential too.
				</p>
				
				<div class="actions">
					<a class="button gray size30 right"
						onclick="$('#joinGoalFormModalDialog').dialog('close');">Cancel</a>
			
					<p:commandButton value="Ignore"
						styleClass="button blue size30 right"
						onclick="$('#joinGoalFormModalDialog').dialog('option', 'submit', true);$('#joinGoalFormModalDialog').dialog('close');"
					 	action="#{joinGoalDialog.ignore()}"/>
			
					<p:commandButton value="Join"
						styleClass="button green size30 right"
						onclick="$('#joinGoalFormModalDialog').dialog('option', 'submit', true);$('#joinGoalFormModalDialog').dialog('close');"
					 	action="#{joinGoalDialog.accept()}" />
		        </div>
			</h:panelGroup>
			
			<h:panelGroup rendered="#{joinGoalDialog.goalStatus == 'HAS_ACTIVE_COURSE_BASED_GOAL'}">
				<p>
					This learning goal is connected to a credential you are already enrolled to. By accepting this invitation to join a goal, you will leave 
					your current collaborators in order to join this other collaborator group. But, your current learning experience (progress, competences, etc.)  
					will be moved to a new collaborator group.
				</p>
				
				<div class="actions">
					<a class="button gray size30 right"
						onclick="$('#joinGoalFormModalDialog').dialog('close');">Cancel</a>
			
					<p:commandButton value="Ignore"
						styleClass="button blue size30 right"
						onclick="$('#joinGoalFormModalDialog').dialog('option', 'submit', true);$('#joinGoalFormModalDialog').dialog('close');"
					 	action="#{joinGoalDialog.ignore()}"/>
			
					<p:commandButton value="Join"
						styleClass="button green size30 right"
						onclick="$('#joinGoalFormModalDialog').dialog('option', 'submit', true);$('#joinGoalFormModalDialog').dialog('close');"
					 	action="#{joinGoalDialog.accept()}" />
		        </div>
			</h:panelGroup>
			
			<h:panelGroup rendered="#{joinGoalDialog.goalStatus == 'HAS_INACTIVE_COURSE_BASED_GOAL'}">
				<p>
					This learning goal is connected to a credential and we see that you have previously been in it, but are now withdrawn. Nevertheless, you choose to save your learning 
					experience. By choosing the 'Join and restore' option, your previous learning experience (progress, competences, etc.) will be restored.
				</p>
				
				<div class="actions">
					<a class="button gray size30 right"
						onclick="$('#joinGoalFormModalDialog').dialog('close');">Cancel</a>
					 	
				 	<p:commandButton value="Ignore"
						styleClass="button blue size30 right"
						onclick="$('#joinGoalFormModalDialog').dialog('option', 'submit', true);$('#joinGoalFormModalDialog').dialog('close');"
					 	action="#{joinGoalDialog.ignore()}"/>
			
					<p:commandButton value="Join and restore"
						styleClass="button green size30 right"
						onclick="$('#joinGoalFormModalDialog').dialog('option', 'submit', true);$('#joinGoalFormModalDialog').dialog('close');"
					 	action="#{joinGoalDialog.accept()}" />
		        </div>
			</h:panelGroup>
			
			<h:panelGroup rendered="#{joinGoalDialog.goalStatus == 'NO_GOAL_REGULAR'}">
				<div class="actions">
					<a class="button gray size30 right"
						onclick="$('#joinGoalFormModalDialog').dialog('close');">Cancel</a>
					 	
				 	<p:commandButton value="Ignore"
						styleClass="button blue size30 right"
						onclick="$('#joinGoalFormModalDialog').dialog('option', 'submit', true);$('#joinGoalFormModalDialog').dialog('close');"
					 	action="#{joinGoalDialog.ignore()}"/>
			
					<p:commandButton value="Join"
						styleClass="button green size30 right"
						onclick="$('#joinGoalFormModalDialog').dialog('option', 'submit', true);$('#joinGoalFormModalDialog').dialog('close');"
					 	action="#{joinGoalDialog.accept()}" />
		        </div>
			</h:panelGroup>
			
			<input type="text" class="id" style="display: none;" value="#{joinGoalDialog.targetGoalToJoinData.id}" />
	        <input type="text" class="context" style="display: none;" value="#{joinGoalDialog.context}" />
	        
			<script>
				$('#joinGoalFormModalDialog').dialog({
					autoOpen: false,
					show : 'slide',
					width: 630,
					modal: true,
					resizable: false,
					open: function() {
						$(this).children(':first')
							.css('text-align', 'center')
							.css('padding-top', '50px')
							.html('<img src="#{request.contextPath}/resources/images/style/ajax-loader-black.gif" style="vertical-align:middle;"/>');
					},
					close: function() {
						var submitted = $(this).dialog('option', 'submit');
						
						if (!submitted) {
							var id = $('#joinGoalFormModalDialog .id').val();
							var context = $('#joinGoalFormModalDialog .context').val();
							sendServiceUse('MOUSE_CLICK', {context: context+'.joinGoalDialog', link: 'cancel', 'targetGoalId' : id});
						}
						
						$(this).dialog('option', 'submit', false);
					}
				});
				$('#joinGoalFormModalDialog').show();
			</script>
		</h:form>
	</div>
</ui:composition>