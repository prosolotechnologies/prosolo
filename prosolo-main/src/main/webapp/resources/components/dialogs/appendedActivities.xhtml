<ui:component xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:func="http://org.prosolo/functions"
	xmlns:comp="http://java.sun.com/jsf/composite/components"
	xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:dlg="http://java.sun.com/jsf/composite/components/dialogs"
	xmlns:socialWall="http://java.sun.com/jsf/composite/components/socialWall"
	xmlns:link="http://java.sun.com/jsf/composite/components/resourceLinks">

	<composite:interface>
		<composite:attribute name="regionToUpdateAfterConnect" required="false" default="" />
	</composite:interface>
	
	<composite:implementation>
		<div id="appendedActivitiesModalDialog" title="Appended Activities" class="appendedActivities" style="display: none;">
			<h:form id="appendedActivitiesForm" prependId="false">
				<p:growl id="appendedActivitiesGrowl" showDetail="true" />				
				<h:panelGroup styleClass="appendedActivityPanel">
					<ui:repeat value="#{appendedActivitiesBean.appendedPlans}" var="planData" varStatus="iterator">
						<h:panelGroup layout="block" id="post" class="post post#{iterator.index}"
							rendered="#{appendedActivitiesBean.hasPlanDataHasActivities(planData)}">
							<ui:remove>
							<link:user value="userDetails"
								user="#{planData.maker}" mode="image"
								imageSize="30" idPrefix="appendedActMaker#{iterator.index}"
								context="appendedActivities.image" />
								</ui:remove>		
							<div class="postBlock">
							<ui:remove>
								<p class="title">
									<link:user value="userDetails"
										user="#{planData.maker}" mode="name"
										idPrefix="appendedActMakerName#{iterator.index}" 
										context="appendedActivities.name" />
									
									<h:outputText value="added the following activities" />
								</p>
							</ui:remove>
								<ui:repeat value="#{planData.activities}" var="actIterator">
									<div class="activityContainer">
										<h:panelGroup id="appActButtons" styleClass="connectAction">
											<p:commandLink 
												styleClass="#{recommendedplans.doesNotContainActivity(actIterator.object.id) ? 'iconConnect' : 'iconConnectBlue'} hasTooltip"
												title="Connect"
												onclick="$('form.compWallForm a.refreshAllHanler').trigger('click');"
												action="#{compwall.connectActivityById(actIterator.object.id, 'appendedActivitiesDialog')}"
												update=":#{cc.clientId}:appendedActivitiesForm #{cc.attrs.regionToUpdateAfterConnect} ">
											</p:commandLink>
										</h:panelGroup>
										
										<div class="marginBottom10 bold">
											#{actIterator.object.title}
										</div>
								
										<socialWall:attachmentPreview
											uniqueParentSelector="#appendedActivitiesModalDialog .post#{iterator.index}"
											attachmentPreview="#{actIterator.attachmentPreview}" />
									</div>
									
									<div class="clear separator"></div>
								</ui:repeat>
								
								<script>
								$(function() {
									var urlLength = #{actIterator.attachmentPreview != null ? 38 : 65};
									$('.postBlock .richContent .atcUrl').shortenedText({showChar: urlLength, mode: 'static'});
									$('.postBlock .richContent .atcTitle').shortenedText({showChar: urlLength, mode: 'static'});
									$('.postBlock .richContent .atcDesc').shortenedText({showChar: 130, mode: 'link'});
								});
								</script>
							</div>
							
							<div class="clear"></div>
						</h:panelGroup>
					</ui:repeat>
					
					<h:panelGroup layout="block" id="appendedActivitiesButtonPanelId" class="right">
						<h:commandLink id="closeButton" value="Close"
							styleClass="button green size30"
							onclick="$('#appendedActivitiesModalDialog').dialog('close');">
							<f:ajax event="click" onevent="$('form.compWallForm a.refreshAllHanler').trigger('click');" />
						</h:commandLink>
					</h:panelGroup>
				</h:panelGroup>
			</h:form>
		</div>
 
		<script>
		$(function() {
			$("#appendedActivitiesModalDialog").dialog({
				autoOpen : false,
				width : 600,
				modal : true,
				show : 'slide',
				resizable : false,
				open: function(event, ui) { 
					 $(this).children(':first')
					 	.css('text-align','center')
					 	.css('padding-top','50px')
					 	.html('<img src="#{request.contextPath}/resources/images/style/ajax-loader-black.gif" style="vertical-align:middle;"/>');
				}
			});
			$('#appendedActivitiesModalDialog').show();
		});
		</script>
	</composite:implementation>
</ui:component>