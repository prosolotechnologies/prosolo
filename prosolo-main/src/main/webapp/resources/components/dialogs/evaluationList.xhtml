<ui:component
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:comp="http://java.sun.com/jsf/composite/components"
	xmlns:dlg="http://java.sun.com/jsf/composite/components/dialogs"
	xmlns:link="http://java.sun.com/jsf/composite/components/resourceLinks"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util">

	<composite:interface>
		<composite:attribute name="displayDetails" default="true" />
	</composite:interface>
	
	<composite:implementation>
		<utilcomp:messagesBundle var="msg" />
		
		<h:outputScript library="javascript" name="jquery.switchButton.js" />
		<h:outputScript library="javascript" name="prosolo.switchButton.js" />
		<h:outputStylesheet library="css" name="jquery.switchButton.css"  />
	
		<script>
			$(function() {
				$('#evaluationListDialog').dialog({
					autoOpen : false,
					show : 'slide',
					width : 600,
					modal : true,
					resizable : false,
					open : function(event, ui) {
						$(this).children(':first')
							.css('text-align', 'center')
							.css('padding-top', '50px')
							.html('<img src="#{request.contextPath}/resources/images/style/ajax-loader-black.gif" style="vertical-align:middle;"/>');
					}
				});
				$('#evaluationListDialog').show();
			});
		</script>
		
		<div id="evaluationListDialog" title="#{msg['dialog.evaluationList.title']}" style="display: none;">
			<h:form id="evaluationListForm" prependId="false" class="evaluationList">
				<p:growl id="evaluationListDialogGrowl" showDetail="true" />
				
				Assessment list for the 
					<span class="bold">#{evaluationlist.resource.title}</span>:		
				
				<div class="evalutionsContainer">
					<h:panelGroup layout="block" rendered="#{empty evaluationlist.evaluations}" class="noContentMessage marginTop10">
						#{msg['dialog.evaluationList.noEvaluationsMessage']}
					</h:panelGroup>
		
					<ui:repeat value="#{evaluationlist.evaluations}" var="evIterator" id="evalitionListRepeat" varStatus="iterator">
						<div class="evaluation" data-id="#{evIterator.id}">
							<div class="avatar">
								<link:user value="evaluatorAvatar" 
				    				user="#{evIterator.creator}"
				    				mode="image"
				    				imageSize="30"
				    				idPrefix="evaluatorImage#{iterator.index}"
				    				context="evaluationList.image"/>
							</div>
							
							<div class="textWrapper">
								<div class="user">
									<link:user value="userDetails" 
					    				user="#{evIterator.creator}"
					    				divClass="name"
					    				mode="name"
					    				idPrefix="evaluator#{iterator.index}"
					    				context="evaluationList.name"/>
								</div>
								<div class="clear"></div>
								<div class="message">"#{evIterator.message}"</div>
							</div>
	
							<div class="details">
								<h:link value="Details"
									rendered="#{cc.attrs.displayDetails}"
									styleClass="button green size24 detailsBtn" 
									outcome="/evaluation">
									<f:param name="id" value="#{evIterator.evaluationSubmissionId}" />
									<f:param name="origin" value="#{request.requestURI}" />
								</h:link>
								
								<div class="date">#{evIterator.date}</div>
							</div>
	
							<h:panelGroup rendered="#{cc.attrs.displayDetails}" class="accepted right">
								<span class="switchButton">
						    		<h:selectBooleanCheckbox value="#{evIterator.accepted}"
						    			class="acceptedBtn" />
						    			
									<script>
										$('#evaluationListDialog .evaluation .switchButton .acceptedBtn').switchButton({
						    				width: 40,
						    				height: 15,
						    				button_width: 20,
				    						on_label: '', 
				    						off_label: '',
				    						disabled: true,
				    					});
									</script>
					    		</span>
							</h:panelGroup>
							
							<h:panelGroup layout="block" class="badgeContainer">&#160;
								<ui:repeat value="#{evIterator.badges}" var="badge">
									<div class="badgeWrapper">
			    						<h:panelGroup layout="block" styleClass="badge size20 badge#{badge.capitalizedName}" />
					    			</div>
								</ui:repeat>
							</h:panelGroup>
						</div>
					</ui:repeat>
				</div>
				
				<script>
				$(function() {
					roundImages();
					var ev = $('#evaluationListDialog').dialog( "option", "evaluationToHighlight");
					
					// if the number is set, then it is not jQuery object
					if (!(ev instanceof jQuery)) {
						$('#evaluationListDialog .evaluation[data-id='+ev+']').effect("highlight", {}, 3000);
						$('#evaluationListDialog').dialog( "option", "evaluationToHighlight", null);
					}
				});
				</script>
			</h:form>
		</div>
	</composite:implementation>
</ui:component>