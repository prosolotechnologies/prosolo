<ui:component
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:link="http://java.sun.com/jsf/composite/components/resourceLinks"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:post="http://java.sun.com/jsf/composite/components/post">

	<composite:interface>
		<composite:attribute name="uploadFileInfo" default=""/>
		<composite:attribute name="fileUploadListenerMethodName" required="true"/>
		<composite:attribute name="fileUploadListenerMethod" method-signature="void #{cc.attrs.fileUploadListenerMethodName}(
			org.primefaces.event.FileUploadEvent)"/>
		<composite:attribute name="toUpdate" default="" />
		<composite:attribute name="learningContext" default="" />
		<composite:attribute name="service" default="" />
		<composite:attribute name="disabled" type="java.lang.Boolean" default="true"/>
		<composite:attribute name="disabledReason" default=""/>
	</composite:interface>
	
	<composite:implementation>
		<div id="#{cc.clientId}">
			<p:fileUpload id="fileUploadActivity" disabled="#{cc.attrs.disabled}"
   				style="display: none;"
   				styleClass="fileUploadFile"
				fileUploadListener="#{cc.attrs.fileUploadListenerMethod}"  
	            dragDropSupport="true"
	            fileLimit="1"
	        	auto="true"
	            label="Choose a file"
	            update="#{cc.attrs.toUpdate}"
	            onstart="showLoader('#loaderContainerFileUpload');"
	            oncomplete="hideLoader('#loaderContainerFileUpload');">
	        	<f:attribute name="page" value="#{facesContext.viewRoot.viewId}" />
	        	<f:attribute name="learningContext" value="#{cc.attrs.learningContext}" />
	        	<f:attribute name="service" value="#{cc.attrs.service}" />
	        </p:fileUpload>
          	<div class="dropFileDiv uploadResultBox">
          		<h3>#{cc.attrs.uploadFileInfo}</h3>
                <p>Drop file to upload or</p>
                <ui:fragment rendered="#{!cc.attrs.disabled}">
                	<a id="linkTriggerFileUpload" href="javascript:void(0);" class="btn btn-green-stroke btn-sm">Choose from Computer</a>
            	</ui:fragment>
            	<ui:fragment rendered="#{cc.attrs.disabled}">
                	<a id="linkTriggerFileUpload" href="javascript:void(0);" class="btn btn-green-stroke btn-sm" disabled="disabled" data-toggle="tooltip" title="#{cc.attrs.disabledReason}">Choose from Computer</a>
            	</ui:fragment>
            </div>
            <div id="loaderContainerFileUpload"/>
            
            <script>
			 $('.dropFileDiv').on(
					    'dragover',
					    function(e) {
					        e.preventDefault();
					        e.stopPropagation();
					    }
					)
					$('.dropFileDiv').on(
					    'dragenter',
					    function(e) {
					        e.preventDefault();
					        e.stopPropagation();
					    }
					)
				$(".dropFileDiv").on('drop', function(e){
					e.preventDefault();
				    e.stopPropagation();
					if(e.originalEvent.dataTransfer){
						if(e.originalEvent.dataTransfer.files.length) {
							var f = e.originalEvent.dataTransfer.files;
						    $('.fileUploadFile').fileupload('add', {files: f});
						}
					}
				});
			 	$('#' + escapeColons('#{cc.clientId}') + ' #linkTriggerFileUpload').on('click', function(e){
			 		e.stopPropagation();
					$('#' + escapeColons('#{cc.clientId}') + ' .fileUploadFile :input').trigger('click');
				});
			 	
			</script>                 
        </div>
	</composite:implementation>
</ui:component>