<ui:composition
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:link="http://java.sun.com/jsf/composite/components/resourceLinks"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util">

	<utilcomp:messagesBundle var="msg" />

	<div class="pageNavigation">
		<h:form id="navigation">
			
			<div class="controlsContainer">
				<div class="leftRegion">
					<span class="show">SHOW:</span>
					
					<p:commandLink value="Competences"
						styleClass="learnNavItem navItemCompetences learnTripStep10"
						onclick="learnMenuControl.menuItemChange('navItemCompetences');sendServiceUse('MOUSE_CLICK', {context: 'learn.targetGoal.#{learninggoals.selectedGoalData.data.targetGoalId}.navigation', link: 'competences', 'targetGoalId' : '#{learninggoals.selectedGoalData.data.targetGoalId}'});" />
					
					<span class="show marginLeft10">or</span>
						
					<p:commandLink value="Goal Wall"
						styleClass="learnNavItem navItemGoalWall selected learnTripStep8"
						onclick="addLoader('.goalWallForm .goalWall', 'Loading Goal Wall...');learnMenuControl.menuItemChange('navItemGoalWall');sendServiceUse('MOUSE_CLICK', {context: 'learn.targetGoal.#{learninggoals.selectedGoalData.data.targetGoalId}.navigation', link: 'goalWall', 'targetGoalId' : '#{learninggoals.selectedGoalData.data.targetGoalId}'});"
						oncomplete="$('form.goalWallForm a.initializeActivitiesHanler').trigger('click');" />
					
					<script>
						$('.goalsPage .pageNavigation .navItemGoalWall').on('click', function(){
							history.replaceState({}, null, removeQueryParameter('comp'));
							setQueryParam('id', $('.leftNav li.goal.selected').attr('data-id'));
						});
						$('.goalsPage .pageNavigation .navItemCompetences').on('click', function(){
							history.replaceState({}, null, removeQueryParameter('comp'));
						});
					</script>
				</div>
				
				<div class="rightRegion">
					<ul>
						<li id="compNavDrop">
							<a class="goalFilterDrop" href="javascript:void(0);">
								#{msg['goals.navigation.filter.collaborator']}
							</a>
							
							<ui:remove>
							<div class="dropdown hidden">
								<ul>
									<li>
										<a href="javascript:void(0);">
											#{msg['goals.navigation.filter.course']}
										</a>
									</li>
								</ul>
							</div>
							</ui:remove>
						</li>
					</ul>
					
					<span class="avatars learnTripStep7">
						<a href="#" class="leftNavAvatar">
							<span class="leftArrow hover"></span>
						</a>
						
						<div class="avatarList">
							<ui:repeat value="#{learninggoals.collaborators}"
								var="member" id="lGoalMembersList" varStatus="loop" offset="0">
								
								<span class="collaboratorContainer">
									<span class="shade #{goalwall.userFilterData.id == member.id ? 'selected' : ''}">
										<link:user value="goalCollaborators" 
						    				userData="#{member}"
						    				idPrefix="goalCollab#{loop.index}Image"
						    				divClass="collaborator"
						    				mode="image"
						    				imageSize="30"
						    				context="learn.targetGoal.#{learninggoals.selectedGoalData.data.targetGoalId}.collaborators.image"
						    				disableLink="true"
						    				tooltipPosition="top" />
				    				</span>
								</span>
				    			
				    			<p:commandLink style="display: none;"
				    				styleClass="filterGoalWall navigationFilter"
				    				onclick="addLoader('form.goalWallForm .goalWall', 'Loading...')"
				    				action="#{goalwall.setUserFilter(member)}"
				    				process="@this"
				    				update=":collabCompsForm :goalWallTitle"
				    				oncomplete="$('form.goalWallForm a.initializeActivitiesHanler').trigger('click')"
				    				async="true"
				    			/>
				    			
				    			<p:commandLink style="display: none;"
				    				styleClass="compareCompetencesAction navigationFilter"
				    				onclick="addLoader($('.goalsPage .competenceList .comparisonOverlay .collabCompsForm'),'');$('.goalsPage .competenceList .comparisonOverlay').fadeIn()"
				    				action="#{competenceComparisonBean.initCompetences(member, learninggoals.selectedGoalData.data.goalId)}"
				    				process="@this"
				    				update=":collabCompsForm"
				    				async="true"
				    			/>
				    			
				    			<p:commandLink style="display: none;"
				    				styleClass="compareActivitiesAction navigationFilter"
				    				onclick="addLoader('.goalsPage .activities .comparisonOverlay .collabActivitiesForm','');$('.goalsPage .activities .comparisonOverlay').fadeIn();"
				    				action="#{activitiesComparisonBean.initActivities(member, learninggoals.selectedGoalData.data.goalId, learninggoals.selectedGoalData.selectedCompetence)}"
				    				process="@this"
				    				update=":activities:collabActivitiesForm"
				    				async="true"
				    			/>
							</ui:repeat>
							
							<script>
								$('.goalsPage .pageNavigation .shade').on('click', function(e){
									e.stopPropagation();
									
									if (learnMenuControl.selected == "navItemGoalWall") {
										$($(this).parent().nextAll('.filterGoalWall').get(0)).trigger('click');
									} else if (learnMenuControl.selected == "navItemCompetences") {
										$($(this).parent().nextAll('.compareCompetencesAction').get(0)).trigger('click');
									} else if (learnMenuControl.selected == "navItemCompActivities") {
										$($(this).parent().nextAll('.compareActivitiesAction').get(0)).trigger('click');
									} 
								});

								$('.goalsPage .pageNavigation .navigationFilter').on('click', function(e){
									$('.goalsPage .pageNavigation .collaboratorContainer .shade').removeClass('selected');
									$(this).prevAll('.collaboratorContainer').first().find('.shade').addClass('selected');
								});
							</script>
						</div>
						
						<a href="#" class="rightNavAvatar">
							<span class="rightArrow hover"></span>
						</a>
						
						<span class="pager"></span>
					</span>
					<script>
					$(function(){
						$('.avatarList').bxSlider({
							slideWidth: 50,
							slideMargin: 0,
							minSlides: 1,
							maxSlides: 4,
							infiniteLoop: false,
							slideSelector: '.collaboratorContainer',
							prevSelector: '.leftNavAvatar',
							nextSelector: '.rightNavAvatar',
							pagerSelector: '.avatars .pager'
						});
					});
					
					</script>
					
					<p:commandLink styleClass="add iconAddBig"
						onclick="$('#inviteGoalCollaboratorDialog').dialog('open');"
						action="#{inviteGoalCollaboratorDialog.initialize(learninggoals.selectedGoalData)}"
						process="@this"
						update=":inviteGoalCollaboratorDialogForm"
					/>
				</div>
			</div>
			<script>
				$(function() {
					enableDropdown('.pageNavigation .goalFilterDrop');
					roundImages();
				
					learnMenuControl.selected = "#{learn.targetCompId > 0 ? 'navItemCompActivities' : 'navItemCompetences'}";
					learnMenuControl.menuItemChange(learnMenuControl.selected);
				});
				learnMenuControl.selected = "#{learn.targetCompId > 0 ? 'navItemCompActivities' : 'navItemCompetences'}";
				learnMenuControl.menuItemChange(learnMenuControl.selected);
			</script>
		</h:form>
	</div>
</ui:composition>