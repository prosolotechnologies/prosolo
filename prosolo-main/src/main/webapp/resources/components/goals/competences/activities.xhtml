<ui:composition
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:comp="http://java.sun.com/jsf/composite/components"
	xmlns:post="http://java.sun.com/jsf/composite/components/post"
	xmlns:goalcomp="http://java.sun.com/jsf/composite/components/goals"
	xmlns:dlg="http://java.sun.com/jsf/composite/components/dialogs"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util">
	
	<utilcomp:messagesBundle var="msg" />
	
	<div class="learnMenuContent activities" style="display: none;">
		<h:form id="activities" enctype="multipart/form-data">
			<div class="loader hidden"><img src="#{request.contextPath}/resources/images/style/ajax-loader-black.gif"/></div>
				
			<h:panelGroup id="activitiesContent" rendered="#{learninggoals.selectedGoalData.selectedCompetence != null}">
				<script>
					$('#activities .loader').hide();
				</script>
		
				<div class="twoThirdsColumn">
					
					<p:commandLink 
						styleClass="button gray size25 backBtn navItemCompetences marginRight20"
						onclick="learnControl.selectGoal(learnControl.goal);;sendServiceUse('MOUSE_CLICK', {context: 'learn.targetGoal.#{learninggoals.selectedGoalData.data.targetGoalId}.targetComp.#{learninggoals.selectedGoalData.data.targetGoalId}', link: 'back'});"
					 	action="#{learninggoals.selectedGoalData.setSelectedCompetence(null)}"
					 	value="Back" />
					 	
					<ui:include src="/resources/components/goals/competences/compDetails.xhtml" />
					<div class="clear"></div>
					
					<ui:include src="/resources/components/goals/competences/recommendedActivities.xhtml" />
					<ui:include src="/resources/components/goals/competences/compWall.xhtml" />
					
				</div><!-- .middleColumn end -->
				
				<div class="oneThirdColumn marginLeft30">
					<c:if test="#{!adminSettings.settings.individualCompetencesCanNotBeEvaluated}">
						<div class="oneThirdColumn bottomSeparator50">
							<ui:include src="/resources/components/goals/competences/compEvaluations.xhtml" />
						</div>
						<div class="clear"></div>
						
						<div class="oneThirdColumn bottomSeparator50">
							<ui:include src="/resources/components/goals/competences/compBadges.xhtml" />
						</div>
						<div class="clear"></div>
					</c:if>
					
					<div class="oneThirdColumn bottomSeparator50">
						<ui:include src="/resources/components/goals/competences/activityDiscovery.xhtml" />
					</div>
					<div class="clear"></div>
					<ui:remove>
					<div class="oneThirdColumn bottomSeparator50">
						<ui:include src="/resources/components/goals/competences/activityRecommendations.xhtml" />
					</div>
					</ui:remove>
				</div><!-- .middleColumn end -->
				
				<div class="clear"></div>
				
				<div id="collabAct" class="comparisonOverlay" style="display: none;">
					<h:panelGroup layout="block" id="collabActivitiesForm" class="collabActivitiesForm">
						<h:panelGroup rendered="#{activitiesComparisonBean.user != null}" class="learnTripStep12a">
							<a class="closeIcon" onclick="$('.goalsPage .activities .comparisonOverlay').fadeOut();"></a>
							<h3>Activity Wall of #{activitiesComparisonBean.user.name}</h3>
							
							<h:panelGroup rendered="#{!activitiesComparisonBean.hasCompetence}">
								#{msg['goals.competences.activityWall.noCompetences']}
							</h:panelGroup>
							
							<h:panelGroup rendered="#{activitiesComparisonBean.hasCompetence}">
								<script>
									$(function() {
										addLoader('.collabActivitiesForm div.compWall', 'Loading activities...');
										refreshCompetenceActivityWall();
									});
									
									function refreshCompetenceActivityWall() {
										$('.collabActivitiesForm a.refreshAllHanler').trigger('click');
									}
								</script>
							
								<goalcomp:compactivitiesNoForm id="collabActivityWall" value="collabActivityWall"
									loadingMsg="Loading activities..."
									addCommentMsg="Add a comment..."
									allActivities="#{activitiesComparisonBean.activities}"
									initializeHandler="#{compwall.initializeActivities()}"
									actionBean="#{compwall}"
									readOnly="true"
									regionToRenderAfterConnect=":selectedCompetenceDetailsForm :actSearchForm:actSearchGrowl 
										#{learninggoals.selectedGoalData.data.progressActivityDependent ? ':goalDetails' : ''} "
									refreshCommandAfterConnect="$('.goalCompWall a.refreshAllHanler').trigger('click');"
									context="learn.targetGoal.#{learninggoals.selectedGoalData.data.targetGoalId}.targetComp.#{learninggoals.selectedGoalData.selectedCompetence.data.id}.activityComparison"
								/>
							</h:panelGroup>
							
							<utilcomp:tooltip target=".hasTooltip[title]" />
						</h:panelGroup>
					</h:panelGroup>
				</div>
			
				<script>
					var view = "activities";
				</script>
			</h:panelGroup>
		</h:form>
	</div>
	
	<dlg:appendedActivities id="actRecommendationAppendedAct" 
		regionToUpdateAfterConnect="#{learninggoals.selectedGoalData.data.progressActivityDependent ? ':goalDetails' : ''} 
			:selectedCompetenceDetailsForm" />
</ui:composition>