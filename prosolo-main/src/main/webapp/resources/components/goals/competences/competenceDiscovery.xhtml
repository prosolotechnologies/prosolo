<ui:composition
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util"
	xmlns:comp="http://java.sun.com/jsf/composite/components"
	xmlns:link="http://java.sun.com/jsf/composite/components/resourceLinks"
	xmlns:icon="http://java.sun.com/jsf/composite/components/resourceLinks/icons"
	xmlns:pt="http://java.sun.com/jsf/passthrough">
	
	<utilcomp:messagesBundle var="msg" />
	
	<h:outputScript library="javascript" name="jquery.shortenedText.js" target="head"/>
	
	<div class="sideRecommendedComp">
		<h3>Recommended competences <utilcomp:infotooltip position="RECOMMENDED_COMPETENCES" context="learn.targetGoal.#{learninggoals.selectedGoalData.data.targetGoalId}.competences.recommendation" /></h3>
		
		<div class="clear"></div>
		<h:form id="compRecommendationsForm" style="font-size: 10px;">
			<p:growl id="compRecommendGrowl" showDetail="true" />
			
			<h:panelGroup layout="block" class="recommendedCompetences" id="compRecommendationsPanel" style="display: none">
				<h:panelGroup rendered="#{empty learninggoals.recommendedCompetences}" styleClass="noContentMessage">
					No recommendations.
				</h:panelGroup>
			
				<ul>
					<ui:repeat value="#{learninggoals.recommendedCompetences}" var="compData" id="recommendationList">
						<li>
							<p:commandLink value="remove" 
								id="connectCompRecommendation" 
								styleClass="iconRemove hasTooltip"
								disabled="#{learninggoals.completed}"
								pt:title="#{learninggoals.completed ? msg['learn.disabledAsGoalIsCompleted.tooltip'] : msg['generic.remove.tooltip']}"
							/>
							
							<p:commandLink value="connect" styleClass="iconConnect hasTooltip"
								disabled="#{learninggoals.completed}"
								action="#{competencesBean.connectCompetenceById(compData.id, 'learn.targetGoal.'.concat(learninggoals.selectedGoalData.data.targetGoalId).concat('.competences.recommendation'))}"		
								process="@this"
								async="true"
								pt:title="#{learninggoals.completed ? msg['learn.disabledAsGoalIsCompleted.tooltip'] : msg['generic.connect.tooltip']}"
								update=":compRecommendationsForm :competenceList :newCompetenceButtonForm :compSearchForm"						
							/>
							
							<icon:competence size="16" />
							
							<link:competence 
								resourceId="#{compData.id}"
								type="Competence"
								styleClass="title" 
								title="#{compData.title}"
								context="learn.targetGoal.#{learninggoals.selectedGoalData.data.targetGoalId}.competences.recommendation" />
						</li>
					</ui:repeat>
				</ul>
				
				<script>
					roundImages();
					$('.members .collaborators').fadeIn();
					$('#compRecommendationsForm .recommendedCompetences ul li .title').shortenedText({showChar: 50, mode: 'static'});
				</script>
				
				<utilcomp:tooltip target=".hasTooltip[title]" />
			</h:panelGroup>
			
			<h:panelGroup rendered="#{learninggoals.hasMoreRecommendedCompetences()}">
				<a href="#" class="font11">See all</a>
			</h:panelGroup>
			
			<utilcomp:lazyLoad 
				parentClass="sideRecommendedComp"
				updateOnComplete=":compRecommendationsForm:compRecommendationsPanel"
				loaderContainer=".recommendedCompetences"
				initializeAction="#{learninggoals.initializeRecommendedCompetences()}"
				fadeIn="true"
				async="false"
			/>
		</h:form>
	</div>
</ui:composition>