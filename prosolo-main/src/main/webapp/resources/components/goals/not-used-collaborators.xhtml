<ui:component
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:func="http://org.prosolo/functions"
	xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:comp="http://java.sun.com/jsf/composite/components"
	xmlns:dlg="http://java.sun.com/jsf/composite/components/dialogs"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util"
	xmlns:link="http://java.sun.com/jsf/composite/components/resourceLinks">

	<composite:interface>
	</composite:interface>
	
	<composite:implementation>
		<div class="sideBoxFrame sideCollaborators">
			<div class="sideContent sideRecommendedSearch">
			
				<h3>Collaborators</h3>

				<div class="members">
					<h:form id="collaboratorsForm">
					
						<h:panelGroup layout="block" class="collaborators" style="display: none;" id="collaboratorsPanel">
							<ui:repeat value="#{learninggoals.collaborators}"
								var="member" id="lGoalMembersList" varStatus="loop" offset="0">
								<link:user value="goalCollaborators" 
				    				user="#{member}"
				    				idPrefix="collaborator#{loop.index}"
				    				divClass="collaborator"
				    				mode="image"
				    				context="collaborators.image"/>
							</ui:repeat>
							
							<h:panelGroup class="noContentMessage" rendered="#{empty learninggoals.collaborators}">
								No collaborators
							</h:panelGroup>
							
							<script>
								roundImages();
							</script>
						</h:panelGroup>
						
						<utilcomp:lazyLoad 
							parentClass="members"
							updateOnComplete=":collaborators:collaboratorsForm:collaboratorsPanel"
							loaderContainer=".collaborators"
							initializeAction="#{learninggoals.initializeCollaborators()}"
							async="true"
						/>
					</h:form>
				</div>
			
				<div class="clear"></div>
			
				<script>
				var collaboratorSearch;
				$(function() {
					$('.sideRecommendedSearch').prosolosearch({
						resultContainer: '.sideRecommendedSearch .collaboratorSearchContainer',
						loaderContainer: '.sideRecommendedSearch .collaboratorSearchContainer .collaboratorSearchResult',
						searchInput: '.sideRecommendedSearch .searchInput',
						watermark: 'Search collaborators'
					});
					collaboratorSearch = $('.sideRecommendedSearch').data('prosolo.search');
				});
				
	 	 	var delay = (function() {
    var timer = 0;
    return function(callback, ms) {
        clearTimeout (timer);
        timer = setTimeout(callback, ms);
    };
	})();


function ajaxCollaboratorsDelay(){ 
	delay(function() { 
		sendCollaboratorsAjaxical(); 
		}, 500);}
				</script>
				
				<div class="sideSearch searchContainer">
					<h:form id="collaboratorsSearchForm" class="collaboratorsSearchForm">
					<p:remoteCommand name="sendCollaboratorsAjaxical" update="collaboratorSearchResult" action="#{searchPeopleBean.executeSearch}"/>
 
						<div class="mGlass"></div>
						
						<h:inputText id="collaboratorsSearch" size="20"
							class="searchInput"
							value="#{searchPeopleBean.query}"
							onkeyup="ajaxCollaboratorsDelay()" 
							onblur="this.value='Search collaborators'">
						</h:inputText>
						
						<div class="genericSearchContainer collaboratorSearchContainer">
							<h:panelGroup layout="block" class="collaboratorSearchResult" id="collaboratorSearchResult">
						
								<script>
								$(function() {
									collaboratorSearch.clearTimeout();
									$('.sideRecommendedSearch .seeAllLink').attr('href', $('.sideRecommendedSearch .seeAllLink').attr('href')+$('.sideRecommendedSearch .searchInput').val());
								});
								</script>
						
								<h:panelGroup id="collaboratorsSearchResultPanelContent" rendered="#{!empty searchPeopleBean.users}">
								 	<span class="category">
								 		Collegues (#{searchPeopleBean.userSize})
								 	</span>
									
									<ui:repeat value="#{searchPeopleBean.users}" var="userData" id="foundUsersList">
										<div class="searchRecord">
											<div class="image">
												<h:graphicImage styleClass="imageRound image30"
													value="#{userData.avatarUrl}" width="30"
													height="30" alt="" />
											</div>
											
											<div class="info">
												<div class="title">#{userData.name}</div>
												<div>#{userData.position}</div>
												
												<div class="actions">
													<p:commandLink id="inviteButton" value="Invite"
														onclick="collaboratorSearch.hideResults();$('#invitationToJoinGoalModalDialog').dialog('open');"
														action="#{invitationToJoinGoalDialog.openInvitationToJoinLearningGoalDialog(userData)}" 
														update=":invjoingoal:invitationToJoinGoalFormId"
													/>
													
													<span class="bullet"></span>
													
													<p:commandLink id="recommendButton" value="Recommend"
														onclick="collaboratorSearch.hideResults();openGoalRecommendationDialog()"
														action="#{recommendLearningGoalBean.init(userData)}" 
														update=":grcomp:goalRecommendationFormId" />
												</div>
											</div>
										</div>
									</ui:repeat>
								</h:panelGroup>
							
								<h:panelGroup id="noResultsPanelCollaborators" class="noResultsPanel" rendered="#{(empty searchPeopleBean.users)}">
									No results found
								</h:panelGroup>
	
								<h:panelGroup id="seeAllLinkCollaborators" rendered="#{searchPeopleBean.hasMoreUsers()}">
									<span class="category">
										<h:outputLink class="seeAllLink" value="search.xhtml">
											<h:outputText value="See all" />
											<f:param name="tab" value="people" />
											<f:param name="query" value="" />
										</h:outputLink>
									</span>
								</h:panelGroup>
								
								<div class="break"></div>
							</h:panelGroup>
						</div>
					</h:form>
				</div>
				
				<h:form id="recommendedCollaboratorsForm">
					<strong>Recommended collaborators: <utilcomp:infotooltip position="RECOMMENDED_COLLEAGUES" /></strong>
						
					<h:panelGroup layout="block" class="recommendedCollaborators" style="display: none;" id="recommendedCollaboratorsPanel">
						<h:panelGroup rendered="#{empty learninggoals.recommendedCollaborators}" styleClass="noContentMessage">
							No recommendations.
						</h:panelGroup>
						
						<ui:repeat value="#{learninggoals.recommendedCollaborators}"
							var="recommendedUser" id="recommendedUsersList"	varStatus="loop">

							<div class="user198">
								<div>
									<link:user value="goalCollaborators" 
					    				userData="#{recommendedUser}"
					    				idPrefix="recommendedCollaboratoe#{loop.index}"
					    				mode="image"
					    				imageSize="30"
					    				styleClass="name"
					    				context="collaborators.image"/>
				    			</div>
								
								<div class="info">
									<link:user value="userDetails" 
					    				userData="#{recommendedUser}"
					    				divClass="name"
					    				mode="name"
					    				idPrefix="collaborator#{iterator.index}"
					    				context="collaborators.name"/>
					    				
									<div class="font11">#{recommendedUser.position}</div>
									
									<div class="action">
										<p:commandLink id="inviteButton" value="Invite"
											onclick="$('#invitationToJoinGoalModalDialog').dialog('open');"
											action="#{invitationToJoinGoalDialog.openInvitationToJoinLearningGoalDialog(recommendedUser)}" 
											update=":invjoingoal:invitationToJoinGoalFormId"
										/>
										
										<span class="bullet"></span>
										
										<p:commandLink id="recommendButton" value="Recommend"
											onclick="openGoalRecommendationDialog();"
											action="#{recommendLearningGoalBean.init(recommendedUser)}"
											update=":grcomp:goalRecommendationFormId"
										/>
									</div>
								</div>
							</div>
						</ui:repeat>
	
						<div class="clear"></div>
						
						<script>
							roundImages();
							$('.recommendedCollaborators').fadeIn();
						</script>
					</h:panelGroup>
					
					<utilcomp:lazyLoad 
						parentClass="sideCollaborators"
						updateOnComplete=":collaborators:recommendedCollaboratorsForm:recommendedCollaboratorsPanel"
						loaderContainer=".recommendedCollaborators"
						initializeAction="#{learninggoals.initializeCollaboratorRecommendations()}"
						async="true"
						/>
				</h:form>
			</div>
		</div>
	</composite:implementation>
</ui:component>