/**
 *  Trip.js
 *
 *  This is a jQuery plugin that can help you customize your tutorial trip
 *  with full flexibilities.
 *
 *  Version: 2.0.2
 *
 *  Author: EragonJ <eragonj@eragonj.me>
 *  Blog: http://eragonj.me
 *
 *  Customized by Nikola Milikic. Added method getSettings() to expose the settigns object.
 */
(function(e,t){function i(t,n){var r;var i;var s=n;this.pause=function(){e.clearTimeout(r);s-=new Date-i};this.resume=function(){i=new Date;r=e.setTimeout(t,s);return s};this.stop=function(){e.clearTimeout(r)};this.resume()}var n=["flash","bounce","shake","tada","fadeIn","fadeInUp","fadeInDown","fadeInLeft","fadeInRight","fadeInUpBig","fadeInDownBig","fadeInLeftBig","fadeInRightBig","bounceIn","bounceInDown","bounceInUp","bounceInLeft","bounceInRight","rotateIn","rotateInDownLeft","rotateInDownRight","rotateInUpLeft","rotateInUpRight"];var r=function(n,r){this.settings=t.extend({tripIndex:0,tripTheme:"black",backToTopWhenEnded:false,overlayZindex:99999,delay:1e3,enableKeyBinding:true,enableAnimation:true,showCloseBox:false,showHeader:false,skipUndefinedTrip:false,showNavigation:false,canGoNext:true,canGoPrev:true,nextLabel:"Next",prevLabel:"Back",finishLabel:"Dismiss",closeBoxLabel:"&#215;",header:"Step {{tripIndex}}",onStart:t.noop,onEnd:t.noop,onTripStart:t.noop,onTripEnd:t.noop,onTripStop:t.noop,onTripPause:t.noop,onTripResume:t.noop,onTripChange:t.noop,onTripClose:t.noop,animation:"tada",tripBlockHTML:['<div class="trip-block">','<a href="#" class="trip-close"></a>','<div class="trip-header"></div>','<div class="trip-content"></div>','<div class="trip-progress-wrapper">','<div class="trip-progress-bar"></div>','<a href="#" class="trip-prev"></a>','<a href="#" class="trip-next"></a>',"</div>","</div>"]},r);this.tripData=n;this.$tripBlock=null;this.$overlay=null;this.$bar=null;this.$root=t("body, html");this.tripIndex=this.settings.tripIndex;this.tripDirection="next";this.timer=null;this.progressing=false;this.hasExpose=false;this.CONSTANTS={LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,ESC:27,SPACE:32,TRIP_BLOCK_OFFSET_VERTICAL:10,TRIP_BLOCK_OFFSET_HORIZONTAL:10,RESIZE_TIMEOUT:200};this.console=e.console||{}};r.prototype={preInit:function(){if(typeof this.console==="undefined"){var e=this;var n=["log","warn","debug","info","error"];t.each(n,function(n,r){e.console[r]=t.noop})}},showExpose:function(){var e=this.getCurrentTripObject();var n=t(e.sel);var r;var i;this.hasExpose=true;if(n.get(0)!==undefined){r={position:n.css("position"),zIndex:n.css("z-Index")};i={position:"relative",zIndex:this.settings.overlayZindex+1};n.data("trip-old-css",r).css(i).addClass("trip-exposed")}this.$overlay.show()},hideExpose:function(){var e=t(".trip-exposed");this.hasExpose=false;if(e.get(0)!==undefined){var n=e.data("trip-old-css");e.css(n).removeClass("trip-exposed")}this.$overlay.hide()},bindResizeEvents:function(){var n=this;var r;t(e).on("resize.Trip",function(){e.clearTimeout(r);r=e.setTimeout(function(){n.run()},n.CONSTANTS.RESIZE_TIMEOUT)})},unbindResizeEvents:function(){t(e).off("resize.Trip")},bindKeyEvents:function(){var e=this;t(document).on({"keydown.Trip":function(t){e.keyEvent.call(e,t)}})},unbindKeyEvents:function(){t(document).off("keydown.Trip")},keyEvent:function(e){switch(e.which){case this.CONSTANTS.ESC:this.stop();break;case this.CONSTANTS.SPACE:e.preventDefault();this.pause();break;case this.CONSTANTS.LEFT_ARROW:case this.CONSTANTS.UP_ARROW:this.prev();break;case this.CONSTANTS.RIGHT_ARROW:case this.CONSTANTS.DOWN_ARROW:this.next();break}},stop:function(){if(this.timer){this.timer.stop()}if(this.hasExpose){this.hideExpose()}this.hideTripBlock();this.unbindKeyEvents();this.unbindResizeEvents();var e=this.getCurrentTripObject();var t=e.onTripStop||this.settings.onTripStop;t(this.tripIndex,e);this.settings.onEnd();this.tripIndex=this.settings.tripIndex},pauseAndResume:function(){if(this.progressing){this.timer.pause();this.pauseProgressBar()}else{var e=this.timer.resume();this.resumeProgressBar(e)}this.progressing=!this.progressing},pause:function(){this.pauseAndResume();var e=this.getCurrentTripObject();var t=e.onTripPause||this.settings.onTripPause;t(this.tripIndex,e)},resume:function(){this.pauseAndResume();var e=this.getCurrentTripObject();var t=e.onTripResume||this.settings.onTripResume;t(this.tripIndex,e)},next:function(){if(!this.canGoNext()){return this.run()}this.tripDirection="next";var e=this.getCurrentTripObject();var t=e.onTripEnd||this.settings.onTripEnd;t(this.tripIndex,e);if(this.isLast()){this.doLastOperation()}else{this.increaseIndex();this.run()}},prev:function(){this.tripDirection="prev";if(!this.isFirst()&&this.canGoPrev()){this.decreaseIndex()}this.run()},showCurrentTrip:function(e){if(this.settings.enableAnimation){this.removeAnimation()}if(this.timer){this.timer.stop()}if(this.hasExpose){this.hideExpose()}if(this.progressing){this.hideProgressBar();this.progressing=false}this.setTripBlock(e);this.showTripBlock(e);if(this.settings.enableAnimation){this.addAnimation(e)}if(e.expose){this.showExpose()}},doLastOperation:function(){if(this.timer){this.timer.stop()}if(this.settings.enableKeyBinding){this.unbindKeyEvents()}this.hideTripBlock();this.unbindResizeEvents();if(this.hasExpose){this.hideExpose()}if(this.settings.backToTopWhenEnded){this.$root.animate({scrollTop:0},"slow")}this.settings.onEnd();this.tripIndex=this.settings.tripIndex;return false},showProgressBar:function(e){var t=this;this.$bar.animate({width:"100%"},e,"linear",function(){t.$bar.width(0)})},hideProgressBar:function(){this.$bar.width(0);this.$bar.stop(true)},pauseProgressBar:function(){this.$bar.stop(true)},resumeProgressBar:function(e){this.showProgressBar(e)},run:function(){var e=this;var t=this.getCurrentTripObject();var n=t.onTripStart||this.settings.onTripStart;var r=t.onTripChange||this.settings.onTripChange;var s=t.delay||this.settings.delay;if(!this.isTripDataValid(t)){if(this.settings.skipUndefinedTrip===false){this.console.error("Your tripData is not valid at index: "+this.tripIndex);this.stop();return false}else{return this[this.tripDirection]()}}this.showCurrentTrip(t);this.showProgressBar(s);this.progressing=true;r(this.tripIndex,t);n(this.tripIndex,t);if(s>=0){this.timer=new i(function(){e.next()},s)}},isFirst:function(){return this.tripIndex===0?true:false},isLast:function(){return this.tripIndex===this.tripData.length-1?true:false},isTripDataValid:function(e){if(this.hasSpeicalDirections()){return true}if(typeof e.content==="undefined"||typeof e.sel==="undefined"||e.sel===null||e.sel.length===0||t(e.sel).length===0){return false}return true},hasSpeicalDirections:function(){var e=this.getCurrentTripObject();var n=e.position;var r=["screen-ne","screen-se","screen-sw","screen-nw","screen-center"];if(t.inArray(n,r)>=0){return true}return false},canGoPrev:function(){var e=this.tripData[this.tripIndex];var t=e.canGoPrev||this.settings.canGoPrev;if(typeof t==="function"){t=t.call(e)}return t},canGoNext:function(){var e=this.tripData[this.tripIndex];var t=e.canGoNext||this.settings.canGoNext;if(typeof t==="function"){t=t.call(e)}return t},increaseIndex:function(){if(this.tripIndex>=this.tripData.length-1){}else{this.tripIndex+=1}},decreaseIndex:function(){if(this.tripIndex<=0){}else{this.tripIndex-=1}},getCurrentTripObject:function(){return this.tripData[this.tripIndex]},getReplacedTripContent:function(e){e=e||"";var t=/\{\{(tripIndex)\}\}/g;var n=/\{\{(tripTotal)\}\}/g;e=e.replace(t,this.tripIndex+1);e=e.replace(n,this.tripData.length);return e},setTripBlock:function(e){var t=this.$tripBlock;var n=e.showCloseBox||this.settings.showCloseBox;var r=e.showNavigation||this.settings.showNavigation;var i=e.showHeader||this.settings.showHeader;var s=e.closeBoxLabel||this.settings.closeBoxLabel;var o=e.prevLabel||this.settings.prevLabel;var u=e.nextLabel||this.settings.nextLabel;var a=e.finishLabel||this.settings.finishLabel;var f=e.header||this.settings.header;t.find(".trip-header").html(this.getReplacedTripContent(f)).toggle(i);t.find(".trip-content").html(this.getReplacedTripContent(e.content));t.find(".trip-prev").html(o).toggle(r&&!this.isFirst());t.find(".trip-next").html(this.isLast()?a:u).toggle(r);t.find(".trip-close").html(s).toggle(n);t.removeClass("e s w n screen-ne screen-se screen-sw screen-nw screen-center");t.addClass(e.position);this.setTripBlockPosition(e,"horizontal");this.setTripBlockPosition(e,"vertical")},setTripBlockPosition:function(e,n){var r=this.$tripBlock;var i=t(e.sel);var s=i&&i.outerWidth();var o=i&&i.outerHeight();var u=r.outerWidth();var a=r.outerHeight();var f=10;var l=10;var c;var h;switch(e.position){case"screen-center":c="50%";h="50%";break;case"screen-ne":case"screen-se":case"screen-nw":case"screen-sw":c=this.CONSTANTS.TRIP_BLOCK_OFFSET_HORIZONTAL;h=this.CONSTANTS.TRIP_BLOCK_OFFSET_VERTICAL;break;case"e":c=i.offset().left+s+l;h=i.offset().top-(a-o)/2;break;case"s":c=i.offset().left+(s-u)/2;h=i.offset().top+o+f;break;case"w":c=i.offset().left-(l+u);h=i.offset().top-(a-o)/2;break;case"n":default:c=i.offset().left+(s-u)/2;h=i.offset().top-f-a;break}if(n==="horizontal"){r.css({left:"",right:"",marginLeft:""});switch(e.position){case"screen-center":r.css({left:c,marginLeft:-.5*u});break;case"screen-se":case"screen-ne":r.css({right:c});break;case"screen-sw":case"screen-nw":case"e":case"s":case"w":case"n":default:r.css({left:c});break}}else if(n==="vertical"){r.css({top:"",bottom:"",marginTop:""});switch(e.position){case"screen-center":r.css({top:h,marginTop:-.5*a});break;case"screen-sw":case"screen-se":r.css({bottom:h});break;case"screen-nw":case"screen-ne":case"e":case"s":case"w":case"n":default:r.css({top:h});break}}},addAnimation:function(e){var r=e.animation||this.settings.animation;if(t.inArray(r,n)>=0){this.$tripBlock.addClass("animated");this.$tripBlock.addClass(r)}},removeAnimation:function(){this.$tripBlock.removeClass(n.join(" "));this.$tripBlock.removeClass("animated")},showTripBlock:function(n){this.$tripBlock.css({display:"inline-block",zIndex:this.settings.overlayZindex+1});var r=t(e).height();var i=t(e).scrollTop();var s=this.$tripBlock.offset().top;var o=this.$tripBlock.height();var u=100;if(s+o<i+r&&s>=i){}else{this.$root.animate({scrollTop:s-u},"slow")}},hideTripBlock:function(){this.$tripBlock.fadeOut("slow")},create:function(){this.createTripBlock();this.createOverlay()},createTripBlock:function(){if(typeof t(".trip-block").get(0)==="undefined"){var e=this;var n=this.settings.tripBlockHTML.join("");var r=t(n).addClass(this.settings.tripTheme);t("body").append(r);r.find(".trip-close").on("click",function(t){t.preventDefault();var n=e.getCurrentTripObject();var r=n.onTripClose||e.settings.onTripClose;r(e.tripIndex,n);e.stop()});r.find(".trip-prev").on("click",function(n){n.preventDefault();t(this).blur();e.prev()});r.find(".trip-next").on("click",function(n){n.preventDefault();t(this).blur();e.next()})}},createOverlay:function(){if(typeof t(".trip-overlay").get(0)==="undefined"){var n=['<div class="trip-overlay">',"</div>"].join("");var r=t(n);r.height(t(e).height()).css({zIndex:this.settings.overlayZindex});t("body").append(r)}},cleanup:function(){t(".trip-overlay, .trip-block").remove()},init:function(){this.preInit();if(this.settings.enableKeyBinding){this.bindKeyEvents()}this.bindResizeEvents();this.$tripBlock=t(".trip-block");this.$bar=t(".trip-progress-bar");this.$overlay=t(".trip-overlay")},start:function(){this.cleanup();this.settings.onStart();this.create();this.init();this.run()}};e.Trip=r})(window,jQuery)
