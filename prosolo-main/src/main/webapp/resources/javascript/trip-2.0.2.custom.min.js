/**
 *  Trip.js
 *
 *  This is a jQuery plugin that can help you customize your tutorial trip
 *  with full flexibilities.
 *
 *  Version: 2.0.2
 *
 *  Author: EragonJ <eragonj@eragonj.me>
 *  Blog: http://eragonj.me
 *
 *  Customized by Nikola Milikic. Added method getSettings() to expose the settigns object.
 */
!function(t,e){function i(e,i){var s,n,r=i;this.pause=function(){t.clearTimeout(s),r-=new Date-n},this.resume=function(){return n=new Date,s=t.setTimeout(e,r),r},this.stop=function(){t.clearTimeout(s)},this.resume()}var s=["flash","bounce","shake","tada","fadeIn","fadeInUp","fadeInDown","fadeInLeft","fadeInRight","fadeInUpBig","fadeInDownBig","fadeInLeftBig","fadeInRightBig","bounceIn","bounceInDown","bounceInUp","bounceInLeft","bounceInRight","rotateIn","rotateInDownLeft","rotateInDownRight","rotateInUpLeft","rotateInUpRight"],n=function(i,s){this.settings=e.extend({tripIndex:0,tripTheme:"black",backToTopWhenEnded:!1,overlayZindex:99999,delay:1e3,enableKeyBinding:!0,enableAnimation:!0,showCloseBox:!1,showHeader:!1,skipUndefinedTrip:!1,showNavigation:!1,canGoNext:!0,canGoPrev:!0,nextLabel:"Next",prevLabel:"Back",finishLabel:"Dismiss",closeBoxLabel:"&#215;",header:"Step {{tripIndex}}",onStart:e.noop,onEnd:e.noop,onTripStart:e.noop,onTripEnd:e.noop,onTripStop:e.noop,onTripPause:e.noop,onTripResume:e.noop,onTripChange:e.noop,onTripClose:e.noop,animation:"tada",tripBlockHTML:['<div class="trip-block">','<a href="#" class="trip-close"></a>','<div class="trip-header"></div>','<div class="trip-content"></div>','<div class="trip-progress-wrapper">','<div class="trip-progress-bar"></div>','<a href="#" class="trip-prev"></a>','<a href="#" class="trip-next"></a>',"</div>","</div>"]},s),this.tripData=i,this.$tripBlock=null,this.$overlay=null,this.$bar=null,this.$root=e("body, html"),this.tripIndex=this.settings.tripIndex,this.tripDirection="next",this.timer=null,this.progressing=!1,this.hasExpose=!1,this.CONSTANTS={LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,ESC:27,SPACE:32,TRIP_BLOCK_OFFSET_VERTICAL:10,TRIP_BLOCK_OFFSET_HORIZONTAL:10,RESIZE_TIMEOUT:200},this.console=t.console||{}};n.prototype={preInit:function(){if("undefined"==typeof this.console){var t=this,i=["log","warn","debug","info","error"];e.each(i,function(i,s){t.console[s]=e.noop})}},showExpose:function(){var t,i,s=this.getCurrentTripObject(),n=e(s.sel);this.hasExpose=!0,void 0!==n.get(0)&&(t={position:n.css("position"),zIndex:n.css("z-Index")},i={position:"relative",zIndex:this.settings.overlayZindex+1},n.data("trip-old-css",t).css(i).addClass("trip-exposed")),this.$overlay.show()},hideExpose:function(){var t=e(".trip-exposed");if(this.hasExpose=!1,void 0!==t.get(0)){var i=t.data("trip-old-css");t.css(i).removeClass("trip-exposed")}this.$overlay.hide()},bindResizeEvents:function(){var i,s=this;e(t).on("resize.Trip",function(){t.clearTimeout(i),i=t.setTimeout(function(){s.run()},s.CONSTANTS.RESIZE_TIMEOUT)})},unbindResizeEvents:function(){e(t).off("resize.Trip")},bindKeyEvents:function(){var t=this;e(document).on({"keydown.Trip":function(e){t.keyEvent.call(t,e)}})},unbindKeyEvents:function(){e(document).off("keydown.Trip")},keyEvent:function(t){switch(t.which){case this.CONSTANTS.ESC:this.stop();break;case this.CONSTANTS.SPACE:t.preventDefault(),this.pause();break;case this.CONSTANTS.LEFT_ARROW:case this.CONSTANTS.UP_ARROW:this.prev();break;case this.CONSTANTS.RIGHT_ARROW:case this.CONSTANTS.DOWN_ARROW:this.next()}},stop:function(){this.timer&&this.timer.stop(),this.hasExpose&&this.hideExpose(),this.hideTripBlock(),this.unbindKeyEvents(),this.unbindResizeEvents();var t=this.getCurrentTripObject(),e=t.onTripStop||this.settings.onTripStop;e(this.tripIndex,t),this.settings.onEnd(),this.tripIndex=this.settings.tripIndex},pauseAndResume:function(){if(this.progressing)this.timer.pause(),this.pauseProgressBar();else{var t=this.timer.resume();this.resumeProgressBar(t)}this.progressing=!this.progressing},pause:function(){this.pauseAndResume();var t=this.getCurrentTripObject(),e=t.onTripPause||this.settings.onTripPause;e(this.tripIndex,t)},resume:function(){this.pauseAndResume();var t=this.getCurrentTripObject(),e=t.onTripResume||this.settings.onTripResume;e(this.tripIndex,t)},next:function(){if(!this.canGoNext())return this.run();this.tripDirection="next";var t=this.getCurrentTripObject(),e=t.onTripEnd||this.settings.onTripEnd;e(this.tripIndex,t),this.isLast()?this.doLastOperation():(this.increaseIndex(),this.run())},prev:function(){this.tripDirection="prev",!this.isFirst()&&this.canGoPrev()&&this.decreaseIndex(),this.run()},showCurrentTrip:function(t){this.settings.enableAnimation&&this.removeAnimation(),this.timer&&this.timer.stop(),this.hasExpose&&this.hideExpose(),this.progressing&&(this.hideProgressBar(),this.progressing=!1),this.setTripBlock(t),this.showTripBlock(t),this.settings.enableAnimation&&this.addAnimation(t),t.expose&&this.showExpose()},doLastOperation:function(){return this.timer&&this.timer.stop(),this.settings.enableKeyBinding&&this.unbindKeyEvents(),this.hideTripBlock(),this.unbindResizeEvents(),this.hasExpose&&this.hideExpose(),this.settings.backToTopWhenEnded&&this.$root.animate({scrollTop:0},"slow"),this.settings.onEnd(),this.tripIndex=this.settings.tripIndex,!1},showProgressBar:function(t){var e=this;this.$bar.animate({width:"100%"},t,"linear",function(){e.$bar.width(0)})},hideProgressBar:function(){this.$bar.width(0),this.$bar.stop(!0)},pauseProgressBar:function(){this.$bar.stop(!0)},resumeProgressBar:function(t){this.showProgressBar(t)},run:function(){var t=this,e=this.getCurrentTripObject(),s=e.onTripStart||this.settings.onTripStart,n=e.onTripChange||this.settings.onTripChange,r=e.delay||this.settings.delay;return this.isTripDataValid(e)?(this.showCurrentTrip(e),this.showProgressBar(r),this.progressing=!0,n(this.tripIndex,e),s(this.tripIndex,e),void(r>=0&&(this.timer=new i(function(){t.next()},r)))):this.settings.skipUndefinedTrip===!1?(this.console.error("Your tripData is not valid at index: "+this.tripIndex),this.stop(),!1):this[this.tripDirection]()},isFirst:function(){return 0===this.tripIndex?!0:!1},isLast:function(){return this.tripIndex===this.tripData.length-1?!0:!1},isTripDataValid:function(t){return this.hasSpeicalDirections()?!0:"undefined"==typeof t.content||"undefined"==typeof t.sel||null===t.sel||0===t.sel.length||0===e(t.sel).length?!1:!0},hasSpeicalDirections:function(){var t=this.getCurrentTripObject(),i=t.position,s=["screen-ne","screen-se","screen-sw","screen-nw","screen-center"];return e.inArray(i,s)>=0?!0:!1},canGoPrev:function(){var t=this.tripData[this.tripIndex],e=t.canGoPrev||this.settings.canGoPrev;return"function"==typeof e&&(e=e.call(t)),e},canGoNext:function(){var t=this.tripData[this.tripIndex],e=t.canGoNext||this.settings.canGoNext;return"function"==typeof e&&(e=e.call(t)),e},increaseIndex:function(){this.tripIndex>=this.tripData.length-1||(this.tripIndex+=1)},decreaseIndex:function(){this.tripIndex<=0||(this.tripIndex-=1)},getCurrentTripObject:function(){return this.tripData[this.tripIndex]},getReplacedTripContent:function(t){t=t||"";var e=/\{\{(tripIndex)\}\}/g,i=/\{\{(tripTotal)\}\}/g;return t=t.replace(e,this.tripIndex+1),t=t.replace(i,this.tripData.length)},setTripBlock:function(t){var e=this.$tripBlock,i=t.showCloseBox||this.settings.showCloseBox,s=t.showNavigation||this.settings.showNavigation,n=t.showHeader||this.settings.showHeader,r=t.closeBoxLabel||this.settings.closeBoxLabel,o=t.prevLabel||this.settings.prevLabel,a=t.nextLabel||this.settings.nextLabel,h=t.finishLabel||this.settings.finishLabel,c=t.header||this.settings.header;e.find(".trip-header").html(this.getReplacedTripContent(c)).toggle(n),e.find(".trip-content").html(this.getReplacedTripContent(t.content)),e.find(".trip-prev").html(o).toggle(s&&!this.isFirst()),e.find(".trip-next").html(this.isLast()?h:a).toggle(s),e.find(".trip-close").html(r).toggle(i),e.removeClass("e s w n screen-ne screen-se screen-sw screen-nw screen-center"),e.addClass(t.position),this.setTripBlockPosition(t,"horizontal"),this.setTripBlockPosition(t,"vertical")},setTripBlockPosition:function(t,i){var s,n,r=this.$tripBlock,o=e(t.sel),a=o&&o.outerWidth(),h=o&&o.outerHeight(),c=r.outerWidth(),p=r.outerHeight(),l=10,d=10;switch(t.position){case"screen-center":s="50%",n="50%";break;case"screen-ne":case"screen-se":case"screen-nw":case"screen-sw":s=this.CONSTANTS.TRIP_BLOCK_OFFSET_HORIZONTAL,n=this.CONSTANTS.TRIP_BLOCK_OFFSET_VERTICAL;break;case"e":s=o.offset().left+a+d,n=o.offset().top-(p-h)/2;break;case"s":s=o.offset().left+(a-c)/2,n=o.offset().top+h+l;break;case"w":s=o.offset().left-(d+c),n=o.offset().top-(p-h)/2;break;case"n":default:s=o.offset().left+(a-c)/2,n=o.offset().top-l-p}if("horizontal"===i)switch(r.css({left:"",right:"",marginLeft:""}),t.position){case"screen-center":r.css({left:s,marginLeft:-.5*c});break;case"screen-se":case"screen-ne":r.css({right:s});break;case"screen-sw":case"screen-nw":case"e":case"s":case"w":case"n":default:r.css({left:s})}else if("vertical"===i)switch(r.css({top:"",bottom:"",marginTop:""}),t.position){case"screen-center":r.css({top:n,marginTop:-.5*p});break;case"screen-sw":case"screen-se":r.css({bottom:n});break;case"screen-nw":case"screen-ne":case"e":case"s":case"w":case"n":default:r.css({top:n})}},addAnimation:function(t){var i=t.animation||this.settings.animation;e.inArray(i,s)>=0&&(this.$tripBlock.addClass("animated"),this.$tripBlock.addClass(i))},removeAnimation:function(){this.$tripBlock.removeClass(s.join(" ")),this.$tripBlock.removeClass("animated")},showTripBlock:function(){this.$tripBlock.css({display:"inline-block",zIndex:this.settings.overlayZindex+1});var i=e(t).height(),s=e(t).scrollTop(),n=this.$tripBlock.offset().top,r=this.$tripBlock.height(),o=100;s+i>n+r&&n>=s||this.$root.animate({scrollTop:n-o},"slow")},hideTripBlock:function(){this.$tripBlock.fadeOut("slow")},create:function(){this.createTripBlock(),this.createOverlay()},createTripBlock:function(){if("undefined"==typeof e(".trip-block").get(0)){var t=this,i=this.settings.tripBlockHTML.join(""),s=e(i).addClass(this.settings.tripTheme);e("body").append(s),s.find(".trip-close").on("click",function(e){e.preventDefault();var i=t.getCurrentTripObject(),s=i.onTripClose||t.settings.onTripClose;s(t.tripIndex,i),t.stop()}),s.find(".trip-prev").on("click",function(i){i.preventDefault(),e(this).blur(),t.prev()}),s.find(".trip-next").on("click",function(i){i.preventDefault(),e(this).blur(),t.next()})}},createOverlay:function(){if("undefined"==typeof e(".trip-overlay").get(0)){var i=['<div class="trip-overlay">',"</div>"].join(""),s=e(i);s.height(e(t).height()).css({zIndex:this.settings.overlayZindex}),e("body").append(s)}},cleanup:function(){e(".trip-overlay, .trip-block").remove()},init:function(){this.preInit(),this.settings.enableKeyBinding&&this.bindKeyEvents(),this.bindResizeEvents(),this.$tripBlock=e(".trip-block"),this.$bar=e(".trip-progress-bar"),this.$overlay=e(".trip-overlay")},start:function(){this.cleanup(),this.settings.onStart(),this.create(),this.init(),this.run()},getSettings:function(){return this.settings}},t.Trip=n}(window,jQuery);