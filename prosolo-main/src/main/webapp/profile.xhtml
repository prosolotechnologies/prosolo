<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:comp="http://java.sun.com/jsf/composite/components"
	template="templates/masterLayout2.xhtml"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:dlg="http://java.sun.com/jsf/composite/components/dialogs"
	xmlns:post="http://java.sun.com/jsf/composite/components/post"
	xmlns:link="http://java.sun.com/jsf/composite/components/resourceLinks">
	
	<ui:define name="windowTitle">
		Prosolo - Profile
	</ui:define>
	
	<ui:define name="metadata">
		<f:metadata>
			<f:viewParam name="id" value="#{profile1.studentId}" />
			<f:viewAction action="#{profile1.init}" />		
		</f:metadata>
	</ui:define>
	
	<ui:define name="resourceTitle">
    	<div class="profileHeader">
    			<ui:fragment rendered="#{not empty profile1.avatarUrl}" >
    				<img src="#{profile1.avatarUrl}" class="img-circle" width="120" height="120" alt="#{profile1.studentFullName}" />
    			</ui:fragment>
    			<ui:fragment rendered="#{empty profile1.avatarUrl}" >
    				<span class="letterAvatar letterAvatar120 img-circle">#{profile1.studentInitials}</span>
    			</ui:fragment>
                <div class="profileHeaderInfo">
                    <h1>#{profile1.studentFullName}</h1>
                    <div>#{profile1.studentAffiliation}</div>
                    <div>#{profile1.studentLocation}</div>
                    <ul class="socialLinks">
                    	<ui:repeat value="#{profile1.socialNetworksData.socialNetworkAccountDatas.entrySet().toArray()}" 
                    			var="socialNetworkData" varStatus="iterator">
                    		<ui:fragment rendered="#{not empty socialNetworkData.value.link}" >
		                        <li class="#{profile1.getAlternativeName(socialNetworkData.value.socialNetworkName)}">
		                        	<a href="#{socialNetworkData.value.link}" target="_blank">#{socialNetworkData.value.socialNetworkName}</a>
		                        </li>
	                        </ui:fragment>
                        </ui:repeat>
                    </ul>
                </div>
                <div class="clear"></div>
            </div>
    </ui:define>

	<ui:define name="content">
	<script>
		function expandTextarea(id) {
		    var $element = $('#'+id).get(0);  
		    $element.addEventListener('keyup', function() {
		        this.style.overflow = 'hidden';
		        this.style.height = 0;
		        this.style.height = this.scrollHeight + 'px';
		    }, false);
		}
		function hideMessageDialog(dialogId) {
			$('#'+dialogId).modal('hide');
			$("body").removeAttr("class").removeAttr("style")
			$("div.modal-backdrop.fade.in").remove()
		}
	</script>
		<div class="whiteBar">
	        <div class="container">
	            <div class="whiteBarContent" id="whiteBarContent">
	                <div class="whiteBarLeft">
	                	<h:form id="whiteBarProfileForm">
			                <ui:fragment rendered="#{profile1.personalProfile}" >
			                	<h:link outcome="settings" class="btn btn-green-stroke btn-sm">Edit Profile</h:link>
			                </ui:fragment>
			                <ui:fragment rendered="#{not profile1.personalProfile}" >
			                		<p:growl id="profileGrowl" showDetail="true" />
					                <p:commandLink id="followButton"
												   rendered="#{!peopleActionBean.isLoggedUserFollowingUser(profile1.studentId)}"
												   action="#{peopleActionBean.followCollegueById(profile1.studentId, 'recommendpeople.similarity')}"
												   update="whiteBarProfileForm"
												   process="@this"
												   styleClass="btn btn-green btn-sm">
										Follow
									</p:commandLink>
									<p:commandLink id="unfollowButton"
												   rendered="#{peopleActionBean.isLoggedUserFollowingUser(profile1.studentId)}"
												   action="#{peopleActionBean.unfollowCollegueById(profile1.studentId, 'recommendpeople.similarity')}"
												   update="whiteBarProfileForm"
												   process="@this"
												   styleClass="btn btn-green-stroke btn-sm">
										Following
									</p:commandLink>
				                    <a href="#" class="btn btn-green btn-sm btnMessage" data-toggle="modal" data-target="#message"><span></span>Message</a>
				                    <div class="modal fade" id="message" tabindex="-1" role="dialog" aria-labelledby="sendMessage">
				                        <div class="modal-dialog" role="document">
				                            <div class="modal-content">
				                                <div class="modal-header alignLeft">
				                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
				                                    <h2 class="modal-title" id="sendMessage">Send a Message</h2>
				                                </div>
				                                <div class="messageModalMeta">
				                                    <div class="messageModalMetaLine">
				                                        <div class="messageModalMetaLeft">
				                                            To:
				                                        </div>
				                                        <div class="messageModalMetaRight">
				                                            <img src="#{profile1.smallAvatarUrl}" class="img-circle" width="32" height="32" alt="#{profile1.studentFullName}" />
				                                            <h3>#{profile1.studentFullName}</h3>
				                                        </div>
				                                    </div>
				                                </div>
				                                <div class="modal-body alignLeft">
				                                     <p:inputTextarea placeholder="Type a message..." value="#{profile1.message}" id="messageContentTextarea" >
	                                    			 </p:inputTextarea>
	                                    			  <script>try{expandTextarea("messageContentTextarea")}catch(e){}</script>
				                                </div>
				                                <div class="modal-footer alignLeft">
				                                    <p:commandLink action="#{profile1.sendMessage()}" 
	                                            			styleClass="btn btn-green"
	                                            			process="@form"
	                                            			update="profileGrowl"
	                                            			oncomplete="hideMessageDialog('message')">
				                                    	Send
				                                    </p:commandLink>
				                                </div>
				                            </div>
				                        </div>
				                    </div>
			                </ui:fragment>
		                </h:form>
	                </div>
	            </div>
	        </div>
	    </div>
	
	    <div class="container">
	        <div class="row">
	            <h:panelGroup rendered="#{profile1.personalProfile}" styleClass="col-md-12" layout="block">
	                <div class="alert alert-info alert-dismissible" role="alert">
	                    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button>
	                    You can choose which achievements you want to display on your public profile page <a href="achievements.html">here</a>.
	                </div>
	            </h:panelGroup>
	            <div class="col-md-12">
	                <div class="whiteBox">
	                    <ul class="nav nav-tabs pageSubmenu" role="tablist">
	                        <li role="presentation" class="active"><a href="#credentials" aria-controls="info" role="tab" data-toggle="tab">Credentials</a></li>
	                        <li role="presentation"><a href="#competences" aria-controls="competences" role="tab" data-toggle="tab">Competences</a></li>
	                        <ui:remove>
	                        	<li role="presentation"><a href="#externalcompetences" aria-controls="competences" role="tab" data-toggle="tab">External Competences</a></li>
	                        </ui:remove>
	                        <li role="presentation"><a href="#inprogress" aria-controls="competences" role="tab" data-toggle="tab">In Progress</a></li>
	                    </ul>
	                </div>
	            </div>
	            <div class="tab-content">
	            <!-- CREDENTIALS -->
	                <div role="tabpanel" class="tab-pane fade in active" id="credentials">
		                <ui:repeat value="#{profile1.credentialAchievementsData.targetCredentialDataList}" 
	                    			var="targetCredential" varStatus="iterator">
			                <div class="col-md-6">
		                        <article class="whiteBox summaryCard">
		                            <h2><a href="#{targetCredential.link}">#{targetCredential.title}</a></h2>
		                            <div class="clear"></div>
		                            <p class="cardDescription">#{targetCredential.description}</p>
		                            <div class="metaBox">
		                                <div class="metaLeft">
		                                    <h:panelGroup rendered="#{profile1.personalProfile}" styleClass="tagCompleted" layout="block">
		                                    	Completed
		                                    </h:panelGroup>
		                                    <!-- <p:commandLink rendered="#{not profile1.personalProfile}" styleClass="linkCompare" target="#">Compare</p:commandLink> -->
		                                </div>
		                                <div class="metaRight">
		                                	<ui:fragment rendered="#{targetCredential.madeByUniversity()}" >
			                                    <a href="" class="madeByUniversity" data-toggle="tooltip" 
			                                    		   title="Made by University">made by university</a>
		                                    </ui:fragment>
		                                    <div class="duration">#{targetCredential.duration} minutes</div>
		                                </div>
		                            </div>
		                            <!-- <a href="javascript:void(0)" class="bookmarkStar" data-toggle="tooltip" title="Bookmark">bookmark</a> -->
		                        </article>
		                    </div>
		                </ui:repeat>
	                </div>
	                <!-- COMPETENCES -->
	                <div role="tabpanel" class="tab-pane fade" id="competences">
	                	<ui:repeat value="#{profile1.competenceAchievementsData.targetCompetenceDataList}" 
	                    			var="targetCompetence" varStatus="iterator">
		                    <div class="col-md-6">
		                        <article class="whiteBox summaryCard">
		                            <h2><a href="#{targetCompetence.link}">#{targetCompetence.title}</a></h2>
		                            <div class="clear"></div>
		                            <p class="cardDescription">#{targetCompetence.description}</p>
		                            <div class="metaBox">
											<h:panelGroup rendered="#{profile1.personalProfile}" styleClass="tagCompleted" layout="block">
		                                    	Completed
		                                    </h:panelGroup>
		                                <div class="metaRight">
		                                    <ui:fragment rendered="#{targetCompetence.madeByUniversity()}" >
			                                    <a href="" class="madeByUniversity" data-toggle="tooltip" 
			                                    		   title="Made by University">made by university</a>
		                                    </ui:fragment>
		                                     <div class="duration">#{targetCompetence.duration} minutes</div>
		                                </div>
		                            </div>
		                        </article>
		                    </div>
	                    </ui:repeat>
	                </div>
	                <ui:remove>
	                 	<!-- EXTERNAL COMPETENCES -->
		                <div role="tabpanel" class="tab-pane fade" id="externalcompetences">
		                    <div class="col-md-6">
		                        <article class="whiteBox summaryCard">
		                            <h2>Introduction to Learning Analytics</h2>
		                            <div class="clear"></div>
		                            <p class="cardDescription">Cras pellentesque id sapien eu malesuada. Aliquam vestibulum nulla commodo purus faucibus, vel feugiat nulla ultrices. Quisque a nisl sed lacus laoreet dapibus. Class aptent taciti sociosqu…</p>
		                            <div class="metaBox">
		                                <div class="metaLeft">
		                                    <a href="#" class="linkViewEvidence">View Evidence</a>
		                                </div>
		                                <div class="metaRight">
		                                    <div class="dateCompleted">Jan 25, 2015</div>
		                                </div>
		                            </div>
		                        </article>
		                    </div>
		                </div>
	                </ui:remove>
	                <!-- UNFINISHED COMPETENCES -->
	                <div role="tabpanel" class="tab-pane fade" id="inprogress">
	                <ui:repeat value="#{profile1.unfinishedCompetenceAchievementsData.targetCompetenceDataList}" 
	                    			var="unfinishedCompetence" varStatus="iterator">
		                    <div class="col-md-6">
		                        <article class="whiteBox summaryCard">
		                           <h2><a href="#{unfinishedCompetence.link}">#{unfinishedCompetence.title}</a></h2>
		                            <div class="clear"></div>
		                            <p class="cardDescription">#{unfinishedCompetence.description}</p>
		                            <div class="metaBox">
		                                <div class="metaLeft">
		                                    <a href="#{unfinishedCompetence.activityLink}" class="btn btn-green btn-sm">Resume</a>
		                                    <div class="progressBar">
		                                        <span>#{unfinishedCompetence.progress}%</span>
		                                        <div class="progress">
		                                            <div class="progress-bar" role="progressbar" aria-valuenow="#{unfinishedCompetence.progress}" 
		                                            		aria-valuemin="0" aria-valuemax="100" style="width: #{unfinishedCompetence.progress}%;">
		                                            </div>
		                                        </div>
		                                    </div>
		                                </div>
		                                <div class="metaRight">
		                                     <ui:fragment rendered="#{unfinishedCompetence.madeByUniversity()}" >
			                                    <a href="" class="madeByUniversity" data-toggle="tooltip" 
			                                    		   title="Made by University">made by university</a>
		                                    </ui:fragment>
		                                     <div class="duration">#{unfinishedCompetence.duration} minutes</div>
		                                </div>
		                            </div>
		                            
		                        </article>
		                    </div>
	                    </ui:repeat>
	                </div>
	            </div>
	        </div>
	    </div>
	    <!-- Include all compiled plugins (below), or include individual files as needed -->
	    <script src="#{request.contextPath}/resources/javascript2/bootstrap-tagsinput.min.js"></script>
	    <script src="#{request.contextPath}/resources/javascript2/bootstrap-tagsinput-angular.min.js"></script>
	</ui:define>
</ui:composition>