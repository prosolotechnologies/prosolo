<ui:composition xmlns="http://www.w3.org/1999/xhtml"
				xmlns:h="http://java.sun.com/jsf/html"
				xmlns:f="http://java.sun.com/jsf/core"
				xmlns:ui="http://java.sun.com/jsf/facelets"
				xmlns:p="http://primefaces.org/ui"
				template="templates/masterLayout2.xhtml"
				xmlns:a="http://xmlns.jcp.org/jsf/passthrough"
				xmlns:util="http://www.prosolo.com/util"
				xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util">
	
	<ui:define name="windowTitle">
		#{profileBean.personalProfile ? '' : profileBean.userData.fullName.concat(' - ')}Profile - ProSolo
	</ui:define>
	
	<ui:define name="metadata">
		<f:metadata>
			<f:viewParam name="id" value="#{profileBean.studentId}" />
			<f:viewParam name="tab" value="#{profileBean.tab}"/>
			<f:viewAction action="#{profileBean.init}" />
		</f:metadata>
	</ui:define>
	
	<ui:define name="resourceTitle">
		<utilcomp:messagesBundle var="msg" />

    	<div class="profileHeader">
   			<ui:fragment rendered="#{not empty profileBean.userData.avatarUrl}" >
   				<img src="#{profileBean.userData.avatarUrl}" class="img-circle" width="120" height="120"
					 alt="#{profileBean.userData.fullName}" />
   			</ui:fragment>
   			
   			<ui:fragment rendered="#{empty profileBean.userData.avatarUrl}" >
   				<span class="letterAvatar letterAvatar120 img-circle">#{util:initials(profileBean.userData.fullName)}</span>
   			</ui:fragment>
   			
               <div class="profileHeaderInfo">
                   <h1>#{profileBean.userData.fullName}</h1>
                   <div>#{profileBean.userData.position}</div>
                   <div>#{profileBean.userData.locationName}</div>
                   <ul class="socialLinks">
                   	<ui:repeat value="#{profileBean.userSocialNetworksData.socialNetworkAccountsData.entrySet().toArray()}"
                   			var="socialNetworkData" varStatus="iterator">
                   		<ui:fragment rendered="#{not empty socialNetworkData.value.link}" >
	                        <li class="#{profileBean.getAlternativeName(socialNetworkData.value.socialNetworkName)}">
	                        	<a href="#{socialNetworkData.value.link}" target="_blank">#{socialNetworkData.value.socialNetworkName}</a>
	                        </li>
                        </ui:fragment>
                       </ui:repeat>
                   </ul>
               </div>
			<div class="clear"></div>
           </div>
    </ui:define>

	<ui:define name="content">
		<script>
			function expandTextarea(id) {
			    var $element = $('#'+id).get(0);  
			    $element.addEventListener('keyup', function() {
			        this.style.overflow = 'hidden';
			        this.style.height = 0;
			        this.style.height = this.scrollHeight + 'px';
			    }, false);
			}
			function hideMessageDialog(dialogId) {
				$('#'+dialogId).modal('hide');
				$("body").removeAttr("class").removeAttr("style")
				$("div.modal-backdrop.fade.in").remove()
			}
			
			function makeTabActive(id) {
				$("#"+id).addClass( "in active" )
				$( "div[role='tabPanel']" ).not( "[id='"+id+"']" ).removeClass("in active")
                setQueryParam('tab', id);
			}
			
		</script>
		
		<div class="whiteBar">
	        <div class="container">
	            <div class="whiteBarContent" id="whiteBarContent">
	                <div class="whiteBarLeft">
	                	<h:form id="whiteBarProfileForm">
	                		
			                <ui:fragment rendered="#{profileBean.personalProfile}" >
			                	<h:link outcome="settings" class="btn btn-green-stroke btn-sm">Edit Profile</h:link>
			                </ui:fragment>
			                
			                <ui:fragment rendered="#{not profileBean.personalProfile}" >
		                		<p:growl id="profileGrowl" showDetail="true" />
				                <p:commandLink id="followButton"
											   rendered="#{!peopleActionBean.isLoggedUserFollowingUser(profileBean.decodedStudentId)}"
											   action="#{peopleActionBean.followCollegueById(profileBean.userData.fullName, profileBean.decodedStudentId)}"
											   update="@form"
											   process="@this"
											   styleClass="btn btn-green btn-sm">
									<f:param name="page" value="/profile.xhtml" />
									<f:param name="learningContext" value="name:profile|id:#{profileBean.studentId}" />
									Follow
								</p:commandLink>
								<p:commandLink id="unfollowButton"
											   rendered="#{peopleActionBean.isLoggedUserFollowingUser(profileBean.decodedStudentId)}"
											   action="#{peopleActionBean.unfollowCollegueById(profileBean.userData.fullName, profileBean.decodedStudentId)}"
											   update="whiteBarProfileForm"
											   process="@form"
											   styleClass="btn btn-green-stroke btn-sm">
									<f:param name="page" value="/profile.xhtml" />
									<f:param name="learningContext" value="name:profile|id:#{profileBean.studentId}" />
									Following
								</p:commandLink>
								
			                    <a href="#" class="btn btn-green btn-sm btnMessage" data-toggle="modal" data-target="#message"><span></span>Message</a>
			                    
			                    <div class="modal fade" id="message" tabindex="-1" role="dialog" aria-labelledby="sendMessage">
			                        <div class="modal-dialog" role="document">
			                            <div class="modal-content">
			                                <div class="modal-header alignLeft">
			                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
			                                    <h2 class="modal-title" id="sendMessage">Send a Message</h2>
			                                </div>
			                                
			                                <div class="messageModalMeta">
			                                    <div class="messageModalMetaLine">
			                                        <div class="messageModalMetaLeft">
			                                            To:
			                                        </div>
			                                        <div class="messageModalMetaRight">
			                                            <img src="#{profileBean.userData.avatarUrl}" class="img-circle" width="32" height="32" alt="#{profileBean.userData.fullName}" />
			                                            <h3>#{profileBean.userData.fullName}</h3>
			                                        </div>
			                                    </div>
			                                </div>
			                                
			                                <div class="modal-body alignLeft">
			                                     <p:inputTextarea placeholder="Type a message..." value="#{profileBean.message}" id="messageContentTextarea" >
                                    			 </p:inputTextarea>
                                    			  <script>try{expandTextarea("messageContentTextarea")}catch(e){}</script>
			                                </div>
			                                
			                                <div class="modal-footer alignLeft">
			                                    <p:commandLink action="#{profileBean.sendMessage()}"
                                            			styleClass="btn btn-green"
                                            			process="@form"
                                            			update="profileGrowl"
                                            			oncomplete="hideMessageDialog('message')">
			                                    	Send
			                                    </p:commandLink>
			                                </div>
			                            </div>
			                        </div>
			                    </div>
			                </ui:fragment>
		                </h:form>
	                </div>
	            </div>
	        </div>
	    </div>
	
	    <div class="container">
	    	
	        <div class="row">

	            <div class="col-md-12">
	                <div class="whiteBox">
	                	<h:form id="tabsForm" prependId="false">
		                    <ul class="nav nav-tabs pageSubmenu" role="tablist">
		                        <li role="presentation" class="#{param.tab ne 'competences' and param.tab ne 'inprogress' ? 'active' : ''}">
			                        <p:commandLink oncomplete="makeTabActive('credentials')" update=":#{p:component('tabPanel')}" actionListener="#{profileBean.changeTab('credentials')}" a:aria-controls="info" a:role="tab" a:data-toggle="tab" >#{msg['label.credential.plural']}</p:commandLink>
		                        </li>
		                        <li role="presentation" class="#{param.tab eq 'competences' ? 'active' : ''}">
		                        	<p:commandLink oncomplete="makeTabActive('competences')" update=":#{p:component('tabPanel')}" actionListener="#{profileBean.changeTab('competences')}" a:aria-controls="info" a:role="tab" a:data-toggle="tab" >#{msg['label.competence.plural']}</p:commandLink>
		                        </li>
		                        <ui:remove>
		                        	<li role="presentation">
										<a href="#externalcompetences" aria-controls="competences" role="tab" data-toggle="tab">External Competences</a>
									</li>
		                        </ui:remove>
		                        <li role="presentation" class="#{param.tab eq 'inprogress' ? 'active' : ''}">
		                        	<p:commandLink oncomplete="makeTabActive('inprogress')" update=":#{p:component('tabPanel')}" actionListener="#{profileBean.changeTab('inprogress')}" a:aria-controls="info" a:role="tab" a:data-toggle="tab" >In Progress</p:commandLink>
		                        </li>
		                    </ul>
		                </h:form>
	                </div>
	            </div>
	            
	            <h:panelGroup id="tabPanel" styleClass="tab-content" layout="block">
	            <!-- CREDENTIALS -->
	              <h:panelGroup id="credentials" a:role="tabPanel" styleClass="tab-pane fade #{param.tab ne 'competences' and param.tab ne 'inprogress' ? 'active in' : ''}" layout="block">
	                	<ui:fragment rendered="#{empty profileBean.targetCredential1List}">
		                	<div class="col-md-12">
		                        <div class="noContentMessage">
		                            <p>
		                                No completed #{msg['label.credential.plural'].toLowerCase()}.<br/>
		                                <h:link
		                                	rendered="#{profileBean.personalProfile}"
		                                	outcome="/credentialLibrary">
		                                	Browse #{msg['label.credential.plural'].toLowerCase()}
	                                	</h:link>
		                            </p>
		                        </div>
		                    </div>
	                    </ui:fragment>

					  <h:form id="completedCredentialsForm">
						  <p:growl id="growlCompletedCredentials" showDetail="true" globalOnly="true"/>
						  <ui:repeat value="#{profileBean.targetCredential1List}"
										var="targetCredential">
								<h:panelGroup layout="block" rendered="#{not empty targetCredential.category}" styleClass="col-md-12">
									<div class="categorySeparator">
										#{targetCredential.category.title}
									</div>
								</h:panelGroup>
								<ui:repeat value="#{targetCredential.credentials}" var="cred" varStatus="iterator">
									<div class="col-md-6">
										<article class="whiteBox summaryCard">
											<h2>
												<h:link outcome="credential">
													<f:param name="id" value="#{util:encodeId(cred.credentialId)}"/>
													#{cred.title}
												</h:link>
											</h2>
											<div class="clear"></div>

											<p class="cardDescription">#{util:cleanHTMLTags(cred.description)}</p>

											<div class="metaBox">
												<div class="metaLeft">
													<h:panelGroup rendered="#{profileBean.personalProfile}" styleClass="tagCompleted" layout="block">
														Completed
													</h:panelGroup>
												</div>

												<div class="metaRight">
													<ui:fragment rendered="#{cred.durationString ne null}">
														<div class="duration">#{cred.durationString}</div>
													</ui:fragment>
												</div>
											</div>

											<h:panelGroup layout="block" rendered="#{profileBean.personalProfile}" styleClass="metaBox">
												<div class="metaLeft">
													<div class="checkbox checkLine">
														<h:selectBooleanCheckbox id="completedCredentialAchievements"
																				 value="#{cred.hiddenFromProfile}">
															<f:ajax event="click" execute="@this"
																	listener="#{profileBean.updateTargetCredentialProfileVisibility(cred)}"
																	render="completedCredentialsForm"
															/>
														</h:selectBooleanCheckbox>

														<h:outputLabel for="completedCredentialAchievements">Hide from Public Profile</h:outputLabel>
													</div>
												</div>
											</h:panelGroup>
										</article>
									</div>

									<ui:fragment rendered="#{iterator.index % 2 == 1}">
										<div class="clear"></div>
									</ui:fragment>
								</ui:repeat>
							</ui:repeat>
					  </h:form>
		            </h:panelGroup>
	                
	                <!-- COMPETENCES -->
	                <h:panelGroup id="competences" a:role="tabPanel" styleClass="tab-pane fade #{param.tab eq 'competences' ? 'active in' : ''}" layout="block">
	                	<ui:fragment rendered="#{empty profileBean.targetCompetence1List}">
		                	<div class="col-md-12">
		                        <div class="noContentMessage">
		                            <p>
		                                No completed #{msg['label.competence.plural'].toLowerCase()}.<br/>
		                                <h:link rendered="#{profileBean.personalProfile}"
		                                	outcome="/credentialLibrary">
		                                	Browse #{msg['label.competence.plural'].toLowerCase()}
	                                	</h:link>
		                            </p>
		                        </div>
		                    </div>
	                    </ui:fragment>

						<h:form id="competencesForm">
							<p:growl id="growlCompetences" showDetail="true" globalOnly="true"/>
							<ui:repeat value="#{profileBean.targetCompetence1List}"
								var="targetCompetence" varStatus="iterator">
								<div class="col-md-6">
									<article class="whiteBox summaryCard">
										<h2>
											<h:link	outcome="competence">
												#{targetCompetence.title}
												<f:param name="compId" value="#{util:encodeId(targetCompetence.competenceId)}"/>
											</h:link>
										</h2>
										<div class="clear"></div>

										<p class="cardDescription">#{util:cleanHTMLTags(targetCompetence.description)}</p>

										<div class="metaBox">
											<h:panelGroup rendered="#{profileBean.personalProfile}" styleClass="tagCompleted" layout="block">
												Completed
											</h:panelGroup>

											<div class="metaRight">
												<ui:fragment rendered="#{targetCompetence.durationString ne null}">
													<div class="duration">#{targetCompetence.durationString}</div>
												</ui:fragment>
											</div>
										</div>

										<h:panelGroup layout="block" rendered="#{profileBean.personalProfile}" styleClass="metaBox">
											<div class="metaLeft">
												<div class="checkbox checkLine">
													<h:selectBooleanCheckbox id="competenceAchievements"
																			 value="#{targetCompetence.hiddenFromProfile}">
														<f:ajax event="click" execute="@this"
																listener="#{profileBean.updateTargetCompetenceProfileVisibility(targetCompetence)}"
																render="competencesForm"
														/>
													</h:selectBooleanCheckbox>

													<h:outputLabel for="competenceAchievements">Hide from Public Profile</h:outputLabel>
												</div>
											</div>
										</h:panelGroup>
									</article>
								</div>

								<ui:fragment rendered="#{iterator.index % 2 == 1}">
									<div class="clear"></div>
								</ui:fragment>
							</ui:repeat>
						</h:form>
	               </h:panelGroup>
	                
	                
	                <ui:remove>
	                 	<!-- EXTERNAL COMPETENCES -->
		                <div role="tabpanel" class="tab-pane fade" id="externalcompetences">
		                    <div class="col-md-6">
		                        <article class="whiteBox summaryCard">
		                            <h2>Introduction to Learning Analytics</h2>
		                            <div class="clear"></div>
		                            <p class="cardDescription">Cras pellentesque id sapien eu malesuada. Aliquam vestibulum nulla commodo purus faucibus, vel feugiat nulla ultrices. Quisque a nisl sed lacus laoreet dapibus. Class aptent taciti sociosqu…</p>
		                            <div class="metaBox">
		                                <div class="metaLeft">
		                                    <a href="#" class="linkViewEvidence">View Evidence</a>
		                                </div>
		                                <div class="metaRight">
		                                    <div class="dateCompleted">Jan 25, 2015</div>
		                                </div>
		                            </div>
		                        </article>
		                    </div>
		                </div>
	                </ui:remove>
	                
	                <!-- IN PROGRESS CREDENTIALS -->
	                <h:panelGroup id="inprogress" a:role="tabPanel" styleClass="tab-pane fade #{param.tab eq 'inprogress' ? 'active in' : ''}" layout="block">
	                	<ui:fragment rendered="#{empty profileBean.targetCredential1ListInProgress}">
		                	<div class="col-md-12">
		                        <div class="noContentMessage">
		                            <p>
		                                No credentials in progress.<br/>
		                                <h:link rendered="#{profileBean.personalProfile}"
		                                	outcome="/credentialLibrary">
		                                	Browse credentials
	                                	</h:link>
		                            </p>
		                        </div>
		                    </div>
	                    </ui:fragment>

						<h:form id="inProgressCredentialsForm">
							<p:growl id="growlInProgressCredentials" showDetail="true" globalOnly="true"/>
							<ui:repeat value="#{profileBean.targetCredential1ListInProgress}"
										var="inProgressCredential">
								<h:panelGroup layout="block" rendered="#{not empty inProgressCredential.category}" styleClass="col-md-12">
									<div class="categorySeparator">
										#{inProgressCredential.category.title}
									</div>
								</h:panelGroup>
								<ui:repeat value="#{inProgressCredential.credentials}" var="cred" varStatus="iterator">
									<div class="col-md-6">
										<article class="whiteBox summaryCard">
											<h2>
												<h:link	outcome="credential">
													#{cred.title}
													<f:param name="id" value="#{util:encodeId(cred.credentialId)}"/>
												</h:link>
											</h2>
											<div class="clear"></div>

											<p class="cardDescription">#{util:cleanHTMLTags(cred.description)}</p>

											<div class="metaBox">
												<div class="metaLeft">
													<h:link
														value="Resume"
														styleClass="btn btn-green btn-sm"
														outcome="/competence">
														<f:param name="credId" value="#{util:encodeId(cred.credentialId)}"/>
														<f:param name="compId" value="#{util:encodeId(cred.nextCompetenceToLearnId)}"/>
													</h:link>

													<div class="progressBar">
														<span>#{cred.progress}%</span>
														<div class="progress">
															<div class="progress-bar" role="progressbar" aria-valuenow="#{cred.progress}"
																	aria-valuemin="0" aria-valuemax="100" style="width: #{cred.progress}%;">
															</div>
														</div>
													</div>
												</div>

												<div class="metaRight">
													<ui:fragment rendered="#{cred.durationString ne null}">
														<div class="duration">#{cred.durationString}</div>
													</ui:fragment>
												</div>
											</div>

											<h:panelGroup layout="block" rendered="#{profileBean.personalProfile}" styleClass="metaBox">
												<div class="metaLeft">
													<div class="checkbox checkLine">
														<h:selectBooleanCheckbox id="inProgressCredentialAchievements"
																				 value="#{cred.hiddenFromProfile}">
															<f:ajax event="click" execute="@this"
																	listener="#{profileBean.updateTargetCredentialProfileVisibility(cred)}"
																	render="inProgressCredentialsForm"
															/>
														</h:selectBooleanCheckbox>

														<h:outputLabel for="inProgressCredentialAchievements">Hide from Public Profile</h:outputLabel>
													</div>
												</div>
											</h:panelGroup>
										</article>
									</div>

									<ui:fragment rendered="#{iterator.index % 2 == 1}">
										<div class="clear"></div>
									</ui:fragment>
								</ui:repeat>
							</ui:repeat>
						</h:form>
	                </h:panelGroup>
	            </h:panelGroup>
	        </div>
	    </div>
	    
	    <!-- Include all compiled plugins (below), or include individual files as needed -->
	    <script src="#{request.contextPath}/resources/javascript2/bootstrap-tagsinput.min.js"></script>
	    <script src="#{request.contextPath}/resources/javascript2/bootstrap-tagsinput-angular.min.js"></script>
	</ui:define>
</ui:composition>