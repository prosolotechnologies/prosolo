<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:port="http://java.sun.com/jsf/composite/components/portfolio"
	template="templates/masterLayout.xhtml"
	xmlns:dlg="http://java.sun.com/jsf/composite/components/dialogs"
	xmlns:comp="http://java.sun.com/jsf/composite/components"
	xmlns:util="http://www.prosolo.com/util">

<ui:define name="windowTitle">
	Profile | ProSolo
</ui:define>

<ui:define name="metadata">
	<f:metadata>
		<f:viewParam name="ev" value="#{portfolio.evaluationParameter}" />
	</f:metadata>
</ui:define>

<ui:define name="content">

	<h:outputScript library="javascript" name="readmore.custom.js" target="head" />
	<h:outputScript library="javascript" name="jquery.scrollTo.min.js" target="head" />
	<h:outputScript library="javascript" name="ZeroClipboard/ZeroClipboard.min.js" />
	
	<script type="text/javascript">
		var callsCounter = 0;
	
		function registerLazyLoadCompleted() {
			callsCounter++;
			
			if (callsCounter == 5) {
				var tab = getParameterByName('tab');
				if (tab) {
					$("#portfolio .leftNav li[tab-id='"+tab+"']").find('a').trigger('click');
				}
			}
		}
	</script>

	<div id="portfolio" class="container">
	
		<div class="leftSidebar floating">
		
			<h:panelGroup layout="block" id="userActions" class="actions sideBoxFrame">
				<div class="sideContent">
					<h:link class="button gray size30 left publicProfile"
						onclick="sendLogPageNavigation('profile', 'profile.actions');"
						value="Public Profile" outcome="/publicprofile">
						<f:param name="id" value="#{util:encodeId(loggeduser.user.id)}" />
					</h:link>
					<span class="iconCopy left hasTooltip" title="Copy to clipboard"></span>

					<script>
					ZeroClipboard.config( { swfPath: '#{request.contextPath}/resources/javascript/ZeroClipboard/ZeroClipboard.swf' });
					var client = new ZeroClipboard($('#portfolio .leftSidebar #userActions .iconCopy'));

					client.on( "copy", function (event) {
						var clipboard = event.clipboardData;
						clipboard.setData( "text/plain", $('#portfolio .leftSidebar #userActions .publicProfile')[0].href);
					});
					</script>
				</div>
			</h:panelGroup>

			<div class="leftNav shortNav">
				<ul>
					<li	class="selected" tab-id="info">
						<a href="#" 
							onclick="scrollToSection('#info');logTabNavigation('info', 'profile.navigation');">
							Info
						</a>
					</li>
					
					<li tab-id="learning">
						<a href="#" 
							onclick="scrollToSection('#learning');logTabNavigation('learning', 'profile.navigation');">
							Learning
						</a>
					</li>
					
					<li tab-id="competences">
						<a href="#" 
							onclick="scrollToSection('#competences');logTabNavigation('competences', 'profile.navigation');">
							Competences
						</a>
					</li>

					<li tab-id="credits">
						<a href="#" 
							onclick="scrollToSection('#credits');logTabNavigation('credits', 'profile.navigation');">
							External Credits
						</a>
					</li>

					<li tab-id="statuswall">
						<a href="#" 
							onclick="scrollToSection('#statuswall');logTabNavigation('statuswall', 'profile.navigation');">
							Status Wall
						</a>
					</li>
				</ul>
			</div>
			
			<script>
				function scrollToSection(target) {
					$('body').scrollTo(target, 1000, {offset: -70});
					return false;
				}
				
				$('#portfolio .leftNav li a').on('click', function(){
					$('#portfolio .leftNav li.selected').removeClass('selected');
					var parentLi = $(this).parent();
					parentLi.addClass('selected');
					
					setQueryParam('tab', parentLi.attr('tab-id'));
				});
			</script>
			
			<ui:remove>
			<div class="sideBoxFrame sideBadges">
				<div class="sideContent">
					<h3>Badges</h3>
					<a href="#" class="linkEdit">Add</a>
					<div class="clear"></div>
					<ul>
						<li>
							<span class="badge"></span>Evaluator
							<a href="#">Details</a>
							<a href="javascript:void(0);" class="drop all">visibility</a>
							<div class="dropdown hidden">
								<ul>
									<li class="selected"><a href="#">Visible to all</a></li>
									<li><a href="#">Visible to friends</a></li>
									<li><a href="#">Private</a></li>
								</ul>
							</div>
						</li>
						<li>
							<span class="badge"></span>Announcer
							<a href="#">Details</a>
							<a href="javascript:void(0);" class="drop all">visibility</a>
							<div class="dropdown hidden">
								<ul>
									<li class="selected"><a href="#">Visible to all</a></li>
									<li><a href="#">Visible to friends</a></li>
									<li><a href="#">Private</a></li>
								</ul>
							</div>
						</li>
						<li>
							<span class="badge"></span>First Like
							<a href="#">Details</a>
							<a href="javascript:void(0);" class="drop all">visibility</a>
							<div class="dropdown hidden">
								<ul>
									<li class="selected"><a href="#">Visible to all</a></li>
									<li><a href="#">Visible to friends</a></li>
									<li><a href="#">Private</a></li>
								</ul>
							</div>
						</li>
					</ul>
				</div>
			</div>
			
			<div class="sideBoxFrame">
				<div class="sideContent">
					<h3>Statistics</h3>
				</div>
			</div>
			</ui:remove>
		</div><!-- .leftSidebar -->
	
		<div class="content">
		
			<div id="info">
				<h2>Info</h2>
				
				<div class="avatarNameContainer">
					<div class="avatarContainer">
						<h:graphicImage styleClass="imageRound image120"
							value="#{loggeduser.bigAvatar}" width="120"
							height="120" alt="" />
					</div>
					<div class="infoContainer">
						<h2 class="name">
							<h:link value="#{loggeduser.name} #{loggeduser.user.lastname}"
								onclick="sendLogPageNavigation('profile', 'profile.info');" 
								outcome="/publicprofile">
								<f:param name="user" value="#{util:encodeId(loggeduser.user.id)}" />
							</h:link>
						</h2>
						<div class="position">#{loggeduser.user.position}</div>
						
						<h:panelGroup rendered="#{loggeduser.user.locationName != null}" class="position marginTop10">
							<ui:include src="/resources/components/dialogs/locationDialog.xhtml" />
							<a href="#" class="location" onclick="$('#locationDialog').dialog('option', 'data', ['#{loggeduser.user.locationName}', #{loggeduser.user.latitude}, #{loggeduser.user.longitude}]).dialog('open');sendServiceUse('USER_LOCATION_DIALOG', {context: 'profile.info.location', userId: #{loggeduser.user.id}});return false;">#{loggeduser.user.locationName}</a>
						
							<script>
								$('#portfolio .avatarNameContainer .infoContainer .location').readmore({maxHeight: 40});
							</script>
						</h:panelGroup>
					</div>
				</div>
				
				<div class="socialNetworksInterestsContainer">
					<div class="socialNetworks">
						<h3>
							Social Networks
							
							<h:link outcome="/settings"
								class="button gray size20 right fontWeightNornal"
								onclick="sendLogPageNavigation('settings/socialNetworks', 'profile.info.socialNetworks.edit');"
								value="Edit">
								<f:param  name="tab" value="socialNetworks" />
								<f:param  name="origin" value="#{request.requestURI}" />
							</h:link>
						</h3>
						
						
						<c:if test="#{portfolio.socialNetworksData.twitterLink != null and 
									portfolio.socialNetworksData.twitterLink.length() > 0}">
							<a href="#{portfolio.socialNetworksData.twitterLink}"
								onclick="sendLogPageNavigation('#{portfolio.socialNetworksData.twitterLink}', 'profile.info.socialNetworks.twitter');"
								target="_blank" class="icon twitter active"></a>
						</c:if>
						<c:if test="#{portfolio.socialNetworksData.twitterLink == null or 
									portfolio.socialNetworksData.twitterLink.length() == 0}">
							<span class="icon twitter inactive"></span>
						</c:if>
						
						<c:if test="#{portfolio.socialNetworksData.facebookLink != null and 
									portfolio.socialNetworksData.facebookLink.length() > 0}">
							<a href="#{portfolio.socialNetworksData.facebookLink}"
								onclick="sendLogPageNavigation('#{portfolio.socialNetworksData.facebookLink}', 'profile.info.socialNetworks.facebook');"
								target="_blank" class="icon facebook active"></a>
						</c:if>
						<c:if test="#{portfolio.socialNetworksData.facebookLink == null or 
									portfolio.socialNetworksData.facebookLink.length() == 0}">
							<span class="icon facebook inactive"></span>
						</c:if>
						
						<c:if test="#{portfolio.socialNetworksData.gplusLink != null and 
									portfolio.socialNetworksData.gplusLink.length() > 0}">
							<a href="#{portfolio.socialNetworksData.gplusLink}"
								onclick="sendLogPageNavigation('#{portfolio.socialNetworksData.gplusLink}', 'profile.info.socialNetworks.gplus');"
								target="_blank" class="icon gplus active"></a>
						</c:if>
						<c:if test="#{portfolio.socialNetworksData.gplusLink == null or 
									portfolio.socialNetworksData.gplusLink.length() == 0}">
							<span class="icon gplus inactive"></span>
						</c:if>
						
						<c:if test="#{portfolio.socialNetworksData.blogLink != null and 
									portfolio.socialNetworksData.blogLink.length() > 0}">
							<a href="#{portfolio.socialNetworksData.blogLink}"
								onclick="sendLogPageNavigation('#{portfolio.socialNetworksData.blogLink}', 'profile.info.socialNetworks.blog');"
								target="_blank" class="icon blog active"></a>
						</c:if>
						<c:if test="#{portfolio.socialNetworksData.blogLink == null or 
									portfolio.socialNetworksData.blogLink.length() == 0}">
							<span class="icon blog inactive"></span>
						</c:if>
					</div>
					
					<div class="userInterests">
						<port:userinterests 
							id="userInterests" 
							user="#{loggeduser.user}"
							context="profile.info"
						/>
					</div>
				</div>
				
				<div class="clear separator"></div>
			</div>
			
			<div id="learning">
				<ui:include src="/resources/components/portfolio/learning.xhtml" />
				
				<div class="clear separator"></div>
			</div>
			
			<div id="competences">
				<ui:include src="/resources/components/portfolio/competences.xhtml" />
				
				<div class="clear separator"></div>
			</div>
			
			<div id="credits">
				<ui:include src="/resources/components/portfolio/externalCredits.xhtml" />

				<div class="clear separator"></div>
			</div>
			
			<dlg:appendedActivities id="appActivities"/>
			
			<div id="statuswall">
				<h1 class="marginBottom20">Status Wall</h1>
				<div class="clear"></div>
			
				<div class="main">
					<comp:activitywall id="mainActivityWall"
						value="mainActivityWall"
						refreshRate="#{activitywall.refreshRate}"
						moreToLoadIndicator="#{portfolio.moreToLoad}"
						allActivities="#{portfolio.allActivities}"
						initializeHandler="#{portfolio.initializeActivities()}"
						loadMoreHandler="#{portfolio.loadMoreActivities()}"
						refreshHandler="#{portfolio.refresh()}"
						oncomplete="registerLazyLoadCompleted();"
						noOptions="true"
						context="profile.statusWall"
					/>
				</div>
			</div>
		</div><!-- .content -->
	
		<div class="clear"></div>
	</div><!-- .container end -->
	
	<ui:include src="/resources/components/dialogs/askForEvaluation.xhtml" />
	<dlg:evaluationList />
	<ui:include src="/resources/components/dialogs/badgeList.xhtml" />
	<ui:include src="/resources/components/dialogs/courseDetails.xhtml" />

</ui:define>
</ui:composition>