<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                template="templates/masterLayout2.xhtml"
                xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
                xmlns:util="http://www.prosolo.com/util"
                xmlns:assessment="http://java.sun.com/jsf/composite/components/assessments"
                xmlns:p="http://primefaces.org/ui"
                xmlns:credential="http://java.sun.com/jsf/composite/components/courses"
>

    <utilcomp:messagesBundle var="msg" />

    <ui:define name="windowTitle">
        #{userCredentialReadOnlyBean.credentialData.idData.title} - ProSolo
    </ui:define>

    <ui:define name="metadata">
        <f:metadata>
            <f:viewParam name="credId" value="#{userCredentialReadOnlyBean.credId}" default="null" />
            <f:viewParam name="studentId" value="#{userCredentialReadOnlyBean.studentId}" default="null" />
            <f:viewAction action="#{userCredentialReadOnlyBean.init()}" />
        </f:metadata>
    </ui:define>

    <ui:define name="resourceTitle">
        <h1><span>#{userCredentialReadOnlyBean.credentialData.student.fullName}:</span> #{userCredentialReadOnlyBean.credentialData.idData.title}</h1>
    </ui:define>
    <ui:define name="navLinks">
        <credential:credentialStudentNavLinksPublic
                id="headerLinks"
                credId="#{userCredentialReadOnlyBean.decodedCredId}"
                studentId="#{userCredentialReadOnlyBean.decodedStudentId}"
                displayAssessments="#{userCredentialReadOnlyBean.credentialData.credentialAssessmentsDisplayed and userCredentialReadOnlyBean.credentialData.numberOfAssessments gt 0}"
        />
    </ui:define>

    <ui:define name="content">
        <p:growl id="growlMain" showDetail="true" globalOnly="true"/>

        <div class="whiteBar">
            <div class="container">
                <div class="whiteBarContent">
                    <div class="whiteBarLeft">

                    </div>
                    <div class="whiteBarRight">
                        <h:panelGroup id="panelCredentialAssessmentCount">
                            <ui:fragment rendered="#{userCredentialReadOnlyBean.credentialData.credentialAssessmentsDisplayed}">
                                <ui:fragment rendered="#{userCredentialReadOnlyBean.credentialData.numberOfAssessments eq 0}">
                                    <a href="javascript:void(0);" class="numberAssessments" data-toggle="tooltip" title="No Assessments">assessments</a>
                                </ui:fragment>
                                <ui:fragment rendered="#{userCredentialReadOnlyBean.credentialData.numberOfAssessments gt 0}">
                                    <h:link outcome="/credential-instructor-assessment-profile" styleClass="numberAssessments" pt:data-toggle="tooltip" title="#{userCredentialReadOnlyBean.credentialData.numberOfAssessments} Assessment#{userCredentialReadOnlyBean.credentialData.numberOfAssessments eq 1 ? '' : 's'}">
                                        assessments
                                        <f:param name="credId" value="#{param.credId}"/>
                                        <f:param name="studentId" value="#{param.studentId}"/>
                                    </h:link>
                                </ui:fragment>
                            </ui:fragment>
                        </h:panelGroup>
                        <h:panelGroup
                                rendered="#{userCredentialReadOnlyBean.credentialData.mandatoryFlow}"
                                styleClass="mandatoryTag item">Mandatory flow</h:panelGroup>
                        <ui:fragment rendered="#{userCredentialReadOnlyBean.credentialData.durationString ne null}">
                            <div class="duration item">#{userCredentialReadOnlyBean.credentialData.durationString}</div>
                        </ui:fragment>
                    </div>
                </div>
            </div>
        </div>

        <div class="container">
            <ol class="breadcrumb">
                <li>
                    <ui:fragment rendered="#{userCredentialReadOnlyBean.currentUserCredentialStudent}">
                        <h:link value="#{util:shortenAndAddDots(userCredentialReadOnlyBean.credentialData.student.fullName)}" outcome="/profile"/>
                    </ui:fragment>
                    <ui:fragment rendered="#{not userCredentialReadOnlyBean.currentUserCredentialStudent}">
                        <h:link value="#{util:shortenAndAddDots(userCredentialReadOnlyBean.credentialData.student.fullName)}" outcome="profile">
                                <f:param name="id" value="#{util:encodeId(userCredentialReadOnlyBean.credentialData.student.id)}"/>
                        </h:link>
                    </ui:fragment>
                </li>
                <li class="active">#{util:shortenAndAddDots(userCredentialReadOnlyBean.credentialData.idData.title)}</li>
            </ol>
        </div>

        <div class="container">
            <div class="row">
                <div class="col-md-8 #{userCredentialReadOnlyBean.credentialData.mandatoryFlow ? 'mandatoryFlow' : ''}">
                    <h2>About #{msg['label.credential']}</h2>
                    <p>
                        <h:outputText escape="false" value="#{userCredentialReadOnlyBean.credentialData.description}" />
                    </p>

                    <h:panelGroup id="panelCompetences">
                        <ui:repeat id="compList" var="comp" value="#{userCredentialReadOnlyBean.credentialData.competences}" varStatus="status">
                            <article class="whiteBox summaryCard summaryCompetence">
                                <div class="innerWrapper">
                                    <h2>#{comp.title}</h2>
                                    <div class="clear"></div>

                                    <p class="cardDescription">#{util:cleanHTMLTags(comp.description)}</p>

                                    <div class="metaBox">
                                        <div class="metaLeft"></div>

                                        <div class="metaRight">
                                            <ui:fragment rendered="#{userCredentialReadOnlyBean.credentialData.competenceAssessmentsDisplayed}">
                                                <ui:fragment rendered="#{comp.numberOfAssessments eq 0}">
                                                    <a class="numberAssessments" data-toggle="tooltip" title="No Assessments">assessments</a>
                                                </ui:fragment>
                                                <ui:fragment rendered="#{comp.numberOfAssessments gt 0}">
                                                    <h:link outcome="/competence-instructor-assessments-profile" styleClass="numberAssessments" pt:data-toggle="tooltip" title="#{comp.numberOfAssessments} Assessment#{comp.numberOfAssessments eq 1 ? '' : 's'}">
                                                        assessments
                                                        <f:param name="compId" value="#{util:encodeId(comp.competenceId)}"/>
                                                        <f:param name="studentId" value="#{param.studentId}"/>
                                                    </h:link>
                                                </ui:fragment>
                                            </ui:fragment>
                                            <ui:fragment rendered="#{comp.durationString ne null}">
                                                <div class="duration">#{comp.durationString}</div>
                                            </ui:fragment>
                                        </div>
                                    </div>
                                </div>
                                <div class="collapseActivityList">
                                    <div id="comp#{comp.competenceId}" class="collapse">
                                        <h:panelGroup id="actList">
                                            <ul>
                                                <ui:repeat var="act" value="#{comp.activities}">
                                                    <li class="#{styleUtilBean.getStyleClassBasedOnActivityType(act.activityType)}">
                                                        <a>
                                                            <span class="iconType"></span>
                                                            #{act.title}
                                                            <ui:fragment rendered="#{act.completed}">
                                                                <span class="check"></span>
                                                            </ui:fragment>
                                                        </a>
                                                    </li>
                                                </ui:repeat>
                                            </ul>
                                        </h:panelGroup>
                                    </div>

                                    <ui:fragment rendered="#{comp.learningPathType eq 'ACTIVITY'}">
                                        <h:panelGroup id="panelExpandActivityList">
                                            <h:panelGroup rendered="#{comp.activitiesInitialized}">
                                                <a href="javascript:void(0);" data-toggle="collapse" data-target="#comp#{comp.competenceId}" class="collapseButton collapsed">
                                                    <span class="textShow">Show Activities</span>
                                                    <span class="arrowDown">down</span>
                                                    <span class="textHide">Hide Activities</span>
                                                    <span class="arrowUp">up</span>
                                                </a>
                                            </h:panelGroup>

                                            <p:commandLink
                                                    rendered="#{!comp.activitiesInitialized}"
                                                    styleClass="collapseButton collapsed"
                                                    process="@this"
                                                    action="#{userCredentialReadOnlyBean.loadCompetenceActivitiesIfNotLoaded(comp)}"
                                                    update="actList panelExpandActivityList"
                                                    oncomplete="$('#comp#{comp.competenceId}').collapse();">
                                                <span class="textShow">Show Activities</span>
                                                <span class="arrowDown">down</span>
                                                <span class="textHide">Hide Activities</span>
                                                <span class="arrowUp">up</span>
                                            </p:commandLink>
                                        </h:panelGroup>
                                    </ui:fragment>
                                </div>
                                <ui:remove>
                                    <ui:fragment rendered="#{not empty comp.evidences and userCredentialReadOnlyBean.credentialData.evidenceDisplayed}">
                                        <assessment:evidenceItems
                                                evidences="#{comp.evidences}"
                                                canViewEvidence="true"
                                        />
                                    </ui:fragment>
                                </ui:remove>
                            </article>

                            <h:panelGroup
                                    rendered="#{userCredentialReadOnlyBean.credentialData.hasMoreCompetences(status.index)}"
                                    layout="block"
                                    styleClass="mandatoryArrow"
                                    style="#{cc.attrs.bean.credentialData.mandatoryFlow ? '' : 'display:none;'}">
                            </h:panelGroup>
                        </ui:repeat>
                    </h:panelGroup>
                </div>

                <div class="col-md-4">
                    <h:panelGroup layout="block" styleClass="sidebarBlock" rendered="#{userCredentialReadOnlyBean.credentialData.learningStageEnabled}">
                        <div class="whiteBox sidebarStage">
                            <h2>Stage #{userCredentialReadOnlyBean.credentialData.learningStage.order}: #{userCredentialReadOnlyBean.credentialData.learningStage.title}</h2>
                        </div>
                    </h:panelGroup>
                    <h:panelGroup layout="block" rendered="#{userCredentialReadOnlyBean.currentUserCredentialStudent}" styleClass="sidebarBlock">
                        <h2>Preview Settings</h2>
                        <h:form id="formDisplaySettings">
                            <div class="checkbox checkLine">
                                <h:selectBooleanCheckbox id="checkDisplayCredentialAssessments"
                                                         value="#{userCredentialReadOnlyBean.credentialData.credentialAssessmentsDisplayed}">
                                    <f:ajax event="click" execute="@this"
                                            listener="#{userCredentialReadOnlyBean.updateCredentialAssessmentsVisibility()}"
                                            render="@this :growlMain :panelCredentialAssessmentCount headerLinks"
                                    />
                                </h:selectBooleanCheckbox>
                                <h:outputLabel for="checkDisplayCredentialAssessments">Display #{msg['label.credential']} Assessments</h:outputLabel>
                            </div>
                            <div class="checkbox checkLine">
                                <h:selectBooleanCheckbox id="checkDisplayCompetenceAssessments"
                                                         value="#{userCredentialReadOnlyBean.credentialData.competenceAssessmentsDisplayed}">
                                    <f:ajax event="click" execute="@this"
                                            listener="#{userCredentialReadOnlyBean.updateCompetenceAssessmentsVisibility()}"
                                            render="@this :growlMain :panelCompetences"
                                    />
                                </h:selectBooleanCheckbox>
                                <h:outputLabel for="checkDisplayCompetenceAssessments">Display #{msg['label.competence']} Assessments</h:outputLabel>
                            </div>
                            <ui:remove>
                            <div class="checkbox checkLine">
                                <h:selectBooleanCheckbox id="checkDisplayEvidence"
                                                         value="#{userCredentialReadOnlyBean.credentialData.evidenceDisplayed}">
                                    <f:ajax event="click" execute="@this"
                                            listener="#{userCredentialReadOnlyBean.updateEvidenceVisibility()}"
                                            render="@this :growlMain :panelCompetences"
                                    />
                                </h:selectBooleanCheckbox>
                                <h:outputLabel for="checkDisplayEvidence">Display Evidence</h:outputLabel>
                            </div>
                            </ui:remove>
                        </h:form>
                    </h:panelGroup>
                    <ui:fragment rendered="#{not empty userCredentialReadOnlyBean.credentialData.tags}">
                        <div class="sidebarBlock sidebarBlockKeywords">
                            <h2>Keywords</h2>
                            <ul class="tags">
                                <ui:repeat var="tag"
                                           value="#{userCredentialReadOnlyBean.credentialData.tags}">
                                    <li>#{tag.title}</li>
                                </ui:repeat>
                            </ul>
                        </div>
                    </ui:fragment>

                    <ui:fragment
                            rendered="#{not empty userCredentialReadOnlyBean.credentialData.hashtags}">
                        <div class="sidebarBlock">
                            <h2>Twitter hashtags</h2>
                            <ul class="tags">
                                <ui:repeat var="hashtag"
                                           value="#{userCredentialReadOnlyBean.credentialData.hashtags}">
                                    <li>#{hashtag.title}</li>
                                </ui:repeat>
                            </ul>
                        </div>
                    </ui:fragment>
                    <div class="sidebarBlock">
                        <h2>Created by</h2>
                        <div class="user32">
                            <a href="#"> <utilcomp:userAvatar
                                    avatar="#{userCredentialReadOnlyBean.credentialData.creator.avatar}"
                                    fullName="#{userCredentialReadOnlyBean.credentialData.creator.name}" />
                            </a>
                            <h3>
                                <a href="#">#{userCredentialReadOnlyBean.credentialData.creator.name}</a>
                            </h3>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </ui:define>
</ui:composition>