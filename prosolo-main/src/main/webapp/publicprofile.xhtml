<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:port="http://java.sun.com/jsf/composite/components/portfolio"
	xmlns:actions="http://java.sun.com/jsf/composite/components/actions"
	template="templates/masterLayout.xhtml"
	xmlns:dlg="http://java.sun.com/jsf/composite/components/dialogs"
	xmlns:comp="http://java.sun.com/jsf/composite/components"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util"
	xmlns:link="http://java.sun.com/jsf/composite/components/resourceLinks">

<ui:define name="windowTitle">
	Profile | ProSolo
</ui:define>

<ui:define name="metadata">
	<f:metadata>
		<f:viewParam name="id" value="#{publicportfolio.id}" />
		<f:viewAction action="#{publicportfolio.init}" />
	</f:metadata>
</ui:define>
	
<ui:define name="content">

	<h:outputScript library="javascript" name="jquery.scrollTo.min.js" target="head" />
	<h:outputScript library="javascript" name="readmore.custom.js" target="head" />
	
	<ui:param name="userId" value="#{publicportfolio.profileOwnerData.id}" />
	
	<script type="text/javascript">
		var callsCounter = 0;
	
		function registerLazyLoadCompleted() {
			callsCounter++;
			
			if (callsCounter == 5) {
				var tab = getParameterByName('tab');
				if (tab) {
					$("#portfolio .leftNav li[tab-id='"+tab+"']").find('a').trigger('click');
				}
			}
		}
	</script>

	<div id="portfolio" class="container">
	
		<div class="leftSidebar floating">
		
			<ui:remove>
			<div class="userDetails marginBottom10">
				<div class="avatarContainer">
					<h:graphicImage styleClass="imageRound image60"
						value="#{publicportfolio.profileOwnerData.avatarUrl}" width="60"
						height="60" alt="" />
				</div>
				<div class="infoContainer">
					<h2 class="name">
						#{publicportfolio.profileOwner.name} #{publicportfolio.profileOwner.lastname}
					</h2>
					
					<div class="position">#{publicportfolio.profileOwner.position}</div>
					
					<h:panelGroup rendered="#{publicportfolio.profileOwner.locationName != null}" class="position">
						<ui:include src="/resources/components/dialogs/locationDialog.xhtml" />
						<a href="#" onclick="$('#locationDialog').dialog('option', 'data', ['#{publicportfolio.profileOwner.locationName}', #{publicportfolio.profileOwner.latitude}, #{publicportfolio.profileOwner.longitude}]).dialog('open');return false;">#{publicportfolio.profileOwner.locationName}</a>
					</h:panelGroup>
				</div>
			</div>
			</ui:remove>

			<c:if test="#{loggeduser != null and loggeduser.loggedIn and 
				publicportfolio.profileOwnerData != null and
				userId != loggeduser.userId}">
				<h:panelGroup layout="block" id="userActions" class="actions sideBoxFrame">
					
					<div class="sideContent">
						<actions:directMessage
							receiverData="#{publicportfolio.profileOwnerData}"
							styleClass="button gray size30 marginRight10"
							context="profile.#{userId}" />
					
						<p:commandLink id="followButton"
							styleClass="button gray size30"
							rendered="#{!peopleActionBean.isLoggedUserFollowingUser(userId)}"
							value="Follow"
							action="#{peopleActionBean.followCollegueById(userId, 'profile.'.concat(userId))}"
							update=":userActions :userInterests:userInterestsBlock:userInterestsGrowl" />
						
						<actions:unfollow
							userData="#{publicportfolio.profileOwnerData}"
							styleClass="button gray size30 unfollowButton"
							toRender="#{peopleActionBean.isLoggedUserFollowingUser(cc.attrs.userData.id)}"
							context="profile.#{userId}"
							toUpdate=":userActions :userInterests:userInterestsBlock:userInterestsGrowl" />
					</div>
				</h:panelGroup>
			</c:if>
			
			<div class="leftNav shortNav">
				<ul>
					<li	class="selected" tab-id="info">
						<a href="#" 
							onclick="scrollToSection('#info');logTabNavigation('info', 'profile.#{userId}.navigation');">
							Info
						</a>
					</li>
					
					<li tab-id="learning">
						<a href="#" 
							onclick="scrollToSection('#learning');logTabNavigation('learning', 'profile.#{userId}.navigation');">
							Learning
						</a>
					</li>
					
					<li tab-id="competences">
						<a href="#" 
							onclick="scrollToSection('#competences');logTabNavigation('competences', 'profile.#{userId}.navigation');">
							Competences
						</a>
					</li>

					<li tab-id="credits">
						<a href="#" 
							onclick="scrollToSection('#credits');logTabNavigation('credits', 'profile.#{userId}.navigation');">
							External Credits
						</a>
					</li>

					<li tab-id="statuswall">
						<a href="#" 
							onclick="scrollToSection('#statuswall');logTabNavigation('statuswall', 'profile.#{userId}.navigation');">
							Status Wall
						</a>
					</li>
				</ul>
			</div>
			
			<script>
				function scrollToSection(target) {
					$('body').scrollTo(target, 1000, {offset: -70});
					return false;
				}
				
				$('#portfolio .leftNav li a').on('click', function(){
					$('#portfolio .leftNav li.selected').removeClass('selected');
					var parentLi = $(this).parent();
					parentLi.addClass('selected');
					
					setQueryParam('tab', parentLi.attr('tab-id'));
				});
			</script>
		</div><!-- .leftSidebar -->
	
		<div class="content">
		
			<div id="info">
				<h2>Info</h2>
				
				<div class="avatarNameContainer">
					<div class="avatarContainer">
						<h:graphicImage styleClass="imageRound image120"
							value="#{publicportfolio.profileOwnerData.avatarUrl}" width="120"
							height="120" alt="" />
					</div>
					<div class="infoContainer">
						<h2 class="name">
							#{publicportfolio.profileOwner.name} #{publicportfolio.profileOwner.lastname}
						</h2>
						<div class="position">#{publicportfolio.profileOwner.position}</div>
						
						<h:panelGroup rendered="#{publicportfolio.profileOwner.locationName != null}" class="position marginTop10">
							<ui:include src="/resources/components/dialogs/locationDialog.xhtml" />
							<a href="#" class="location" onclick="$('#locationDialog').dialog('option', 'data', ['#{publicportfolio.profileOwner.locationName}', #{publicportfolio.profileOwner.latitude}, #{publicportfolio.profileOwner.longitude}]).dialog('open');sendServiceUse('USER_LOCATION_DIALOG', {context: 'profile.#{userId}.info.location', userId: #{userId}});return false;">#{publicportfolio.profileOwner.locationName}</a>
						
							<script>
								$('#portfolio .avatarNameContainer .infoContainer .location').readmore({maxHeight: 40});
							</script>
						</h:panelGroup>
					</div>
				</div>
				
				<div class="socialNetworksInterestsContainer">
					<div class="socialNetworks">
						<h3>Social Networks</h3>
						
						<h:panelGroup id="socialNetworksContainer" class="socialNetworksContainer left">
							<c:if test="#{publicportfolio.socialNetworksData.twitterLink != null and 
										publicportfolio.socialNetworksData.twitterLink.length() > 0}">
								<a href="#{publicportfolio.socialNetworksData.twitterLink}"
									onclick="sendLogPageNavigation('#{publicportfolio.socialNetworksData.twitterLink}', 'profile.${userId}.info.socialNetworks.twitter');"
									target="_blank" class="icon twitter active"></a>
							</c:if>
							<c:if test="#{publicportfolio.socialNetworksData.twitterLink == null or 
										publicportfolio.socialNetworksData.twitterLink.length() == 0}">
								<span class="icon twitter inactive"></span>
							</c:if>
							
							<c:if test="#{publicportfolio.socialNetworksData.facebookLink != null and 
										publicportfolio.socialNetworksData.facebookLink.length() > 0}">
								<a href="#{publicportfolio.socialNetworksData.facebookLink}"
									onclick="sendLogPageNavigation('#{publicportfolio.socialNetworksData.facebookLink}', 'profile.${userId}.info.socialNetworks.facebook');"
									target="_blank" class="icon facebook active"></a>
							</c:if>
							<c:if test="#{publicportfolio.socialNetworksData.facebookLink == null or 
										publicportfolio.socialNetworksData.facebookLink.length() == 0}">
								<span class="icon facebook inactive"></span>
							</c:if>
							
							<c:if test="#{publicportfolio.socialNetworksData.gplusLink != null and 
										publicportfolio.socialNetworksData.gplusLink.length() > 0}">
								<a href="#{publicportfolio.socialNetworksData.gplusLink}"
									onclick="sendLogPageNavigation('#{publicportfolio.socialNetworksData.gplusLink}', 'profile.${userId}.info.socialNetworks.gplus');"
									target="_blank" class="icon gplus active"></a>
							</c:if>
							<c:if test="#{publicportfolio.socialNetworksData.gplusLink == null or 
										publicportfolio.socialNetworksData.gplusLink.length() == 0}">
								<span class="icon gplus inactive"></span>
							</c:if>
							
							<c:if test="#{publicportfolio.socialNetworksData.blogLink != null and 
										publicportfolio.socialNetworksData.blogLink.length() > 0}">
								<a href="#{publicportfolio.socialNetworksData.blogLink}"
									onclick="sendLogPageNavigation('#{publicportfolio.socialNetworksData.blogLink}', 'profile.${userId}.info.socialNetworks.blog');"
									target="_blank" class="icon blog active"></a>
							</c:if>
							<c:if test="#{publicportfolio.socialNetworksData.blogLink == null or 
										publicportfolio.socialNetworksData.blogLink.length() == 0}">
								<span class="icon blog inactive"></span>
							</c:if>
						</h:panelGroup>
						
						<utilcomp:lazyLoad 
							parentClass="socialNetworks"
							updateOnComplete=":socialNetworksContainer"
							loaderContainer=".socialNetworksContainer"
							initializeAction="#{publicportfolio.initSocialNetworks()}"
						/>
					</div>
					
					<div class="userInterests">
						<port:userinterests id="userInterests" edit="false" user="#{publicportfolio.profileOwner}"/>
					</div>
				</div>
				
				<div class="clear separator"></div>
			</div>
			
			<div id="learning">
				<ui:include src="/resources/components/publicprofile/learning.xhtml" />
				
				<div class="clear separator"></div>
			</div>
			
			<div id="competences">
				<ui:include src="/resources/components/publicprofile/competences.xhtml" />
				
				<div class="clear separator"></div>
			</div>
			
			<div id="credits">
				<ui:include src="/resources/components/publicprofile/externalCredits.xhtml" />

				<div class="clear separator"></div>
			</div>
			
			<dlg:appendedActivities id="appActivities"/>
			
			<div id="statuswall">
				<h1 class="marginBottom10">Status Wall</h1>
				<div class="clear"></div>
			
				<div class="main">
					<comp:activitywall id="mainActivityWall"
						value="mainActivityWall"
						refreshRate="#{activitywall.refreshRate}"
						moreToLoadIndicator="#{publicportfolio.moreToLoad}"
						allActivities="#{publicportfolio.allActivities}"
						initializeHandler="#{publicportfolio.initializeActivities()}"
						loadMoreHandler="#{publicportfolio.loadMoreActivities()}"
						refreshHandler="#{publicportfolio.refresh()}"
						oncomplete="registerLazyLoadCompleted();"
						noOptions="true"
						context="profile.#{userId}.statusWall"
					/>
				</div>
			</div>
		</div><!-- .content -->
	
		<div class="clear"></div>
	</div><!-- .container end -->
	
	<dlg:evaluationList displayDetails="false" />
	<ui:include src="/resources/components/dialogs/badgeList.xhtml" />
	<ui:include src="/resources/components/dialogs/courseDetails.xhtml" />

</ui:define>
</ui:composition>