<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:comp="http://java.sun.com/jsf/composite/components"
	template="templates/masterLayout2.xhtml"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:dlg="http://java.sun.com/jsf/composite/components/dialogs"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:util="http://www.prosolo.com/util"
	xmlns:courses="http://java.sun.com/jsf/composite/components/courses">

	<ui:define name="windowTitle">
		ProSolo - #{credentialEditBean.pageHeaderTitle}
	</ui:define>

	<ui:define name="metadata">
		<f:metadata>
			<f:viewParam name="id" value="#{credentialEditBean.id}"></f:viewParam>
			<f:viewAction action="#{credentialEditBean.init()}" />
		</f:metadata>
	</ui:define>
	
	<ui:define name="resourceTitle">
		<h:panelGroup id="panelTitle">
	    	<h1>#{credentialEditBean.pageHeaderTitle} 
	    		<h:panelGroup rendered="#{credentialEditBean.credentialData.id > 0 and !credentialEditBean.credentialData.published}">
	    			(Draft)
	    		</h:panelGroup>
	    	</h1>
	    </h:panelGroup>
    </ui:define>

	<ui:define name="content">
		<link rel="stylesheet" type="text/css" media="all" href="#{request.contextPath}/resources/css2/bootstrap-tagsinput.css" />
		<script src="https://use.typekit.net/zvv0dgl.js"></script>
    	<script>try{Typekit.load({ async: true });}catch(e){}</script>
    	<script src="#{request.contextPath}/resources/javascript2/bootstrap-tagsinput.min.js"></script>
    	<script src="#{request.contextPath}/resources/javascript2/search.js"></script>
    	<script src="#{request.contextPath}/resources/javascript2/createCredential.js?#{applicationbean.loginTime}"></script>

    <div class="whiteBar">

    </div>
	<h:form id="formMain">
		<p:growl id="growlMain" showDetail="true" globalOnly="true"></p:growl>
		
		<div class="container">
			<div class="row">
				<h:inputHidden id="hiddenType" value="#{credentialEditBean.credentialData.typeString}" />
				<div class="col-md-8">
					<div class="whiteBox">
						<ul class="nav nav-tabs pageSubmenu" role="tablist">
							<li role="presentation" class="active"><a href="#info" aria-controls="info" role="tab" data-toggle="tab">Credential Info</a></li>
							<li role="presentation"><a href="#competences" aria-controls="competences" role="tab" data-toggle="tab">Competences</a></li>
						</ul>
					</div>
					
					<div class="tab-content">
						<div role="tabpanel" class="tab-pane fade in active" id="info">
							<div class="whiteBox">
								<h2>Credential Info</h2>
								
								<div class="formWrapper">
									<div class="formLine">
										<label>Title</label>
										<div class="formLineRight">
											<h:inputText 
												styleClass="pasteable"
												id="inputTitle" 
												value="#{credentialEditBean.credentialData.title}" 
												onkeypress="updateStatusToDraft();"/>
										</div>
									</div>
									
									<div class="formLine">
										<label>About credential</label>
										<div class="formLineRight">                           
											<h:inputTextarea 
												styleClass="pasteable"
												id="inputDescription" 
												value="#{credentialEditBean.credentialData.description}"
												onkeypress="updateStatusToDraft();"></h:inputTextarea>
										</div>
									</div>
									
									<div class="formLine">
										<label>Keywords</label>
										
										<div class="formLineRight">
											<h:inputText id="inputKeywords" styleClass="tagsInputCredTag"
												value="#{credentialEditBean.credentialData.tagsString}"
												pt:placeholder="Type and press 'Enter'"
												pt:data-role="tagsinput" />
										</div>
									</div>
									
									<script>$('.tagsInputCredTag').tagsinput();</script>
									
									<div class="formLine">
										<label>Twitter hashtags</label>
										
										<div class="formLineRight">
											<h:inputText id="inputHashtags" styleClass="tagsInputCredHahstag"
											value="#{credentialEditBean.credentialData.hashtagsString}"
											pt:placeholder="Type and press 'Enter'"
											pt:data-role="tagsinput" />
										</div>
									</div>
									<script>$('.tagsInputCredHahstag').tagsinput();</script>
								</div>
							</div>
						</div>
			            
						<div role="tabpanel" class="tab-pane fade mandatoryFlow" id="competences">
							<courses:compList 
								id="compList"
								bean="#{credentialEditBean}"
								competences="#{credentialEditBean.credentialData.competences}"
								isEdit="true"
								startedLearning="false"
								toUpdate=":formMain:credSidebar"/>
		
							<div class="mandatoryArrow"></div>
		                        
							<div class="newCompetenceBox">
								<div class="elementsWrapper">
									<ui:remove><h:link 
										value="Create New Competence" 
										outcome="/create-competence">
										<f:param name="credId" value="#{util:encodeId(comp.competenceId)}" />
									</h:link></ui:remove>
									
									<p:commandLink
										styleClass="btn btn-green"
										value="Create New Competence"
										action="#{credentialEditBean.saveAndNavigateToCreateCompetence}" />
										
									<span>or</span>
	
									<div class="elementsRight">
										<p:remoteCommand name="execSearchComps" process="inputCompName"
											update=":formMain:panelCompSearchResults"
											action="#{credentialEditBean.searchCompetences()}" />
										
										<h:inputText id="inputCompName"
											styleClass="competenceSearchField"
											value="#{credentialEditBean.compSearchTerm}"
											placeholder="Add existing one" 
											onclick="$(this).select();"
											onkeyup="showSearchResults('.searchResultsDrop', '.competenceSearchField');searchIfNeeded('.competenceSearchField', execSearchComps);return false;">
										</h:inputText>
										
										<h:panelGroup id="panelCompSearchResults">
											<ul class="dropdown-menu searchResultsDrop" style="display:block;">
												<ui:repeat var="comp" value="#{credentialEditBean.compSearchResults}">
													<li>
														<p:commandLink
															process="@this"
															action="#{credentialEditBean.addComp(comp)}"
															update=":formMain:compList :formMain:panelCompSearchResults"
															oncomplete="$('.competenceSearchField').val(''); $('.searchResultsDrop').first().stop(true, true).slideUp(10);">
															<h3>#{comp.title}</h3>
														</p:commandLink>
													</li>
												</ui:repeat>
											</ul>
										</h:panelGroup>
	
										<a href="#">Recommended Competences</a>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				
	            <div class="col-md-4">
	            	<courses:rightSideBar
	            		id="credSidebar"
	            		chooseOptionText="Mandatory flow"
	            		chooseOptionValue="#{credentialEditBean.credentialData.mandatoryFlow}"
	            		publishValues="#{credentialEditBean.courseStatusArray}" 
	            		publishValue="#{credentialEditBean.credentialData.status}"
	            		saveAction="#{credentialEditBean.save}"
	            		toUpdate=":formMain :panelTitle" 
	            		previewAction="#{credentialEditBean.preview}"
	            		linkPreviewClass="hiddenLinkPreview"/>
	            		
	            	<h:link
						style="display: none;"
						styleClass="hiddenLinkPreview"
						target="_blank"
						outcome="/credential">
						<f:param name="id" value="#{credentialEditBean.id}"></f:param>
						<f:param name="mode" value="preview"></f:param>
					</h:link>
	            		
	                <ui:remove><div class="whiteBox publishBox">
	                    <h2>Publish</h2>
	                    <a href="#" class="linkPreview">Preview</a>             
	                    	
	                    <div class="clear"></div>
	                    <div class="checkbox checkLine">
	                        <input type="checkbox" id="checkMandatory"></input>
	                        <label for="checkMandatory">Mandatory flow</label>
	                    </div>
	                    <select class="selectpicker">
	                        <option>Draft</option>
	                        <option>Published</option>
	                    </select>
	                    <div class="publishRow">
	                        <a href="#" class="btn btn-green">Save Changes</a>
	                        <a href="#" class="linkRed">Delete</a>
	                    </div>
	                </div></ui:remove>
	            </div>
	            
	            <script>         		
					document.getElementById('formMain:hiddenType').value = "user_created";
	            </script>
	        </div>
	    </div>
    </h:form>
    
    <h:form id="formRemoveComp">
    	<div class="modal fade" id="modalRemoveComp" tabindex="-1" role="dialog" aria-labelledby="removeCompetence">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&#215;</span></button>
                        <h2 class="modal-title" id="removeCompetence1">Remove Competence?</h2>
                    </div>
                    <div class="modal-body">
                        <p>Are you sure you want to remove this competence from credential?<br></br><br></br>
                        <small>Note: Competence will not be deleted entirely. In order to do that, go to competence Edit > Delete.</small></p>
                    </div>
                    <div class="modal-footer">
                    	<p:commandLink
                    		value="Remove"
                    		styleClass="btn btn-red"
                    		process="@this"
                    		action="#{credentialEditBean.removeComp()}"
                    		update=":formMain:compList :formMain:credSidebar"
                    		oncomplete="$('#modalRemoveComp').modal('hide');">
                    	</p:commandLink>
                        <a href="#" class="btn btn-default" data-dismiss="modal">Cancel</a>
                    </div>
                </div>
            </div>
        </div>
    </h:form>
    
    <courses:deleteModalDialog      
    	deleteActionMethodName="delete"  	
		deleteAction="#{credentialEditBean.delete}"
		toUpdate=":formMain :panelTitle" 
		modalDeleteTitle="Credential"
		modalDeleteText="credential"/>
	
</ui:define>
</ui:composition>
