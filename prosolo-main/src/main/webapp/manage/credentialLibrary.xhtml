<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:comp="http://java.sun.com/jsf/composite/components"
	template="templates/masterLayout2.xhtml"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:dlg="http://java.sun.com/jsf/composite/components/dialogs"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:util="http://www.prosolo.com/util"
	xmlns:courses="http://java.sun.com/jsf/composite/components/courses">

	<ui:define name="windowTitle">
		Library - Credential
	</ui:define>

	<ui:define name="metadata">
		<f:metadata>
			<f:viewParam name="p" value="#{credentialLibraryBeanManager.paginationData.pageString}" default="1" />
			<f:viewAction action="#{credentialLibraryBeanManager.init()}" />
		</f:metadata>
	</ui:define>

    <ui:define name="resourceTitle">
    	<h1>Library</h1>
    </ui:define>
    
    <ui:define name="navLinks">
		<ul class="nav nav-tabs headerSubmenu">
			<li role="presentation" class="active">
				<a href="javascript:void(0);">Credentials</a>
			</li>
			<li role="presentation">
				<h:link outcome="competenceLibrary">
					Competencies
				</h:link>
			</li>
		</ul>
    </ui:define>
    
	<ui:define name="content">
	<script src="#{request.contextPath}/resources/javascript2/search.js"></script>
	<p:growl id="growlMain" showDetail="true"></p:growl>
    <div class="whiteBar">
        <div class="container">
            <div class="whiteBarContent">
                <div class="whiteBarLeft">
                	<h:form id="formSearch">
	                    <div class="searchBox">
	                    	<p:remoteCommand 
	                    		name="execSearchCredentials" 
	                    		process=":formSearch:inputCredName"
								update=":panelCredentials :pagination"
								action="#{credentialLibraryBeanManager.resetAndSearch()}">
							</p:remoteCommand>
								
							<h:inputText id="inputCredName"
								type="search"
								placeholder="Search Credentials"
								value="#{credentialLibraryBeanManager.searchTerm}"
								onclick="$(this).select();"
								onkeyup="searchListener(execSearchCredentials);">
							</h:inputText>              
	                    </div>
	                </h:form>
                </div>
                <div class="whiteBarRight">
                    <div class="dropdown sortDrop item">
                        <span>Sort:</span>
                        <h:link 
                        	id="linkSortOption" 
                        	pt:data-toggle="dropdown" 
                        	pt:aria-haspopup="true" 
                        	pt:aria-expanded="true">
                            #{credentialLibraryBeanManager.sortOption.label}
                            <span class="arrowDown">arrowDown</span>
                        </h:link>
                        <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenu1">
                        	<ui:repeat var="sortOption" value="#{credentialLibraryBeanManager.sortOptions}">
                        		<li>
	                        		<p:commandLink 
	                        			process="@this"
	                        			value="#{sortOption.label}"
			                        	action="#{credentialLibraryBeanManager.applySortOption(sortOption)}"
			                        	update=":panelCredentials :linkSortOption">
			                        </p:commandLink>
			                    </li>
                        	</ui:repeat>      
                        </ul>
                    </div>
                    <div class="dropdown showDrop item">
                        <span>Show:</span>
                        <h:link 
                        	id="linkSearchFilter"
                        	pt:data-toggle="dropdown" 
                        	pt:aria-haspopup="true" 
                        	pt:aria-expanded="true">
                            #{credentialLibraryBeanManager.searchFilter.label}
                            <span class="arrowDown">arrowDown</span>
                        </h:link>
                        <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenu1">
                        	<ui:repeat var="searchFilter" value="#{credentialLibraryBeanManager.searchFilters}">
                        		<li>
	                        		<p:commandLink 
	                        			process="@this"
	                        			value="#{searchFilter.label}"
			                        	action="#{credentialLibraryBeanManager.applySearchFilter(searchFilter)}"
			                        	update=":panelCredentials :pagination :linkSearchFilter">
			                        </p:commandLink>
			                	</li>
                        	</ui:repeat>       
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <h:panelGroup layout="block" id="panelCredentials" styleClass="col-md-12">
            	<ui:repeat var="cred" value="#{credentialLibraryBeanManager.credentials}">
	                <article class="whiteBox credentialCard">
	                    <div class="credentialCardTop innerWrapper">
	                        <h2>
	                        	<h:link outcome="/manage/credential">
			                    	#{cred.title}
			                    	<f:param name="id" value="#{util:encodeId(cred.id)}"></f:param>
			                    </h:link>
	                        </h2>
	                        <div class="credentialCardTopOptions">
	                        	<h:link
			                    	outcome="/manage/create-credential" 
			                    	styleClass="btn btn-green-stroke btn-sm">
			                    	Edit
			                    	<f:param name="id" value="#{util:encodeId(cred.id)}"></f:param>
			                    </h:link>
			                    <h:link outcome="/manage/credential">
			                    	Preview
			                    	<f:param name="id" value="#{util:encodeId(cred.id)}"></f:param>
			                    </h:link>
			                    <p:commandLink rendered="#{not cred.archived}"
			                  	  	value="Archive"
			                  	  	styleClass="linkRed"
			                  	  	process="@this"
			                  	  	action="#{credentialLibraryBeanManager.selectCredential(cred)}"
			                  	  	update=":archiveDialog"
			                  	  	oncomplete="$('#archiveModal').modal('show');">
			                  	</p:commandLink>
			                  	<p:commandLink rendered="#{cred.archived}"
			                  	  	value="Restore"
			                  	  	process="@this"
			                  	  	action="#{credentialLibraryBeanManager.selectCredential(cred)}"
			                  	  	update=":restoreDialog"
			                  	  	oncomplete="$('#restoreModal').modal('show');">
			                  	</p:commandLink>
	                        </div>
	                    </div>
	                    <div class="deliveriesList">
	                    	<ui:fragment rendered="#{empty cred.deliveries}">
	                    		<p class="noDeliveres">No active deliveries.</p>
	                    	</ui:fragment>
	                    	<ui:fragment rendered="#{not empty cred.deliveries}">
		                        <courses:deliveryItems
		                        	deliveries="#{cred.deliveries}"
		                        	showNumberOfStudentsAndInstructors="false"
		                        	canEdit="true"
		                        />
		                    </ui:fragment>
	                    </div>
	                </article>
	            </ui:repeat>
            </h:panelGroup>
        </div>

        <utilcomp:pagination
        	id="pagination" 
        	bean="#{credentialLibraryBeanManager}"
        	updateUrl="true"
        	toUpdate=":panelCredentials"
        />

    </div>
    
    <dlg:archiveResource
    		id="archiveDialog"
			archiveActionMethodName="archive"  	
			archiveAction="#{credentialLibraryBeanManager.archive}"
			toUpdate=":pagination :panelCredentials :formSearch :growlMain"
			title="Credential" 
			resourceType="credential"
			resourceTypePlural="credentials"
			learningContext="name:library|context:/name:credential|id:#{credentialLibraryBeanManager.selectedCred.id}/"/>
			
	<dlg:restoreResource
    		id="restoreDialog"
			restoreActionMethodName="restore"  	
			restoreAction="#{credentialLibraryBeanManager.restore}"
			toUpdate=":pagination :panelCredentials :formSearch :growlMain"
			title="Credential" 
			resourceType="credential"
			resourceTypePlural="credentials"
			learningContext="name:library|context:/name:credential|id:#{credentialLibraryBeanManager.selectedCred.id}/"/>
  
  </ui:define>
</ui:composition>
