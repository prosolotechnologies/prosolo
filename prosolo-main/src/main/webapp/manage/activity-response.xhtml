<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:comp="http://java.sun.com/jsf/composite/components"
	template="templates/masterLayout2.xhtml"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:dlg="http://java.sun.com/jsf/composite/components/dialogs"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:util="http://www.prosolo.com/util"
	xmlns:activities="http://java.sun.com/jsf/composite/components/activities"
	xmlns:post="http://java.sun.com/jsf/composite/components/post">

	<ui:define name="windowTitle">
		Activity Response
	</ui:define>

	<ui:define name="metadata">
		<f:metadata>
			<f:viewParam name="targetActId" value="#{activityResultsBeanManager.targetActId}" default="null" />
			<f:viewParam name="actId" value="#{activityResultsBeanManager.actId}" default="null" />
			<f:viewParam name="compId" value="#{activityResultsBeanManager.compId}" default="null"/>
			<f:viewParam name="credId" value="#{activityResultsBeanManager.credId}" default="null"/>
			<f:viewParam name="comment" value="#{activityResultsBeanManager.commentId}" default="null"/>
			<f:viewAction action="#{activityResultsBeanManager.initIndividualResponse()}" />
		</f:metadata>
	</ui:define>

    <ui:define name="resourceTitle">
    	<h1>#{activityResultsBeanManager.activity.title}</h1>
    </ui:define>
    
	<ui:define name="content">
	<h:outputStylesheet library="css2" name="bootstrap-slider.css"  />
	<script	src="#{request.contextPath}/resources/javascript2/bootstrap-slider.min.js"></script>
	<script>
		$(function() {
			if(#{not empty param['comment']}) {
				if(#{activityResultsBeanManager.currentResult.resultComments.initialized}) {
					$('#commentsContainerDiv#{activityResultsBeanManager.currentResult.targetActivityId}').collapse();
				}
				scrollTo('comment_' + #{util:decodeId(param['comment'])});
			}	
		});
		
		function markDiscussionAsSeen(discussionId, parentElement) {
			markActivityDiscussionRead([{name:'encodedActivityDiscussionId', value:discussionId}])
			$(parentElement).removeClass( "hasNewComments" );
		}
	</script>
	<ui:param name="canEdit" value="#{request.isUserInRole('MANAGE.CONTENT.EDIT') and activityResultsBeanManager.access.canEdit}" />
	<h:form prependId="false" id="remoteCommandForm">
		<p:remoteCommand action="#{activityResultsBeanManager.markDiscussionRead()}" name="markActivityDiscussionRead"></p:remoteCommand>
	</h:form>
	
	<ui:param name="learningContext" value="name:credential|id:#{activityResultsBeanManager.decodedCredId}|context:/name:competence|id:#{activityResultsBeanManager.decodedCompId}|context:/name:activity|id:#{activityResultsBeanManager.decodedActId}|context:/name:target_activity|id:#{activityResultsBeanManager.decodedTargetActId}|context:/name:RESULTS////"/>
	<p:growl id="growlMain" showDetail="true" globalOnly="true" />
	
    <div class="whiteBar">
        <div class="container">
            <activities:activityHeaderOptions
				bean="#{activityResultsBeanManager}"
				activity="#{activityResultsBeanManager.activity}"
				learningContext="#{learningContext}"
				canEdit="#{canEdit}"
			/>
        </div>
    </div>

    <div class="container">
    	<ui:fragment rendered="#{activityResultsBeanManager.credentialId != 0}">
	    	<ol class="breadcrumb">
	            <li>
	            	<h:link value="Credentials" outcome="/manage/credentialLibrary"/>
	            </li>
	            <li>
	            	<h:link 
	            		value="#{activityResultsBeanManager.credentialTitle}"
	            		outcome="/manage/credential"
	            		onclick="sendLogPageNavigation('/manage/credential.xhtml', 
								'#{facesContext.viewRoot.viewId}', 
								'#{util:addSubContext(learningContext, &#34;name:breadcrumbs|context:/name:CREDENTIAL|id:&#34;.concat(activityResultsBeanManager.decodedCredId).concat(&#34;/&#34;))}', 
								'');">
	            		<f:param name="id" value="#{param['credId']}"></f:param>
	            	</h:link>
	            </li>
	            <li>
	            	<h:link 
	            		value="#{activityResultsBeanManager.competenceTitle}"
	            		outcome="/manage/competence"
	            		onclick="sendLogPageNavigation('/manage/competence.xhtml', 
								'#{facesContext.viewRoot.viewId}', 
								'#{util:addSubContext(learningContext, &#34;name:breadcrumbs|context:/name:COMPETENCE|id:&#34;.concat(activityResultsBeanManger.decodedCompId).concat(&#34;/&#34;))}', 
								'');">
	            		<f:param name="compId" value="#{param['compId']}"></f:param>
	            		<f:param name="credId" value="#{param['credId']}"></f:param>
	            	</h:link>
	            </li>
	            <li>
	            	<h:link 
	            		value="#{activityResultsBeanManager.activity.title}"
	            		outcome="/manage/activity"
	            		onclick="sendLogPageNavigation('/manage/activity.xhtml', 
								'#{facesContext.viewRoot.viewId}', 
								'#{util:addSubContext(learningContext, &#34;name:breadcrumbs|context:/name:activity|id:&#34;.concat(activityResultsBeanManager.decodedActId).concat(&#34;/&#34;))}', 
								'');">
						<f:param name="actId" value="#{param['actId']}"></f:param>
	            		<f:param name="compId" value="#{param['compId']}"></f:param>
	            		<f:param name="credId" value="#{param['credId']}"></f:param>
	            	</h:link>
	            	
	            </li>
	            <li>
	            	<h:link
	            		outcome="/manage/activity-responses"
	            		onclick="sendLogPageNavigation('/manage/activity-responses.xhtml', 
								'#{facesContext.viewRoot.viewId}', 
								'#{util:addSubContext(learningContext, &#34;name:breadcrumbs|context:/name:result|id:&#34;.concat(activityResultsBeanManager.targetActivityId).concat(&#34;/&#34;))}', 
								'');">
	            		<f:param name="credId" value="#{param['credId']}" />
		            	<f:param name="compId" value="#{param['compId']}" />
		            	<f:param name="actId" value="#{param['actId']}" />
	            		Responses
	            	</h:link>
	            </li>
	            <li class="active">
	            	#{activityResultsBeanManager.resultOwnerFullName}
	            </li>
	        </ol>
	     </ui:fragment>
	     <ui:fragment rendered="#{activityResultsBeanManager.credentialId == 0}">
       		<ol class="breadcrumb">	 
    			<li>
    				<h:link value="Competencies" outcome="competenceLibrary"/>
	            </li> 
    			<li>
	            	<h:link 
	            		value="#{activityResultsBeanManager.competenceTitle}"
	            		outcome="/manage/competence"
	            		onclick="sendLogPageNavigation('/manage/competence.xhtml', 
								'#{facesContext.viewRoot.viewId}', 
								'#{util:addSubContext(learningContext, &#34;name:breadcrumbs|context:/name:COMPETENCE|id:&#34;.concat(activityResultsBeanManger.decodedCompId).concat(&#34;/&#34;))}', 
								'');">
	            		<f:param name="compId" value="#{param['compId']}"></f:param>
	            	</h:link>
	            </li>         
	            <li>
	            	<h:link 
	            		value="#{activityResultsBeanManager.activity.title}"
	            		outcome="/manage/activity"
	            		onclick="sendLogPageNavigation('/manage/activity.xhtml', 
								'#{facesContext.viewRoot.viewId}', 
								'#{util:addSubContext(learningContext, &#34;name:breadcrumbs|context:/name:activity|id:&#34;.concat(activityResultsBeanManager.decodedActId).concat(&#34;/&#34;))}', 
								'');">
						<f:param name="actId" value="#{param['actId']}"></f:param>
	            		<f:param name="compId" value="#{param['compId']}"></f:param>
	            	</h:link>
	            </li>
	            <li>
	            	<h:link
	            		outcome="/manage/activity-responses"
	            		onclick="sendLogPageNavigation('/manage/activity-responses.xhtml', 
								'#{facesContext.viewRoot.viewId}', 
								'#{util:addSubContext(learningContext, &#34;name:breadcrumbs|context:/name:result|id:&#34;.concat(activityResultsBeanManager.targetActivityId).concat(&#34;/&#34;))}', 
								'');">
		            	<f:param name="compId" value="#{param['compId']}" />
		            	<f:param name="actId" value="#{param['actId']}" />
	            		Responses
	            	</h:link>
	            </li>
	            <li class="active">
	            	#{activityResultsBeanManager.resultOwnerFullName}
	            </li>
	        </ol>
       </ui:fragment>
    </div>

    <div class="container">
        <div class="row">
            <div class="col-md-8">
            	<h:panelGroup id="panelUploadAssignment">
	                <h2>Activity Response</h2>
	                <activities:activityResult
	               	 	bean="#{activityResultsBeanManager}"
	           			resultData="#{activityResultsBeanManager.currentResult}"
	           			resultType="#{activityResultsBeanManager.activityResultType}"
	           			learningContext="#{learningContext}"
	           			role="MANAGER"
	           			assignmentUploadModalId=""
	           			growlToUpdate=":growlMain"
	           			regionToUpdate=""
	           			privateConvModalId="assessmentCommentsModal1"
	           			toUpdateConvModal=":commentModal:formPrivateConversation:panelModalPrivateConversation"
	           			privateConvNumberOfMsgsLink="privateConvMsgsNoLink_#{activityResultsBeanManager.currentResult.targetActivityId}"
	           			assessmentGradeModalId="assessmentGradeModal1"
	           			gradeLink="gradeLink_#{activityResultsBeanManager.currentResult.targetActivityId}"
	           			toUpdateAssessmentGradeModal=":activityGradeModal:formGradeModal:panelGradeModal"
	           		/>
	           	</h:panelGroup>
            </div>
        </div>
    </div>
    
	<activities:activityCommentModal 
    	id="commentModal"
		toUpdate=":growlMain"/>
    
    <activities:activityGradeModal
    	id="activityGradeModal"
   	 	bean="#{activityResultsBeanManager}"
		assessment="#{not empty activityResultsBeanManager.currentResult ? activityResultsBeanManager.currentResult.assessment : null}"
		toUpdate=":growlMain @(.gradeLink_#{activityResultsBeanManager.currentResult.targetActivityId})"
		minGrade="#{activityResultsBeanManager.activity.gradeOptions.minGrade}"
		maxGrade="#{activityResultsBeanManager.activity.gradeOptions.maxGrade}"
		learningContext="#{learningContext}"
	/>
    
</ui:define>
</ui:composition>
