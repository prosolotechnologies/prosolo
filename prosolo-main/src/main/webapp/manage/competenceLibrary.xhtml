<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:comp="http://java.sun.com/jsf/composite/components"
	template="templates/masterLayout2.xhtml"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:dlg="http://java.sun.com/jsf/composite/components/dialogs"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:util="http://www.prosolo.com/util"
	xmlns:competences="http://java.sun.com/jsf/composite/components/competences"
	xmlns:dialogs="http://java.sun.com/jsf/composite/components/dialogs"
	xmlns:compDialogs="http://java.sun.com/jsf/composite/components/dialogs/competences">

	<ui:define name="windowTitle">
		Library - Competencies
	</ui:define>

	<ui:define name="metadata">
		<f:metadata>
			<f:viewParam name="p" value="#{competenceLibraryBeanManager.paginationData.pageString}" default="1" />
			<f:viewAction action="#{competenceLibraryBeanManager.init()}" />
		</f:metadata>
	</ui:define>

    <ui:define name="resourceTitle">
    	<h1>Library</h1>
    </ui:define>
    
    <ui:define name="navLinks">
		<ul class="nav nav-tabs headerSubmenu">
			<li role="presentation">
				<h:link outcome="credentialLibrary">
					Credentials
				</h:link>
			</li>
			<li role="presentation" class="active">
				<a href="javascript:void(0)">Competencies</a>
			</li>
		</ul>
    </ui:define>
    
	<ui:define name="content">
		<script src="#{request.contextPath}/resources/javascript2/search.js"></script>
		<p:growl id="growlMain" showDetail="true" globalOnly="true" />
		
	    <div class="whiteBar">
	        <div class="container">
	            <div class="whiteBarContent">
	                <div class="whiteBarLeft">
	                	<h:form id="formSearch">
		                    <div class="searchBox">
		                    	<p:remoteCommand 
		                    		name="execSearchCompetences" 
		                    		process=":formSearch:inputCompName"
									update=":panelCompetences :pagination"
									action="#{competenceLibraryBeanManager.resetAndSearch()}">
								</p:remoteCommand>
									
								<h:inputText id="inputCompName"
									type="search"
									styleClass="competencesSearchField"
									placeholder="Search Competencies"
									value="#{competenceLibraryBeanManager.searchTerm}"
									onclick="$(this).select();"
									onkeyup="searchListener(execSearchCompetences);">
								</h:inputText>              
		                    </div>
		                </h:form>
	                </div>
	                <div class="whiteBarRight">
	                    <div class="dropdown sortDrop item">
	                        <span>Sort:</span>
	                        <h:link 
	                        	id="linkSortOption" 
	                        	pt:data-toggle="dropdown" 
	                        	pt:aria-haspopup="true" 
	                        	pt:aria-expanded="true">
	                            #{competenceLibraryBeanManager.sortOption.label}
	                            <span class="arrowDown">arrowDown</span>
	                        </h:link>
	                        <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenu1">
	                        	<ui:repeat var="sortOption" value="#{competenceLibraryBeanManager.sortOptions}">
	                        		<li>
		                        		<p:commandLink 
		                        			process="@this"
		                        			value="#{sortOption.label}"
				                        	action="#{competenceLibraryBeanManager.applySortOption(sortOption)}"
				                        	update=":panelCompetences :pagination :linkSortOption">
				                        </p:commandLink>
				                    </li>
	                        	</ui:repeat>      
	                        </ul>
	                    </div>
	                    <div class="dropdown showDrop item">
	                        <span>Show:</span>
	                        <h:link 
	                        	id="linkSearchFilter"
	                        	pt:data-toggle="dropdown" 
	                        	pt:aria-haspopup="true" 
	                        	pt:aria-expanded="true">
	                            #{competenceLibraryBeanManager.searchFilter.label}
	                            <span class="arrowDown">arrowDown</span>
	                        </h:link>
	                        <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenu1">
	                        	<ui:repeat var="searchFilter" value="#{competenceLibraryBeanManager.searchFilters}">
	                        		<li>
		                        		<p:commandLink 
		                        			process="@this"
		                        			value="#{searchFilter.label}"
				                        	action="#{competenceLibraryBeanManager.applySearchFilter(searchFilter)}"
				                        	update=":panelCompetences :pagination :linkSearchFilter">
				                        </p:commandLink>
				                	</li>
	                        	</ui:repeat>       
	                        </ul>
	                    </div>
	                </div>
	            </div>
	        </div>
	    </div>
	
	    <div class="container">
	    	<h:panelGroup layout="block" id="panelCompetences" styleClass="row">
	            <div class="col-md-12">
	            	<ui:fragment rendered="#{empty competenceLibraryBeanManager.competences}">
						<div class="noContentMessage">
		                    <p>
		                        There are no competencies you are allowed to see currently.
		                    </p>
		                </div>
	                </ui:fragment>
	            	<ui:fragment rendered="#{not empty competenceLibraryBeanManager.competences}">
		                <ul class="whiteBox manageCompetencesList">
		                	<ui:repeat value="#{competenceLibraryBeanManager.competences}" var="comp">
			                    <li>
			                        <div class="manageCompetencesListLeft">
			                            <h2>
			                            	<h:link outcome="/manage/competence">
			                            		#{comp.title}<span>#{comp.published or comp.archived ? '' : ' (Draft)'}</span>
			                            		<f:param name="compId" value="#{util:encodeId(comp.competenceId)}"></f:param>
			                            	</h:link>
			                            </h2>
			                            <div class="competenceInfo">
			                                <div class="status">
			                                    Published#{comp.scheduledPublish ? ' Scheduled for' : ''}: <span>#{comp.formattedDatePublished}</span>
			                                </div>
			                                <div class="studentsNum">
			                                    Students: 
			                                    <ui:fragment rendered="#{comp.numberOfStudents eq 0}">
			                                    	<span>-</span>
			                                    </ui:fragment>
			                                    <ui:fragment rendered="#{comp.numberOfStudents gt 0}">
			                                    	<h:link outcome="/manage/competence-students">
			                                    		#{comp.numberOfStudents}
			                                    		<f:param name="id" value="#{util:encodeId(comp.competenceId)}" />
			                                    	</h:link>
			                                    </ui:fragment>
			                                </div>
			                            </div>
			                        </div>
			                        <div class="manageCompetencesListRight">
			                            <h:link outcome="/manage/create-competence" styleClass="btn btn-sm btn-green-stroke">
			                            	Edit
			                            	<f:param name="id" value="#{util:encodeId(comp.competenceId)}"></f:param>
			                            </h:link>
			                            <p:commandLink 
			                            	styleClass="btn btn-sm btn-green-stroke"
			                            	action="#{competenceLibraryBeanManager.prepareComp(comp)}"
			                            	update=":duplicateDialog"
			                            	oncomplete="$('#duplicateComp').modal('show');">
			                            	Duplicate
			                            </p:commandLink>
			                            <h:link outcome="/manage/competence">
			                            	Preview
			                            	<f:param name="compId" value="#{util:encodeId(comp.competenceId)}"></f:param>
			                            </h:link>
			                            <p:commandLink rendered="#{not comp.archived}"
					                  	  	value="Archive"
					                  	  	styleClass="linkRed"
					                  	  	process="@this"
					                  	  	action="#{competenceLibraryBeanManager.prepareComp(comp)}"
					                  	  	update=":archiveDialog"
					                  	  	oncomplete="$('#archiveModal').modal('show');">
					                  	</p:commandLink>
					                  	<p:commandLink rendered="#{comp.archived}"
					                  	  	value="Restore"
					                  	  	process="@this"
					                  	  	action="#{competenceLibraryBeanManager.prepareComp(comp)}"
					                  	  	update=":restoreDialog"
					                  	  	oncomplete="$('#restoreModal').modal('show');">
					                  	</p:commandLink>
			                        </div>
			                    </li>
			                </ui:repeat>
		                </ul>
		             </ui:fragment>
	            </div>
	        </h:panelGroup>
	
	       <utilcomp:pagination
	        	id="pagination" 
	        	bean="#{competenceLibraryBeanManager}"
	        	updateUrl="true"
	        	toUpdate=":panelCompetences"
	        />
	
	    </div>
	    
	    <dialogs:archiveResource
	    		id="archiveDialog"
	    		competence="#{competenceLibraryBeanManager.selectedComp}"      
				archiveActionMethodName="archive"  	
				archiveAction="#{competenceLibraryBeanManager.archive}"
				toUpdate=":pagination :panelCompetences :formSearch :growlMain"
				title="Competency" 
				resourceType="competency"
				resourceTypePlural="competencies"
				learningContext="name:library"/>
				
		<dialogs:restoreResource
	    		id="restoreDialog"
	    		competence="#{competenceLibraryBeanManager.selectedComp}"      
				restoreActionMethodName="restore"  	
				restoreAction="#{competenceLibraryBeanManager.restore}"
				toUpdate=":pagination :panelCompetences :formSearch :growlMain"
				title="Competency" 
				resourceType="competency"
				resourceTypePlural="competencies"
				learningContext="name:library"/>
				
	 	<compDialogs:duplicateCompetence   
	 			id="duplicateDialog"   
	 			competence="#{competenceLibraryBeanManager.selectedComp}"
				duplicateActionMethodName="duplicate"  	
				duplicateAction="#{competenceLibraryBeanManager.duplicate}"
				toUpdate=":growlMain"
				learningContext="name:library"/>

</ui:define>
</ui:composition>
