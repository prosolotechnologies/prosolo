<ui:composition
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util"
	xmlns:icon="http://java.sun.com/jsf/composite/components/resourceLinks/icons"
	xmlns:link="http://java.sun.com/jsf/composite/components/resourceLinks"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">
	
	<h:panelGroup layout="block" role="tabpanel" styleClass="tab-pane fade in active" id="progression">

		<div id="svgContainer"></div>
		<h2>
			<img
				src="#{request.contextPath}/resources/images/ico-credentials.svg"
				alt="Credentials" title="Credentials" class="ico40" />
			Credentials
		</h2>

		<div class="blockRow" id="credentials">
		
			<a href="" class="sliderIconLeft">
				<i class="fa fa-angle-left"></i>
			</a>

			
			<ui:repeat var="goal" value="#{studentProfileBean.lGoals}">
				<p:commandLink
					styleClass="progressBlock #{goal.id == studentProfileBean.selectedGoal.id ? 'selected' : ''}"
					action="#{studentProfileBean.selectGoal(goal)}"
					update=":progression :lastObservationPanel" 
					oncomplete="hideObservationPanel();initProgressionTabScripts();">

					<div class="progress">
						<div class="progression bgGreen"
							style="height: #{goal.progress}%"></div>
						<div class="progressMask"></div>
						<div class="percentage">#{goal.progress}%</div>
					</div>
					<h3>#{goal.name}</h3>
				</p:commandLink>
			</ui:repeat>
			
			
			<a href="" class="sliderIconRight">
				<i class="fa fa-angle-right"></i>
			</a>

			<div class="clearfix"></div>
		</div>
		
		<script>
		$(function() {
			//initCredentialsSlider();
		});
		</script>

		<h2>
			<img
				src="#{request.contextPath}/resources/images/ico-competences.svg"
				alt="Competences" title="Competences" class="ico40" />
			Competences
		</h2>

		<div class="blockRow" id="competences">
			<a href="" class="sliderIconLeftCred"><i class="fa fa-angle-left"></i></a>
			<ui:repeat var="comp"
				value="#{studentProfileBean.selectedGoal.competences}">

				<h:panelGroup layout="block"
					styleClass="progressBlock competence #{comp.id == studentProfileBean.selectedGoal.selectedCompetence.id ? 'selected' : ''}"
					onclick="$('.hiddenCompLink[data-id=&#34;#{comp.id}&#34;]').trigger('click')">
					<div class="trophy #{comp.trophyWon ? 'achieved' : ''}">
						<i class="fa fa-trophy" data-toggle="tooltip"
							data-placement="top"
							title="#{comp.trophyWon ? 'Trophy won' : 'Trophy'}"></i>
					</div>

					<div class="progress">
						<div class="progression bgBlue"
							style="height: #{comp.progress}%"></div>
						<div class="progressMask"></div>
						<div class="percentage">#{comp.progress}%</div>
					</div>

					<h3>#{comp.name}</h3>
					<div class="blockBar">
						<div class="assessments">
							Assessments
							<div class="count">
								<span class="good">#{comp.approvedSubmissionNumber}</span> <span
									class="bad">#{comp.rejectedSubmissionNumber}</span>
							</div>
						</div>

						<div class="assessmentExpand dropup">
							<p:commandLink
								actionListener="#{studentProfileBean.loadSubmissions(comp)}"
								oncomplete="$('#assesmentDropdown').dropdown('toggle'); return false;"
								update="assesmentPanel">
								<i class="fa fa-external-link"></i>
							</p:commandLink>

							<a id="assesmentDropdown" data-target="#"
								data-toggle="dropdown" role="button" aria-haspopup="true"
								aria-expanded="false"></a>

							<h:panelGroup layout="block" id="assesmentPanel"
								styleClass="dropdown-menu" pt:aria-labelledby="dLabel">

								<div class="ddPanelHeader">
									<h4>Assessments</h4>
									<button type="button" class="close" data-dismiss="alert"
										aria-label="Close">
										<span aria-hidden="true"> <i class="fa fa-times"></i>
										</span>
									</button>
								</div>

								<div class="ddPanelBody">
									<ui:repeat value="#{comp.submissions}" var="submission">
										<div class="assessment">
											<div class="userInfo">
												<span class="userProfileImage"> <h:graphicImage
														value="#{submission.evaluator.avatar}"
														title="#{submission.evaluator.name}"
														alt="#{submission.evaluator.name}" />
												</span> <span class="date">#{submission.formattedDate}</span>
												by

												<h:link value="#{submission.evaluator.name}"
													outcome="/publicprofile">
													<f:param name="id"
														value="#{util:encodeId(submission.evaluator.id)}" />
												</h:link>
												<a href="#">#{submission.evaluator.name}</a>

												<div class="icons">
													<i
														class="fa fa-check-circle #{submission.accepted ? 'good' : 'bad'}"
														data-toggle="tooltip" data-placement="top"
														title="#{submission.accepted ? 'Passed' : 'Failed'}"></i>

													<span
														class="trophy #{submission.trophyWon ? 'achieved' : ''}">
														<i class="fa fa-trophy" data-toggle="tooltip"
														data-placement="top"
														title="#{submission.trophyWon ? 'Trophy won' : 'Trophy'}"></i>
													</span>
												</div>

											</div>
											<p>#{submission.message}</p>
										</div>
									</ui:repeat>
								</div>
							</h:panelGroup>
						</div>
					</div>
				</h:panelGroup>

				<p:commandLink styleClass="hiddenCompLink"
					style="display: none;" 
					pt:data-id="#{comp.id}"
					action="#{studentProfileBean.selectCompetence(comp)}"
					update=":progression"
					oncomplete="initProgressionTabScripts()" />
			</ui:repeat>
			<a href="" class="sliderIconRightCred"><i class="fa fa-angle-right"></i></a>
			<div class="clearfix"></div>
		</div>

		<h2>
			<img
				src="#{request.contextPath}/resources/images/ico-activities.svg"
				alt="Activities" title="Activities" class="ico40" /> Activities
		</h2>

		<div class="activities" id="activitiesBlock">
			<div class="col-md-6">
				<div class="panel-group" id="activities" role="tablist"
					aria-multiselectable="true">

					<ui:repeat var="act"
						value="#{studentProfileBean.selectedGoal.selectedCompetence.activities}">
						<div class="panel panel-default">
							<h:inputHidden value="#{act.id}"></h:inputHidden>
							<div class="panel-heading" role="tab" id="headingOne">

								<h4 id="activity#{act.id}" class="panel-title">
									<a class="done collapsed" role="button"
										data-toggle="collapse" data-parent="#activities"
										href="#act#{act.id}" aria-expanded="true"
										aria-controls="act#{act.id}"> <span
										class="hexagon #{act.completed ? 'done' : ''}"></span>
										#{act.name}
									</a>
								</h4>
							</div>

							<div id="act#{act.id}" class="panel-collapse collapse"
								role="tabpanel" aria-labelledby="headingOne">
								<div class="panel-body">
									<p>#{act.description}</p>

									<div class="fileContainer">
										<div class="col-md-10">
											<div class="fileIcon youtube">
												<i class="fa fa-youtube-square"></i>
											</div>
											<h5>
												<a href="">Introduction to Social Network Analysis</a>
											</h5>
											<div class="fileUrl">https://www.youtube.com/ea0ef897e8f18d...</div>
										</div>
										<div class="col-md-2 fileSizeTime">12:08</div>
										<div class="clearfix"></div>
									</div>
								</div>
							</div>
						</div>
					</ui:repeat>
				</div>
			</div>
			<div class="col-md-6 graph">
				Performance graph
				<div id="quadrantchart">
				<script>
				    var service = "#{studentProfileBean.completedActivitiesServicePath}";
					drawQuadrantChart(service);
				</script>
				</div>
			</div>
			<div class="clearfix"></div>
		</div>
	</h:panelGroup>
</ui:composition>