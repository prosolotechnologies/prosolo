<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:comp="http://java.sun.com/jsf/composite/components"
	template="templates/masterLayout1.xhtml"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:dlg="http://java.sun.com/jsf/composite/components/dialogs"
	xmlns:actions="http://java.sun.com/jsf/composite/components/actions"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:util="http://www.prosolo.com/util"
	xmlns:dlgComp="http://java.sun.com/jsf/composite/components/dialogs/manager"
	xmlns:mngComp="http://java.sun.com/jsf/composite/components/manage">

	<ui:define name="windowTitle">
		Reassign Students
	</ui:define>

	<ui:define name="metadata">
		<f:metadata>
			<f:viewParam name="id" value="#{studentReassignBean.id}" default="null" />
			<f:viewParam name="courseId" value="#{studentReassignBean.courseId}" default="null" />
			<f:viewParam name="courseName" value="#{studentReassignBean.courseTitle}" default="null" />
			<f:viewAction action="#{studentReassignBean.init()}" />
		</f:metadata>
	</ui:define>

	<ui:define name="content">
	
		<script>
			function searchListener(execFunction) {
				var $this = this;
				//this.updateUrlQuery(); 
				
				var delayedSearch = function(){
					execFunction();
				};
	
				window.clearTimeout(this.keystrokeTimeout);
				this.keystrokeTimeout = window.setTimeout(delayedSearch, 350);
			};
			function triggerCancelLink() {
			    document.getElementById("cancelLink").click();
			};
		</script>
		
		<mngComp:credentialsHeader
        	courseName="#{studentReassignBean.courseTitle}"
        	activeLink="Instructors"/>
        	
        <section>
			<div class="subHeader">
		   	<h3 class="title">Reassign #{studentReassignBean.instructor.name}'s students</h3>
		    <h:link id="cancelLink"
            	styleClass="btn btn-default panelButton pull-right" 
            	outcome="/manage/instructorList" 
            	pt:role="button">
            		<i class="fa fa-ban red"></i> Cancel
            		<f:param name="id" value="#{param['courseId']}" />
            		<f:param name="courseName" value="#{studentReassignBean.courseTitle}"/>
            </h:link>
		    <p:commandLink
		    	styleClass="btn btn-primary panelButton pull-right"
		    	process="@this"
		    	action="#{studentReassignBean.saveReassignedStudents()}"
		    	oncomplete="triggerCancelLink();return false;">
		    	<i class="fa fa-save"></i> Save
		    	<f:param name="page" value="#{facesContext.viewRoot.viewId}" />
		    </p:commandLink>            
		   </div>
		</section>

<section class="container-fluid mainArea fullWidth">

<div class="row fullWidthPanel">
   
     	<div class="col-md-12">
   			<div class="row">    
            	<div class="col-md-9">
               	<div class="row">
               		<h:form id="formAssignedStudents">
                  	<div class="col-md-5">
   	                  <label>#{studentReassignBean.instructor.name}'s students</label>
	                     <ul class="ddStudentsList">
	                     <ui:repeat var="student" value="#{studentReassignBean.assignedStudents}">
	                     	<li>
                           	<div class="selectionBox">
                                <ui:remove> <span class="checkbox checkbox-success checkbox-inline"> </span> </ui:remove>
                                    <h:selectBooleanCheckbox disabled="#{!student.selected and studentReassignBean.isNumberOfAssignedStudentsLimitAchieved()}"
		                     					value="#{student.selected}"
		                     					styleClass="checkbox checkbox-success checkbox-inline">
		                     					<p:ajax event="click" process="@this"
													listener="#{studentReassignBean.studentSelectionListener(student)}" 
													update=":formAssignedStudents" />
		                     		</h:selectBooleanCheckbox>
                                 <ui:remove><span></span> </ui:remove>
                              </div>
                              <div class="userInfo">
                               	  <span class="userProfileImage">
			                           <h:graphicImage value="#{student.avatarUrl}"
											title="#{student.fullName}" alt="#{student.fullName}" />
			                      </span>
		   	                      <span class="userProfileName">#{student.fullName}</span>   
                              </div>
                            </li>
	                     </ui:repeat>                 	
                        	                           
                        </ul>
                     </div>
                     </h:form>
                  	<div class="col-md-2 dd">
                     	<h3>Select and click to reassign</h3>
                     	<p:commandLink
                     		styleClass="btn btn-default"
                     		process="@this"
                     		action="#{studentReassignBean.reassignStudentsTemp()}"
                     		update=":formAssignedStudents :panelSelectedInstructorAssignedStudents ">
                     		<i class="fa fa-long-arrow-right"></i>
                     	</p:commandLink>
                     
                     </div>
							<div class="col-md-5">
                        <h:form id="formSelectInstructor">
                           <div>
                              <label>Select instructor</label>
                            	<div class="insContainer">
                              	
                                 
	                             <h:panelGroup id="panelSelectedInstructor">
	                             <h:panelGroup id="panelClickToSelect" styleClass="initial" rendered="#{!studentReassignBean.instructorSelected}">
	                             	Click to select instructor
	                             </h:panelGroup>
	                             <h:panelGroup layout="block" styleClass="userInfo" rendered="#{studentReassignBean.instructorSelected}">
	                                    <span class="userProfileImage">
	                                    	<h:graphicImage value="#{studentReassignBean.selectedInstructorData.instructor.avatarUrl}"
												title="#{studentReassignBean.selectedInstructorData.instructor.name}" alt="#{studentReassignBean.selectedInstructorData.instructor.name}" />
	                                    </span>
	                                    <span class="userProfileName">#{studentReassignBean.selectedInstructorData.instructor.name}</span>
	                             	 </h:panelGroup>
                             	 </h:panelGroup>
                                 
                               				<p:commandLink
												styleClass="btn btn-primary pull-right"
												pt:role="button" 
												pt:data-toggle="modal"
												process="@this"
												action="#{studentReassignBean.loadInstructors()}"
												oncomplete="$('.assignInstructor').modal('show');"
												update=":dlgInstructors:modalForm:assignInstructorModalContent">
												Select
											</p:commandLink> 
                                 
                                 <div class="clearfix"></div>
                              </div>
                           </div>
                        </h:form>                     
   	                  <label>Current students assigned</label>
   	                     <h:panelGroup id="panelSelectedInstructorAssignedStudents">
	                     <ul class="ddStudentsList results">
	                     	<ui:repeat var="student" value="#{studentReassignBean.selectedInstructorData.students}">
	                     		<li>
                           			<div class="userInfo">
	                           			<span class="userProfileImage">
				                           <h:graphicImage value="#{student.user.avatarUrl}"
												title="#{student.user.fullName}" alt="#{student.user.fullName}" />
				                      	</span>
		   	                     		<span class="userProfileName">#{student.user.fullName}</span>
		   	                     		<h:panelGroup rendered="#{student.new}">
		   	                     			<p:commandLink
		   	                           	   		action="#{studentReassignBean.moveStudentToAssigned(student)}"
		   	                           	   		update=":formAssignedStudents :panelSelectedInstructorAssignedStudents">
		   	                           	   		<i class="fa fa-close pull-right"></i>
		   	                     			</p:commandLink>
		   	                     		</h:panelGroup> 
                              		</div>
                           		</li>
	                     	</ui:repeat>
                                             
                        </ul>
                        </h:panelGroup>
                     </div>
                  </div>
               </div>               
				</div>
			</div>
  
		</div>



</section>

<dlgComp:instructorAssign id="dlgInstructors"
			title="Select instructor"
			bean="#{studentReassignBean}"
			searchListener="searchListener"
			instructorList="#{studentReassignBean.otherInstructorsList}"
			updateRegion=":formAssignedStudents :panelSelectedInstructorAssignedStudents :formSelectInstructor:panelSelectedInstructor" 
			page="#{facesContext.viewRoot.viewId}"/>
			

</ui:define>
</ui:composition>
