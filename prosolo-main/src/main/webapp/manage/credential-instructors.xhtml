<ui:composition xmlns="http://www.w3.org/1999/xhtml"
				xmlns:h="http://java.sun.com/jsf/html"
				xmlns:f="http://java.sun.com/jsf/core"
				xmlns:ui="http://java.sun.com/jsf/facelets"
				xmlns:p="http://primefaces.org/ui"
				template="templates/masterLayout2.xhtml"
				xmlns:c="http://java.sun.com/jsp/jstl/core"
				xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
				xmlns:mngComp="http://java.sun.com/jsf/composite/components/manage"
				xmlns:jsf="http://xmlns.jcp.org/jsf"
				xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util"
				xmlns:util="http://www.prosolo.com/util">

	<utilcomp:messagesBundle var="msg" />

	<ui:define name="windowTitle">
		#{msg['label.delivery']} - #{credentialInstructorsBean.credentialTitle} - Instructors
	</ui:define>

	<ui:define name="metadata">
		<f:metadata>
			<f:viewParam name="id" value="#{credentialInstructorsBean.id}" default="null" />
			<f:viewParam name="p" value="#{credentialInstructorsBean.paginationData.pageString}" default="1" />
			<f:viewAction action="#{credentialInstructorsBean.init()}" />
		</f:metadata>
	</ui:define>

    <ui:define name="resourceTitle">
    	<h1><span>#{msg['label.delivery']}:</span> #{credentialInstructorsBean.credentialTitle}</h1>
    </ui:define>
    
    <ui:define name="navLinks">
		<mngComp:credentialsHeaderNavLinks
			id="headerNavLinks"
			credId="#{credentialInstructorsBean.credentialId}"
			credType="Delivery"
			canEdit="true"
		/>
	</ui:define>
	
	<ui:define name="content">
	 <script src="#{request.contextPath}/resources/javascript2/search.js"></script>
	 <script src="#{request.contextPath}/resources/javascript2/credentialInstructors.js"></script>

	<h:form id="formSearch">
	    <div class="whiteBar">
	        <div class="container">
	            <div class="whiteBarContent">
	                <div class="whiteBarLeft">
	                	<p:commandLink rendered="#{credentialInstructorsBean.canEdit()}"
	                		value="New Instructor"
	                		styleClass="btn btn-green btn-sm item"
	                		pt:data-toggle="modal"
	                		process="@this"
	                		action="#{credentialInstructorsBean.prepareAddingInstructor()}"
							update=":formAddNewInstructor:addInstructorModalContent"
	                		oncomplete="$('#newInstructorModal').modal('show');">
	                	</p:commandLink>
	                	<ui:fragment rendered="#{not credentialInstructorsBean.canEdit()}">
							<a href="javascript:void(0);" 
								disabled="true"
								class="btn btn-green btn-sm item"
								data-toggle="tooltip"
								title="You are not allowed to add new instructors to this credential">
								New Instructor
							</a>
						</ui:fragment>
	                    <div class="searchBox">
	                    	<p:remoteCommand 
	                    		name="execSearchInstructors" 
	                    		process="inputInstructorSearch"
								update=":formMain:panelInstructors :formMain:pagination"
								action="#{credentialInstructorsBean.resetAndSearch()}" />							
							<h:inputText id="inputInstructorSearch"
								type="search"
								styleClass="instructorSearchField"
								placeholder="Search by name"
								value="#{credentialInstructorsBean.searchTerm}"
								onclick="$(this).select();"
								onkeyup="searchListener(execSearchInstructors);">
							</h:inputText>              
	                    </div>
	                </div>
	                
	                <div class="whiteBarRight">
	                    <h:panelGroup id="sortPanel" layout="block" styleClass="dropdown sortDrop item">
	                        <span>Sort:</span>
	                        <h:link 
	                        	id="linkSortOption" 
	                        	pt:data-toggle="dropdown" 
	                        	pt:aria-haspopup="true" 
	                        	pt:aria-expanded="true">
	                            #{credentialInstructorsBean.sortOption.label}
	                            <span class="arrowDown">arrowDown</span>
	                        </h:link>
	                        <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenu1">
	                        	<ui:repeat var="sortOption" value="#{credentialInstructorsBean.sortOptions}">
	                        		<li>
		                        		<p:commandLink 
		                        			process="@this"
		                        			value="#{sortOption.label}"
				                        	action="#{credentialInstructorsBean.applySortOption(sortOption)}"
				                        	update=":formMain:panelInstructors :formMain:pagination :formSearch:linkSortOption">
				                        </p:commandLink>
				                    </li>
	                        	</ui:repeat>      
	                        </ul>
	                    </h:panelGroup>
	                </div>
	            </div>
	        </div>
	    </div>
	</h:form>

	<div class="container">
		<ol class="breadcrumb">
			<li><h:link value="#{msg['label.credential.plural']}" outcome="credentialLibrary"></h:link></li>
			<li><h:link value="#{credentialInstructorsBean.credentialTitle}"
						outcome="/manage/create-credential">
				<f:param name="id" value="#{credentialInstructorsBean.id}"></f:param>
			</h:link></li>
			<li class="active">Instructors</li>
		</ol>
	</div>
    
	<h:form id="formMain">
		<p:growl id="growlMain" globalOnly="true" showDetail="true"/>
	    <div class="container">
	        <div class="row">
	            <h:panelGroup layout="block" id="panelInstructors" styleClass="col-md-12">
					<ui:fragment rendered="#{empty credentialInstructorsBean.instructors}" >
						<div class="noContentMessage">
							<p>
								No instructors.
							</p>
						</div>
					</ui:fragment>
	            
	                <ul class="whiteBox peopleList">
	                	<ui:repeat var="instructor" value="#{credentialInstructorsBean.instructors}">
		               		 <li>
		                        <div class="peopleListLeft">
		                        	<utilcomp:userAvatar
										avatar="#{instructor.user.avatarUrl}"
										fullName="#{instructor.user.commaSeparatedFullName}"
										width="64"
										height="64"
								    />        
		                            <div>
		                                <h2><a href="#">#{instructor.user.commaSeparatedFullName}</a></h2>
		                                <span>#{instructor.user.position}</span>
		                            </div>
		                        </div>
		                        <div class="peopleListRight">
		                            <div class="studentsNum">
		                                Students: <span class="#{instructor.full ? 'redText' : ''}">#{instructor.numberOfAssignedStudents}/#{instructor.maxNumberOfStudentsString}</span>
		                            </div>
		                            <div class="assignedTo">
		                            	<p:commandLink rendered="#{credentialInstructorsBean.canEdit()}"
					                		value="Assign Students"
					                		styleClass="btn btn-green-stroke"
					                		pt:data-toggle="modal"
					                		process="@this"
					                		action="#{studentAssignBean.prepareStudentAssign(instructor)}"
											update=":formAssignStudents:assignStudentsModalContent"
					                		oncomplete="$('#assignInstructorModal1').modal('show'); checkCheckboxes();">
					                	</p:commandLink>  
					                	<ui:fragment rendered="#{not credentialInstructorsBean.canEdit()}">
											<a href="javascript:void(0);" 
												disabled="true"
												class="btn btn-green-stroke"
												data-toggle="tooltip"
												title="You are not allowed to assign students to instructors for this credential">
												Assign Students
											</a>
										</ui:fragment>  
					                	<p:commandLink rendered="#{credentialInstructorsBean.canEdit()}"
					                		value="Remove"
					                		styleClass="linkRed"
					                		pt:data-toggle="modal"
					                		process="@this"
					                		action="#{credentialInstructorsBean.prepareInstructorForDelete(instructor)}"
					                		oncomplete="$('#removeInstructor1').modal('show');">
					                	</p:commandLink>
					                	<ui:fragment rendered="#{not credentialInstructorsBean.canEdit()}">
											<a href="javascript:void(0);" 
												disabled="true"
												class="linkRed"
												data-toggle="tooltip"
												title="You are not allowed to remove instructors from this credential">
												Remove
											</a>
										</ui:fragment>          
		                            </div>
		                        </div>
		                    </li>
	                	</ui:repeat>
	                </ul>
	            </h:panelGroup>
	        </div>
	
			<utilcomp:pagination
	        	id="pagination" 
	        	bean="#{credentialInstructorsBean}"
	        	updateUrl="true"
	        	toUpdate=":formMain:panelInstructors"
			/>
	    </div>
    </h:form>
    
    <h:form id="formAddNewInstructor">
		<div class="modal fade assignInstructorModal" id="newInstructorModal" tabindex="-1" role="dialog" aria-labelledby="assignInstructorModal">
          <div class="modal-dialog">
              <h:panelGroup layout="block" id="addInstructorModalContent" styleClass="modal-content">
                  <div class="modal-header alignLeft">
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&#215;</span></button>
                      <h2 class="modal-title">Add New Instructor</h2>
                      New instructors will automatically get View privilege
                  </div>
                  <div class="searchInstructors">
			  	  <p:remoteCommand 
                  		name="execSearchUnassignedInstructors" 
                  		process="inputUnassignedInstructorSearch"
					    update="panelUnassignedInstructors"
					    action="#{credentialInstructorsBean.searchUnassignedInstructors()}" />							
				  <h:inputText id="inputUnassignedInstructorSearch"
					    type="search"
					    placeholder="Search instructors"
						value="#{credentialInstructorsBean.instructorSearchTerm}"
						onclick="$(this).select();"
						onkeyup="searchListener(execSearchUnassignedInstructors);"/>  	
                  </div>
                  <h:panelGroup id="panelUnassignedInstructors">
	                  <ul class="list">
	                  	  <ui:repeat var="user" value="#{credentialInstructorsBean.unassignedInstructors}">
	                  	  	<li>
	                          <div class="instructorInfo">
	                          	  <utilcomp:userAvatar
										avatar="#{user.avatarUrl}"
										fullName="#{user.commaSeparatedFullName}"
										width="48"
										height="48"
								  />            
	                              <div class="infoWrap">
	                                  <h3>#{user.commaSeparatedFullName}</h3>
	                                  <span>#{user.position}</span>
	                              </div>
	                          </div>
	                          <div class="assignOpt">
	                              <div class="buttonWrapper">
	                              	  <p:commandLink
	                              	  	value="Add"
	                              	  	styleClass="btn btn-green btn-sm"
	                              	  	process="@this"
	                              	  	action="#{credentialInstructorsBean.addInstructorToCredential(user)}"
	                              	  	update=":formMain:panelInstructors :formMain:pagination :formSearch:sortPanel :formSearch:inputInstructorSearch"
	                              	  	oncomplete="$('#newInstructorModal').modal('hide');">
	                              	  </p:commandLink>
	                              </div>
	                          </div>
	                      	</li>
	                  	  </ui:repeat>
	                  </ul>
	               </h:panelGroup>
              </h:panelGroup>
          </div>
      </div>
    </h:form>
    
    <h:form id="formAssignStudents">
    	<div class="modal fade assignInstructorModal" id="assignInstructorModal1" tabindex="-1" role="dialog" aria-labelledby="assignInstructorModal">
          <div class="modal-dialog modal-lg">
              <h:panelGroup layout="block" id="assignStudentsModalContent" styleClass="modal-content">
                  <div class="modal-header alignLeft">
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&#215;</span></button>
                      <h2 class="modal-title">Assign Students to #{studentAssignBean.instructorForStudentAssign.user.fullName}</h2>
                  </div>
                  <div class="maxStudents">
                  	  <h:outputLabel 
                  	  	for="inputTextMaxNumberOfStudents" 
                  	  	value="Maxiumum number of students:"
                  	  	data-toggle="tooltip"
		              	title="If you set limit for maximum number of students, you can not use 'Select all' option to assign all unassigned students to instructor" />
                       
                      <h:inputText
                      		disabled="#{studentAssignBean.selectAll}"
                      		id="inputTextMaxNumberOfStudents" 
                      		value="#{studentAssignBean.maxNumberOfStudents}"
                      		onkeyup="setMaxNumberOfStudents();"
                      		converterMessage="Only numbers allowed">
                      </h:inputText>
					  <small class="redText"><h:message id="validationMessage" for="inputTextMaxNumberOfStudents" /></small>
                      <h:panelGroup id="panelValidationMessage"> 
                      	<ui:fragment rendered="#{studentAssignBean.limitExceeded and 
                      		empty facesContext.getMessageList('formAssignStudents:inputTextMaxNumberOfStudents')}">
                      		You have exceeded limit for maximum number of students that can be assigned
                      	</ui:fragment>
                      </h:panelGroup>
                      <p:remoteCommand
                      	name="setMaxNumberOfStudents"
                      	process="inputTextMaxNumberOfStudents"
                      	update="selectAllStudents :formAssignStudents:panelAssignLink :formAssignStudents:validationMessage :formAssignStudents:panelValidationMessage">
                      </p:remoteCommand>
                  </div>
                  <div class="searchInstructors">
                      <p:remoteCommand 
                    		name="execSearchStudents" 
                    		process="inputStudentSearch"
							update=":formAssignStudents:panelStudents :formAssignStudents:panelSearchFilters"
							action="#{studentAssignBean.resetAndSearch()}" />							
						<h:inputText id="inputStudentSearch"
							type="search"
							styleClass="studentSearchField"
							placeholder="Search students"
							value="#{studentAssignBean.studentSearchTerm}"
							onclick="$(this).select();"
							onkeyup="searchListener(execSearchStudents);">
						</h:inputText>         
                      <h:panelGroup layout="block" id="panelSearchFilters" styleClass="dropdown showDrop item">
                        <span>Show:</span>
                        <h:link 
                        	id="linkSearchFilter"
                        	pt:data-toggle="dropdown" 
                        	pt:aria-haspopup="true" 
                        	pt:aria-expanded="true">
                            #{studentAssignBean.searchFilter.filter.label} (#{studentAssignBean.searchFilter.numberOfResults})
                            <span class="arrowDown">arrowDown</span>
                        </h:link>
                        <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenu1">
                        	<ui:repeat var="searchFilter" value="#{studentAssignBean.searchFilters}">
                        		<li>
	                        		<p:commandLink 
	                        			process="@this"
	                        			value="#{searchFilter.filter.label} (#{searchFilter.numberOfResults})"
			                        	action="#{studentAssignBean.applySearchFilter(searchFilter)}"
			                        	update=":formAssignStudents:panelStudents :formAssignStudents:panelSearchFilters">
			                        </p:commandLink>
			                	</li>
                        	</ui:repeat> 
                        </ul>
                    </h:panelGroup>       
                  </div>
                  <div class="checkbox checkLine checkAll">
                  	  <h:selectBooleanCheckbox id="selectAllStudents"
                  	  		disabled="#{studentAssignBean.maxNumberOfStudents > 0}"
                         	value="#{studentAssignBean.selectAll}">
                         	<p:ajax 
	                         	event="change" 
	                         	process="@this" 
	                         	listener="#{studentAssignBean.selectAllChecked()}"
	                         	update="panelStudents inputTextMaxNumberOfStudents">
                         	</p:ajax>
                   	  </h:selectBooleanCheckbox>
                   	  <h:outputLabel 
                   	  	data-toggle="tooltip"
		              	title="If you check this option, you can not set limit for maximum number of students for instructor" 
		              	for="selectAllStudents" 
		              	value="Select All"/>
                  </div>
                  <h:panelGroup id="panelStudents">
	                  <ul class="list">
	                  	<ui:repeat id="repeat" var="student" value="#{studentAssignBean.students}" varStatus="status">
	                  		<li>
	                          <div class="instructorInfo">
	                              <div class="checkbox checkLine">
	                              	  <ui:remove><p:commandLink
	                              	  	style="display: none;"
	                              	  	pt:data-id="checkStudentHidden#{status.index}"
	                              	  	process="checkStudent1#{status.index}"
	                              	  	action="#{studentAssignBean.studentAssignChecked(status.index)}">
	                              	  </p:commandLink></ui:remove>
	                              	  <h:selectBooleanCheckbox id="selectBooleanAssignStudent"
	                              	  	styleClass="hiddenStudentLink"
	                              	  	pt:data-id="checkStudentHidden#{status.index}"
	                                    value="#{student.assigned}">
	                                    <p:ajax 
	                                    	event="change" 
	                                    	process="@this :formAssignStudents:inputTextMaxNumberOfStudents" 
	                                    	listener="#{studentAssignBean.studentAssignChecked(status.index)}"
	                                    	update=":formAssignStudents:validationMessage :formAssignStudents:panelValidationMessage :formAssignStudents:panelAssignLink">
	                                    </p:ajax>
	                              	  </h:selectBooleanCheckbox>
	                              	  <h:outputLabel for="selectBooleanAssignStudent" />
	                              	   <ui:remove><input type="checkbox" id="checkStudent1#{status.index}"
	                              	   		class="checkboxStudentAssigned"
	                              	   		value="#{student.assigned}" 
	                              	   		onchange="$('.hiddenStudentLink[data-id=&#34;checkStudentHidden#{status.index}&#34;]').trigger('click');">
	                              	   </input>
                                       <label for="checkStudent1#{status.index}">&#160;</label></ui:remove>                
	                              </div>
	                              <utilcomp:userAvatar
										avatar="#{student.user.avatarUrl}"
										fullName="#{student.user.commaSeparatedFullName}"
										width="48"
										height="48"
								  />  
	                              <div class="infoWrap">
	                                  <h3>#{student.user.commaSeparatedFullName}</h3>
	                                  <span>#{student.user.position}</span>
	                              </div>
	                          </div>
	                          <div class="progressWrapper">
	                              <div class="progressBar">
	                                  <span>#{student.progress}%</span>
	                                  <div class="progress">
	                                      <div class="progress-bar" role="progressbar" aria-valuenow="#{student.progress}" aria-valuemin="0" aria-valuemax="100" style="width: #{student.progress}%;">
	                                      </div>
	                                  </div>
	                              </div>
	                          </div>
	                      </li>
	                  	</ui:repeat>
	                  </ul>
						<utilcomp:pagination
							id="pagination1" 
							bean="#{studentAssignBean}"
							toUpdate=":formAssignStudents:panelStudents"
						/>
                  </h:panelGroup>
                  
                  <h:panelGroup layout="block" id="panelAssignLink" styleClass="modal-footer alignLeft">
                  	
               		<p:commandLink
                  	  	value="Done"
                  	  	styleClass="btn btn-green #{studentAssignBean.limitExceeded ? 'disabled' : ''}"
                  	  	disabled="#{studentAssignBean.limitExceeded}"
                  	  	action="#{studentAssignBean.assignStudents()}"
						update=":formMain:growlMain :formMain:panelInstructors :formAssignStudents:validationMessage :formAssignStudents:panelValidationMessage"
                  	  	oncomplete="if (args &amp;&amp; !args.validationFailed) { $('#assignInstructorModal1').modal('hide'); }">
                  	</p:commandLink>
                  </h:panelGroup>
			</h:panelGroup>
			</div>
		</div>
    </h:form>
    
    <h:form id="formRemoveInstructor">
    	<div class="modal fade removeInstructorModal" id="removeInstructor1" tabindex="-1" role="dialog" aria-labelledby="removeInst1">
          <div class="modal-dialog" role="document">
              <div class="modal-content">
                  <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&#215;</span></button>
                      <h2 class="modal-title" id="removeInst1">Remove instructor?</h2>
                  </div>
                  <div class="modal-body">
                      <p>Please choose an option for students assigned to this instructor:</p>
	                  <div class="radioGroup">
	                  	<div class="radio">
	                  		<c:if test="#{credentialInstructorsBean.reassignAutomatically}">
	                  			<input type="radio" jsf:id="radio1" pt:name="#{selectedOptionHidden.clientId}"
			                    value="#{true}" pt:checked="checked" />
	                  		</c:if>
	                  		<c:if test="#{!credentialInstructorsBean.reassignAutomatically}">
	                  			<input type="radio" jsf:id="radio1" pt:name="#{selectedOptionHidden.clientId}"
			                    value="#{true}"/>
	                  		</c:if>
	                  		<h:outputLabel for="radio1">Assign students to other intructors automatically</h:outputLabel>
		                </div>
		                <div class="radio">
		                	<c:if test="#{credentialInstructorsBean.reassignAutomatically}">
	                  			<input type="radio" jsf:id="radio2" pt:name="#{selectedOptionHidden.clientId}"
			                    value="#{false}" />
	                  		</c:if>
	                  		<c:if test="#{!credentialInstructorsBean.reassignAutomatically}">
	                  			<input type="radio" jsf:id="radio2" pt:name="#{selectedOptionHidden.clientId}"
			                    value="#{false}" pt:checked="checked" />
	                  		</c:if>
			                <h:outputLabel for="radio2" value="Leave students unassigned" />
		                </div>
		                <h:inputHidden id="selectedOption" binding="#{selectedOptionHidden}" value="#{credentialInstructorsBean.reassignAutomatically}"
        					rendered="#{facesContext.currentPhaseId.ordinal ne 6}" />
        				</div>
                  </div>
                  <div class="modal-footer">
                  	  <p:commandLink
                  	  	value="Remove"
                  	  	styleClass="btn btn-red"
                  	  	action="#{credentialInstructorsBean.removeInstructorFromCredential()}"
                  	  	update=":formMain:panelInstructors :formMain:growlMain"
                  	  	oncomplete="$('#removeInstructor1').modal('hide');">
                  	  </p:commandLink>
                      <a href="#" class="btn btn-default" data-dismiss="modal">Cancel</a>
                  </div>
              </div>
          </div>
      </div>
    </h:form>
	</ui:define>
</ui:composition>
