<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:comp="http://java.sun.com/jsf/composite/components"
	template="templates/masterLayout1.xhtml"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:actions="http://java.sun.com/jsf/composite/components/actions"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:util="http://www.prosolo.com/util"
	xmlns:mngComp="http://java.sun.com/jsf/composite/components/manage">

	<ui:define name="windowTitle">
		Course Instructors
	</ui:define>

	<ui:define name="metadata">
		<f:metadata>
			<f:viewParam name="id" value="#{instructorEditBean.id}" default="null" />
			<f:viewParam name="courseId" value="#{instructorEditBean.courseId}" default="null" />
			<f:viewParam name="courseName" value="#{instructorEditBean.courseTitle}" default="null" />
			<f:viewAction action="#{instructorEditBean.init()}" />
		</f:metadata>
	</ui:define>

	<ui:define name="content">
	<script>
			function searchListener(execFunction) {
				var $this = this;
				//this.updateUrlQuery(); 
				
				var delayedSearch = function(){
					execFunction();
				};
	
				window.clearTimeout(this.keystrokeTimeout);
				this.keystrokeTimeout = window.setTimeout(delayedSearch, 250);
			};
			
			function searchInstructorsIfNeeded() {
				if( $('.acField').val().length != 0 ) { 
					searchListener(execSearchInstructors); 
				}
				
			}
	</script>
	<mngComp:credentialsHeader
		courseNameField="#{instructorEditBean.courseTitle}"
		courseEncodedIdField="#{instructorEditBean.id}"
		activeLink="Instructors"/>

	<section>
		<div class="subHeader">
	   		<h3 class="title">#{instructorEditBean.title}</h3>
			<a class="btn btn-default panelButton pull-right" href="credentials-instructors.html" role="button"><i class="fa fa-ban red"></i> Cancel</a>
			<a class="btn btn-primary panelButton pull-right" href="credentials-instructors.html" role="button"><i class="fa fa-save"></i> Save</a>         
	   </div>
	</section>
	
	<section class="container-fluid mainArea fullWidth">
	
	<div class="row fullWidthPanel">
    	<div class="col-md-12">
   			<div class="row">    
            	<div class="col-md-4">
					<h:form id="instructorInfoForm">
					<p:growl id="instructorInfoGrowl"></p:growl>
					<p:remoteCommand name="execSearchInstructors" 
								process="inputNameInstructor"
								update="searchInstructorsResultPanel"
								action="#{instructorEditBean.searchInstructors()}"
								/>
		                
                  	<div class="form-group acContainer">
                     	<label>Name</label>
                     	<h:panelGroup id="instructorPanel">
	                     	<h:panelGroup rendered="#{instructorEditBean.instructor.instructorId == 0}">
	                     		<h:inputText 
		                     		styleClass="form-control acField" 
		                     		id="inputNameInstructor" 
		                     		value="#{instructorEditBean.instructorSearchTerm}"
		                     		placeholder="Start typing..."
		                     		onclick="$(this).select();" 
								    onkeyup="showSearchResults();searchInstructorsIfNeeded();">
	                     		</h:inputText>
	                     	</h:panelGroup> 
	                     	<h:panelGroup rendered="#{instructorEditBean.instructor.instructorId > 0}">
	                     		<h:inputText 
		                     		styleClass="form-control acField"           	
		                     		value="#{instructorEditBean.instructor.name}"
		       						disabled='true'>
	                     		</h:inputText>
	                     	</h:panelGroup> 
	                    </h:panelGroup>
								<h:panelGroup layout="block" id="dropdownInstructors" styleClass="acPanel userList dropdown-menu">
						         <h:panelGroup id="searchInstructorsResultPanel">
						         <table width="100%" cellspacing="0" cellpadding="0" border="0">
                                    <tbody>
                                       <ui:repeat var="instructor" value="#{instructorEditBean.instructors}">
                                    	<p:commandLink styleClass="hiddenInstructorLink"
												style="display: none;" 
												pt:data-id="#{instructor.id}"
												action="#{instructorEditBean.selectInstructor(instructor)}"
                                      			update=":instructorInfoForm:instructorPanel"
                                      			oncomplete="$('.acField').val('#{instructor.fullName}'); $('.acPanel').first().stop(true, true).slideUp(10);">
                                      		   
                                      	<tr onclick="$('.hiddenInstructorLink[data-id=&#34;#{instructor.id}&#34;]').trigger('click')">
	                                       <td>
	                                          <div class="userInfo">
	                                             <span class="userProfileImage">
	                                             	<h:graphicImage value="#{instructor.avatarUrl}"
															title="#{instructor.fullName}" alt="#{instructor.fullName}" />
	                                             </span>
	                                             <span class="userProfileName">
	                                                #{instructor.fullName} </span>
	                                          </div>
	                                       </td>
	                                      
	                                       <td class="affiliation">#{instructor.position}	
	                                       </td>
                                       </tr>
                                      </p:commandLink>
                                       		
                                       </ui:repeat>
                                                                                            
                                                                              
                                    </tbody>
                                 </table>

            					
                     	</h:panelGroup>
                     	</h:panelGroup>
                     </div>
                  	<div class="form-group form-inline">
                     	<label>Maximum number of students to assign:</label>
                     	<h:inputText 
                     		id="inputMaxNumberOfStudents"
                     		pt:size="2" 
                     		styleClass="form-control" 
                     		value="#{instructorEditBean.instructor.maxNumberOfStudents}">
                     	</h:inputText>
                  	</div>                                       
		            
		            <h:link
		            	styleClass="btn btn-default panelButton pull-right" 
		            	outcome="/manage/instructorList" 
		            	pt:role="button">
		            		<i class="fa fa-ban red"></i> Cancel
		            		<f:param name="id" value="#{param['courseId']}" />
		            		<f:param name="courseName" value="#{instructorEditBean.courseTitle}" />
		            </h:link> 
		            <p:commandLink
		            	styleClass="btn btn-primary panelButton pull-right"
		            	pt:role="button"
		            	process="instructorPanel inputMaxNumberOfStudents"
		            	action="#{instructorEditBean.saveInstructor()}"
		            	update=":instructorInfoForm :assignStudentsForm :assignedStudentsPanel">
		            	<i class="fa fa-save"></i> Save
		            	<f:param name="page" value="#{facesContext.viewRoot.viewId}" />
            		</p:commandLink>       
            		                
                  	</h:form>


               </div>
            	<div class="col-md-8 ddContainer">
               	<div class="row">
                  <h:panelGroup layout="block" id="assignedStudentsPanel" styleClass="col-md-5">
   	                  <label>Assigned students #{instructorEditBean.new ? '' : ' ('.concat(instructorEditBean.instructor.numberOfAssignedStudents).concat('/').concat(instructorEditBean.instructor.maxNumberOfStudents).concat(')')}</label>
	                     <ul class="ddStudentsList">
	                     	<ui:repeat var="student" value="#{instructorEditBean.assignedStudents}">
	                     		<li>
		                           	<div class="userInfo">
			                           <span class="userProfileImage">
			                             	<h:graphicImage value="#{student.avatarUrl}"
																title="#{student.fullName}" alt="#{student.fullName}" />
			                           </span>
		   	                           <span class="userProfileName">#{student.fullName}</span>
		   	                           	   <p:commandLink
		   	                           	   		action="#{instructorEditBean.unassignStudent(student)}"
		   	                           	   		update=":assignedStudentsPanel :assignStudentsForm:studentSearchResults">
		   	                           	   		<i class="fa fa-close pull-right"></i>
		   	                           	   </p:commandLink>
		                             </div>
                           		</li>
	                     	</ui:repeat>
                               
                        </ul>
                     </h:panelGroup>
                     
                    <h:form id="assignStudentsForm">
                  	<h:panelGroup layout="block" id="panelMoveStudents" 
                  		styleClass="col-md-2 dd">
                     	<h3>Select and click to assign</h3>
                     	<p:commandLink
                     		styleClass="btn btn-default"
                     		process="studentSearchResults"
                     		action="#{instructorEditBean.moveStudentsToAssigned()}"
                     		update=":assignedStudentsPanel :assignStudentsForm:studentSearchResults ">
                     		<i class="fa fa-long-arrow-left"></i>
                     		<f:param name="page" value="#{facesContext.viewRoot.viewId}" />
                     	</p:commandLink>
                     </h:panelGroup>
							<div class="col-md-5">
                        <p:remoteCommand name="execSearchStudents" 
									process="inputNameStudent"
									update=":assignStudentsForm:studentSearchResults"
									action="#{instructorEditBean.searchUnassignedStudents()}"/>

                           <div class="form-group noMargin">
                              <label>Search for student</label>
                              <h:inputText id="inputNameStudent" 
										value="#{instructorEditBean.studentSearchTerm}"
								    	pt:placeholder="Start typing..."
								    	styleClass="form-control"
								    	onclick="$(this).select();" 
								    	onkeydown="searchListener(execSearchStudents);"></h:inputText>
                           </div>
                                           
   	                  <label>Search results</label>
   	                  	<h:panelGroup id="studentSearchResults">
	                     <ul class="ddStudentsList results">
	                     	<ui:repeat var="student" value="#{instructorEditBean.unassignedStudents}">
	                     		<li>
	                     			<div class="selectionBox">
	                     			   <ui:remove> <span class="checkbox checkbox-success checkbox-inline"> </span></ui:remove>
		                     				<h:selectBooleanCheckbox disabled="#{!student.selected and instructorEditBean.isNumberOfAssignedStudentsLimitAchieved()}"
		                     					value="#{student.selected}"
		                     					styleClass="checkbox checkbox-success checkbox-inline">
		                     					<p:ajax event="click" process="@this"
													listener="#{instructorEditBean.studentSelectionListener(student)}" 
													update=":assignStudentsForm:studentSearchResults" />
		                     				</h:selectBooleanCheckbox>
		                     			<ui:remove><span></span></ui:remove> 
                              		</div>
		                           	<div class="userInfo">
			                           <span class="userProfileImage">
			                             	<h:graphicImage value="#{student.avatarUrl}"
																title="#{student.fullName}" alt="#{student.fullName}" />
			                           </span>
		   	                           <span class="userProfileName">#{student.fullName}</span>   
		                             </div>
                           		</li>
	                     	</ui:repeat>                                                                   
                        </ul>
                        </h:panelGroup>
                     </div>
                     </h:form>
                  </div>
               </div>               
				</div>
      </div>
</div>



</section>

</ui:define>
</ui:composition>
