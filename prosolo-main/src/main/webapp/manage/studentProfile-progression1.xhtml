<ui:composition
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util"
	xmlns:icon="http://java.sun.com/jsf/composite/components/resourceLinks/icons"
	xmlns:link="http://java.sun.com/jsf/composite/components/resourceLinks"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">

	<style>
		.slick-slide{
			width: 180px;
		}
	</style>
	
	<div role="tabpanel" id="progression" class="tab-pane fade in active">
		<h:panelGroup layout="block" id="svgContainer">
			<script>
			if (typeof (drawTreePath) == "function"){
				drawTreePath();
			}
			</script>
		</h:panelGroup>
		
		<h2>
			<img src="#{request.contextPath}/resources/images/ico-credentials.svg"
				alt="Credentials" title="Credentials" class="ico40" />
			Credentials
		</h2>

		<div class="blockRow" id="credentials" style="display: none;">
		
			<p:commandLink styleClass="sliderIconLeft"
				update=":svgContainer">
				<i class="fa fa-angle-left"></i>
			</p:commandLink>

			
			<div class="slides">
				<ui:repeat var="cred" value="#{studentProfileBean.credentials}">
				
					<p:commandLink
						styleClass="progressBlock #{cred.id == studentProfileBean.selectedCredential.id ? 'selected' : ''}"
						action="#{studentProfileBean.selectCredential(cred)}"
						update=":competencesBlock :lastObservationPanel :svgContainer"
						onclick="$('#credentials .slides .progressBlock').removeClass('selected');$(this).addClass('selected');"
						oncomplete="hideObservationPanel();">
	
						<div class="progress">
							<div class="progression bgGreen"
								style="height: #{cred.progress}%"></div>
							<div class="progressMask"></div>
							<div class="percentage">#{cred.progress}%</div>
						</div>
						<h3>#{cred.name}</h3>
					</p:commandLink>
				</ui:repeat>
			</div>
			
			
			<p:commandLink styleClass="sliderIconRight"
				update=":svgContainer">
				<i class="fa fa-angle-right"></i>
			</p:commandLink>

			<div class="clearfix"></div>
			
			<script>
			$(function(){
				initCredentialsSlider();
				$('#credentials').fadeIn();
			});
			</script>
		</div>

		<h2>
			<img 
				src="#{request.contextPath}/resources/images/ico-competences.svg"
				alt="Competences" title="Competences" class="ico40" />
			Competences
		</h2>

		<h:panelGroup layout="block" styleClass="blockRow" id="competencesBlock" style="display: none;">
			
			<p:commandLink styleClass="sliderIconLeftCred"
				update=":svgContainer">
				<i class="fa fa-angle-left"></i>
			</p:commandLink>
			
			<div class="slides">
				<ui:repeat var="comp" value="#{studentProfileBean.selectedCredential.competences}">
	
					<h:panelGroup layout="block" id="competencePanel"
						styleClass="progressBlock competence #{comp.id == studentProfileBean.selectedCredential.selectedCompetence.id ? 'selected' : ''}">
						
						<p:commandLink
							onclick="$('#competencesBlock .slides .progressBlock').removeClass('selected');$(this).parent().addClass('selected');"
							action="#{studentProfileBean.selectCompetence(comp)}"
							update=":activitiesBlock :svgContainer">
		
							<div class="trophy #{comp.trophyWon ? 'achieved' : ''}">
								<i class="fa fa-trophy" data-toggle="tooltip"
									data-placement="top"
									title="#{comp.trophyWon ? 'Trophy won' : 'Trophy'}"></i>
							</div>
		
							<div class="progress">
								<div class="progression bgBlue" style="height: #{comp.progress}%"></div>
								<div class="progressMask"></div>
								<div class="percentage">#{comp.progress}%</div>
							</div>
							
							<h3>#{comp.name}</h3>
						</p:commandLink>
						
						<div class="blockBar">
							<div class="assessments">
								Assessments
								<div class="count">
									<span class="good">#{comp.approvedSubmissionNumber}</span>
									<span class="bad">#{comp.rejectedSubmissionNumber}</span>
								</div>
							</div>
	
							<div class="assessmentExpand dropup">
								<p:commandLink
									actionListener="#{studentProfileBean.loadSubmissions(comp)}"
									oncomplete="$('.hiddenAssessmendDropdownToggleLink[data-id=&#34;#{comp.id}&#34;]').dropdown('toggle'); return false;"
									update="assesmentPanel">
									<i class="fa fa-external-link"></i>
								</p:commandLink>
	
								<a class="hiddenAssessmendDropdownToggleLink"
									data-id="#{comp.id}"
									data-target="#"
									data-toggle="dropdown" 
									role="button" 
									aria-haspopup="true"
									aria-expanded="false"></a>
	
								<h:panelGroup layout="block" id="assesmentPanel"
									styleClass="dropdown-menu" pt:aria-labelledby="dLabel">
	
									<div class="ddPanelHeader">
										<h4>Assessments</h4>
										
										<button type="button" class="close" data-dismiss="alert" aria-label="Close">
											<span aria-hidden="true">
												<i class="fa fa-times"></i>
											</span>
										</button>
									</div>
	
									<div class="ddPanelBody">
									
										<ui:repeat value="#{comp.submissions}" var="submission">
											<div class="assessment">
												<div class="userInfo">
													<span class="userProfileImage"> <h:graphicImage
															value="#{submission.evaluator.avatar}"
															title="#{submission.evaluator.name}"
															alt="#{submission.evaluator.name}" />
													</span> <span class="date">#{submission.formattedDate}</span>
													by
	
													<h:link value="#{submission.evaluator.name}" outcome="/publicprofile">
														<f:param name="id" value="#{util:encodeId(submission.evaluator.id)}" />
													</h:link>
	
													<div class="icons">
														<i class="fa fa-check-circle #{submission.accepted ? 'good' : 'bad'}"
															data-toggle="tooltip" data-placement="top"
															title="#{submission.accepted ? 'Passed' : 'Failed'}"></i>
	
														<span class="trophy #{submission.trophyWon ? 'achieved' : ''}">
															<i class="fa fa-trophy" data-toggle="tooltip"
																data-placement="top"
																title="#{submission.trophyWon ? 'Trophy won' : 'Trophy'}"></i>
														</span>
													</div>
	
												</div>
												<p>#{submission.message}</p>
											</div>
										</ui:repeat>
									</div>
								</h:panelGroup>
							</div>
						</div>
					</h:panelGroup>
				</ui:repeat>
			</div>

			<p:commandLink styleClass="sliderIconRightCred"
				update=":svgContainer">
				<i class="fa fa-angle-right"></i>
			</p:commandLink>
			
			<div class="clearfix"></div>
			<script>
			$(function(){
				initCompetenceSlider();
				$('#competencesBlock').fadeIn();
			});
			</script>
		</h:panelGroup>
		

		<h2>
			<img src="#{request.contextPath}/resources/images/ico-activities.svg"
				alt="Activities" title="Activities" class="ico40" />
			Activities
		</h2>

		<h:panelGroup layout="block" class="activities" id="activitiesBlock" style="display: none;">
			<div class="col-md-6">
				<div class="panel-group" id="activities" role="tablist"
					aria-multiselectable="true">

					<ui:repeat var="act" value="#{studentProfileBean.selectedCredential.selectedCompetence.activities}">
					
						<div class="panel panel-default">
							<h:inputHidden value="#{act.id}"></h:inputHidden>
							
							<div class="panel-heading" role="tab" id="headingOne">

								<h4 id="activity#{act.id}" class="panel-title">
									<a class="done collapsed" role="button"
										data-toggle="collapse" data-parent="#activities"
										href="#act#{act.id}" aria-expanded="true"
										aria-controls="act#{act.id}">
										
										<span class="hexagon #{act.completed ? 'done' : ''}"></span>
										#{act.name}
									</a>
								</h4>
							</div>

							<div id="act#{act.id}" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
								<div class="panel-body">
									<p>#{act.description}</p>

									<div class="fileContainer">
										<div class="col-md-10">
											<div class="fileIcon youtube">
												<i class="fa fa-youtube-square"></i>
											</div>
											<h5>
												<a href="">Introduction to Social Network Analysis</a>
											</h5>
											<div class="fileUrl">https://www.youtube.com/ea0ef897e8f18d...</div>
										</div>
										
										<div class="col-md-2 fileSizeTime">12:08</div>
										<div class="clearfix"></div>
									</div>
								</div>
							</div>
						</div>
					</ui:repeat>
				</div>
			</div>
			
			<div class="col-md-6 graph">
				Performance graph
				<div id="quadrantchart">
					<script>
					    var service = "#{studentProfileBean.completedActivitiesServicePath}";
						drawQuadrantChart(service);
					</script>
				</div>
			</div>
			<div class="clearfix"></div>
			
			<script>
			$(function(){
				$('#activitiesBlock').fadeIn();
			});
			</script>
		</h:panelGroup>
	</div>
</ui:composition>