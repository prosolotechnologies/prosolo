<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	template="templates/masterLayout2.xhtml"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:util="http://www.prosolo.com/util"
	xmlns:courses="http://java.sun.com/jsf/composite/components/courses"
	xmlns:utilcomp="http://java.sun.com/jsf/composite/components/util">

	<ui:define name="windowTitle">
		Students
	</ui:define>

	<ui:define name="metadata">
		<f:metadata>
			<f:viewParam name="p" value="#{manageUsersBean.paginationData.pageString}" default="1" />
			<f:viewParam name="role" value="#{manageUsersBean.roleId}" default="null" />
			<f:viewAction action="#{manageUsersBean.init()}" />
		</f:metadata>
	</ui:define>

	<ui:define name="resourceTitle">
		<h1>Students</h1>
	</ui:define>

	<ui:define name="navLinks">
		<ul class="nav nav-tabs headerSubmenu">
			<li role="presentation" class="active"><h:link outcome="/manage/students-students">Students</h:link></li>
			<li role="presentation"><h:link outcome="/manage/students-groups">Groups</h:link></li>
		</ul>
	</ui:define>

	<ui:define name="content">
		<script src="#{request.contextPath}/resources/javascript2/search.js"></script>
		<p:growl id="growlMain" showDetail="true" globalOnly="true" />

		<div class="whiteBar">
			<div class="container">
				<div class="whiteBarContent">
					<div class="whiteBarLeft">
						<div class="searchBox">
							<h:form>
								<p:remoteCommand name="execSearchUsers"
									process="inputUserSearch"
									update=":panelUsers :panelSearchFilters :pagination"
									action="#{manageUsersBean.resetAndSearch()}" />

								<h:inputText id="inputUserSearch" type="search"
									placeholder="Filter by Name"
									value="#{manageUsersBean.searchTerm}"
									onclick="$(this).select();"
									onkeyup="searchListener(execSearchUsers);" />
							</h:form>
						</div>
					</div>
					<div class="whiteBarRight">
						<h:panelGroup layout="block" id="panelSearchFilters"
							styleClass="dropdown showDrop item">
							<span>Show:</span>
							<h:link id="linkSearchFilter" pt:data-toggle="dropdown"
								pt:aria-haspopup="true" pt:aria-expanded="true">
							#{manageUsersBean.filter.label} (#{manageUsersBean.filter.numberOfResults})
							<span class="arrowDown">arrowDown</span>
							</h:link>

							<ul class="dropdown-menu dropdown-menu-right"
								aria-labelledby="dropdownMenu1">
								<ui:repeat var="searchFilter" value="#{manageUsersBean.filters}">
									<li><p:commandLink process="@this"
											value="#{searchFilter.label} (#{searchFilter.numberOfResults})"
											action="#{manageUsersBean.applySearchFilter(searchFilter)}"
											update=":panelUsers :pagination :panelSearchFilters" /></li>
								</ui:repeat>
							</ul>
						</h:panelGroup>
					</div>
				</div>
			</div>
		</div>

		<div class="container">
			<div class="row">
				<h:panelGroup layout="block" id="panelUsers" styleClass="col-md-12">
					<ul class="whiteBox peopleList">
						<ui:repeat var="user" value="#{manageUsersBean.users}">
							<li>
								<div class="peopleListLeft">
									<h:link outcome="/admin/userEdit">
										<utilcomp:userAvatar avatar="#{user.avatarUrl}"
											fullName="#{user.fullName}" width="64" height="64" />
										<f:param name="id" value="#{util:encodeId(user.id)}"></f:param>
									</h:link>

								</div>
								<div class="peopleListRight">
									<div class="userRole">#{user.rolesCSV}</div>
									<div class="userEditOpt">
										<p:commandLink pt:data-toggle="modal"
											action="#{manageUsersBean.initUserGroups(user)}"
											update=":formUserGroups:panelUserGroups"
											oncomplete="$('#addToGroupModal').modal('show');">
				                    	Groups
				                    </p:commandLink>
									</div>
								</div>
							</li>
						</ui:repeat>
					</ul>
				</h:panelGroup>
			</div>

			<utilcomp:pagination id="pagination" 
				bean="#{manageUsersBean}"
				updateUrl="true"
				toUpdate=":panelUsers" />
		</div>

		<h:form id="formUserGroups">
			<div class="modal fade addToGroupModal" id="addToGroupModal"
				tabindex="-1" role="dialog" aria-labelledby="toGroupModal">
				<div class="modal-dialog">
					<h:panelGroup layout="block" id="panelUserGroups" styleClass="modal-content">
						<ui:fragment rendered="#{not empty usersGroupsBean.user}">
							<div class="modal-header alignLeft">
								<button type="button" class="close" data-dismiss="modal" aria-label="Close">
									<span aria-hidden="true">&#215;</span>
								</button>
								<h2 class="modal-title">Add	#{usersGroupsBean.user.fullName} to a Group</h2>
							</div>
							<div class="searchGroups">
								<p:remoteCommand name="execSearchGroups"
									process="inputGroupSearch"
									update=":formUserGroups:panelUserGroups"
									action="#{usersGroupsBean.loadGroups()}" />

								<h:inputText id="inputGroupSearch" type="search"
									placeholder="Filter Groups"
									value="#{usersGroupsBean.searchTerm}"
									onclick="$(this).select();"
									onkeyup="searchListener(execSearchGroups);" />
							</div>
							<ul class="list">
								<ui:repeat var="group" value="#{usersGroupsBean.groups}"
									varStatus="status">
									<li>
										<div class="checkbox checkLine">
											<h:selectBooleanCheckbox id="selectBooleanGroup" value="#{group.userInGroup}">
												<p:ajax event="change" process="@this"
													listener="#{usersGroupsBean.userGroupAssignChecked(status.index)}" />
											</h:selectBooleanCheckbox>
											<h:outputLabel for="selectBooleanGroup" />
										</div>
										<h3>#{group.name} (#{group.userCount})</h3>
									</li>
								</ui:repeat>
							</ul>
							<div class="modal-footer alignLeft">
								<p:commandLink styleClass="btn btn-green"
									action="#{usersGroupsBean.saveUserGroups()}"
									update=":panelUsers :growlMain"
									oncomplete="$('#addToGroupModal').modal('hide');">
									<f:param name="page" value="#{facesContext.viewRoot.viewId}" />
									<f:param name="learningContext" value="name:user_groups_dialog|id:#{usersGroupsBean.user.id}" />
		                       		Done
		                       	</p:commandLink>
							</div>
						</ui:fragment>
					</h:panelGroup>
				</div>
			</div>
		</h:form>

	</ui:define>
</ui:composition>
